/*!
https://github.com/mvasilkov/box2d-html5
*/!function(){{var e,t,o=function(){var e=!1,t=t||{};return t.global=this,t.global.CLOSURE_DEFINES,t.exportPath_=function(e,o,i){var n=e.split("."),s=i||t.global;n[0]in s||!s.execScript||s.execScript("var "+n[0]);for(var r;n.length&&(r=n.shift());)n.length||void 0===o?s=s[r]?s[r]:s[r]={}:s[r]=o},t.define=function(o,i){var n=i;e||t.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(t.global.CLOSURE_DEFINES,o)&&(n=t.global.CLOSURE_DEFINES[o]),t.exportPath_(o,n)},t.DEBUG=!0,t.define("goog.LOCALE","en"),t.define("goog.TRUSTED_SITE",!0),t.provide=function(o){if(!e){if(t.isProvided_(o))throw Error('Namespace "'+o+'" already declared.');delete t.implicitNamespaces_[o];for(var i=o;(i=i.substring(0,i.lastIndexOf(".")))&&!t.getObjectByName(i);)t.implicitNamespaces_[i]=!0}t.exportPath_(o)},t.setTestOnly=function(o){if(e&&!t.DEBUG)throw o=o||"",Error(": "+o)},e||(t.isProvided_=function(e){return!t.implicitNamespaces_[e]&&!!t.getObjectByName(e)},t.implicitNamespaces_={}),t.getObjectByName=function(e,o){for(var i,n=e.split("."),s=o||t.global;i=n.shift();){if(!t.isDefAndNotNull(s[i]))return null;s=s[i]}return s},t.globalize=function(e,o){var i=o||t.global;for(var n in e)i[n]=e[n]},t.addDependency=function(e,o,i){if(t.DEPENDENCIES_ENABLED){for(var n,s,r=e.replace(/\\/g,"/"),a=t.dependencies_,l=0;n=o[l];l++)a.nameToPath[n]=r,r in a.pathToNames||(a.pathToNames[r]={}),a.pathToNames[r][n]=!0;for(var p=0;s=i[p];p++)r in a.requires||(a.requires[r]={}),a.requires[r][s]=!0}},t.define("goog.ENABLE_DEBUG_LOADER",!0),t.require=function(o){if(!e){if(t.isProvided_(o))return;if(t.ENABLE_DEBUG_LOADER){var i=t.getPathFromDeps_(o);if(i)return t.included_[i]=!0,t.writeScripts_(),void 0}var n="goog.require could not find: "+o;throw t.global.console&&t.global.console.error(n),Error(n)}},t.basePath="",t.global.CLOSURE_BASE_PATH,t.global.CLOSURE_NO_DEPS,t.global.CLOSURE_IMPORT_SCRIPT,t.nullFunction=function(){},t.identityFunction=function(e){return e},t.abstractMethod=function(){throw Error("unimplemented abstract method")},t.addSingletonGetter=function(e){e.getInstance=function(){return e.instance_?e.instance_:(t.DEBUG&&(t.instantiatedSingletons_[t.instantiatedSingletons_.length]=e),e.instance_=new e)}},t.instantiatedSingletons_=[],t.DEPENDENCIES_ENABLED=!e&&t.ENABLE_DEBUG_LOADER,t.DEPENDENCIES_ENABLED&&(t.included_={},t.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},t.inHtmlDocument_=function(){var e=t.global.document;return"undefined"!=typeof e&&"write"in e},t.findBasePath_=function(){if(t.global.CLOSURE_BASE_PATH)return t.basePath=t.global.CLOSURE_BASE_PATH,void 0;if(t.inHtmlDocument_())for(var e=t.global.document,o=e.getElementsByTagName("script"),i=o.length-1;i>=0;--i){var n=o[i].src,s=n.lastIndexOf("?"),r=-1==s?n.length:s;if("base.js"==n.substr(r-7,7))return t.basePath=n.substr(0,r-7),void 0}},t.importScript_=function(e){var o=t.global.CLOSURE_IMPORT_SCRIPT||t.writeScriptTag_;!t.dependencies_.written[e]&&o(e)&&(t.dependencies_.written[e]=!0)},t.writeScriptTag_=function(e){if(t.inHtmlDocument_()){var o=t.global.document;if("complete"==o.readyState){var i=/\bdeps.js$/.test(e);if(i)return!1;throw Error('Cannot write "'+e+'" after document load')}return o.write('<script type="text/javascript" src="'+e+'"></script>'),!0}return!1},t.writeScripts_=function(){function e(s){if(!(s in n.written)){if(s in n.visited)return s in i||(i[s]=!0,o.push(s)),void 0;if(n.visited[s]=!0,s in n.requires)for(var r in n.requires[s])if(!t.isProvided_(r)){if(!(r in n.nameToPath))throw Error("Undefined nameToPath for "+r);e(n.nameToPath[r])}s in i||(i[s]=!0,o.push(s))}}var o=[],i={},n=t.dependencies_;for(var s in t.included_)n.written[s]||e(s);for(var r=0;r<o.length;r++){if(!o[r])throw Error("Undefined script input");t.importScript_(t.basePath+o[r])}},t.getPathFromDeps_=function(e){return e in t.dependencies_.nameToPath?t.dependencies_.nameToPath[e]:null},t.findBasePath_(),t.global.CLOSURE_NO_DEPS||t.importScript_(t.basePath+"deps.js")),t.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var o=Object.prototype.toString.call(e);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t},t.isDef=function(e){return void 0!==e},t.isNull=function(e){return null===e},t.isDefAndNotNull=function(e){return null!=e},t.isArray=function(e){return"array"==t.typeOf(e)},t.isArrayLike=function(e){var o=t.typeOf(e);return"array"==o||"object"==o&&"number"==typeof e.length},t.isDateLike=function(e){return t.isObject(e)&&"function"==typeof e.getFullYear},t.isString=function(e){return"string"==typeof e},t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isFunction=function(e){return"function"==t.typeOf(e)},t.isObject=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t},t.getUid=function(e){return e[t.UID_PROPERTY_]||(e[t.UID_PROPERTY_]=++t.uidCounter_)},t.hasUid=function(e){return!!e[t.UID_PROPERTY_]},t.removeUid=function(e){"removeAttribute"in e&&e.removeAttribute(t.UID_PROPERTY_);try{delete e[t.UID_PROPERTY_]}catch(o){}},t.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),t.uidCounter_=0,t.getHashCode=t.getUid,t.removeHashCode=t.removeUid,t.cloneObject=function(e){var o=t.typeOf(e);if("object"==o||"array"==o){if(e.clone)return e.clone();var i="array"==o?[]:{};for(var n in e)i[n]=t.cloneObject(e[n]);return i}return e},t.bindNative_=function(e){return e.call.apply(e.bind,arguments)},t.bindJs_=function(e,t){if(!e)throw new Error;if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,o),e.apply(t,i)}}return function(){return e.apply(t,arguments)}},t.bind=function(){return t.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?t.bindNative_:t.bindJs_,t.bind.apply(null,arguments)},t.partial=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var o=t.slice();return o.push.apply(o,arguments),e.apply(this,o)}},t.mixin=function(e,t){for(var o in t)e[o]=t[o]},t.now=t.TRUSTED_SITE&&Date.now||function(){return+new Date},t.globalEval=function(e){if(t.global.execScript)t.global.execScript(e,"JavaScript");else{if(!t.global.eval)throw Error("goog.globalEval not available");if(null==t.evalWorksForGlobals_&&(t.global.eval("var _et_ = 1;"),"undefined"!=typeof t.global._et_?(delete t.global._et_,t.evalWorksForGlobals_=!0):t.evalWorksForGlobals_=!1),t.evalWorksForGlobals_)t.global.eval(e);else{var o=t.global.document,i=o.createElement("script");i.type="text/javascript",i.defer=!1,i.appendChild(o.createTextNode(e)),o.body.appendChild(i),o.body.removeChild(i)}}},t.evalWorksForGlobals_=null,t.cssNameMapping_,t.cssNameMappingStyle_,t.getCssName=function(e,o){var i,n=function(e){return t.cssNameMapping_[e]||e},s=function(e){for(var t=e.split("-"),o=[],i=0;i<t.length;i++)o.push(n(t[i]));return o.join("-")};return i=t.cssNameMapping_?"BY_WHOLE"==t.cssNameMappingStyle_?n:s:function(e){return e},o?e+"-"+i(o):i(e)},t.setCssNameMapping=function(e,o){t.cssNameMapping_=e,t.cssNameMappingStyle_=o},t.global.CLOSURE_CSS_NAME_MAPPING,!e&&t.global.CLOSURE_CSS_NAME_MAPPING&&(t.cssNameMapping_=t.global.CLOSURE_CSS_NAME_MAPPING),t.getMsg=function(e,t){var o=t||{};for(var i in o){var n=(""+o[i]).replace(/\$/g,"$$$$");e=e.replace(new RegExp("\\{\\$"+i+"\\}","gi"),n)}return e},t.getMsgWithFallback=function(e){return e},t.exportSymbol=function(e,o,i){t.exportPath_(e,o,i)},t.exportProperty=function(e,t,o){e[t]=o},t.inherits=function(e,t){function o(){}o.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new o,e.prototype.constructor=e},t.base=function(e,o){var i=arguments.callee.caller;if(t.DEBUG&&!i)throw Error("arguments.caller not defined.  goog.base() expects not to be running in strict mode. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(i.superClass_)return i.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var n=Array.prototype.slice.call(arguments,2),s=!1,r=e.constructor;r;r=r.superClass_&&r.superClass_.constructor)if(r.prototype[o]===i)s=!0;else if(s)return r.prototype[o].apply(e,n);if(e[o]===i)return e.constructor.prototype[o].apply(e,n);throw Error("goog.base called from a method of one name to a method of a different name")},t.scope=function(e){e.call(t.global)},t}(),i=function(t){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Settings&&(e.b2Settings={}),Object.defineProperty||(Object.defineProperty=function(e,t,o){Object.__defineGetter__&&("get"in o?e.__defineGetter__(t,o.get):"value"in o&&e.__defineGetter__(t,o.value)),Object.__defineSetter__&&("set"in o?e.__defineSetter__(t,o.set):"value"in o&&e.__defineSetter__(t,o.value))}),e.DEBUG=!0,e.ENABLE_ASSERTS=e.DEBUG,e.b2Assert=function(t){e.DEBUG},e.b2_maxFloat=1e37,e.b2_epsilon=1e-5,e.b2_epsilon_sq=e.b2_epsilon*e.b2_epsilon,e.b2_pi=Math.PI,e.b2_maxManifoldPoints=2,e.b2_maxPolygonVertices=8,e.b2_aabbExtension=.1,e.b2_aabbMultiplier=2,e.b2_linearSlop=.008,e.b2_angularSlop=2/180*e.b2_pi,e.b2_polygonRadius=2*e.b2_linearSlop,e.b2_maxSubSteps=8,e.b2_maxTOIContacts=32,e.b2_velocityThreshold=1,e.b2_maxLinearCorrection=.2,e.b2_maxAngularCorrection=8/180*e.b2_pi,e.b2_maxTranslation=2,e.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,e.b2_maxRotation=.5*e.b2_pi,e.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,e.b2_baumgarte=.2,e.b2_toiBaumgarte=.75,e.b2_timeToSleep=.5,e.b2_linearSleepTolerance=.01,e.b2_angularSleepTolerance=2/180*e.b2_pi,e.b2Alloc=function(){return null},e.b2Free=function(){},e.b2Log=function(){t.global.console.log.apply(null,arguments)},e.b2Version=function(e,t,o){this.major=e||0,this.minor=t||0,this.revision=o||0},e.b2Version.prototype.major=0,e.b2Version.prototype.minor=0,e.b2Version.prototype.revision=0,e.b2Version.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},e.b2_version=new e.b2Version(2,3,0),e.b2_changelist=278,e.b2ParseInt=function(e){return parseInt(e,10)},e.b2ParseUInt=function(t){return e.b2Abs(parseInt(t,10))},e.b2MakeArray=function(e,t){void 0===e&&(e=0);var o=new Array(e);if(void 0!==t)for(var i=0;e>i;++i)o[i]=t(i);return o},e.b2MakeNumberArray=function(t){return e.b2MakeArray(t,function(){return 0})},e}(o),n=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Math&&(t.b2Math={}),t.b2_pi_over_180=t.b2_pi/180,t.b2_180_over_pi=180/t.b2_pi,t.b2_two_pi=2*t.b2_pi,t.b2Abs=function(e){return 0>e?-e:e},t.b2Min=function(e,t){return t>e?e:t},t.b2Max=function(e,t){return e>t?e:t},t.b2Clamp=function(e,t,o){return t>e?t:e>o?o:e},t.b2Swap=function(e,o){t.ENABLE_ASSERTS&&t.b2Assert(!1);var i=e[0];e[0]=o[0],o[0]=i},t.b2IsValid=function(e){return isFinite(e)},t.b2Sq=function(e){return e*e},t.b2InvSqrt=function(e){return 1/Math.sqrt(e)},t.b2Sqrt=function(e){return Math.sqrt(e)},t.b2Pow=function(e,t){return Math.pow(e,t)},t.b2DegToRad=function(e){return e*t.b2_pi_over_180},t.b2RadToDeg=function(e){return e*t.b2_180_over_pi},t.b2Cos=function(e){return Math.cos(e)},t.b2Sin=function(e){return Math.sin(e)},t.b2Acos=function(e){return Math.acos(e)},t.b2Asin=function(e){return Math.asin(e)},t.b2Atan2=function(e,t){return Math.atan2(e,t)},t.b2NextPowerOfTwo=function(e){return e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},t.b2IsPowerOfTwo=function(e){return e>0&&0==(e&e-1)},t.b2Random=function(){return 2*Math.random()-1},t.b2RandomRange=function(e,t){return(t-e)*Math.random()+e},t.b2Vec2=function(e,t){this.x=e||0,this.y=t||0},t.b2Vec2.prototype.x=0,t.b2Vec2.prototype.y=0,t.b2Vec2_zero=new t.b2Vec2,t.b2Vec2.ZERO=new t.b2Vec2,t.b2Vec2.UNITX=new t.b2Vec2(1,0),t.b2Vec2.UNITY=new t.b2Vec2(0,1),t.b2Vec2.s_t0=new t.b2Vec2,t.b2Vec2.s_t1=new t.b2Vec2,t.b2Vec2.s_t2=new t.b2Vec2,t.b2Vec2.s_t3=new t.b2Vec2,t.b2Vec2.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2Vec2})},t.b2Vec2.prototype.Clone=function(){return new t.b2Vec2(this.x,this.y)},t.b2Vec2.prototype.SetZero=function(){return this.x=0,this.y=0,this},t.b2Vec2.prototype.Set=function(e,t){return this.x=e,this.y=t,this},t.b2Vec2.prototype.Copy=function(e){return this.x=e.x,this.y=e.y,this},t.b2Vec2.prototype.SelfAdd=function(e){return this.x+=e.x,this.y+=e.y,this},t.b2Vec2.prototype.SelfAddXY=function(e,t){return this.x+=e,this.y+=t,this},t.b2Vec2.prototype.SelfSub=function(e){return this.x-=e.x,this.y-=e.y,this},t.b2Vec2.prototype.SelfSubXY=function(e,t){return this.x-=e,this.y-=t,this},t.b2Vec2.prototype.SelfMul=function(e){return this.x*=e,this.y*=e,this},t.b2Vec2.prototype.SelfMulAdd=function(e,t){return this.x+=e*t.x,this.y+=e*t.y,this},t.b2Vec2.prototype.SelfMulSub=function(e,t){return this.x-=e*t.x,this.y-=e*t.y,this},t.b2Vec2.prototype.Dot=function(e){return this.x*e.x+this.y*e.y},t.b2Vec2.prototype.Cross=function(e){return this.x*e.y-this.y*e.x},t.b2Vec2.prototype.Length=function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)},t.b2Vec2.prototype.GetLength=t.b2Vec2.prototype.Length,t.b2Vec2.prototype.LengthSquared=function(){var e=this.x,t=this.y;return e*e+t*t},t.b2Vec2.prototype.GetLengthSquared=t.b2Vec2.prototype.LengthSquared,t.b2Vec2.prototype.Normalize=function(){var e=this.GetLength();if(e>=t.b2_epsilon){var o=1/e;this.x*=o,this.y*=o}return e},t.b2Vec2.prototype.SelfNormalize=function(){var e=this.GetLength();if(e>=t.b2_epsilon){var o=1/e;this.x*=o,this.y*=o}return this},t.b2Vec2.prototype.SelfRotate=function(e,t){var o=this.x,i=this.y;return this.x=e*o-t*i,this.y=t*o+e*i,this},t.b2Vec2.prototype.SelfRotateRadians=function(e){return this.SelfRotate(Math.cos(e),Math.sin(e))},t.b2Vec2.prototype.SelfRotateDegrees=function(e){return this.SelfRotateRadians(t.b2DegToRad(e))},t.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},t.b2Vec2.prototype.SelfCrossVS=function(e){var t=this.x;return this.x=e*this.y,this.y=-e*t,this},t.b2Vec2.prototype.SelfCrossSV=function(e){var t=this.x;return this.x=-e*this.y,this.y=e*t,this},t.b2Vec2.prototype.SelfMinV=function(e){return this.x=t.b2Min(this.x,e.x),this.y=t.b2Min(this.y,e.y),this},t.b2Vec2.prototype.SelfMaxV=function(e){return this.x=t.b2Max(this.x,e.x),this.y=t.b2Max(this.y,e.y),this},t.b2Vec2.prototype.SelfAbs=function(){return this.x=t.b2Abs(this.x),this.y=t.b2Abs(this.y),this},t.b2Vec2.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},t.b2Vec2.prototype.SelfSkew=function(){var e=this.x;return this.x=-this.y,this.y=e,this},t.b2AbsV=function(e,o){return o.x=t.b2Abs(e.x),o.y=t.b2Abs(e.y),o},t.b2MinV=function(e,o,i){return i.x=t.b2Min(e.x,o.x),i.y=t.b2Min(e.y,o.y),i},t.b2MaxV=function(e,o,i){return i.x=t.b2Max(e.x,o.x),i.y=t.b2Max(e.y,o.y),i},t.b2ClampV=function(e,o,i,n){return n.x=t.b2Clamp(e.x,o.x,i.x),n.y=t.b2Clamp(e.y,o.y,i.y),n},t.b2RotateV=function(e,t,o,i){var n=e.x,s=e.y;return i.x=t*n-o*s,i.y=o*n+t*s,i},t.b2RotateRadiansV=function(e,o,i){return t.b2RotateV(e,Math.cos(o),Math.sin(o),i)},t.b2RotateDegreesV=function(e,o,i){return t.b2RotateRadiansV(e,t.b2DegToRad(o),i)},t.b2DotVV=function(e,t){return e.x*t.x+e.y*t.y},t.b2CrossVV=function(e,t){return e.x*t.y-e.y*t.x},t.b2CrossVS=function(e,t,o){var i=e.x;return o.x=t*e.y,o.y=-t*i,o},t.b2CrossVOne=function(e,t){var o=e.x;return t.x=e.y,t.y=-o,t},t.b2CrossSV=function(e,t,o){var i=t.x;return o.x=-e*t.y,o.y=e*i,o},t.b2CrossOneV=function(e,t){var o=e.x;return t.x=-e.y,t.y=o,t},t.b2AddVV=function(e,t,o){return o.x=e.x+t.x,o.y=e.y+t.y,o},t.b2SubVV=function(e,t,o){return o.x=e.x-t.x,o.y=e.y-t.y,o},t.b2MulSV=function(e,t,o){return o.x=t.x*e,o.y=t.y*e,o},t.b2AddVMulSV=function(e,t,o,i){return i.x=e.x+t*o.x,i.y=e.y+t*o.y,i},t.b2SubVMulSV=function(e,t,o,i){return i.x=e.x-t*o.x,i.y=e.y-t*o.y,i},t.b2AddVCrossSV=function(e,t,o,i){var n=o.x;return i.x=e.x-t*o.y,i.y=e.y+t*n,i},t.b2MidVV=function(e,t,o){return o.x=.5*(e.x+t.x),o.y=.5*(e.y+t.y),o},t.b2ExtVV=function(e,t,o){return o.x=.5*(t.x-e.x),o.y=.5*(t.y-e.y),o},t.b2IsEqualToV=function(e,t){return e.x==t.x&&e.y==t.y},t.b2DistanceVV=function(e,t){var o=e.x-t.x,i=e.y-t.y;return Math.sqrt(o*o+i*i)},t.b2DistanceSquaredVV=function(e,t){var o=e.x-t.x,i=e.y-t.y;return o*o+i*i},t.b2NegV=function(e,t){return t.x=-e.x,t.y=-e.y,t},t.b2Vec3=function(e,t,o){this.x=e||0,this.y=t||0,this.z=o||0},t.b2Vec3.prototype.x=0,t.b2Vec3.prototype.y=0,t.b2Vec3.prototype.z=0,t.b2Vec3.ZERO=new t.b2Vec3,t.b2Vec3.s_t0=new t.b2Vec3,t.b2Vec3.prototype.Clone=function(){return new t.b2Vec3(this.x,this.y,this.z)},t.b2Vec3.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},t.b2Vec3.prototype.Set=function(e,t,o){return this.x=e,this.y=t,this.z=o,this},t.b2Vec3.prototype.Copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},t.b2Vec3.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.b2Vec3.prototype.SelfAdd=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},t.b2Vec3.prototype.SelfAddXYZ=function(e,t,o){return this.x+=e,this.y+=t,this.z+=o,this},t.b2Vec3.prototype.SelfSub=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},t.b2Vec3.prototype.SelfSubXYZ=function(e,t,o){return this.x-=e,this.y-=t,this.z-=o,this},t.b2Vec3.prototype.SelfMul=function(e){return this.x*=e,this.y*=e,this.z*=e,this},t.b2DotV3V3=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.b2CrossV3V3=function(e,t,o){var i=e.x,n=e.y,s=e.z,r=t.x,a=t.y,l=t.z;return o.x=n*l-s*a,o.y=s*r-i*l,o.z=i*a-n*r,o},t.b2Mat22=function(){this.ex=new t.b2Vec2(1,0),this.ey=new t.b2Vec2(0,1)},t.b2Mat22.prototype.ex=null,t.b2Mat22.prototype.ey=null,t.b2Mat22.IDENTITY=new t.b2Mat22,t.b2Mat22.prototype.Clone=function(){return(new t.b2Mat22).Copy(this)},t.b2Mat22.FromVV=function(e,o){return(new t.b2Mat22).SetVV(e,o)},t.b2Mat22.FromSSSS=function(e,o,i,n){return(new t.b2Mat22).SetSSSS(e,o,i,n)},t.b2Mat22.FromAngleRadians=function(e){return(new t.b2Mat22).SetAngleRadians(e)},t.b2Mat22.prototype.SetSSSS=function(e,t,o,i){return this.ex.Set(e,o),this.ey.Set(t,i),this},t.b2Mat22.prototype.SetVV=function(e,t){return this.ex.Copy(e),this.ey.Copy(t),this},t.b2Mat22.prototype.SetAngle=function(e){var t=Math.cos(e),o=Math.sin(e);return this.ex.Set(t,o),this.ey.Set(-o,t),this},t.b2Mat22.prototype.SetAngleRadians=t.b2Mat22.prototype.SetAngle,t.b2Mat22.prototype.SetAngleDegrees=function(e){return this.SetAngle(t.b2DegToRad(e))},t.b2Mat22.prototype.Copy=function(e){return this.ex.Copy(e.ex),this.ey.Copy(e.ey),this},t.b2Mat22.prototype.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},t.b2Mat22.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},t.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},t.b2Mat22.prototype.GetAngleRadians=t.b2Mat22.prototype.GetAngle,t.b2Mat22.prototype.GetInverse=function(e){var t=this.ex.x,o=this.ey.x,i=this.ex.y,n=this.ey.y,s=t*n-o*i;return 0!=s&&(s=1/s),e.ex.x=s*n,e.ey.x=-s*o,e.ex.y=-s*i,e.ey.y=s*t,e},t.b2Mat22.prototype.Solve=function(e,t,o){var i=this.ex.x,n=this.ey.x,s=this.ex.y,r=this.ey.y,a=i*r-n*s;return 0!=a&&(a=1/a),o.x=a*(r*e-n*t),o.y=a*(i*t-s*e),o},t.b2Mat22.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},t.b2Mat22.prototype.SelfInv=function(){return this.GetInverse(this)},t.b2Mat22.prototype.SelfAddM=function(e){return this.ex.SelfAdd(e.ex),this.ey.SelfAdd(e.ey),this},t.b2Mat22.prototype.SelfSubM=function(e){return this.ex.SelfSub(e.ex),this.ey.SelfSub(e.ey),this},t.b2AbsM=function(e,o){var i=e.ex,n=e.ey;return o.ex.x=t.b2Abs(i.x),o.ex.y=t.b2Abs(i.y),o.ey.x=t.b2Abs(n.x),o.ey.y=t.b2Abs(n.y),o},t.b2MulMV=function(e,t,o){var i=e.ex,n=e.ey,s=t.x,r=t.y;return o.x=i.x*s+n.x*r,o.y=i.y*s+n.y*r,o},t.b2MulTMV=function(e,t,o){var i=e.ex,n=e.ey,s=t.x,r=t.y;return o.x=i.x*s+i.y*r,o.y=n.x*s+n.y*r,o},t.b2AddMM=function(e,t,o){var i=e.ex,n=e.ey,s=t.ex,r=t.ey;return o.ex.x=i.x+s.x,o.ex.y=i.y+s.y,o.ey.x=n.x+r.x,o.ey.y=n.y+r.y,o},t.b2MulMM=function(e,t,o){var i=e.ex.x,n=e.ex.y,s=e.ey.x,r=e.ey.y,a=t.ex.x,l=t.ex.y,p=t.ey.x,b=t.ey.y;return o.ex.x=i*a+s*l,o.ex.y=n*a+r*l,o.ey.x=i*p+s*b,o.ey.y=n*p+r*b,o},t.b2MulTMM=function(e,t,o){var i=e.ex.x,n=e.ex.y,s=e.ey.x,r=e.ey.y,a=t.ex.x,l=t.ex.y,p=t.ey.x,b=t.ey.y;return o.ex.x=i*a+n*l,o.ex.y=s*a+r*l,o.ey.x=i*p+n*b,o.ey.y=s*p+r*b,o},t.b2Mat33=function(){this.ex=new t.b2Vec3(1,0,0),this.ey=new t.b2Vec3(0,1,0),this.ez=new t.b2Vec3(0,0,1)},t.b2Mat33.prototype.ex=null,t.b2Mat33.prototype.ey=null,t.b2Mat33.prototype.ez=null,t.b2Mat33.IDENTITY=new t.b2Mat33,t.b2Mat33.prototype.Clone=function(){return(new t.b2Mat33).Copy(this)},t.b2Mat33.prototype.SetVVV=function(e,t,o){return this.ex.Copy(e),this.ey.Copy(t),this.ez.Copy(o),this},t.b2Mat33.prototype.Copy=function(e){return this.ex.Copy(e.ex),this.ey.Copy(e.ey),this.ez.Copy(e.ez),this},t.b2Mat33.prototype.SetIdentity=function(){return this.ex.Set(1,0,0),this.ey.Set(0,1,0),this.ez.Set(0,0,1),this},t.b2Mat33.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},t.b2Mat33.prototype.SelfAddM=function(e){return this.ex.SelfAdd(e.ex),this.ey.SelfAdd(e.ey),this.ez.SelfAdd(e.ez),this},t.b2Mat33.prototype.Solve33=function(e,t,o,i){var n=this.ex.x,s=this.ex.y,r=this.ex.z,a=this.ey.x,l=this.ey.y,p=this.ey.z,b=this.ez.x,m=this.ez.y,_=this.ez.z,d=n*(l*_-p*m)+s*(p*b-a*_)+r*(a*m-l*b);return 0!=d&&(d=1/d),i.x=d*(e*(l*_-p*m)+t*(p*b-a*_)+o*(a*m-l*b)),i.y=d*(n*(t*_-o*m)+s*(o*b-e*_)+r*(e*m-t*b)),i.z=d*(n*(l*o-p*t)+s*(p*e-a*o)+r*(a*t-l*e)),i},t.b2Mat33.prototype.Solve22=function(e,t,o){var i=this.ex.x,n=this.ey.x,s=this.ex.y,r=this.ey.y,a=i*r-n*s;return 0!=a&&(a=1/a),o.x=a*(r*e-n*t),o.y=a*(i*t-s*e),o},t.b2Mat33.prototype.GetInverse22=function(e){var t=this.ex.x,o=this.ey.x,i=this.ex.y,n=this.ey.y,s=t*n-o*i;0!=s&&(s=1/s),e.ex.x=s*n,e.ey.x=-s*o,e.ex.z=0,e.ex.y=-s*i,e.ey.y=s*t,e.ey.z=0,e.ez.x=0,e.ez.y=0,e.ez.z=0},t.b2Mat33.prototype.GetSymInverse33=function(e){var o=t.b2DotV3V3(this.ex,t.b2CrossV3V3(this.ey,this.ez,t.b2Vec3.s_t0));0!=o&&(o=1/o);var i=this.ex.x,n=this.ey.x,s=this.ez.x,r=this.ey.y,a=this.ez.y,l=this.ez.z;e.ex.x=o*(r*l-a*a),e.ex.y=o*(s*a-n*l),e.ex.z=o*(n*a-s*r),e.ey.x=e.ex.y,e.ey.y=o*(i*l-s*s),e.ey.z=o*(s*n-i*a),e.ez.x=e.ex.z,e.ez.y=e.ey.z,e.ez.z=o*(i*r-n*n)},t.b2MulM33V3=function(e,t,o){var i=t.x,n=t.y,s=t.z;return o.x=e.ex.x*i+e.ey.x*n+e.ez.x*s,o.y=e.ex.y*i+e.ey.y*n+e.ez.y*s,o.z=e.ex.z*i+e.ey.z*n+e.ez.z*s,o},t.b2MulM33XYZ=function(e,t,o,i,n){return n.x=e.ex.x*t+e.ey.x*o+e.ez.x*i,n.y=e.ex.y*t+e.ey.y*o+e.ez.y*i,n.z=e.ex.z*t+e.ey.z*o+e.ez.z*i,n},t.b2MulM33V2=function(e,t,o){var i=t.x,n=t.y;return o.x=e.ex.x*i+e.ey.x*n,o.y=e.ex.y*i+e.ey.y*n,o},t.b2MulM33XY=function(e,t,o,i){return i.x=e.ex.x*t+e.ey.x*o,i.y=e.ex.y*t+e.ey.y*o,i},t.b2Rot=function(e){e&&(this.angle=e,this.s=Math.sin(e),this.c=Math.cos(e))},t.b2Rot.prototype.angle=0,t.b2Rot.prototype.s=0,t.b2Rot.prototype.c=1,t.b2Rot.IDENTITY=new t.b2Rot,t.b2Rot.prototype.Clone=function(){return(new t.b2Rot).Copy(this)},t.b2Rot.prototype.Copy=function(e){return this.angle=e.angle,this.s=e.s,this.c=e.c,this},t.b2Rot.prototype.SetAngle=function(e){return this.angle!=e&&(this.angle=e,this.s=Math.sin(e),this.c=Math.cos(e)),this},t.b2Rot.prototype.SetAngleRadians=t.b2Rot.prototype.SetAngle,t.b2Rot.prototype.SetAngleDegrees=function(e){return this.SetAngle(t.b2DegToRad(e))},t.b2Rot.prototype.SetIdentity=function(){return this.angle=0,this.s=0,this.c=1,this},t.b2Rot.prototype.GetAngle=function(){return this.angle},t.b2Rot.prototype.GetAngleRadians=t.b2Rot.prototype.GetAngle,t.b2Rot.prototype.GetAngleDegrees=function(){return t.b2RadToDeg(this.GetAngle())},t.b2Rot.prototype.GetXAxis=function(e){return e.x=this.c,e.y=this.s,e},t.b2Rot.prototype.GetYAxis=function(e){return e.x=-this.s,e.y=this.c,e},t.b2MulRR=function(e,o,i){var n=e.c,s=e.s,r=o.c,a=o.s;for(i.s=s*r+n*a,i.c=n*r-s*a,i.angle=e.angle+o.angle;i.angle<-t.b2_pi;)i.angle+=t.b2_two_pi;for(;i.angle>=t.b2_pi;)i.angle-=t.b2_two_pi;return i},t.b2MulTRR=function(e,o,i){var n=e.c,s=e.s,r=o.c,a=o.s;for(i.s=n*a-s*r,i.c=n*r+s*a,i.angle=e.angle-o.angle;i.angle<-t.b2_pi;)i.angle+=t.b2_two_pi;for(;i.angle>=t.b2_pi;)i.angle-=t.b2_two_pi;return i},t.b2MulRV=function(e,t,o){var i=e.c,n=e.s,s=t.x,r=t.y;return o.x=i*s-n*r,o.y=n*s+i*r,o},t.b2MulTRV=function(e,t,o){var i=e.c,n=e.s,s=t.x,r=t.y;return o.x=i*s+n*r,o.y=-n*s+i*r,o},t.b2Transform=function(){this.p=new t.b2Vec2,this.q=new t.b2Rot},t.b2Transform.prototype.p=null,t.b2Transform.prototype.q=null,t.b2Transform.IDENTITY=new t.b2Transform,t.b2Transform.prototype.Clone=function(){return(new t.b2Transform).Copy(this)},t.b2Transform.prototype.Copy=function(e){return this.p.Copy(e.p),this.q.Copy(e.q),this},t.b2Transform.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},t.b2Transform.prototype.SetPositionRotation=function(e,t){return this.p.Copy(e),this.q.Copy(t),this},t.b2Transform.prototype.SetPositionAngleRadians=function(e,t){return this.p.Copy(e),this.q.SetAngleRadians(t),this},t.b2Transform.prototype.SetPosition=function(e){return this.p.Copy(e),this},t.b2Transform.prototype.SetPositionXY=function(e,t){return this.p.Set(e,t),this},t.b2Transform.prototype.SetRotation=function(e){return this.q.Copy(e),this},t.b2Transform.prototype.SetRotationAngleRadians=function(e){return this.q.SetAngleRadians(e),this},t.b2Transform.prototype.GetPosition=function(){return this.p},t.b2Transform.prototype.GetRotation=function(){return this.q},t.b2Transform.prototype.GetRotationAngle=function(){return this.q.GetAngle()},t.b2Transform.prototype.GetRotationAngleRadians=t.b2Transform.prototype.GetRotationAngle,t.b2Transform.prototype.GetAngle=function(){return this.q.GetAngle()},t.b2Transform.prototype.GetAngleRadians=t.b2Transform.prototype.GetAngle,t.b2MulXV=function(e,t,o){var i=e.q.c,n=e.q.s,s=t.x,r=t.y;return o.x=i*s-n*r+e.p.x,o.y=n*s+i*r+e.p.y,o},t.b2MulTXV=function(e,t,o){var i=e.q.c,n=e.q.s,s=t.x-e.p.x,r=t.y-e.p.y;return o.x=i*s+n*r,o.y=-n*s+i*r,o},t.b2MulXX=function(e,o,i){return t.b2MulRR(e.q,o.q,i.q),t.b2AddVV(t.b2MulRV(e.q,o.p,i.p),e.p,i.p),i},t.b2MulTXX=function(e,o,i){return t.b2MulTRR(e.q,o.q,i.q),t.b2MulTRV(e.q,t.b2SubVV(o.p,e.p,i.p),i.p),i},t.b2Sweep=function(){this.localCenter=new t.b2Vec2,this.c0=new t.b2Vec2,this.c=new t.b2Vec2},t.b2Sweep.prototype.localCenter=null,t.b2Sweep.prototype.c0=null,t.b2Sweep.prototype.c=null,t.b2Sweep.prototype.a0=0,t.b2Sweep.prototype.a=0,t.b2Sweep.prototype.alpha0=0,t.b2Sweep.prototype.Clone=function(){return(new t.b2Sweep).Copy(this)},t.b2Sweep.prototype.Copy=function(e){return this.localCenter.Copy(e.localCenter),this.c0.Copy(e.c0),this.c.Copy(e.c),this.a0=e.a0,this.a=e.a,this.alpha0=e.alpha0,this},t.b2Sweep.prototype.GetTransform=function(e,o){var i=1-o;e.p.x=i*this.c0.x+o*this.c.x,e.p.y=i*this.c0.y+o*this.c.y;var n=i*this.a0+o*this.a;return e.q.SetAngleRadians(n),e.p.SelfSub(t.b2MulRV(e.q,this.localCenter,t.b2Vec2.s_t0)),e},t.b2Sweep.prototype.Advance=function(e){t.ENABLE_ASSERTS&&t.b2Assert(this.alpha0<1);var o=(e-this.alpha0)/(1-this.alpha0);this.c0.x+=o*(this.c.x-this.c0.x),this.c0.y+=o*(this.c.y-this.c0.y),this.a0+=o*(this.a-this.a0),this.alpha0=e},t.b2Sweep.prototype.Normalize=function(){var e=t.b2_two_pi*Math.floor(this.a0/t.b2_two_pi);this.a0-=e,this.a-=e},t}(o,i),s=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Joint&&(t.b2Joint={}),t.b2JointType={e_unknownJoint:0,e_revoluteJoint:1,e_prismaticJoint:2,e_distanceJoint:3,e_pulleyJoint:4,e_mouseJoint:5,e_gearJoint:6,e_wheelJoint:7,e_weldJoint:8,e_frictionJoint:9,e_ropeJoint:10,e_motorJoint:11,e_areaJoint:12},e.exportProperty(t.b2JointType,"e_unknownJoint",t.b2JointType.e_unknownJoint),e.exportProperty(t.b2JointType,"e_revoluteJoint",t.b2JointType.e_revoluteJoint),e.exportProperty(t.b2JointType,"e_prismaticJoint",t.b2JointType.e_prismaticJoint),e.exportProperty(t.b2JointType,"e_distanceJoint",t.b2JointType.e_distanceJoint),e.exportProperty(t.b2JointType,"e_pulleyJoint",t.b2JointType.e_pulleyJoint),e.exportProperty(t.b2JointType,"e_mouseJoint",t.b2JointType.e_mouseJoint),e.exportProperty(t.b2JointType,"e_gearJoint",t.b2JointType.e_gearJoint),e.exportProperty(t.b2JointType,"e_wheelJoint",t.b2JointType.e_wheelJoint),e.exportProperty(t.b2JointType,"e_weldJoint",t.b2JointType.e_weldJoint),e.exportProperty(t.b2JointType,"e_frictionJoint",t.b2JointType.e_frictionJoint),e.exportProperty(t.b2JointType,"e_ropeJoint",t.b2JointType.e_ropeJoint),e.exportProperty(t.b2JointType,"e_motorJoint",t.b2JointType.e_motorJoint),e.exportProperty(t.b2JointType,"e_areaJoint",t.b2JointType.e_areaJoint),t.b2LimitState={e_inactiveLimit:0,e_atLowerLimit:1,e_atUpperLimit:2,e_equalLimits:3},e.exportProperty(t.b2LimitState,"e_inactiveLimit",t.b2LimitState.e_inactiveLimit),e.exportProperty(t.b2LimitState,"e_atLowerLimit",t.b2LimitState.e_atLowerLimit),e.exportProperty(t.b2LimitState,"e_atUpperLimit",t.b2LimitState.e_atUpperLimit),e.exportProperty(t.b2LimitState,"e_equalLimits",t.b2LimitState.e_equalLimits),t.b2Jacobian=function(){this.linear=new t.b2Vec2},t.b2Jacobian.prototype.linear=null,t.b2Jacobian.prototype.angularA=0,t.b2Jacobian.prototype.angularB=0,t.b2Jacobian.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},t.b2Jacobian.prototype.Set=function(e,t,o){return this.linear.Copy(e),this.angularA=t,this.angularB=o,this},t.b2JointEdge=function(){},t.b2JointEdge.prototype.other=null,t.b2JointEdge.prototype.joint=null,t.b2JointEdge.prototype.prev=null,t.b2JointEdge.prototype.next=null,t.b2JointDef=function(e){this.type=e},t.b2JointDef.prototype.type=t.b2JointType.e_unknownJoint,t.b2JointDef.prototype.userData=null,t.b2JointDef.prototype.bodyA=null,t.b2JointDef.prototype.bodyB=null,t.b2JointDef.prototype.collideConnected=!1,t.b2Joint=function(e){t.ENABLE_ASSERTS&&t.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_edgeA=new t.b2JointEdge,this.m_edgeB=new t.b2JointEdge,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_userData=e.userData},t.b2Joint.prototype.m_type=t.b2JointType.e_unknownJoint,t.b2Joint.prototype.m_prev=null,t.b2Joint.prototype.m_next=null,t.b2Joint.prototype.m_edgeA=null,t.b2Joint.prototype.m_edgeB=null,t.b2Joint.prototype.m_bodyA=null,t.b2Joint.prototype.m_bodyB=null,t.b2Joint.prototype.m_index=0,t.b2Joint.prototype.m_islandFlag=!1,t.b2Joint.prototype.m_collideConnected=!1,t.b2Joint.prototype.m_userData=null,t.b2Joint.prototype.GetAnchorA=function(e){return e.SetZero()},t.b2Joint.prototype.GetAnchorB=function(e){return e.SetZero()},t.b2Joint.prototype.GetReactionForce=function(e,t){return t.SetZero()},t.b2Joint.prototype.GetReactionTorque=function(){return 0},t.b2Joint.prototype.InitVelocityConstraints=function(){},t.b2Joint.prototype.SolveVelocityConstraints=function(){},t.b2Joint.prototype.SolvePositionConstraints=function(){return!1},t.b2Joint.prototype.GetType=function(){return this.m_type},t.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},t.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},t.b2Joint.prototype.GetNext=function(){return this.m_next},t.b2Joint.prototype.GetUserData=function(){return this.m_userData},t.b2Joint.prototype.SetUserData=function(e){this.m_userData=e},t.b2Joint.prototype.GetCollideConnected=function(){return this.m_collideConnected},t.b2Joint.prototype.Dump=function(){t.DEBUG&&t.b2Log("// Dump is not supported for this joint type.\n")},t.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},t.b2Joint.prototype.ShiftOrigin=function(){},t}(o,n,i),r=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2AreaJoint&&(t.b2AreaJoint={}),t.b2AreaJointDef=function(){e.base(this,t.b2JointType.e_areaJoint),this.bodies=new Array
},e.inherits(t.b2AreaJointDef,t.b2JointDef),t.b2AreaJointDef.prototype.world=null,t.b2AreaJointDef.prototype.bodies=null,t.b2AreaJointDef.prototype.frequencyHz=0,t.b2AreaJointDef.prototype.dampingRatio=0,t.b2AreaJointDef.prototype.AddBody=function(e){this.bodies.push(e),1==this.bodies.length?this.bodyA=e:2==this.bodies.length&&(this.bodyB=e)},t.b2AreaJoint=function(o){e.base(this,o),t.ENABLE_ASSERTS&&t.b2Assert(o.bodies.length>=3,"You cannot create an area joint with less than three bodies."),this.m_bodies=o.bodies,this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_targetLengths=t.b2MakeNumberArray(o.bodies.length),this.m_normals=t.b2Vec2.MakeArray(o.bodies.length),this.m_joints=new Array(o.bodies.length),this.m_deltas=t.b2Vec2.MakeArray(o.bodies.length),this.m_delta=new t.b2Vec2;var i=new t.b2DistanceJointDef;i.frequencyHz=o.frequencyHz,i.dampingRatio=o.dampingRatio,this.m_targetArea=0;for(var n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],a=this.m_bodies[(n+1)%s],l=r.GetWorldCenter(),p=a.GetWorldCenter();this.m_targetLengths[n]=t.b2DistanceVV(l,p),this.m_targetArea+=t.b2CrossVV(l,p),i.Initialize(r,a,l,p),this.m_joints[n]=o.world.CreateJoint(i)}this.m_targetArea*=.5},e.inherits(t.b2AreaJoint,t.b2Joint),t.b2AreaJoint.prototype.m_bodies=null,t.b2AreaJoint.prototype.m_frequencyHz=0,t.b2AreaJoint.prototype.m_dampingRatio=0,t.b2AreaJoint.prototype.m_impulse=0,t.b2AreaJoint.prototype.m_targetLengths=null,t.b2AreaJoint.prototype.m_targetArea=0,t.b2AreaJoint.prototype.m_normals=null,t.b2AreaJoint.prototype.m_joints=null,t.b2AreaJoint.prototype.m_deltas=null,t.b2AreaJoint.prototype.m_delta=null,t.b2AreaJoint.prototype.GetAnchorA=function(e){return e.SetZero()},t.b2AreaJoint.prototype.GetAnchorB=function(e){return e.SetZero()},t.b2AreaJoint.prototype.GetReactionForce=function(e,t){return t.SetZero()},t.b2AreaJoint.prototype.GetReactionTorque=function(){return 0},t.b2AreaJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e;for(var t=0,o=this.m_joints.length;o>t;++t)this.m_joints[t].SetFrequency(e)},t.b2AreaJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},t.b2AreaJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e;for(var t=0,o=this.m_joints.length;o>t;++t)this.m_joints[t].SetDampingRatio(e)},t.b2AreaJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},t.b2AreaJoint.prototype.Dump=function(){t.DEBUG&&t.b2Log("Area joint dumping is not supported.\n")},t.b2AreaJoint.prototype.InitVelocityConstraints=function(e){for(var o=0,i=this.m_bodies.length;i>o;++o){var n=this.m_bodies[(o+i-1)%i],s=this.m_bodies[(o+1)%i],r=e.positions[n.m_islandIndex].c,a=e.positions[s.m_islandIndex].c,l=this.m_deltas[o];t.b2SubVV(a,r,l)}if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio;for(var o=0,i=this.m_bodies.length;i>o;++o){var p=this.m_bodies[o],b=e.velocities[p.m_islandIndex].v,l=this.m_deltas[o];b.x+=p.m_invMass*l.y*.5*this.m_impulse,b.y+=p.m_invMass*-l.x*.5*this.m_impulse}}else this.m_impulse=0},t.b2AreaJoint.prototype.SolveVelocityConstraints=function(e){for(var o=0,i=0,n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],a=e.velocities[r.m_islandIndex].v,l=this.m_deltas[n];o+=l.GetLengthSquared()/r.GetMass(),i+=t.b2CrossVV(a,l)}var p=-2*i/o;this.m_impulse+=p;for(var n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],a=e.velocities[r.m_islandIndex].v,l=this.m_deltas[n];a.x+=r.m_invMass*l.y*.5*p,a.y+=r.m_invMass*-l.x*.5*p}},t.b2AreaJoint.prototype.SolvePositionConstraints=function(e){for(var o=0,i=0,n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],a=this.m_bodies[(n+1)%s],l=e.positions[r.m_islandIndex].c,p=e.positions[a.m_islandIndex].c,b=t.b2SubVV(p,l,this.m_delta),m=b.GetLength();m<t.b2_epsilon&&(m=1),this.m_normals[n].x=b.y/m,this.m_normals[n].y=-b.x/m,o+=m,i+=t.b2CrossVV(l,p)}i*=.5;for(var _=this.m_targetArea-i,d=.5*_/o,h=!0,n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],l=e.positions[r.m_islandIndex].c,c=(n+1)%s,b=t.b2AddVV(this.m_normals[n],this.m_normals[c],this.m_delta);b.SelfMul(d);var u=b.GetLengthSquared();u>t.b2Sq(t.b2_maxLinearCorrection)&&b.SelfMul(t.b2_maxLinearCorrection/t.b2Sqrt(u)),u>t.b2Sq(t.b2_linearSlop)&&(h=!1),l.x+=b.x,l.y+=b.y}return h},t}(o,s,n,i),a=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Distance&&(t.b2Distance={}),t.b2DistanceProxy=function(){this.m_buffer=t.b2Vec2.MakeArray(2)},t.b2DistanceProxy.prototype.m_buffer=null,t.b2DistanceProxy.prototype.m_vertices=null,t.b2DistanceProxy.prototype.m_count=0,t.b2DistanceProxy.prototype.m_radius=0,t.b2DistanceProxy.prototype.Reset=function(){return this.m_vertices=null,this.m_count=0,this.m_radius=0,this},t.b2DistanceProxy.prototype.SetShape=function(e,t){e.SetupDistanceProxy(this,t)},t.b2DistanceProxy.prototype.GetSupport=function(e){for(var o=0,i=t.b2DotVV(this.m_vertices[0],e),n=1;n<this.m_count;++n){var s=t.b2DotVV(this.m_vertices[n],e);s>i&&(o=n,i=s)}return o},t.b2DistanceProxy.prototype.GetSupportVertex=function(e,o){for(var i=0,n=t.b2DotVV(this.m_vertices[0],e),s=1;s<this.m_count;++s){var r=t.b2DotVV(this.m_vertices[s],e);r>n&&(i=s,n=r)}return o.Copy(this.m_vertices[i])},t.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},t.b2DistanceProxy.prototype.GetVertex=function(e){return t.ENABLE_ASSERTS&&t.b2Assert(e>=0&&e<this.m_count),this.m_vertices[e]},t.b2SimplexCache=function(){this.indexA=t.b2MakeNumberArray(3),this.indexB=t.b2MakeNumberArray(3)},t.b2SimplexCache.prototype.metric=0,t.b2SimplexCache.prototype.count=0,t.b2SimplexCache.prototype.indexA=null,t.b2SimplexCache.prototype.indexB=null,t.b2SimplexCache.prototype.Reset=function(){return this.metric=0,this.count=0,this},t.b2DistanceInput=function(){this.proxyA=new t.b2DistanceProxy,this.proxyB=new t.b2DistanceProxy,this.transformA=new t.b2Transform,this.transformB=new t.b2Transform},t.b2DistanceInput.prototype.proxyA=null,t.b2DistanceInput.prototype.proxyB=null,t.b2DistanceInput.prototype.transformA=null,t.b2DistanceInput.prototype.transformB=null,t.b2DistanceInput.prototype.useRadii=!1,t.b2DistanceInput.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},t.b2DistanceOutput=function(){this.pointA=new t.b2Vec2,this.pointB=new t.b2Vec2},t.b2DistanceOutput.prototype.pointA=null,t.b2DistanceOutput.prototype.pointB=null,t.b2DistanceOutput.prototype.distance=0,t.b2DistanceOutput.prototype.iterations=0,t.b2DistanceOutput.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0,t.b2SimplexVertex=function(){this.wA=new t.b2Vec2,this.wB=new t.b2Vec2,this.w=new t.b2Vec2},t.b2SimplexVertex.prototype.wA=null,t.b2SimplexVertex.prototype.wB=null,t.b2SimplexVertex.prototype.w=null,t.b2SimplexVertex.prototype.a=0,t.b2SimplexVertex.prototype.indexA=0,t.b2SimplexVertex.prototype.indexB=0,t.b2SimplexVertex.prototype.Copy=function(e){return this.wA.Copy(e.wA),this.wB.Copy(e.wB),this.w.Copy(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB,this},t.b2Simplex=function(){this.m_v1=new t.b2SimplexVertex,this.m_v2=new t.b2SimplexVertex,this.m_v3=new t.b2SimplexVertex,this.m_vertices=new Array(3),this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},t.b2Simplex.prototype.m_v1=null,t.b2Simplex.prototype.m_v2=null,t.b2Simplex.prototype.m_v3=null,t.b2Simplex.prototype.m_vertices=null,t.b2Simplex.prototype.m_count=0,t.b2Simplex.prototype.ReadCache=function(e,o,i,n,s){t.ENABLE_ASSERTS&&t.b2Assert(0<=e.count&&e.count<=3),this.m_count=e.count;for(var r=this.m_vertices,a=0;a<this.m_count;++a){var l=r[a];l.indexA=e.indexA[a],l.indexB=e.indexB[a];var p=o.GetVertex(l.indexA),b=n.GetVertex(l.indexB);t.b2MulXV(i,p,l.wA),t.b2MulXV(s,b,l.wB),t.b2SubVV(l.wB,l.wA,l.w),l.a=0}if(this.m_count>1){var m=e.metric,_=this.GetMetric();(.5*m>_||_>2*m||_<t.b2_epsilon)&&(this.m_count=0)}if(0==this.m_count){var l=r[0];l.indexA=0,l.indexB=0;var p=o.GetVertex(0),b=n.GetVertex(0);t.b2MulXV(i,p,l.wA),t.b2MulXV(s,b,l.wB),t.b2SubVV(l.wB,l.wA,l.w),l.a=1,this.m_count=1}},t.b2Simplex.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=this.m_count;for(var t=this.m_vertices,o=0;o<this.m_count;++o)e.indexA[o]=t[o].indexA,e.indexB[o]=t[o].indexB},t.b2Simplex.prototype.GetSearchDirection=function(e){switch(this.m_count){case 1:return t.b2NegV(this.m_v1.w,e);case 2:var o=t.b2SubVV(this.m_v2.w,this.m_v1.w,e),i=t.b2CrossVV(o,t.b2NegV(this.m_v1.w,t.b2Vec2.s_t0));return i>0?t.b2CrossOneV(o,e):t.b2CrossVOne(o,e);default:return t.ENABLE_ASSERTS&&t.b2Assert(!1),e.SetZero()}},t.b2Simplex.prototype.GetClosestPoint=function(e){switch(this.m_count){case 0:return t.ENABLE_ASSERTS&&t.b2Assert(!1),e.SetZero();case 1:return e.Copy(this.m_v1.w);case 2:return e.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return e.SetZero();default:return t.ENABLE_ASSERTS&&t.b2Assert(!1),e.SetZero()}},t.b2Simplex.prototype.GetWitnessPoints=function(e,o){switch(this.m_count){case 0:t.ENABLE_ASSERTS&&t.b2Assert(!1);break;case 1:e.Copy(this.m_v1.wA),o.Copy(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,o.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,o.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:o.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,o.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:t.ENABLE_ASSERTS&&t.b2Assert(!1)}},t.b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return t.ENABLE_ASSERTS&&t.b2Assert(!1),0;case 1:return 0;case 2:return t.b2DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return t.b2CrossVV(t.b2SubVV(this.m_v2.w,this.m_v1.w,t.b2Vec2.s_t0),t.b2SubVV(this.m_v3.w,this.m_v1.w,t.b2Vec2.s_t1));default:return t.ENABLE_ASSERTS&&t.b2Assert(!1),0}},t.b2Simplex.prototype.Solve2=function(){var e=this.m_v1.w,o=this.m_v2.w,i=t.b2SubVV(o,e,t.b2Simplex.s_e12),n=-t.b2DotVV(e,i);if(0>=n)return this.m_v1.a=1,this.m_count=1,void 0;var s=t.b2DotVV(o,i);if(0>=s)return this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2),void 0;var r=1/(s+n);this.m_v1.a=s*r,this.m_v2.a=n*r,this.m_count=2},t.b2Simplex.prototype.Solve3=function(){var e=this.m_v1.w,o=this.m_v2.w,i=this.m_v3.w,n=t.b2SubVV(o,e,t.b2Simplex.s_e12),s=t.b2DotVV(e,n),r=t.b2DotVV(o,n),a=r,l=-s,p=t.b2SubVV(i,e,t.b2Simplex.s_e13),b=t.b2DotVV(e,p),m=t.b2DotVV(i,p),_=m,d=-b,h=t.b2SubVV(i,o,t.b2Simplex.s_e23),c=t.b2DotVV(o,h),u=t.b2DotVV(i,h),y=u,f=-c,S=t.b2CrossVV(n,p),C=S*t.b2CrossVV(o,i),v=S*t.b2CrossVV(i,e),A=S*t.b2CrossVV(e,o);if(0>=l&&0>=d)return this.m_v1.a=1,this.m_count=1,void 0;if(a>0&&l>0&&0>=A){var g=1/(a+l);return this.m_v1.a=a*g,this.m_v2.a=l*g,this.m_count=2,void 0}if(_>0&&d>0&&0>=v){var w=1/(_+d);return this.m_v1.a=_*w,this.m_v3.a=d*w,this.m_count=2,this.m_v2.Copy(this.m_v3),void 0}if(0>=a&&0>=f)return this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2),void 0;if(0>=_&&0>=y)return this.m_v3.a=1,this.m_count=1,this.m_v1.Copy(this.m_v3),void 0;if(y>0&&f>0&&0>=C){var x=1/(y+f);return this.m_v2.a=y*x,this.m_v3.a=f*x,this.m_count=2,this.m_v1.Copy(this.m_v3),void 0}var B=1/(C+v+A);this.m_v1.a=C*B,this.m_v2.a=v*B,this.m_v3.a=A*B,this.m_count=3},t.b2Simplex.s_e12=new t.b2Vec2,t.b2Simplex.s_e13=new t.b2Vec2,t.b2Simplex.s_e23=new t.b2Vec2,t.b2Distance=function(e,o,i){++t.b2_gjkCalls;var n=i.proxyA,s=i.proxyB,r=i.transformA,a=i.transformB,l=t.b2Distance.s_simplex;l.ReadCache(o,n,r,s,a);for(var p=l.m_vertices,b=20,m=t.b2Distance.s_saveA,_=t.b2Distance.s_saveB,d=0,h=t.b2_maxFloat,c=h,u=0;b>u;){d=l.m_count;for(var y=0;d>y;++y)m[y]=p[y].indexA,_[y]=p[y].indexB;switch(l.m_count){case 1:break;case 2:l.Solve2();break;case 3:l.Solve3();break;default:t.ENABLE_ASSERTS&&t.b2Assert(!1)}if(3==l.m_count)break;var f=l.GetClosestPoint(t.b2Distance.s_p);c=f.GetLengthSquared(),h=c;var S=l.GetSearchDirection(t.b2Distance.s_d);if(S.GetLengthSquared()<t.b2_epsilon_sq)break;var C=p[l.m_count];C.indexA=n.GetSupport(t.b2MulTRV(r.q,t.b2NegV(S,t.b2Vec2.s_t0),t.b2Distance.s_supportA)),t.b2MulXV(r,n.GetVertex(C.indexA),C.wA),C.indexB=s.GetSupport(t.b2MulTRV(a.q,S,t.b2Distance.s_supportB)),t.b2MulXV(a,s.GetVertex(C.indexB),C.wB),t.b2SubVV(C.wB,C.wA,C.w),++u,++t.b2_gjkIters;for(var v=!1,y=0;d>y;++y)if(C.indexA==m[y]&&C.indexB==_[y]){v=!0;break}if(v)break;++l.m_count}if(t.b2_gjkMaxIters=t.b2Max(t.b2_gjkMaxIters,u),l.GetWitnessPoints(e.pointA,e.pointB),e.distance=t.b2DistanceVV(e.pointA,e.pointB),e.iterations=u,l.WriteCache(o),i.useRadii){var A=n.m_radius,g=s.m_radius;if(e.distance>A+g&&e.distance>t.b2_epsilon){e.distance-=A+g;var w=t.b2SubVV(e.pointB,e.pointA,t.b2Distance.s_normal);w.Normalize(),e.pointA.SelfMulAdd(A,w),e.pointB.SelfMulSub(g,w)}else{var f=t.b2MidVV(e.pointA,e.pointB,t.b2Distance.s_p);e.pointA.Copy(f),e.pointB.Copy(f),e.distance=0}}},t.b2Distance.s_simplex=new t.b2Simplex,t.b2Distance.s_saveA=t.b2MakeNumberArray(3),t.b2Distance.s_saveB=t.b2MakeNumberArray(3),t.b2Distance.s_p=new t.b2Vec2,t.b2Distance.s_d=new t.b2Vec2,t.b2Distance.s_normal=new t.b2Vec2,t.b2Distance.s_supportA=new t.b2Vec2,t.b2Distance.s_supportB=new t.b2Vec2,t}(o,n,i),l=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Collision&&(t.b2Collision={}),t.b2ContactFeatureType={e_vertex:0,e_face:1},e.exportProperty(t.b2ContactFeatureType,"e_vertex",t.b2ContactFeatureType.e_vertex),e.exportProperty(t.b2ContactFeatureType,"e_face",t.b2ContactFeatureType.e_face),t.b2ContactFeature=function(e){this._id=e},t.b2ContactFeature.prototype._id=null,t.b2ContactFeature.prototype._indexA=0,t.b2ContactFeature.prototype._indexB=0,t.b2ContactFeature.prototype._typeA=0,t.b2ContactFeature.prototype._typeB=0,Object.defineProperty(t.b2ContactFeature.prototype,"indexA",{enumerable:!1,configurable:!0,get:function(){return this._indexA},set:function(e){this._indexA=e,this._id._key=4294967040&this._id._key|255&this._indexA}}),Object.defineProperty(t.b2ContactFeature.prototype,"indexB",{enumerable:!1,configurable:!0,get:function(){return this._indexB},set:function(e){this._indexB=e,this._id._key=4294902015&this._id._key|this._indexB<<8&65280}}),Object.defineProperty(t.b2ContactFeature.prototype,"typeA",{enumerable:!1,configurable:!0,get:function(){return this._typeA},set:function(e){this._typeA=e,this._id._key=4278255615&this._id._key|this._typeA<<16&16711680}}),Object.defineProperty(t.b2ContactFeature.prototype,"typeB",{enumerable:!1,configurable:!0,get:function(){return this._typeB},set:function(e){this._typeB=e,this._id._key=16777215&this._id._key|this._typeB<<24&4278190080}}),t.b2ContactID=function(){this.cf=new t.b2ContactFeature(this)},t.b2ContactID.prototype.cf=null,t.b2ContactID.prototype.key=0,t.b2ContactID.prototype.Copy=function(e){return this.key=e.key,this},t.b2ContactID.prototype.Clone=function(){return(new t.b2ContactID).Copy(this)},Object.defineProperty(t.b2ContactID.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key},set:function(e){this._key=e,this.cf._indexA=255&this._key,this.cf._indexB=this._key>>8&255,this.cf._typeA=this._key>>16&255,this.cf._typeB=this._key>>24&255}}),t.b2ManifoldPoint=function(){this.localPoint=new t.b2Vec2,this.id=new t.b2ContactID},t.b2ManifoldPoint.prototype.localPoint=null,t.b2ManifoldPoint.prototype.normalImpulse=0,t.b2ManifoldPoint.prototype.tangentImpulse=0,t.b2ManifoldPoint.prototype.id=null,t.b2ManifoldPoint.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2ManifoldPoint})},t.b2ManifoldPoint.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},t.b2ManifoldPoint.prototype.Copy=function(e){return this.localPoint.Copy(e.localPoint),this.normalImpulse=e.normalImpulse,this.tangentImpulse=e.tangentImpulse,this.id.Copy(e.id),this},t.b2ManifoldType={e_unknown:-1,e_circles:0,e_faceA:1,e_faceB:2},e.exportProperty(t.b2ManifoldType,"e_unknown",t.b2ManifoldType.e_unknown),e.exportProperty(t.b2ManifoldType,"e_circles",t.b2ManifoldType.e_circles),e.exportProperty(t.b2ManifoldType,"e_faceA",t.b2ManifoldType.e_faceA),e.exportProperty(t.b2ManifoldType,"e_faceB",t.b2ManifoldType.e_faceB),t.b2Manifold=function(){this.points=t.b2ManifoldPoint.MakeArray(t.b2_maxManifoldPoints),this.localNormal=new t.b2Vec2,this.localPoint=new t.b2Vec2,this.type=t.b2ManifoldType.e_unknown,this.pointCount=0},t.b2Manifold.prototype.points=null,t.b2Manifold.prototype.localNormal=null,t.b2Manifold.prototype.localPoint=null,t.b2Manifold.prototype.type=t.b2ManifoldType.e_unknown,t.b2Manifold.prototype.pointCount=0,t.b2Manifold.prototype.Reset=function(){for(var e=0,o=t.b2_maxManifoldPoints;o>e;++e)this.points[e].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=t.b2ManifoldType.e_unknown,this.pointCount=0},t.b2Manifold.prototype.Copy=function(e){this.pointCount=e.pointCount;for(var o=0,i=t.b2_maxManifoldPoints;i>o;++o)this.points[o].Copy(e.points[o]);return this.localNormal.Copy(e.localNormal),this.localPoint.Copy(e.localPoint),this.type=e.type,this},t.b2Manifold.prototype.Clone=function(){return(new t.b2Manifold).Copy(this)},t.b2WorldManifold=function(){this.normal=new t.b2Vec2,this.points=t.b2Vec2.MakeArray(t.b2_maxManifoldPoints),this.separations=t.b2MakeNumberArray(t.b2_maxManifoldPoints)},t.b2WorldManifold.prototype.normal=null,t.b2WorldManifold.prototype.points=null,t.b2WorldManifold.prototype.separations=null,t.b2WorldManifold.prototype.Initialize=function(e,o,i,n,s){if(0!=e.pointCount)switch(e.type){case t.b2ManifoldType.e_circles:this.normal.Set(1,0);var r=t.b2MulXV(o,e.localPoint,t.b2WorldManifold.prototype.Initialize.s_pointA),a=t.b2MulXV(n,e.points[0].localPoint,t.b2WorldManifold.prototype.Initialize.s_pointB);t.b2DistanceSquaredVV(r,a)>t.b2_epsilon_sq&&t.b2SubVV(a,r,this.normal).SelfNormalize();var l=t.b2AddVMulSV(r,i,this.normal,t.b2WorldManifold.prototype.Initialize.s_cA),p=t.b2SubVMulSV(a,s,this.normal,t.b2WorldManifold.prototype.Initialize.s_cB);t.b2MidVV(l,p,this.points[0]),this.separations[0]=t.b2DotVV(t.b2SubVV(p,l,t.b2Vec2.s_t0),this.normal);break;case t.b2ManifoldType.e_faceA:t.b2MulRV(o.q,e.localNormal,this.normal);for(var b=t.b2MulXV(o,e.localPoint,t.b2WorldManifold.prototype.Initialize.s_planePoint),m=0,_=e.pointCount;_>m;++m){var d=t.b2MulXV(n,e.points[m].localPoint,t.b2WorldManifold.prototype.Initialize.s_clipPoint),h=i-t.b2DotVV(t.b2SubVV(d,b,t.b2Vec2.s_t0),this.normal),l=t.b2AddVMulSV(d,h,this.normal,t.b2WorldManifold.prototype.Initialize.s_cA),p=t.b2SubVMulSV(d,s,this.normal,t.b2WorldManifold.prototype.Initialize.s_cB);t.b2MidVV(l,p,this.points[m]),this.separations[m]=t.b2DotVV(t.b2SubVV(p,l,t.b2Vec2.s_t0),this.normal)}break;case t.b2ManifoldType.e_faceB:t.b2MulRV(n.q,e.localNormal,this.normal);for(var b=t.b2MulXV(n,e.localPoint,t.b2WorldManifold.prototype.Initialize.s_planePoint),m=0,_=e.pointCount;_>m;++m){var d=t.b2MulXV(o,e.points[m].localPoint,t.b2WorldManifold.prototype.Initialize.s_clipPoint),h=s-t.b2DotVV(t.b2SubVV(d,b,t.b2Vec2.s_t0),this.normal),p=t.b2AddVMulSV(d,h,this.normal,t.b2WorldManifold.prototype.Initialize.s_cB),l=t.b2SubVMulSV(d,i,this.normal,t.b2WorldManifold.prototype.Initialize.s_cA);t.b2MidVV(l,p,this.points[m]),this.separations[m]=t.b2DotVV(t.b2SubVV(l,p,t.b2Vec2.s_t0),this.normal)}this.normal.SelfNeg()}},t.b2WorldManifold.prototype.Initialize.s_pointA=new t.b2Vec2,t.b2WorldManifold.prototype.Initialize.s_pointB=new t.b2Vec2,t.b2WorldManifold.prototype.Initialize.s_cA=new t.b2Vec2,t.b2WorldManifold.prototype.Initialize.s_cB=new t.b2Vec2,t.b2WorldManifold.prototype.Initialize.s_planePoint=new t.b2Vec2,t.b2WorldManifold.prototype.Initialize.s_clipPoint=new t.b2Vec2,t.b2PointState={b2_nullState:0,b2_addState:1,b2_persistState:2,b2_removeState:3},e.exportProperty(t.b2PointState,"b2_nullState   ",t.b2PointState.b2_nullState),e.exportProperty(t.b2PointState,"b2_addState    ",t.b2PointState.b2_addState),e.exportProperty(t.b2PointState,"b2_persistState",t.b2PointState.b2_persistState),e.exportProperty(t.b2PointState,"b2_removeState ",t.b2PointState.b2_removeState),t.b2GetPointStates=function(e,o,i,n){for(var s=0,r=i.pointCount;r>s;++s){var a=i.points[s].id,l=a.key;e[s]=t.b2PointState.b2_removeState;for(var p=0,b=n.pointCount;b>p;++p)if(n.points[p].id.key==l){e[s]=t.b2PointState.b2_persistState;break}}for(var r=t.b2_maxManifoldPoints;r>s;++s)e[s]=t.b2PointState.b2_nullState;for(var s=0,r=n.pointCount;r>s;++s){var a=n.points[s].id,l=a.key;o[s]=t.b2PointState.b2_addState;for(var p=0,b=i.pointCount;b>p;++p)if(i.points[p].id.key==l){o[s]=t.b2PointState.b2_persistState;break}}for(var r=t.b2_maxManifoldPoints;r>s;++s)o[s]=t.b2PointState.b2_nullState},t.b2ClipVertex=function(){this.v=new t.b2Vec2,this.id=new t.b2ContactID},t.b2ClipVertex.prototype.v=null,t.b2ClipVertex.prototype.id=null,t.b2ClipVertex.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2ClipVertex})},t.b2ClipVertex.prototype.Copy=function(e){return this.v.Copy(e.v),this.id.Copy(e.id),this},t.b2RayCastInput=function(){this.p1=new t.b2Vec2,this.p2=new t.b2Vec2,this.maxFraction=1},t.b2RayCastInput.prototype.p1=null,t.b2RayCastInput.prototype.p2=null,t.b2RayCastInput.prototype.maxFraction=1,t.b2RayCastInput.prototype.Copy=function(e){return this.p1.Copy(e.p1),this.p2.Copy(e.p2),this.maxFraction=e.maxFraction,this},t.b2RayCastOutput=function(){this.normal=new t.b2Vec2,this.fraction=0},t.b2RayCastOutput.prototype.normal=null,t.b2RayCastOutput.prototype.fraction=0,t.b2RayCastOutput.prototype.Copy=function(e){return this.normal.Copy(e.normal),this.fraction=e.fraction,this},t.b2AABB=function(){this.lowerBound=new t.b2Vec2,this.upperBound=new t.b2Vec2,this.m_out_center=new t.b2Vec2,this.m_out_extent=new t.b2Vec2},t.b2AABB.prototype.lowerBound=null,t.b2AABB.prototype.upperBound=null,t.b2AABB.prototype.m_out_center=null,t.b2AABB.prototype.m_out_extent=null,t.b2AABB.prototype.Copy=function(e){return this.lowerBound.Copy(e.lowerBound),this.upperBound.Copy(e.upperBound),this},t.b2AABB.prototype.IsValid=function(){var e=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y,o=e>=0&&t>=0;return o=o&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},t.b2AABB.prototype.GetCenter=function(){return t.b2MidVV(this.lowerBound,this.upperBound,this.m_out_center)},t.b2AABB.prototype.GetExtents=function(){return t.b2ExtVV(this.lowerBound,this.upperBound,this.m_out_extent)},t.b2AABB.prototype.GetPerimeter=function(){var e=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y;return 2*(e+t)},t.b2AABB.prototype.Combine1=function(e){return this.lowerBound.x=t.b2Min(this.lowerBound.x,e.lowerBound.x),this.lowerBound.y=t.b2Min(this.lowerBound.y,e.lowerBound.y),this.upperBound.x=t.b2Max(this.upperBound.x,e.upperBound.x),this.upperBound.y=t.b2Max(this.upperBound.y,e.upperBound.y),this},t.b2AABB.prototype.Combine2=function(e,o){return this.lowerBound.x=t.b2Min(e.lowerBound.x,o.lowerBound.x),this.lowerBound.y=t.b2Min(e.lowerBound.y,o.lowerBound.y),this.upperBound.x=t.b2Max(e.upperBound.x,o.upperBound.x),this.upperBound.y=t.b2Max(e.upperBound.y,o.upperBound.y),this},t.b2AABB.Combine=function(e,t,o){return o.Combine2(e,t),o},t.b2AABB.prototype.Contains=function(e){var t=!0;return t=t&&this.lowerBound.x<=e.lowerBound.x,t=t&&this.lowerBound.y<=e.lowerBound.y,t=t&&e.upperBound.x<=this.upperBound.x,t=t&&e.upperBound.y<=this.upperBound.y},t.b2AABB.prototype.RayCast=function(e,o){var i=-t.b2_maxFloat,n=t.b2_maxFloat,s=o.p1.x,r=o.p1.y,a=o.p2.x-o.p1.x,l=o.p2.y-o.p1.y,p=t.b2Abs(a),b=t.b2Abs(l),m=e.normal;if(p<t.b2_epsilon){if(s<this.lowerBound.x||this.upperBound.x<s)return!1}else{var _=1/a,d=(this.lowerBound.x-s)*_,h=(this.upperBound.x-s)*_,c=-1;if(d>h){var u=d;d=h,h=u,c=1}if(d>i&&(m.x=c,m.y=0,i=d),n=t.b2Min(n,h),i>n)return!1}if(b<t.b2_epsilon){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else{var _=1/l,d=(this.lowerBound.y-r)*_,h=(this.upperBound.y-r)*_,c=-1;if(d>h){var u=d;d=h,h=u,c=1}if(d>i&&(m.x=0,m.y=c,i=d),n=t.b2Min(n,h),i>n)return!1}return 0>i||o.maxFraction<i?!1:(e.fraction=i,!0)},t.b2AABB.prototype.TestOverlap=function(e){var t=e.lowerBound.x-this.upperBound.x,o=e.lowerBound.y-this.upperBound.y,i=this.lowerBound.x-e.upperBound.x,n=this.lowerBound.y-e.upperBound.y;return t>0||o>0?!1:i>0||n>0?!1:!0},t.b2TestOverlapAABB=function(e,t){var o=t.lowerBound.x-e.upperBound.x,i=t.lowerBound.y-e.upperBound.y,n=e.lowerBound.x-t.upperBound.x,s=e.lowerBound.y-t.upperBound.y;return o>0||i>0?!1:n>0||s>0?!1:!0},t.b2ClipSegmentToLine=function(e,o,i,n,s){var r=0,a=o[0],l=o[1],p=t.b2DotVV(i,a.v)-n,b=t.b2DotVV(i,l.v)-n;if(0>=p&&e[r++].Copy(a),0>=b&&e[r++].Copy(l),0>p*b){var m=p/(p-b),_=e[r].v;_.x=a.v.x+m*(l.v.x-a.v.x),_.y=a.v.y+m*(l.v.y-a.v.y);var d=e[r].id;d.cf.indexA=s,d.cf.indexB=a.id.cf.indexB,d.cf.typeA=t.b2ContactFeatureType.e_vertex,d.cf.typeB=t.b2ContactFeatureType.e_face,++r}return r},t.b2TestOverlapShape=function(e,o,i,n,s,r){var a=t.b2TestOverlapShape.s_input.Reset();a.proxyA.SetShape(e,o),a.proxyB.SetShape(i,n),a.transformA.Copy(s),a.transformB.Copy(r),a.useRadii=!0;var l=t.b2TestOverlapShape.s_simplexCache.Reset();l.count=0;var p=t.b2TestOverlapShape.s_output.Reset();return t.b2Distance(p,l,a),p.distance<10*t.b2_epsilon},t.b2TestOverlapShape.s_input=new t.b2DistanceInput,t.b2TestOverlapShape.s_simplexCache=new t.b2SimplexCache,t.b2TestOverlapShape.s_output=new t.b2DistanceOutput,t}(o,a,n,i),p=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Shape&&(t.b2Shape={}),t.b2MassData=function(){this.center=new t.b2Vec2(0,0)},t.b2MassData.prototype.mass=0,t.b2MassData.prototype.center=null,t.b2MassData.prototype.I=0,t.b2ShapeType={e_unknown:-1,e_circleShape:0,e_edgeShape:1,e_polygonShape:2,e_chainShape:3,e_shapeTypeCount:4},e.exportProperty(t.b2ShapeType,"e_unknown",t.b2ShapeType.e_unknown),e.exportProperty(t.b2ShapeType,"e_circleShape",t.b2ShapeType.e_circleShape),e.exportProperty(t.b2ShapeType,"e_edgeShape",t.b2ShapeType.e_edgeShape),e.exportProperty(t.b2ShapeType,"e_polygonShape",t.b2ShapeType.e_polygonShape),e.exportProperty(t.b2ShapeType,"e_chainShape",t.b2ShapeType.e_chainShape),e.exportProperty(t.b2ShapeType,"e_shapeTypeCount",t.b2ShapeType.e_shapeTypeCount),t.b2Shape=function(e,t){this.m_type=e,this.m_radius=t},t.b2Shape.prototype.m_type=t.b2ShapeType.e_unknown,t.b2Shape.prototype.m_radius=0,t.b2Shape.prototype.Clone=function(){return t.ENABLE_ASSERTS&&t.b2Assert(!1),null},t.b2Shape.prototype.Copy=function(e){return t.ENABLE_ASSERTS&&t.b2Assert(this.m_type==e.m_type),this.m_radius=e.m_radius,this},t.b2Shape.prototype.GetType=function(){return this.m_type},t.b2Shape.prototype.GetChildCount=function(){return t.ENABLE_ASSERTS&&t.b2Assert(!1,"pure virtual"),0},t.b2Shape.prototype.TestPoint=function(){return t.ENABLE_ASSERTS&&t.b2Assert(!1,"pure virtual"),!1},t.b2Shape.prototype.RayCast=function(){return t.ENABLE_ASSERTS&&t.b2Assert(!1,"pure virtual"),!1},t.b2Shape.prototype.ComputeAABB=function(){t.ENABLE_ASSERTS&&t.b2Assert(!1,"pure virtual")},t.b2Shape.prototype.ComputeMass=function(){t.ENABLE_ASSERTS&&t.b2Assert(!1,"pure virtual")},t.b2Shape.prototype.SetupDistanceProxy=function(){t.ENABLE_ASSERTS&&t.b2Assert(!1,"pure virtual")},t.b2Shape.prototype.ComputeSubmergedArea=function(){return t.ENABLE_ASSERTS&&t.b2Assert(!1,"pure virtual"),0},t.b2Shape.prototype.Dump=function(){t.ENABLE_ASSERTS&&t.b2Assert(!1,"pure virtual")},t}(o,a,n,i),b=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Fixture&&(t.b2Fixture={}),t.b2Filter=function(){},t.b2Filter.prototype.categoryBits=1,t.b2Filter.prototype.maskBits=65535,t.b2Filter.prototype.groupIndex=0,t.b2Filter.prototype.Clone=function(){return(new t.b2Filter).Copy(this)},t.b2Filter.prototype.Copy=function(e){return t.ENABLE_ASSERTS&&t.b2Assert(this!==e),this.categoryBits=e.categoryBits,this.maskBits=e.maskBits,this.groupIndex=e.groupIndex,this},t.b2FixtureDef=function(){this.filter=new t.b2Filter},t.b2FixtureDef.prototype.shape=null,t.b2FixtureDef.prototype.userData=null,t.b2FixtureDef.prototype.friction=.2,t.b2FixtureDef.prototype.restitution=0,t.b2FixtureDef.prototype.density=0,t.b2FixtureDef.prototype.isSensor=!1,t.b2FixtureDef.prototype.filter=null,t.b2FixtureProxy=function(){this.aabb=new t.b2AABB},t.b2FixtureProxy.prototype.aabb=null,t.b2FixtureProxy.prototype.fixture=null,t.b2FixtureProxy.prototype.childIndex=0,t.b2FixtureProxy.prototype.proxy=null,t.b2FixtureProxy.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2FixtureProxy})},t.b2Fixture=function(){this.m_proxyCount=0,this.m_filter=new t.b2Filter},t.b2Fixture.prototype.m_density=0,t.b2Fixture.prototype.m_next=null,t.b2Fixture.prototype.m_body=null,t.b2Fixture.prototype.m_shape=null,t.b2Fixture.prototype.m_friction=0,t.b2Fixture.prototype.m_restitution=0,t.b2Fixture.prototype.m_proxies=null,t.b2Fixture.prototype.m_proxyCount=0,t.b2Fixture.prototype.m_filter=null,t.b2Fixture.prototype.m_isSensor=!1,t.b2Fixture.prototype.m_userData=null,t.b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},t.b2Fixture.prototype.GetShape=function(){return this.m_shape},t.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},t.b2Fixture.prototype.GetFilterData=function(){return this.m_filter},t.b2Fixture.prototype.GetUserData=function(){return this.m_userData},t.b2Fixture.prototype.SetUserData=function(e){this.m_userData=e},t.b2Fixture.prototype.GetBody=function(){return this.m_body},t.b2Fixture.prototype.GetNext=function(){return this.m_next},t.b2Fixture.prototype.SetDensity=function(e){this.m_density=e},t.b2Fixture.prototype.GetDensity=function(){return this.m_density},t.b2Fixture.prototype.GetFriction=function(){return this.m_friction},t.b2Fixture.prototype.SetFriction=function(e){this.m_friction=e},t.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},t.b2Fixture.prototype.SetRestitution=function(e){this.m_restitution=e},t.b2Fixture.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},t.b2Fixture.prototype.RayCast=function(e,t,o){return this.m_shape.RayCast(e,t,this.m_body.GetTransform(),o)},t.b2Fixture.prototype.GetMassData=function(e){return e=e||new t.b2MassData,this.m_shape.ComputeMass(e,this.m_density),e},t.b2Fixture.prototype.GetAABB=function(e){return t.ENABLE_ASSERTS&&t.b2Assert(e>=0&&e<this.m_proxyCount),this.m_proxies[e].aabb},t.b2Fixture.prototype.Create=function(e,o){this.m_userData=o.userData,this.m_friction=o.friction,this.m_restitution=o.restitution,this.m_body=e,this.m_next=null,this.m_filter.Copy(o.filter),this.m_isSensor=o.isSensor,this.m_shape=o.shape.Clone(),this.m_proxies=t.b2FixtureProxy.MakeArray(this.m_shape.GetChildCount()),this.m_proxyCount=0,this.m_density=o.density},t.b2Fixture.prototype.Destroy=function(){t.ENABLE_ASSERTS&&t.b2Assert(0==this.m_proxyCount),this.m_shape=null},t.b2Fixture.prototype.CreateProxies=function(e,o){t.ENABLE_ASSERTS&&t.b2Assert(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i];this.m_shape.ComputeAABB(n.aabb,o,i),n.proxy=e.CreateProxy(n.aabb,n),n.fixture=this,n.childIndex=i}},t.b2Fixture.prototype.DestroyProxies=function(e){for(var t=0;t<this.m_proxyCount;++t){var o=this.m_proxies[t];e.DestroyProxy(o.proxy),o.proxy=null}this.m_proxyCount=0},t.b2Fixture.prototype.Synchronize=function(e,o,i){if(0!=this.m_proxyCount)for(var n=0;n<this.m_proxyCount;++n){var s=this.m_proxies[n],r=t.b2Fixture.prototype.Synchronize.s_aabb1,a=t.b2Fixture.prototype.Synchronize.s_aabb2;this.m_shape.ComputeAABB(r,o,n),this.m_shape.ComputeAABB(a,i,n),s.aabb.Combine2(r,a);var l=t.b2SubVV(i.p,o.p,t.b2Fixture.prototype.Synchronize.s_displacement);e.MoveProxy(s.proxy,s.aabb,l)}},t.b2Fixture.prototype.Synchronize.s_aabb1=new t.b2AABB,t.b2Fixture.prototype.Synchronize.s_aabb2=new t.b2AABB,t.b2Fixture.prototype.Synchronize.s_displacement=new t.b2Vec2,t.b2Fixture.prototype.SetFilterData=function(e){this.m_filter.Copy(e),this.Refilter()
},t.b2Fixture.prototype.Refilter=function(){if(!this.m_body){for(var e=this.m_body.GetContactList();e;){var t=e.contact,o=t.GetFixtureA(),i=t.GetFixtureB();(o==this||i==this)&&t.FlagForFiltering(),e=e.next}var n=this.m_body.GetWorld();if(null!==n)for(var s=n.m_contactManager.m_broadPhase,r=0;r<this.m_proxyCount;++r)s.TouchProxy(this.m_proxies[r].proxy)}},t.b2Fixture.prototype.SetSensor=function(e){e!=this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=e)},t.b2Fixture.prototype.Dump=function(e){t.DEBUG&&(t.b2Log("    /*box2d.b2FixtureDef*/ var fd = new box2d.b2FixtureDef();\n"),t.b2Log("    fd.friction = %.15f;\n",this.m_friction),t.b2Log("    fd.restitution = %.15f;\n",this.m_restitution),t.b2Log("    fd.density = %.15f;\n",this.m_density),t.b2Log("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t.b2Log("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t.b2Log("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t.b2Log("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(),t.b2Log("\n"),t.b2Log("    fd.shape = shape;\n"),t.b2Log("\n"),t.b2Log("    bodies[%d].CreateFixture(fd);\n",e))},t}(o,l,i,p),m=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Body&&(t.b2Body={}),t.b2BodyType={b2_unknown:-1,b2_staticBody:0,b2_kinematicBody:1,b2_dynamicBody:2,b2_bulletBody:3},e.exportProperty(t.b2BodyType,"b2_unknown",t.b2BodyType.b2_unknown),e.exportProperty(t.b2BodyType,"b2_staticBody",t.b2BodyType.b2_staticBody),e.exportProperty(t.b2BodyType,"b2_kinematicBody",t.b2BodyType.b2_kinematicBody),e.exportProperty(t.b2BodyType,"b2_dynamicBody",t.b2BodyType.b2_dynamicBody),e.exportProperty(t.b2BodyType,"b2_bulletBody",t.b2BodyType.b2_bulletBody),t.b2BodyDef=function(){this.position=new t.b2Vec2(0,0),this.linearVelocity=new t.b2Vec2(0,0)},t.b2BodyDef.prototype.type=t.b2BodyType.b2_staticBody,t.b2BodyDef.prototype.position=null,t.b2BodyDef.prototype.angle=0,t.b2BodyDef.prototype.linearVelocity=null,t.b2BodyDef.prototype.angularVelocity=0,t.b2BodyDef.prototype.linearDamping=0,t.b2BodyDef.prototype.angularDamping=0,t.b2BodyDef.prototype.allowSleep=!0,t.b2BodyDef.prototype.awake=!0,t.b2BodyDef.prototype.fixedRotation=!1,t.b2BodyDef.prototype.bullet=!1,t.b2BodyDef.prototype.active=!0,t.b2BodyDef.prototype.userData=null,t.b2BodyDef.prototype.gravityScale=1,t.b2BodyFlag={e_none:0,e_islandFlag:1,e_awakeFlag:2,e_autoSleepFlag:4,e_bulletFlag:8,e_fixedRotationFlag:16,e_activeFlag:32,e_toiFlag:64},e.exportProperty(t.b2BodyFlag,"e_none",t.b2BodyFlag.e_none),e.exportProperty(t.b2BodyFlag,"e_islandFlag",t.b2BodyFlag.e_islandFlag),e.exportProperty(t.b2BodyFlag,"e_awakeFlag",t.b2BodyFlag.e_awakeFlag),e.exportProperty(t.b2BodyFlag,"e_autoSleepFlag",t.b2BodyFlag.e_autoSleepFlag),e.exportProperty(t.b2BodyFlag,"e_bulletFlag",t.b2BodyFlag.e_bulletFlag),e.exportProperty(t.b2BodyFlag,"e_fixedRotationFlag",t.b2BodyFlag.e_fixedRotationFlag),e.exportProperty(t.b2BodyFlag,"e_activeFlag",t.b2BodyFlag.e_activeFlag),e.exportProperty(t.b2BodyFlag,"e_toiFlag",t.b2BodyFlag.e_toiFlag),t.b2Body=function(e,o){this.m_xf=new t.b2Transform,this.m_out_xf=new t.b2Transform,this.m_sweep=new t.b2Sweep,this.m_out_sweep=new t.b2Sweep,this.m_linearVelocity=new t.b2Vec2,this.m_out_linearVelocity=new t.b2Vec2,this.m_force=new t.b2Vec2,t.ENABLE_ASSERTS&&t.b2Assert(e.position.IsValid()),t.ENABLE_ASSERTS&&t.b2Assert(e.linearVelocity.IsValid()),t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e.angle)),t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e.angularVelocity)),t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e.gravityScale)&&e.gravityScale>=0),t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e.angularDamping)&&e.angularDamping>=0),t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e.linearDamping)&&e.linearDamping>=0),this.m_flags=t.b2BodyFlag.e_none,e.bullet&&(this.m_flags|=t.b2BodyFlag.e_bulletFlag),e.fixedRotation&&(this.m_flags|=t.b2BodyFlag.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=t.b2BodyFlag.e_autoSleepFlag),e.awake&&(this.m_flags|=t.b2BodyFlag.e_awakeFlag),e.active&&(this.m_flags|=t.b2BodyFlag.e_activeFlag),this.m_world=o,this.m_xf.p.Copy(e.position),this.m_xf.q.SetAngleRadians(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=e.angle,this.m_sweep.a=e.angle,this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=e.type,e.type==t.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0},t.b2Body.prototype.m_flags=t.b2BodyFlag.e_none,t.b2Body.prototype.m_islandIndex=0,t.b2Body.prototype.m_world=null,t.b2Body.prototype.m_xf=null,t.b2Body.prototype.m_out_xf=null,t.b2Body.prototype.m_sweep=null,t.b2Body.prototype.m_out_sweep=null,t.b2Body.prototype.m_jointList=null,t.b2Body.prototype.m_contactList=null,t.b2Body.prototype.m_prev=null,t.b2Body.prototype.m_next=null,t.b2Body.prototype.m_linearVelocity=null,t.b2Body.prototype.m_out_linearVelocity=null,t.b2Body.prototype.m_angularVelocity=0,t.b2Body.prototype.m_linearDamping=0,t.b2Body.prototype.m_angularDamping=0,t.b2Body.prototype.m_gravityScale=1,t.b2Body.prototype.m_force=null,t.b2Body.prototype.m_torque=0,t.b2Body.prototype.m_sleepTime=0,t.b2Body.prototype.m_type=t.b2BodyType.b2_staticBody,t.b2Body.prototype.m_mass=1,t.b2Body.prototype.m_invMass=1,t.b2Body.prototype.m_I=0,t.b2Body.prototype.m_invI=0,t.b2Body.prototype.m_userData=null,t.b2Body.prototype.m_fixtureList=null,t.b2Body.prototype.m_fixtureCount=0,t.b2Body.prototype.m_controllerList=null,t.b2Body.prototype.m_controllerCount=0,t.b2Body.prototype.CreateFixture=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.m_world.IsLocked()),1==this.m_world.IsLocked())return null;var o=new t.b2Fixture;if(o.Create(this,e),this.m_flags&t.b2BodyFlag.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;o.CreateProxies(i,this.m_xf)}return o.m_next=this.m_fixtureList,this.m_fixtureList=o,++this.m_fixtureCount,o.m_body=this,o.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=t.b2WorldFlag.e_newFixture,o},t.b2Body.prototype.CreateFixture2=function(e,o){void 0===o&&(o=0);var i=t.b2Body.prototype.CreateFixture2.s_def;return i.shape=e,i.density=o,this.CreateFixture(i)},t.b2Body.prototype.CreateFixture2.s_def=new t.b2FixtureDef,t.b2Body.prototype.DestroyFixture=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()){t.ENABLE_ASSERTS&&t.b2Assert(e.m_body==this),t.ENABLE_ASSERTS&&t.b2Assert(this.m_fixtureCount>0);for(var o=this.m_fixtureList,i=null,n=!1;null!=o;){if(o==e){i?i.m_next=e.m_next:this.m_fixtureList=e.m_next,n=!0;break}i=o,o=o.m_next}t.ENABLE_ASSERTS&&t.b2Assert(n);for(var s=this.m_contactList;s;){var r=s.contact;s=s.next;var a=r.GetFixtureA(),l=r.GetFixtureB();(e==a||e==l)&&this.m_world.m_contactManager.Destroy(r)}if(this.m_flags&t.b2BodyFlag.e_activeFlag){var p=this.m_world.m_contactManager.m_broadPhase;e.DestroyProxies(p)}e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},t.b2Body.prototype.SetTransformVecRadians=function(e,t){this.SetTransformXYRadians(e.x,e.y,t)},t.b2Body.prototype.SetTransformXYRadians=function(e,o,i){if((this.m_xf.p.x!=e||this.m_xf.p.y!=o||this.m_xf.q.GetAngleRadians()!=i)&&(t.ENABLE_ASSERTS&&t.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked())){this.m_xf.q.SetAngleRadians(i),this.m_xf.p.Set(e,o),t.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_world.m_contactManager.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.Synchronize(n,this.m_xf,this.m_xf)}},t.b2Body.prototype.SetTransform=function(e){this.SetTransformVecRadians(e.p,e.GetAngleRadians())},t.b2Body.prototype.GetTransform=function(e){return e=e||this.m_out_xf,e.Copy(this.m_xf)},t.b2Body.prototype.GetPosition=function(e){return e=e||this.m_out_xf.p,e.Copy(this.m_xf.p)},t.b2Body.prototype.SetPosition=function(e){this.SetTransformVecRadians(e,this.GetAngleRadians())},t.b2Body.prototype.SetPositionXY=function(e,t){this.SetTransformXYRadians(e,t,this.GetAngleRadians())},t.b2Body.prototype.GetAngleRadians=function(){return this.m_sweep.a},t.b2Body.prototype.SetAngleRadians=function(e){this.SetTransformVecRadians(this.GetPosition(),e)},t.b2Body.prototype.GetWorldCenter=function(e){return e=e||this.m_out_sweep.c,e.Copy(this.m_sweep.c)},t.b2Body.prototype.GetLocalCenter=function(e){return e=e||this.m_out_sweep.localCenter,e.Copy(this.m_sweep.localCenter)},t.b2Body.prototype.SetLinearVelocity=function(e){this.m_type!=t.b2BodyType.b2_staticBody&&(t.b2DotVV(e,e)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(e))},t.b2Body.prototype.GetLinearVelocity=function(e){return e=e||this.m_out_linearVelocity,e.Copy(this.m_linearVelocity)},t.b2Body.prototype.SetAngularVelocity=function(e){this.m_type!=t.b2BodyType.b2_staticBody&&(e*e>0&&this.SetAwake(!0),this.m_angularVelocity=e)},t.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},t.b2Body.prototype.GetDefinition=function(e){return e.type=this.GetType(),e.allowSleep=(this.m_flags&t.b2BodyFlag.e_autoSleepFlag)==t.b2BodyFlag.e_autoSleepFlag,e.angle=this.GetAngleRadians(),e.angularDamping=this.m_angularDamping,e.gravityScale=this.m_gravityScale,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&t.b2BodyFlag.e_fixedRotationFlag)==t.b2BodyFlag.e_fixedRotationFlag,e.bullet=(this.m_flags&t.b2BodyFlag.e_bulletFlag)==t.b2BodyFlag.e_bulletFlag,e.awake=(this.m_flags&t.b2BodyFlag.e_awakeFlag)==t.b2BodyFlag.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.Copy(this.GetLinearVelocity()),e.position.Copy(this.GetPosition()),e.userData=this.GetUserData(),e},t.b2Body.prototype.ApplyForce=function(e,o,i){i=i||!0,this.m_type==t.b2BodyType.b2_dynamicBody&&(i&&0==(this.m_flags&t.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.b2BodyFlag.e_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(o.x-this.m_sweep.c.x)*e.y-(o.y-this.m_sweep.c.y)*e.x))},t.b2Body.prototype.ApplyForceToCenter=function(e,o){o=o||!0,this.m_type==t.b2BodyType.b2_dynamicBody&&(o&&0==(this.m_flags&t.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.b2BodyFlag.e_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y))},t.b2Body.prototype.ApplyTorque=function(e,o){o=o||!0,this.m_type==t.b2BodyType.b2_dynamicBody&&(o&&0==(this.m_flags&t.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.b2BodyFlag.e_awakeFlag&&(this.m_torque+=e))},t.b2Body.prototype.ApplyLinearImpulse=function(e,o,i){i=i||!0,this.m_type==t.b2BodyType.b2_dynamicBody&&(i&&0==(this.m_flags&t.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.b2BodyFlag.e_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((o.x-this.m_sweep.c.x)*e.y-(o.y-this.m_sweep.c.y)*e.x)))},t.b2Body.prototype.ApplyAngularImpulse=function(e,o){o=o||!0,this.m_type==t.b2BodyType.b2_dynamicBody&&(o&&0==(this.m_flags&t.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.b2BodyFlag.e_awakeFlag&&(this.m_angularVelocity+=this.m_invI*e))},t.b2Body.prototype.GetMass=function(){return this.m_mass},t.b2Body.prototype.GetInertia=function(){return this.m_I+this.m_mass*t.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},t.b2Body.prototype.GetMassData=function(e){return e.mass=this.m_mass,e.I=this.m_I+this.m_mass*t.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),e.center.Copy(this.m_sweep.localCenter),e},t.b2Body.prototype.SetMassData=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==t.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&0==(this.m_flags&t.b2BodyFlag.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*t.b2DotVV(e.center,e.center),t.ENABLE_ASSERTS&&t.b2Assert(this.m_I>0),this.m_invI=1/this.m_I);var o=t.b2Body.prototype.SetMassData.s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),t.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),t.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t.b2SubVV(this.m_sweep.c,o,t.b2Vec2.s_t0),this.m_linearVelocity)}},t.b2Body.prototype.SetMassData.s_oldCenter=new t.b2Vec2,t.b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type==t.b2BodyType.b2_staticBody||this.m_type==t.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a,void 0;t.ENABLE_ASSERTS&&t.b2Assert(this.m_type==t.b2BodyType.b2_dynamicBody);for(var e=t.b2Body.prototype.ResetMassData.s_localCenter.SetZero(),o=this.m_fixtureList;o;o=o.m_next)if(0!=o.m_density){var i=o.GetMassData(t.b2Body.prototype.ResetMassData.s_massData);this.m_mass+=i.mass,e.x+=i.center.x*i.mass,e.y+=i.center.y*i.mass,this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&t.b2BodyFlag.e_fixedRotationFlag)?(this.m_I-=this.m_mass*t.b2DotVV(e,e),t.ENABLE_ASSERTS&&t.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=t.b2Body.prototype.ResetMassData.s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),t.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),t.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t.b2SubVV(this.m_sweep.c,n,t.b2Vec2.s_t0),this.m_linearVelocity)},t.b2Body.prototype.ResetMassData.s_localCenter=new t.b2Vec2,t.b2Body.prototype.ResetMassData.s_oldCenter=new t.b2Vec2,t.b2Body.prototype.ResetMassData.s_massData=new t.b2MassData,t.b2Body.prototype.GetWorldPoint=function(e,o){return t.b2MulXV(this.m_xf,e,o)},t.b2Body.prototype.GetWorldVector=function(e,o){return t.b2MulRV(this.m_xf.q,e,o)},t.b2Body.prototype.GetLocalPoint=function(e,o){return t.b2MulTXV(this.m_xf,e,o)},t.b2Body.prototype.GetLocalVector=function(e,o){return t.b2MulTRV(this.m_xf.q,e,o)},t.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(e,o){return t.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t.b2SubVV(e,this.m_sweep.c,t.b2Vec2.s_t0),o)},t.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(e,t){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(e,t),t)},t.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},t.b2Body.prototype.SetLinearDamping=function(e){this.m_linearDamping=e},t.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},t.b2Body.prototype.SetAngularDamping=function(e){this.m_angularDamping=e},t.b2Body.prototype.GetGravityScale=function(){return this.m_gravityScale},t.b2Body.prototype.SetGravityScale=function(e){this.m_gravityScale=e},t.b2Body.prototype.SetType=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type!=e){this.m_type=e,this.ResetMassData(),this.m_type==t.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var o=this.m_contactList;o;){var i=o;o=o.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var n=this.m_world.m_contactManager.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var r=s.m_proxyCount,a=0;r>a;++a)n.TouchProxy(s.m_proxies[a].proxy)}},t.b2Body.prototype.GetType=function(){return this.m_type},t.b2Body.prototype.SetBullet=function(e){e?this.m_flags|=t.b2BodyFlag.e_bulletFlag:this.m_flags&=~t.b2BodyFlag.e_bulletFlag},t.b2Body.prototype.IsBullet=function(){return(this.m_flags&t.b2BodyFlag.e_bulletFlag)==t.b2BodyFlag.e_bulletFlag},t.b2Body.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=t.b2BodyFlag.e_autoSleepFlag:(this.m_flags&=~t.b2BodyFlag.e_autoSleepFlag,this.SetAwake(!0))},t.b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&t.b2BodyFlag.e_autoSleepFlag)==t.b2BodyFlag.e_autoSleepFlag},t.b2Body.prototype.SetAwake=function(e){e?0==(this.m_flags&t.b2BodyFlag.e_awakeFlag)&&(this.m_flags|=t.b2BodyFlag.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~t.b2BodyFlag.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},t.b2Body.prototype.IsAwake=function(){return(this.m_flags&t.b2BodyFlag.e_awakeFlag)==t.b2BodyFlag.e_awakeFlag},t.b2Body.prototype.SetActive=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.m_world.IsLocked()),e!=this.IsActive())if(e){this.m_flags|=t.b2BodyFlag.e_activeFlag;for(var o=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxies(o,this.m_xf)}else{this.m_flags&=~t.b2BodyFlag.e_activeFlag;for(var o=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies(o);for(var n=this.m_contactList;n;){var s=n;n=n.next,this.m_world.m_contactManager.Destroy(s.contact)}this.m_contactList=null}},t.b2Body.prototype.IsActive=function(){return(this.m_flags&t.b2BodyFlag.e_activeFlag)==t.b2BodyFlag.e_activeFlag},t.b2Body.prototype.SetFixedRotation=function(e){var o=(this.m_flags&t.b2BodyFlag.e_fixedRotationFlag)==t.b2BodyFlag.e_fixedRotationFlag;o!=e&&(e?this.m_flags|=t.b2BodyFlag.e_fixedRotationFlag:this.m_flags&=~t.b2BodyFlag.e_fixedRotationFlag,this.m_angularVelocity=0,this.ResetMassData())},t.b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&t.b2BodyFlag.e_fixedRotationFlag)==t.b2BodyFlag.e_fixedRotationFlag},t.b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},t.b2Body.prototype.GetJointList=function(){return this.m_jointList},t.b2Body.prototype.GetContactList=function(){return this.m_contactList},t.b2Body.prototype.GetNext=function(){return this.m_next},t.b2Body.prototype.GetUserData=function(){return this.m_userData},t.b2Body.prototype.SetUserData=function(e){this.m_userData=e},t.b2Body.prototype.GetWorld=function(){return this.m_world},t.b2Body.prototype.SynchronizeFixtures=function(){var e=t.b2Body.prototype.SynchronizeFixtures.s_xf1;e.q.SetAngleRadians(this.m_sweep.a0),t.b2MulRV(e.q,this.m_sweep.localCenter,e.p),t.b2SubVV(this.m_sweep.c0,e.p,e.p);for(var o=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(o,e,this.m_xf)},t.b2Body.prototype.SynchronizeFixtures.s_xf1=new t.b2Transform,t.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngleRadians(this.m_sweep.a),t.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),t.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},t.b2Body.prototype.ShouldCollide=function(e){if(this.m_type!=t.b2BodyType.b2_dynamicBody&&e.m_type!=t.b2BodyType.b2_dynamicBody)return!1;for(var o=this.m_jointList;o;o=o.next)if(o.other==e&&0==o.joint.m_collideConnected)return!1;return!0},t.b2Body.prototype.Advance=function(e){this.m_sweep.Advance(e),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngleRadians(this.m_sweep.a),t.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),t.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},t.b2Body.prototype.Dump=function(){if(t.DEBUG){var e=this.m_islandIndex;t.b2Log("if (true)\n"),t.b2Log("{\n"),t.b2Log("  /*box2d.b2BodyDef*/ var bd = new box2d.b2BodyDef();\n");var o="";switch(this.m_type){case t.b2BodyType.b2_staticBody:o="box2d.b2BodyType.b2_staticBody";break;case t.b2BodyType.b2_kinematicBody:o="box2d.b2BodyType.b2_kinematicBody";break;case t.b2BodyType.b2_dynamicBody:o="box2d.b2BodyType.b2_dynamicBody";break;default:t.ENABLE_ASSERTS&&t.b2Assert(!1)}t.b2Log("  bd.type = %s;\n",o),t.b2Log("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t.b2Log("  bd.angle = %.15f;\n",this.m_sweep.a),t.b2Log("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t.b2Log("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t.b2Log("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t.b2Log("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t.b2Log("  bd.allowSleep = %s;\n",this.m_flags&t.b2BodyFlag.e_autoSleepFlag?"true":"false"),t.b2Log("  bd.awake = %s;\n",this.m_flags&t.b2BodyFlag.e_awakeFlag?"true":"false"),t.b2Log("  bd.fixedRotation = %s;\n",this.m_flags&t.b2BodyFlag.e_fixedRotationFlag?"true":"false"),t.b2Log("  bd.bullet = %s;\n",this.m_flags&t.b2BodyFlag.e_bulletFlag?"true":"false"),t.b2Log("  bd.active = %s;\n",this.m_flags&t.b2BodyFlag.e_activeFlag?"true":"false"),t.b2Log("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t.b2Log("\n"),t.b2Log("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t.b2Log("\n");for(var i=this.m_fixtureList;i;i=i.m_next)t.b2Log("  if (true)\n"),t.b2Log("  {\n"),i.Dump(e),t.b2Log("  }\n");t.b2Log("}\n")}},t.b2Body.prototype.GetControllerList=function(){return this.m_controllerList},t.b2Body.prototype.GetControllerCount=function(){return this.m_controllerCount},t}(o,b,n,i),_=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2GrowableStack&&(t.b2GrowableStack={}),t.b2GrowableStack=function(e){this.m_stack=new Array(e)},t.b2GrowableStack.prototype.m_stack=null,t.b2GrowableStack.prototype.m_count=0,t.b2GrowableStack.prototype.Reset=function(){return this.m_count=0,this},t.b2GrowableStack.prototype.Push=function(e){this.m_stack[this.m_count]=e,++this.m_count},t.b2GrowableStack.prototype.Pop=function(){t.ENABLE_ASSERTS&&t.b2Assert(this.m_count>0),--this.m_count;var e=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,e},t.b2GrowableStack.prototype.GetCount=function(){return this.m_count},t}(o,i),d=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2DynamicTree&&(t.b2DynamicTree={}),t.b2TreeNode=function(e){this.m_id=e||0,this.aabb=new t.b2AABB},t.b2TreeNode.prototype.m_id=0,t.b2TreeNode.prototype.aabb=null,t.b2TreeNode.prototype.userData=null,t.b2TreeNode.prototype.parent=null,t.b2TreeNode.prototype.child1=null,t.b2TreeNode.prototype.child2=null,t.b2TreeNode.prototype.height=0,t.b2TreeNode.prototype.IsLeaf=function(){return null==this.child1},t.b2DynamicTree=function(){},t.b2DynamicTree.prototype.m_root=null,t.b2DynamicTree.prototype.m_freeList=null,t.b2DynamicTree.prototype.m_path=0,t.b2DynamicTree.prototype.m_insertionCount=0,t.b2DynamicTree.s_stack=new t.b2GrowableStack(256),t.b2DynamicTree.s_r=new t.b2Vec2,t.b2DynamicTree.s_v=new t.b2Vec2,t.b2DynamicTree.s_abs_v=new t.b2Vec2,t.b2DynamicTree.s_segmentAABB=new t.b2AABB,t.b2DynamicTree.s_subInput=new t.b2RayCastInput,t.b2DynamicTree.s_combinedAABB=new t.b2AABB,t.b2DynamicTree.s_aabb=new t.b2AABB,t.b2DynamicTree.prototype.GetUserData=function(e){return t.ENABLE_ASSERTS&&t.b2Assert(null!=e),e.userData},t.b2DynamicTree.prototype.GetFatAABB=function(e){return t.ENABLE_ASSERTS&&t.b2Assert(null!=e),e.aabb},t.b2DynamicTree.prototype.Query=function(e,o){if(null!=this.m_root){var i=t.b2DynamicTree.s_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var n=i.Pop();if(null!=n&&n.aabb.TestOverlap(o))if(n.IsLeaf()){var s=e(n);if(0==s)return}else i.Push(n.child1),i.Push(n.child2)}}},t.b2DynamicTree.prototype.RayCast=function(e,o){if(null!=this.m_root){var i=o.p1,n=o.p2,s=t.b2SubVV(n,i,t.b2DynamicTree.s_r);t.ENABLE_ASSERTS&&t.b2Assert(s.GetLengthSquared()>0),s.Normalize();var r=t.b2CrossOneV(s,t.b2DynamicTree.s_v),a=t.b2AbsV(r,t.b2DynamicTree.s_abs_v),l=o.maxFraction,p=t.b2DynamicTree.s_segmentAABB,b=i.x+l*(n.x-i.x),m=i.y+l*(n.y-i.y);p.lowerBound.x=t.b2Min(i.x,b),p.lowerBound.y=t.b2Min(i.y,m),p.upperBound.x=t.b2Max(i.x,b),p.upperBound.y=t.b2Max(i.y,m);var _=t.b2DynamicTree.s_stack.Reset();for(_.Push(this.m_root);_.GetCount()>0;){var d=_.Pop();if(null!=d&&0!=t.b2TestOverlapAABB(d.aabb,p)){var h=d.aabb.GetCenter(),c=d.aabb.GetExtents(),u=t.b2Abs(t.b2DotVV(r,t.b2SubVV(i,h,t.b2Vec2.s_t0)))-t.b2DotVV(a,c);if(!(u>0))if(d.IsLeaf()){var y=t.b2DynamicTree.s_subInput;y.p1.Copy(o.p1),y.p2.Copy(o.p2),y.maxFraction=l;var f=e(y,d);if(0==f)return;f>0&&(l=f,b=i.x+l*(n.x-i.x),m=i.y+l*(n.y-i.y),p.lowerBound.x=t.b2Min(i.x,b),p.lowerBound.y=t.b2Min(i.y,m),p.upperBound.x=t.b2Max(i.x,b),p.upperBound.y=t.b2Max(i.y,m))}else _.Push(d.child1),_.Push(d.child2)}}}},t.b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e.userData=null,e}return new t.b2TreeNode(t.b2DynamicTree.prototype.s_node_id++)},t.b2DynamicTree.prototype.s_node_id=0,t.b2DynamicTree.prototype.FreeNode=function(e){e.parent=this.m_freeList,e.height=-1,this.m_freeList=e},t.b2DynamicTree.prototype.CreateProxy=function(e,o){var i=this.AllocateNode(),n=t.b2_aabbExtension,s=t.b2_aabbExtension;return i.aabb.lowerBound.x=e.lowerBound.x-n,i.aabb.lowerBound.y=e.lowerBound.y-s,i.aabb.upperBound.x=e.upperBound.x+n,i.aabb.upperBound.y=e.upperBound.y+s,i.userData=o,i.height=0,this.InsertLeaf(i),i},t.b2DynamicTree.prototype.DestroyProxy=function(e){t.ENABLE_ASSERTS&&t.b2Assert(e.IsLeaf()),this.RemoveLeaf(e),this.FreeNode(e)},t.b2DynamicTree.prototype.MoveProxy=function(e,o,i){if(t.ENABLE_ASSERTS&&t.b2Assert(e.IsLeaf()),e.aabb.Contains(o))return!1;this.RemoveLeaf(e);var n=t.b2_aabbExtension+t.b2_aabbMultiplier*(i.x>0?i.x:-i.x),s=t.b2_aabbExtension+t.b2_aabbMultiplier*(i.y>0?i.y:-i.y);return e.aabb.lowerBound.x=o.lowerBound.x-n,e.aabb.lowerBound.y=o.lowerBound.y-s,e.aabb.upperBound.x=o.upperBound.x+n,e.aabb.upperBound.y=o.upperBound.y+s,this.InsertLeaf(e),!0},t.b2DynamicTree.prototype.InsertLeaf=function(e){if(++this.m_insertionCount,null==this.m_root)return this.m_root=e,this.m_root.parent=null,void 0;for(var o,i,n=e.aabb,s=(n.GetCenter(),this.m_root);0==s.IsLeaf();){o=s.child1,i=s.child2;var r=s.aabb.GetPerimeter(),a=t.b2DynamicTree.s_combinedAABB;a.Combine2(s.aabb,n);var l,p,b,m=a.GetPerimeter(),_=2*m,d=2*(m-r),h=t.b2DynamicTree.s_aabb;o.IsLeaf()?(h.Combine2(n,o.aabb),l=h.GetPerimeter()+d):(h.Combine2(n,o.aabb),p=o.aabb.GetPerimeter(),b=h.GetPerimeter(),l=b-p+d);var c;if(i.IsLeaf()?(h.Combine2(n,i.aabb),c=h.GetPerimeter()+d):(h.Combine2(n,i.aabb),p=i.aabb.GetPerimeter(),b=h.GetPerimeter(),c=b-p+d),l>_&&c>_)break;s=c>l?o:i}var u=s,y=u.parent,f=this.AllocateNode();for(f.parent=y,f.userData=null,f.aabb.Combine2(n,u.aabb),f.height=u.height+1,y?(y.child1==u?y.child1=f:y.child2=f,f.child1=u,f.child2=e,u.parent=f,e.parent=f):(f.child1=u,f.child2=e,u.parent=f,e.parent=f,this.m_root=f),s=e.parent;null!=s;)s=this.Balance(s),o=s.child1,i=s.child2,t.ENABLE_ASSERTS&&t.b2Assert(null!=o),t.ENABLE_ASSERTS&&t.b2Assert(null!=i),s.height=1+t.b2Max(o.height,i.height),s.aabb.Combine2(o.aabb,i.aabb),s=s.parent},t.b2DynamicTree.prototype.RemoveLeaf=function(e){if(e==this.m_root)return this.m_root=null,void 0;var o,i=e.parent,n=i.parent;if(o=i.child1==e?i.child2:i.child1,n){n.child1==i?n.child1=o:n.child2=o,o.parent=n,this.FreeNode(i);for(var s=n;s;){s=this.Balance(s);var r=s.child1,a=s.child2;s.aabb.Combine2(r.aabb,a.aabb),s.height=1+t.b2Max(r.height,a.height),s=s.parent}}else this.m_root=o,o.parent=null,this.FreeNode(i)},t.b2DynamicTree.prototype.Balance=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(null!=e),e.IsLeaf()||e.height<2)return e;var o=e.child1,i=e.child2,n=i.height-o.height;if(n>1){var s=i.child1,r=i.child2;return i.child1=e,i.parent=e.parent,e.parent=i,null!=i.parent?i.parent.child1==e?i.parent.child1=i:(t.ENABLE_ASSERTS&&t.b2Assert(i.parent.child2==e),i.parent.child2=i):this.m_root=i,s.height>r.height?(i.child2=s,e.child2=r,r.parent=e,e.aabb.Combine2(o.aabb,r.aabb),i.aabb.Combine2(e.aabb,s.aabb),e.height=1+t.b2Max(o.height,r.height),i.height=1+t.b2Max(e.height,s.height)):(i.child2=r,e.child2=s,s.parent=e,e.aabb.Combine2(o.aabb,s.aabb),i.aabb.Combine2(e.aabb,r.aabb),e.height=1+t.b2Max(o.height,s.height),i.height=1+t.b2Max(e.height,r.height)),i}if(-1>n){var a=o.child1,l=o.child2;return o.child1=e,o.parent=e.parent,e.parent=o,null!=o.parent?o.parent.child1==e?o.parent.child1=o:(t.ENABLE_ASSERTS&&t.b2Assert(o.parent.child2==e),o.parent.child2=o):this.m_root=o,a.height>l.height?(o.child2=a,e.child1=l,l.parent=e,e.aabb.Combine2(i.aabb,l.aabb),o.aabb.Combine2(e.aabb,a.aabb),e.height=1+t.b2Max(i.height,l.height),o.height=1+t.b2Max(e.height,a.height)):(o.child2=l,e.child1=a,a.parent=e,e.aabb.Combine2(i.aabb,a.aabb),o.aabb.Combine2(e.aabb,l.aabb),e.height=1+t.b2Max(i.height,a.height),o.height=1+t.b2Max(e.height,l.height)),o}return e},t.b2DynamicTree.prototype.GetHeight=function(){return null==this.m_root?0:this.m_root.height},t.b2DynamicTree.prototype.GetAreaRatio=function(){if(null==this.m_root)return 0;var e=this.m_root,t=e.aabb.GetPerimeter(),o=function(e){if(null==e)return 0;if(e.IsLeaf())return 0;var t=e.aabb.GetPerimeter();return t+=o(e.child1),t+=o(e.child2)},i=o(this.m_root);return i/t},t.b2DynamicTree.prototype.ComputeHeightNode=function(e){if(e.IsLeaf())return 0;var o=this.ComputeHeightNode(e.child1),i=this.ComputeHeightNode(e.child2);return 1+t.b2Max(o,i)},t.b2DynamicTree.prototype.ComputeHeight=function(){var e=this.ComputeHeightNode(this.m_root);return e},t.b2DynamicTree.prototype.ValidateStructure=function(e){if(null!=e){e==this.m_root&&t.ENABLE_ASSERTS&&t.b2Assert(null==e.parent);var o=e,i=o.child1,n=o.child2;if(o.IsLeaf())return t.ENABLE_ASSERTS&&t.b2Assert(null==i),t.ENABLE_ASSERTS&&t.b2Assert(null==n),t.ENABLE_ASSERTS&&t.b2Assert(0==o.height),void 0;t.ENABLE_ASSERTS&&t.b2Assert(i.parent==e),t.ENABLE_ASSERTS&&t.b2Assert(n.parent==e),this.ValidateStructure(i),this.ValidateStructure(n)}},t.b2DynamicTree.prototype.ValidateMetrics=function(e){if(null!=e){var o=e,i=o.child1,n=o.child2;if(o.IsLeaf())return t.ENABLE_ASSERTS&&t.b2Assert(null==i),t.ENABLE_ASSERTS&&t.b2Assert(null==n),t.ENABLE_ASSERTS&&t.b2Assert(0==o.height),void 0;var s,r=i.height,a=n.height;s=1+t.b2Max(r,a),t.ENABLE_ASSERTS&&t.b2Assert(o.height==s);var l=t.b2DynamicTree.s_aabb;l.Combine2(i.aabb,n.aabb),t.ENABLE_ASSERTS&&t.b2Assert(l.lowerBound==o.aabb.lowerBound),t.ENABLE_ASSERTS&&t.b2Assert(l.upperBound==o.aabb.upperBound),this.ValidateMetrics(i),this.ValidateMetrics(n)}},t.b2DynamicTree.prototype.Validate=function(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);for(var e=0,o=this.m_freeList;null!=o;)o=o.parent,++e;t.ENABLE_ASSERTS&&t.b2Assert(this.GetHeight()==this.ComputeHeight())},t.b2DynamicTree.prototype.GetMaxBalance=function(){var e=function(e,o){if(null==e)return o;if(e.height<=1)return o;t.ENABLE_ASSERTS&&t.b2Assert(0==e.IsLeaf());var i=e.child1,n=e.child2,s=t.b2Abs(n.height-i.height);return t.b2Max(o,s)},o=e(this.m_root,0);return o},t.b2DynamicTree.prototype.RebuildBottomUp=function(){this.Validate()},t.b2DynamicTree.prototype.ShiftOrigin=function(e){var o=function(e,i){if(null!=e&&!(e.height<=1)){t.ENABLE_ASSERTS&&t.b2Assert(0==e.IsLeaf());var n=e.child1,s=e.child2;o(n,i),o(s,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}};o(this.m_root,e)},t}(o,l,_,i),h=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2BroadPhase&&(t.b2BroadPhase={}),t.b2Pair=function(){},t.b2Pair.prototype.proxyA=null,t.b2Pair.prototype.proxyB=null,t.b2BroadPhase=function(){this.m_tree=new t.b2DynamicTree,this.m_moveBuffer=new Array,this.m_pairBuffer=new Array},t.b2BroadPhase.prototype.m_tree=null,t.b2BroadPhase.prototype.m_proxyCount=0,t.b2BroadPhase.prototype.m_moveCount=0,t.b2BroadPhase.prototype.m_moveBuffer=null,t.b2BroadPhase.prototype.m_pairCount=0,t.b2BroadPhase.prototype.m_pairBuffer=null,t.b2BroadPhase.prototype.CreateProxy=function(e,t){var o=this.m_tree.CreateProxy(e,t);
return++this.m_proxyCount,this.BufferMove(o),o},t.b2BroadPhase.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},t.b2BroadPhase.prototype.MoveProxy=function(e,t,o){var i=this.m_tree.MoveProxy(e,t,o);i&&this.BufferMove(e)},t.b2BroadPhase.prototype.TouchProxy=function(e){this.BufferMove(e)},t.b2BroadPhase.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},t.b2BroadPhase.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},t.b2BroadPhase.prototype.TestOverlap=function(e,o){var i=this.m_tree.GetFatAABB(e),n=this.m_tree.GetFatAABB(o);return t.b2TestOverlapAABB(i,n)},t.b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},t.b2BroadPhase.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},t.b2BroadPhase.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},t.b2BroadPhase.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},t.b2BroadPhase.prototype.ShiftOrigin=function(e){this.m_tree.ShiftOrigin(e)},t.b2BroadPhase.prototype.UpdatePairs=function(e){this.m_pairCount=0;for(var o=0;o<this.m_moveCount;++o){var i=this.m_moveBuffer[o];if(null!=i){var n=this,s=function(e){if(e.m_id==i.m_id)return!0;n.m_pairCount==n.m_pairBuffer.length&&(n.m_pairBuffer[n.m_pairCount]=new t.b2Pair);var o=n.m_pairBuffer[n.m_pairCount];return e.m_id<i.m_id?(o.proxyA=e,o.proxyB=i):(o.proxyA=i,o.proxyB=e),++n.m_pairCount,!0},r=this.m_tree.GetFatAABB(i);this.m_tree.Query(s,r)}}this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(t.b2PairLessThan);for(var o=0;o<this.m_pairCount;){var a=this.m_pairBuffer[o],l=this.m_tree.GetUserData(a.proxyA),p=this.m_tree.GetUserData(a.proxyB);for(e.AddPair(l,p),++o;o<this.m_pairCount;){var b=this.m_pairBuffer[o];if(b.proxyA.m_id!=a.proxyA.m_id||b.proxyB.m_id!=a.proxyB.m_id)break;++o}}},t.b2BroadPhase.prototype.Query=function(e,t){this.m_tree.Query(e,t)},t.b2BroadPhase.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},t.b2BroadPhase.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveCount]=e,++this.m_moveCount},t.b2BroadPhase.prototype.UnBufferMove=function(e){var t=this.m_moveBuffer.indexOf(e);this.m_moveBuffer[t]=null},t.b2PairLessThan=function(e,t){return e.proxyA.m_id==t.proxyA.m_id?e.proxyB.m_id-t.proxyB.m_id:e.proxyA.m_id-t.proxyA.m_id},t}(o,d,i),c=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Controller&&(t.b2Controller={}),t.b2ControllerEdge=function(){},t.b2ControllerEdge.prototype.controller=null,t.b2ControllerEdge.prototype.body=null,t.b2ControllerEdge.prototype.prevBody=null,t.b2ControllerEdge.prototype.nextBody=null,t.b2ControllerEdge.prototype.prevController=null,t.b2ControllerEdge.prototype.nextController=null,t.b2Controller=function(){},t.b2Controller.prototype.m_world=null,t.b2Controller.prototype.m_bodyList=null,t.b2Controller.prototype.m_bodyCount=0,t.b2Controller.prototype.m_prev=null,t.b2Controller.prototype.m_next=null,t.b2Controller.prototype.Step=function(){},t.b2Controller.prototype.Draw=function(){},t.b2Controller.prototype.GetNext=function(){return this.m_next},t.b2Controller.prototype.GetPrev=function(){return this.m_prev},t.b2Controller.prototype.GetWorld=function(){return this.m_world},t.b2Controller.prototype.GetBodyList=function(){return this.m_bodyList},t.b2Controller.prototype.AddBody=function(e){var o=new t.b2ControllerEdge;o.body=e,o.controller=this,o.nextBody=this.m_bodyList,o.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=o),this.m_bodyList=o,++this.m_bodyCount,o.nextController=e.m_controllerList,o.prevController=null,e.m_controllerList&&(e.m_controllerList.prevController=o),e.m_controllerList=o,++e.m_controllerCount},t.b2Controller.prototype.RemoveBody=function(e){t.ENABLE_ASSERTS&&t.b2Assert(this.m_bodyCount>0);for(var o=this.m_bodyList;o&&o.body!=e;)o=o.nextBody;t.ENABLE_ASSERTS&&t.b2Assert(null!=o),o.prevBody&&(o.prevBody.nextBody=o.nextBody),o.nextBody&&(o.nextBody.prevBody=o.prevBody),this.m_bodyList==o&&(this.m_bodyList=o.nextBody),--this.m_bodyCount,o.nextController&&(o.nextController.prevController=o.prevController),o.prevController&&(o.prevController.nextController=o.nextController),e.m_controllerList==o&&(e.m_controllerList=o.nextController),--e.m_controllerCount},t.b2Controller.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},t}(o,i),u=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2WorldCallbacks&&(t.b2WorldCallbacks={}),t.b2DestructionListener=function(){},t.b2DestructionListener.prototype.SayGoodbyeJoint=function(){},t.b2DestructionListener.prototype.SayGoodbyeFixture=function(){},t.b2ContactFilter=function(){},t.b2ContactFilter.prototype.ShouldCollide=function(e,t){var o=e.GetFilterData(),i=t.GetFilterData();if(o.groupIndex==i.groupIndex&&0!=o.groupIndex)return o.groupIndex>0;var n=0!=(o.maskBits&i.categoryBits)&&0!=(o.categoryBits&i.maskBits);return n},t.b2ContactFilter.b2_defaultFilter=new t.b2ContactFilter,t.b2ContactImpulse=function(){this.normalImpulses=t.b2MakeNumberArray(t.b2_maxManifoldPoints),this.tangentImpulses=t.b2MakeNumberArray(t.b2_maxManifoldPoints)},t.b2ContactImpulse.prototype.normalImpulses=null,t.b2ContactImpulse.prototype.tangentImpulses=null,t.b2ContactImpulse.prototype.count=0,t.b2ContactListener=function(){},t.b2ContactListener.prototype.BeginContact=function(){},t.b2ContactListener.prototype.EndContact=function(){},t.b2ContactListener.prototype.PreSolve=function(){},t.b2ContactListener.prototype.PostSolve=function(){},t.b2ContactListener.b2_defaultListener=new t.b2ContactListener,t.b2QueryCallback=function(){},t.b2QueryCallback.prototype.ReportFixture=function(){return!0},t.b2RayCastCallback=function(){},t.b2RayCastCallback.prototype.ReportFixture=function(e,t,o,i){return i},t}(o,i),y=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2BuoyancyController&&(t.b2BuoyancyController={}),t.b2BuoyancyController=function(){e.base(this),this.normal=new t.b2Vec2(0,1),this.velocity=new t.b2Vec2(0,0),this.gravity=new t.b2Vec2(0,0)},e.inherits(t.b2BuoyancyController,t.b2Controller),t.b2BuoyancyController.prototype.normal=null,t.b2BuoyancyController.prototype.offset=0,t.b2BuoyancyController.prototype.density=0,t.b2BuoyancyController.prototype.velocity=null,t.b2BuoyancyController.prototype.linearDrag=0,t.b2BuoyancyController.prototype.angularDrag=0,t.b2BuoyancyController.prototype.useDensity=!1,t.b2BuoyancyController.prototype.useWorldGravity=!0,t.b2BuoyancyController.prototype.gravity=null,t.b2BuoyancyController.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.GetWorld().GetGravity());for(var e=this.m_bodyList;e;e=e.nextBody){var o=e.body;if(0!=o.IsAwake()){for(var i=new t.b2Vec2,n=new t.b2Vec2,s=0,r=0,a=o.GetFixtureList();a;a=a.m_next){var l=new t.b2Vec2,p=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,o.GetTransform(),l);s+=p,i.x+=p*l.x,i.y+=p*l.y;var b=0;b=this.useDensity?a.GetDensity():1,r+=p*b,n.x+=p*l.x*b,n.y+=p*l.y*b}if(i.x/=s,i.y/=s,n.x/=r,n.y/=r,!(s<t.b2_epsilon)){var m=t.b2NegV(this.gravity,new t.b2Vec2);m.SelfMul(this.density*s),o.ApplyForce(m,n);var _=o.GetLinearVelocityFromWorldPoint(i,new t.b2Vec2);_.SelfSub(this.velocity),_.SelfMul(-this.linearDrag*s),o.ApplyForce(_,i),o.ApplyTorque(-o.GetInertia()/o.GetMass()*s*o.GetAngularVelocity()*this.angularDrag)}}}}},t.b2BuoyancyController.prototype.Draw=function(e){var o=100,i=new t.b2Vec2,n=new t.b2Vec2;i.x=this.normal.x*this.offset+this.normal.y*o,i.y=this.normal.y*this.offset-this.normal.x*o,n.x=this.normal.x*this.offset-this.normal.y*o,n.y=this.normal.y*this.offset+this.normal.x*o;var s=new t.b2Color(0,0,.8);e.DrawSegment(i,n,s)},t}(o,c,n,i,u),f=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2EdgeShape&&(t.b2EdgeShape={}),t.b2EdgeShape=function(){e.base(this,t.b2ShapeType.e_edgeShape,t.b2_polygonRadius),this.m_vertex1=new t.b2Vec2,this.m_vertex2=new t.b2Vec2,this.m_vertex0=new t.b2Vec2,this.m_vertex3=new t.b2Vec2},e.inherits(t.b2EdgeShape,t.b2Shape),t.b2EdgeShape.prototype.m_vertex1=null,t.b2EdgeShape.prototype.m_vertex2=null,t.b2EdgeShape.prototype.m_vertex0=null,t.b2EdgeShape.prototype.m_vertex3=null,t.b2EdgeShape.prototype.m_hasVertex0=!1,t.b2EdgeShape.prototype.m_hasVertex3=!1,t.b2EdgeShape.prototype.Set=function(e,t){return this.m_vertex1.Copy(e),this.m_vertex2.Copy(t),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},t.b2EdgeShape.prototype.SetAsEdge=t.b2EdgeShape.prototype.Set,t.b2EdgeShape.prototype.Clone=function(){return(new t.b2EdgeShape).Copy(this)},t.b2EdgeShape.prototype.Copy=function(o){return e.base(this,"Copy",o),t.ENABLE_ASSERTS&&t.b2Assert(o instanceof t.b2EdgeShape),this.m_vertex1.Copy(o.m_vertex1),this.m_vertex2.Copy(o.m_vertex2),this.m_vertex0.Copy(o.m_vertex0),this.m_vertex3.Copy(o.m_vertex3),this.m_hasVertex0=o.m_hasVertex0,this.m_hasVertex3=o.m_hasVertex3,this},t.b2EdgeShape.prototype.GetChildCount=function(){return 1},t.b2EdgeShape.prototype.TestPoint=function(){return!1},t.b2EdgeShape.prototype.RayCast=function(e,o,i){var n=t.b2MulTXV(i,o.p1,t.b2EdgeShape.prototype.RayCast.s_p1),s=t.b2MulTXV(i,o.p2,t.b2EdgeShape.prototype.RayCast.s_p2),r=t.b2SubVV(s,n,t.b2EdgeShape.prototype.RayCast.s_d),a=this.m_vertex1,l=this.m_vertex2,p=t.b2SubVV(l,a,t.b2EdgeShape.prototype.RayCast.s_e),b=e.normal.Set(p.y,-p.x).SelfNormalize(),m=t.b2DotVV(b,t.b2SubVV(a,n,t.b2Vec2.s_t0)),_=t.b2DotVV(b,r);if(0==_)return!1;var d=m/_;if(0>d||o.maxFraction<d)return!1;var h=t.b2AddVMulSV(n,d,r,t.b2EdgeShape.prototype.RayCast.s_q),c=t.b2SubVV(l,a,t.b2EdgeShape.prototype.RayCast.s_r),u=t.b2DotVV(c,c);if(0==u)return!1;var y=t.b2DotVV(t.b2SubVV(h,a,t.b2Vec2.s_t0),c)/u;return 0>y||y>1?!1:(e.fraction=d,t.b2MulRV(i.q,e.normal,e.normal),m>0&&e.normal.SelfNeg(),!0)},t.b2EdgeShape.prototype.RayCast.s_p1=new t.b2Vec2,t.b2EdgeShape.prototype.RayCast.s_p2=new t.b2Vec2,t.b2EdgeShape.prototype.RayCast.s_d=new t.b2Vec2,t.b2EdgeShape.prototype.RayCast.s_e=new t.b2Vec2,t.b2EdgeShape.prototype.RayCast.s_q=new t.b2Vec2,t.b2EdgeShape.prototype.RayCast.s_r=new t.b2Vec2,t.b2EdgeShape.prototype.ComputeAABB=function(e,o){var i=t.b2MulXV(o,this.m_vertex1,t.b2EdgeShape.prototype.ComputeAABB.s_v1),n=t.b2MulXV(o,this.m_vertex2,t.b2EdgeShape.prototype.ComputeAABB.s_v2);t.b2MinV(i,n,e.lowerBound),t.b2MaxV(i,n,e.upperBound);var s=this.m_radius;e.lowerBound.SelfSubXY(s,s),e.upperBound.SelfAddXY(s,s)},t.b2EdgeShape.prototype.ComputeAABB.s_v1=new t.b2Vec2,t.b2EdgeShape.prototype.ComputeAABB.s_v2=new t.b2Vec2,t.b2EdgeShape.prototype.ComputeMass=function(e){e.mass=0,t.b2MidVV(this.m_vertex1,this.m_vertex2,e.center),e.I=0},t.b2EdgeShape.prototype.SetupDistanceProxy=function(e){e.m_vertices=new Array(2),e.m_vertices[0]=this.m_vertex1,e.m_vertices[1]=this.m_vertex2,e.m_count=2,e.m_radius=this.m_radius},t.b2EdgeShape.prototype.ComputeSubmergedArea=function(e,t,o,i){return i.SetZero(),0},t.b2EdgeShape.prototype.Dump=function(){t.b2Log("    /*box2d.b2EdgeShape*/ var shape = new box2d.b2EdgeShape();\n"),t.b2Log("    shape.m_radius = %.15f;\n",this.m_radius),t.b2Log("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t.b2Log("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t.b2Log("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t.b2Log("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t.b2Log("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t.b2Log("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},t}(o,p),S=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2ChainShape&&(t.b2ChainShape={}),t.b2ChainShape=function(){e.base(this,t.b2ShapeType.e_chainShape,t.b2_polygonRadius),this.m_prevVertex=new t.b2Vec2,this.m_nextVertex=new t.b2Vec2},e.inherits(t.b2ChainShape,t.b2Shape),t.b2ChainShape.prototype.m_vertices=null,t.b2ChainShape.prototype.m_count=0,t.b2ChainShape.prototype.m_prevVertex=null,t.b2ChainShape.prototype.m_nextVertex=null,t.b2ChainShape.prototype.m_hasPrevVertex=!1,t.b2ChainShape.prototype.m_hasNextVertex=!1,t.b2ChainShape.prototype.CreateLoop=function(e,o){if(o=o||e.length,t.ENABLE_ASSERTS&&t.b2Assert(null==this.m_vertices&&0==this.m_count),t.ENABLE_ASSERTS&&t.b2Assert(o>=3),t.ENABLE_ASSERTS)for(var i=1;o>i;++i){var n=e[i-1],s=e[i];t.b2Assert(t.b2DistanceSquaredVV(n,s)>t.b2_linearSlop*t.b2_linearSlop)}this.m_count=o+1,this.m_vertices=t.b2Vec2.MakeArray(this.m_count);for(var i=0;o>i;++i)this.m_vertices[i].Copy(e[i]);return this.m_vertices[o].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},t.b2ChainShape.prototype.CreateChain=function(e,o){if(o=o||e.length,t.ENABLE_ASSERTS&&t.b2Assert(null==this.m_vertices&&0==this.m_count),t.ENABLE_ASSERTS&&t.b2Assert(o>=2),t.ENABLE_ASSERTS)for(var i=1;o>i;++i){var n=e[i-1],s=e[i];t.b2Assert(t.b2DistanceSquaredVV(n,s)>t.b2_linearSlop*t.b2_linearSlop)}this.m_count=o,this.m_vertices=t.b2Vec2.MakeArray(o);for(var i=0;o>i;++i)this.m_vertices[i].Copy(e[i]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},t.b2ChainShape.prototype.SetPrevVertex=function(e){return this.m_prevVertex.Copy(e),this.m_hasPrevVertex=!0,this},t.b2ChainShape.prototype.SetNextVertex=function(e){return this.m_nextVertex.Copy(e),this.m_hasNextVertex=!0,this},t.b2ChainShape.prototype.Clone=function(){return(new t.b2ChainShape).Copy(this)},t.b2ChainShape.prototype.Copy=function(o){return e.base(this,"Copy",o),t.ENABLE_ASSERTS&&t.b2Assert(o instanceof t.b2ChainShape),this.CreateChain(o.m_vertices,o.m_count),this.m_prevVertex.Copy(o.m_prevVertex),this.m_nextVertex.Copy(o.m_nextVertex),this.m_hasPrevVertex=o.m_hasPrevVertex,this.m_hasNextVertex=o.m_hasNextVertex,this},t.b2ChainShape.prototype.GetChildCount=function(){return this.m_count-1},t.b2ChainShape.prototype.GetChildEdge=function(e,o){t.ENABLE_ASSERTS&&t.b2Assert(o>=0&&o<this.m_count-1),e.m_type=t.b2ShapeType.e_edgeShape,e.m_radius=this.m_radius,e.m_vertex1.Copy(this.m_vertices[o]),e.m_vertex2.Copy(this.m_vertices[o+1]),o>0?(e.m_vertex0.Copy(this.m_vertices[o-1]),e.m_hasVertex0=!0):(e.m_vertex0.Copy(this.m_prevVertex),e.m_hasVertex0=this.m_hasPrevVertex),o<this.m_count-2?(e.m_vertex3.Copy(this.m_vertices[o+2]),e.m_hasVertex3=!0):(e.m_vertex3.Copy(this.m_nextVertex),e.m_hasVertex3=this.m_hasNextVertex)},t.b2ChainShape.prototype.TestPoint=function(){return!1},t.b2ChainShape.prototype.RayCast=function(e,o,i,n){t.ENABLE_ASSERTS&&t.b2Assert(n<this.m_count);var s=t.b2ChainShape.s_edgeShape;return s.m_vertex1.Copy(this.m_vertices[n]),s.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),s.RayCast(e,o,i,0)},t.b2ChainShape.s_edgeShape=new t.b2EdgeShape,t.b2ChainShape.prototype.ComputeAABB=function(e,o,i){t.ENABLE_ASSERTS&&t.b2Assert(i<this.m_count);var n=this.m_vertices[i],s=this.m_vertices[(i+1)%this.m_count],r=t.b2MulXV(o,n,t.b2ChainShape.prototype.ComputeAABB.s_v1),a=t.b2MulXV(o,s,t.b2ChainShape.prototype.ComputeAABB.s_v2);t.b2MinV(r,a,e.lowerBound),t.b2MaxV(r,a,e.upperBound)},t.b2ChainShape.prototype.ComputeAABB.s_v1=new t.b2Vec2,t.b2ChainShape.prototype.ComputeAABB.s_v2=new t.b2Vec2,t.b2ChainShape.prototype.ComputeMass=function(e){e.mass=0,e.center.SetZero(),e.I=0},t.b2ChainShape.prototype.SetupDistanceProxy=function(e,o){t.ENABLE_ASSERTS&&t.b2Assert(o>=0&&o<this.m_count),e.m_buffer[0].Copy(this.m_vertices[o]),o+1<this.m_count?e.m_buffer[1].Copy(this.m_vertices[o+1]):e.m_buffer[1].Copy(this.m_vertices[0]),e.m_vertices=e.m_buffer,e.m_count=2,e.m_radius=this.m_radius},t.b2ChainShape.prototype.ComputeSubmergedArea=function(e,t,o,i){return i.SetZero(),0},t.b2ChainShape.prototype.Dump=function(){t.b2Log("    /*box2d.b2ChainShape*/ var shape = new box2d.b2ChainShape();\n"),t.b2Log("    /*box2d.b2Vec2[]*/ var vs = box2d.b2Vec2.MakeArray(%d);\n",t.b2_maxPolygonVertices);for(var e=0;e<this.m_count;++e)t.b2Log("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t.b2Log("    shape.CreateChain(vs, %d);\n",this.m_count),t.b2Log("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t.b2Log("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t.b2Log("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t.b2Log("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},t}(o,f,p),C=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2CircleShape&&(t.b2CircleShape={}),t.b2CircleShape=function(o){e.base(this,t.b2ShapeType.e_circleShape,o||0),this.m_p=new t.b2Vec2},e.inherits(t.b2CircleShape,t.b2Shape),t.b2CircleShape.prototype.m_p=null,t.b2CircleShape.prototype.Clone=function(){return(new t.b2CircleShape).Copy(this)},t.b2CircleShape.prototype.Copy=function(o){return e.base(this,"Copy",o),t.ENABLE_ASSERTS&&t.b2Assert(o instanceof t.b2CircleShape),this.m_p.Copy(o.m_p),this},t.b2CircleShape.prototype.GetChildCount=function(){return 1},t.b2CircleShape.prototype.TestPoint=function(e,o){var i=t.b2MulXV(e,this.m_p,t.b2CircleShape.prototype.TestPoint.s_center),n=t.b2SubVV(o,i,t.b2CircleShape.prototype.TestPoint.s_d);return t.b2DotVV(n,n)<=t.b2Sq(this.m_radius)},t.b2CircleShape.prototype.TestPoint.s_center=new t.b2Vec2,t.b2CircleShape.prototype.TestPoint.s_d=new t.b2Vec2,t.b2CircleShape.prototype.RayCast=function(e,o,i){var n=t.b2MulXV(i,this.m_p,t.b2CircleShape.prototype.RayCast.s_position),s=t.b2SubVV(o.p1,n,t.b2CircleShape.prototype.RayCast.s_s),r=t.b2DotVV(s,s)-t.b2Sq(this.m_radius),a=t.b2SubVV(o.p2,o.p1,t.b2CircleShape.prototype.RayCast.s_r),l=t.b2DotVV(s,a),p=t.b2DotVV(a,a),b=l*l-p*r;if(0>b||p<t.b2_epsilon)return!1;var m=-(l+t.b2Sqrt(b));return m>=0&&m<=o.maxFraction*p?(m/=p,e.fraction=m,t.b2AddVMulSV(s,m,a,e.normal).SelfNormalize(),!0):!1},t.b2CircleShape.prototype.RayCast.s_position=new t.b2Vec2,t.b2CircleShape.prototype.RayCast.s_s=new t.b2Vec2,t.b2CircleShape.prototype.RayCast.s_r=new t.b2Vec2,t.b2CircleShape.prototype.ComputeAABB=function(e,o){var i=t.b2MulXV(o,this.m_p,t.b2CircleShape.prototype.ComputeAABB.s_p);e.lowerBound.Set(i.x-this.m_radius,i.y-this.m_radius),e.upperBound.Set(i.x+this.m_radius,i.y+this.m_radius)},t.b2CircleShape.prototype.ComputeAABB.s_p=new t.b2Vec2,t.b2CircleShape.prototype.ComputeMass=function(e,o){var i=t.b2Sq(this.m_radius);e.mass=o*t.b2_pi*i,e.center.Copy(this.m_p),e.I=e.mass*(.5*i+t.b2DotVV(this.m_p,this.m_p))},t.b2CircleShape.prototype.SetupDistanceProxy=function(e){e.m_vertices=new Array(1,!0),e.m_vertices[0]=this.m_p,e.m_count=1,e.m_radius=this.m_radius},t.b2CircleShape.prototype.ComputeSubmergedArea=function(e,o,i,n){var s=t.b2MulXV(i,this.m_p,new t.b2Vec2),r=-(t.b2DotVV(e,s)-o);if(r<-this.m_radius+t.b2_epsilon)return 0;if(r>this.m_radius)return n.Copy(s),t.b2_pi*this.m_radius*this.m_radius;var a=this.m_radius*this.m_radius,l=r*r,p=a*(t.b2Asin(r/this.m_radius)+t.b2_pi/2)+r*t.b2Sqrt(a-l),b=-2/3*t.b2Pow(a-l,1.5)/p;return n.x=s.x+e.x*b,n.y=s.y+e.y*b,p},t.b2CircleShape.prototype.Dump=function(){t.b2Log("    /*box2d.b2CircleShape*/ var shape = new box2d.b2CircleShape();\n"),t.b2Log("    shape.m_radius = %.15f;\n",this.m_radius),t.b2Log("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},t}(o,p),v=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2ConstantAccelController&&(t.b2ConstantAccelController={}),t.b2ConstantAccelController=function(){e.base(this),this.A=new t.b2Vec2(0,0)},e.inherits(t.b2ConstantAccelController,t.b2Controller),t.b2ConstantAccelController.prototype.A=null,t.b2ConstantAccelController.prototype.Step=function(e){for(var o=t.b2MulSV(e.dt,this.A,t.b2ConstantAccelController.prototype.Step.s_dtA),i=this.m_bodyList;i;i=i.nextBody){var n=i.body;n.IsAwake()&&n.SetLinearVelocity(t.b2AddVV(n.GetLinearVelocity(),o,t.b2Vec2.s_t0))}},t.b2ConstantAccelController.prototype.Step.s_dtA=new t.b2Vec2,t}(o,c,n,i),A=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2ConstantForceController&&(t.b2ConstantForceController={}),t.b2ConstantForceController=function(){e.base(this),this.F=new t.b2Vec2(0,0)},e.inherits(t.b2ConstantForceController,t.b2Controller),t.b2ConstantForceController.prototype.F=null,t.b2ConstantForceController.prototype.Step=function(){for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())}},t}(o,c,n,i),g=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Timer&&(t.b2Timer={}),t.b2Timer=function(){this.m_start=(new Date).getTime()},t.b2Timer.prototype.m_start=0,t.b2Timer.prototype.Reset=function(){return this.m_start=(new Date).getTime(),this},t.b2Timer.prototype.GetMilliseconds=function(){return(new Date).getTime()-this.m_start},t.b2Counter=function(){},t.b2Counter.prototype.m_count=0,t.b2Counter.prototype.m_min_count=0,t.b2Counter.prototype.m_max_count=0,t.b2Counter.prototype.GetCount=function(){return this.m_count},t.b2Counter.prototype.GetMinCount=function(){return this.m_min_count},t.b2Counter.prototype.GetMaxCount=function(){return this.m_max_count},t.b2Counter.prototype.ResetCount=function(){var e=this.m_count;return this.m_count=0,e},t.b2Counter.prototype.ResetMinCount=function(){this.m_min_count=0},t.b2Counter.prototype.ResetMaxCount=function(){this.m_max_count=0},t.b2Counter.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},t.b2Counter.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},t}(o,i),w=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2TimeOfImpact&&(t.b2TimeOfImpact={}),t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0,t.b2TOIInput=function(){this.proxyA=new t.b2DistanceProxy,this.proxyB=new t.b2DistanceProxy,this.sweepA=new t.b2Sweep,this.sweepB=new t.b2Sweep},t.b2TOIInput.prototype.proxyA=null,t.b2TOIInput.prototype.proxyB=null,t.b2TOIInput.prototype.sweepA=null,t.b2TOIInput.prototype.sweepB=null,t.b2TOIInput.prototype.tMax=0,t.b2TOIOutputState={e_unknown:0,e_failed:1,e_overlapped:2,e_touching:3,e_separated:4},e.exportProperty(t.b2TOIOutputState,"e_unknown",t.b2TOIOutputState.e_unknown),e.exportProperty(t.b2TOIOutputState,"e_failed",t.b2TOIOutputState.e_failed),e.exportProperty(t.b2TOIOutputState,"e_overlapped",t.b2TOIOutputState.e_overlapped),e.exportProperty(t.b2TOIOutputState,"e_touching",t.b2TOIOutputState.e_touching),e.exportProperty(t.b2TOIOutputState,"e_separated",t.b2TOIOutputState.e_separated),t.b2TOIOutput=function(){},t.b2TOIOutput.prototype.state=t.b2TOIOutputState.e_unknown,t.b2TOIOutput.prototype.t=0,t.b2SeparationFunctionType={e_unknown:-1,e_points:0,e_faceA:1,e_faceB:2},e.exportProperty(t.b2SeparationFunctionType,"e_unknown",t.b2SeparationFunctionType.e_unknown),e.exportProperty(t.b2SeparationFunctionType,"e_points",t.b2SeparationFunctionType.e_points),e.exportProperty(t.b2SeparationFunctionType,"e_faceA",t.b2SeparationFunctionType.e_faceA),e.exportProperty(t.b2SeparationFunctionType,"e_faceB",t.b2SeparationFunctionType.e_faceB),t.b2SeparationFunction=function(){this.m_sweepA=new t.b2Sweep,this.m_sweepB=new t.b2Sweep,this.m_localPoint=new t.b2Vec2,this.m_axis=new t.b2Vec2},t.b2SeparationFunction.prototype.m_proxyA=null,t.b2SeparationFunction.prototype.m_proxyB=null,t.b2SeparationFunction.prototype.m_sweepA=null,t.b2SeparationFunction.prototype.m_sweepB=null,t.b2SeparationFunction.prototype.m_type=t.b2SeparationFunctionType.e_unknown,t.b2SeparationFunction.prototype.m_localPoint=null,t.b2SeparationFunction.prototype.m_axis=null,t.b2SeparationFunction.prototype.Initialize=function(e,o,i,n,s,r){this.m_proxyA=o,this.m_proxyB=n;var a=e.count;t.ENABLE_ASSERTS&&t.b2Assert(a>0&&3>a),this.m_sweepA.Copy(i),this.m_sweepB.Copy(s);var l=t.b2TimeOfImpact.s_xfA,p=t.b2TimeOfImpact.s_xfB;if(this.m_sweepA.GetTransform(l,r),this.m_sweepB.GetTransform(p,r),1==a){this.m_type=t.b2SeparationFunctionType.e_points;var b=this.m_proxyA.GetVertex(e.indexA[0]),m=this.m_proxyB.GetVertex(e.indexB[0]),_=t.b2MulXV(l,b,t.b2TimeOfImpact.s_pointA),d=t.b2MulXV(p,m,t.b2TimeOfImpact.s_pointB);t.b2SubVV(d,_,this.m_axis);var h=this.m_axis.Normalize();return h}if(e.indexA[0]==e.indexA[1]){this.m_type=t.b2SeparationFunctionType.e_faceB;var c=this.m_proxyB.GetVertex(e.indexB[0]),u=this.m_proxyB.GetVertex(e.indexB[1]);t.b2CrossVOne(t.b2SubVV(u,c,t.b2Vec2.s_t0),this.m_axis).SelfNormalize();var y=t.b2MulRV(p.q,this.m_axis,t.b2TimeOfImpact.s_normal);t.b2MidVV(c,u,this.m_localPoint);var d=t.b2MulXV(p,this.m_localPoint,t.b2TimeOfImpact.s_pointB),b=this.m_proxyA.GetVertex(e.indexA[0]),_=t.b2MulXV(l,b,t.b2TimeOfImpact.s_pointA),h=t.b2DotVV(t.b2SubVV(_,d,t.b2Vec2.s_t0),y);return 0>h&&(this.m_axis.SelfNeg(),h=-h),h}this.m_type=t.b2SeparationFunctionType.e_faceA;var f=this.m_proxyA.GetVertex(e.indexA[0]),S=this.m_proxyA.GetVertex(e.indexA[1]);t.b2CrossVOne(t.b2SubVV(S,f,t.b2Vec2.s_t0),this.m_axis).SelfNormalize();var y=t.b2MulRV(l.q,this.m_axis,t.b2TimeOfImpact.s_normal);t.b2MidVV(f,S,this.m_localPoint);var _=t.b2MulXV(l,this.m_localPoint,t.b2TimeOfImpact.s_pointA),m=this.m_proxyB.GetVertex(e.indexB[0]),d=t.b2MulXV(p,m,t.b2TimeOfImpact.s_pointB),h=t.b2DotVV(t.b2SubVV(d,_,t.b2Vec2.s_t0),y);return 0>h&&(this.m_axis.SelfNeg(),h=-h),h},t.b2SeparationFunction.prototype.FindMinSeparation=function(e,o,i){var n=t.b2TimeOfImpact.s_xfA,s=t.b2TimeOfImpact.s_xfB;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(s,i),this.m_type){case t.b2SeparationFunctionType.e_points:var r=t.b2MulTRV(n.q,this.m_axis,t.b2TimeOfImpact.s_axisA),a=t.b2MulTRV(s.q,t.b2NegV(this.m_axis,t.b2Vec2.s_t0),t.b2TimeOfImpact.s_axisB);e[0]=this.m_proxyA.GetSupport(r),o[0]=this.m_proxyB.GetSupport(a);var l=this.m_proxyA.GetVertex(e[0]),p=this.m_proxyB.GetVertex(o[0]),b=t.b2MulXV(n,l,t.b2TimeOfImpact.s_pointA),m=t.b2MulXV(s,p,t.b2TimeOfImpact.s_pointB),_=t.b2DotVV(t.b2SubVV(m,b,t.b2Vec2.s_t0),this.m_axis);return _;case t.b2SeparationFunctionType.e_faceA:var d=t.b2MulRV(n.q,this.m_axis,t.b2TimeOfImpact.s_normal),b=t.b2MulXV(n,this.m_localPoint,t.b2TimeOfImpact.s_pointA),a=t.b2MulTRV(s.q,t.b2NegV(d,t.b2Vec2.s_t0),t.b2TimeOfImpact.s_axisB);e[0]=-1,o[0]=this.m_proxyB.GetSupport(a);var p=this.m_proxyB.GetVertex(o[0]),m=t.b2MulXV(s,p,t.b2TimeOfImpact.s_pointB),_=t.b2DotVV(t.b2SubVV(m,b,t.b2Vec2.s_t0),d);return _;case t.b2SeparationFunctionType.e_faceB:var d=t.b2MulRV(s.q,this.m_axis,t.b2TimeOfImpact.s_normal),m=t.b2MulXV(s,this.m_localPoint,t.b2TimeOfImpact.s_pointB),r=t.b2MulTRV(n.q,t.b2NegV(d,t.b2Vec2.s_t0),t.b2TimeOfImpact.s_axisA);o[0]=-1,e[0]=this.m_proxyA.GetSupport(r);var l=this.m_proxyA.GetVertex(e[0]),b=t.b2MulXV(n,l,t.b2TimeOfImpact.s_pointA),_=t.b2DotVV(t.b2SubVV(b,m,t.b2Vec2.s_t0),d);return _;default:return t.ENABLE_ASSERTS&&t.b2Assert(!1),e[0]=-1,o[0]=-1,0}},t.b2SeparationFunction.prototype.Evaluate=function(e,o,i){var n=t.b2TimeOfImpact.s_xfA,s=t.b2TimeOfImpact.s_xfB;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(s,i),this.m_type){case t.b2SeparationFunctionType.e_points:var r=this.m_proxyA.GetVertex(e),a=this.m_proxyB.GetVertex(o),l=t.b2MulXV(n,r,t.b2TimeOfImpact.s_pointA),p=t.b2MulXV(s,a,t.b2TimeOfImpact.s_pointB),b=t.b2DotVV(t.b2SubVV(p,l,t.b2Vec2.s_t0),this.m_axis);return b;case t.b2SeparationFunctionType.e_faceA:var m=t.b2MulRV(n.q,this.m_axis,t.b2TimeOfImpact.s_normal),l=t.b2MulXV(n,this.m_localPoint,t.b2TimeOfImpact.s_pointA),a=this.m_proxyB.GetVertex(o),p=t.b2MulXV(s,a,t.b2TimeOfImpact.s_pointB),b=t.b2DotVV(t.b2SubVV(p,l,t.b2Vec2.s_t0),m);return b;case t.b2SeparationFunctionType.e_faceB:var m=t.b2MulRV(s.q,this.m_axis,t.b2TimeOfImpact.s_normal),p=t.b2MulXV(s,this.m_localPoint,t.b2TimeOfImpact.s_pointB),r=this.m_proxyA.GetVertex(e),l=t.b2MulXV(n,r,t.b2TimeOfImpact.s_pointA),b=t.b2DotVV(t.b2SubVV(l,p,t.b2Vec2.s_t0),m);return b;default:return t.ENABLE_ASSERTS&&t.b2Assert(!1),0}},t.b2TimeOfImpact=function(e,o){var i=t.b2TimeOfImpact.s_timer.Reset();++t.b2_toiCalls,e.state=t.b2TOIOutputState.e_unknown,e.t=o.tMax;var n=o.proxyA,s=o.proxyB,r=t.b2TimeOfImpact.s_sweepA.Copy(o.sweepA),a=t.b2TimeOfImpact.s_sweepB.Copy(o.sweepB);r.Normalize(),a.Normalize();var l=o.tMax,p=n.m_radius+s.m_radius,b=t.b2Max(t.b2_linearSlop,p-3*t.b2_linearSlop),m=.25*t.b2_linearSlop;t.ENABLE_ASSERTS&&t.b2Assert(b>m);var _=0,d=20,h=0,c=t.b2TimeOfImpact.s_cache;c.count=0;var u=t.b2TimeOfImpact.s_distanceInput;for(u.proxyA=o.proxyA,u.proxyB=o.proxyB,u.useRadii=!1;;){var y=t.b2TimeOfImpact.s_xfA,f=t.b2TimeOfImpact.s_xfB;r.GetTransform(y,_),a.GetTransform(f,_),u.transformA.Copy(y),u.transformB.Copy(f);var S=t.b2TimeOfImpact.s_distanceOutput;if(t.b2Distance(S,c,u),S.distance<=0){e.state=t.b2TOIOutputState.e_overlapped,e.t=0;break}if(S.distance<b+m){e.state=t.b2TOIOutputState.e_touching,e.t=_;break}var C=t.b2TimeOfImpact.s_fcn;C.Initialize(c,n,r,s,a,_);for(var v=!1,A=l,g=0;;){var w=t.b2TimeOfImpact.s_indexA,x=t.b2TimeOfImpact.s_indexB,B=C.FindMinSeparation(w,x,A);if(B>b+m){e.state=t.b2TOIOutputState.e_separated,e.t=l,v=!0;break}if(B>b-m){_=A;break}var V=C.Evaluate(w[0],x[0],_);if(b-m>V){e.state=t.b2TOIOutputState.e_failed,e.t=_,v=!0;break}if(b+m>=V){e.state=t.b2TOIOutputState.e_touching,e.t=_,v=!0;break}for(var T=0,M=_,D=A;;){var E=0;E=1&T?M+(b-V)*(D-M)/(B-V):.5*(M+D),++T,++t.b2_toiRootIters;var P=C.Evaluate(w[0],x[0],E);if(t.b2Abs(P-b)<m){A=E;break}if(P>b?(M=E,V=P):(D=E,B=P),50==T)break}if(t.b2_toiMaxRootIters=t.b2Max(t.b2_toiMaxRootIters,T),++g,g==t.b2_maxPolygonVertices)break}if(++h,++t.b2_toiIters,v)break;if(h==d){e.state=t.b2TOIOutputState.e_failed,e.t=_;break}}t.b2_toiMaxIters=t.b2Max(t.b2_toiMaxIters,h);var R=i.GetMilliseconds();t.b2_toiMaxTime=t.b2Max(t.b2_toiMaxTime,R),t.b2_toiTime+=R},t.b2TimeOfImpact.s_timer=new t.b2Timer,t.b2TimeOfImpact.s_cache=new t.b2SimplexCache,t.b2TimeOfImpact.s_distanceInput=new t.b2DistanceInput,t.b2TimeOfImpact.s_distanceOutput=new t.b2DistanceOutput,t.b2TimeOfImpact.s_xfA=new t.b2Transform,t.b2TimeOfImpact.s_xfB=new t.b2Transform,t.b2TimeOfImpact.s_indexA=t.b2MakeNumberArray(1),t.b2TimeOfImpact.s_indexB=t.b2MakeNumberArray(1),t.b2TimeOfImpact.s_fcn=new t.b2SeparationFunction,t.b2TimeOfImpact.s_sweepA=new t.b2Sweep,t.b2TimeOfImpact.s_sweepB=new t.b2Sweep,t.b2TimeOfImpact.s_pointA=new t.b2Vec2,t.b2TimeOfImpact.s_pointB=new t.b2Vec2,t.b2TimeOfImpact.s_normal=new t.b2Vec2,t.b2TimeOfImpact.s_axisA=new t.b2Vec2,t.b2TimeOfImpact.s_axisB=new t.b2Vec2,t}(o,a,n,i,g),x=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Contact&&(t.b2Contact={}),t.b2MixFriction=function(e,o){return t.b2Sqrt(e*o)},t.b2MixRestitution=function(e,t){return e>t?e:t},t.b2ContactEdge=function(){},t.b2ContactEdge.prototype.other=null,t.b2ContactEdge.prototype.contact=null,t.b2ContactEdge.prototype.prev=null,t.b2ContactEdge.prototype.next=null,t.b2ContactFlag={e_none:0,e_islandFlag:1,e_touchingFlag:2,e_enabledFlag:4,e_filterFlag:8,e_bulletHitFlag:16,e_toiFlag:32},e.exportProperty(t.b2ContactFlag,"e_none",t.b2ContactFlag.e_none),e.exportProperty(t.b2ContactFlag,"e_islandFlag",t.b2ContactFlag.e_islandFlag),e.exportProperty(t.b2ContactFlag,"e_touchingFlag",t.b2ContactFlag.e_touchingFlag),e.exportProperty(t.b2ContactFlag,"e_enabledFlag",t.b2ContactFlag.e_enabledFlag),e.exportProperty(t.b2ContactFlag,"e_filterFlag",t.b2ContactFlag.e_filterFlag),e.exportProperty(t.b2ContactFlag,"e_bulletHitFlag",t.b2ContactFlag.e_bulletHitFlag),e.exportProperty(t.b2ContactFlag,"e_toiFlag",t.b2ContactFlag.e_toiFlag),t.b2Contact=function(){this.m_nodeA=new t.b2ContactEdge,this.m_nodeB=new t.b2ContactEdge,this.m_manifold=new t.b2Manifold,this.m_oldManifold=new t.b2Manifold},t.b2Contact.prototype.m_flags=t.b2ContactFlag.e_none,t.b2Contact.prototype.m_prev=null,t.b2Contact.prototype.m_next=null,t.b2Contact.prototype.m_nodeA=null,t.b2Contact.prototype.m_nodeB=null,t.b2Contact.prototype.m_fixtureA=null,t.b2Contact.prototype.m_fixtureB=null,t.b2Contact.prototype.m_indexA=0,t.b2Contact.prototype.m_indexB=0,t.b2Contact.prototype.m_manifold=null,t.b2Contact.prototype.m_toiCount=0,t.b2Contact.prototype.m_toi=0,t.b2Contact.prototype.m_friction=0,t.b2Contact.prototype.m_restitution=0,t.b2Contact.prototype.m_tangentSpeed=0,t.b2Contact.prototype.m_oldManifold=null,t.b2Contact.prototype.GetManifold=function(){return this.m_manifold
},t.b2Contact.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody(),i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),i.m_radius,o.GetTransform(),n.m_radius)},t.b2Contact.prototype.IsTouching=function(){return(this.m_flags&t.b2ContactFlag.e_touchingFlag)==t.b2ContactFlag.e_touchingFlag},t.b2Contact.prototype.SetEnabled=function(e){e?this.m_flags|=t.b2ContactFlag.e_enabledFlag:this.m_flags&=~t.b2ContactFlag.e_enabledFlag},t.b2Contact.prototype.IsEnabled=function(){return(this.m_flags&t.b2ContactFlag.e_enabledFlag)==t.b2ContactFlag.e_enabledFlag},t.b2Contact.prototype.GetNext=function(){return this.m_next},t.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},t.b2Contact.prototype.GetChildIndexA=function(){return this.m_indexA},t.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},t.b2Contact.prototype.GetChildIndexB=function(){return this.m_indexB},t.b2Contact.prototype.Evaluate=function(){},t.b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=t.b2ContactFlag.e_filterFlag},t.b2Contact.prototype.SetFriction=function(e){this.m_friction=e},t.b2Contact.prototype.GetFriction=function(){return this.m_friction},t.b2Contact.prototype.ResetFriction=function(){this.m_friction=t.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},t.b2Contact.prototype.SetRestitution=function(e){this.m_restitution=e},t.b2Contact.prototype.GetRestitution=function(){return this.m_restitution},t.b2Contact.prototype.ResetRestitution=function(){this.m_restitution=t.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.b2Contact.prototype.SetTangentSpeed=function(e){this.m_tangentSpeed=e},t.b2Contact.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},t.b2Contact.prototype.Reset=function(e,o,i,n){this.m_flags=t.b2ContactFlag.e_enabledFlag,this.m_fixtureA=e,this.m_fixtureB=i,this.m_indexA=o,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,this.m_friction=t.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=t.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.b2Contact.prototype.Update=function(e){var o=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=o,this.m_flags|=t.b2ContactFlag.e_enabledFlag;var i=!1,n=(this.m_flags&t.b2ContactFlag.e_touchingFlag)==t.b2ContactFlag.e_touchingFlag,s=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),a=s||r,l=this.m_fixtureA.GetBody(),p=this.m_fixtureB.GetBody(),b=l.GetTransform(),m=p.GetTransform();if(a){var _=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape();i=t.b2TestOverlapShape(_,this.m_indexA,d,this.m_indexB,b,m),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,b,m),i=this.m_manifold.pointCount>0;for(var h=0;h<this.m_manifold.pointCount;++h){var c=this.m_manifold.points[h];c.normalImpulse=0,c.tangentImpulse=0;for(var u=c.id,y=0;y<this.m_oldManifold.pointCount;++y){var f=this.m_oldManifold.points[y];if(f.id.key==u.key){c.normalImpulse=f.normalImpulse,c.tangentImpulse=f.tangentImpulse;break}}}i!=n&&(l.SetAwake(!0),p.SetAwake(!0))}i?this.m_flags|=t.b2ContactFlag.e_touchingFlag:this.m_flags&=~t.b2ContactFlag.e_touchingFlag,0==n&&1==i&&e&&e.BeginContact(this),1==n&&0==i&&e&&e.EndContact(this),0==a&&i&&e&&e.PreSolve(this,this.m_oldManifold)},t.b2Contact.prototype.ComputeTOI=function(e,o){var i=t.b2Contact.prototype.ComputeTOI.s_input;i.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),i.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),i.sweepA.Copy(e),i.sweepB.Copy(o),i.tMax=t.b2_linearSlop;var n=t.b2Contact.prototype.ComputeTOI.s_output;return t.b2TimeOfImpact(n,i),n.t},t.b2Contact.prototype.ComputeTOI.s_input=new t.b2TOIInput,t.b2Contact.prototype.ComputeTOI.s_output=new t.b2TOIOutput,t}(o,l,i,w),B=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2DistanceJoint&&(t.b2DistanceJoint={}),t.b2DistanceJointDef=function(){e.base(this,t.b2JointType.e_distanceJoint),this.localAnchorA=new t.b2Vec2,this.localAnchorB=new t.b2Vec2},e.inherits(t.b2DistanceJointDef,t.b2JointDef),t.b2DistanceJointDef.prototype.localAnchorA=null,t.b2DistanceJointDef.prototype.localAnchorB=null,t.b2DistanceJointDef.prototype.length=1,t.b2DistanceJointDef.prototype.frequencyHz=0,t.b2DistanceJointDef.prototype.dampingRatio=0,t.b2DistanceJointDef.prototype.Initialize=function(e,o,i,n){this.bodyA=e,this.bodyB=o,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.length=t.b2DistanceVV(i,n),this.frequencyHz=0,this.dampingRatio=0},t.b2DistanceJoint=function(o){e.base(this,o),this.m_u=new t.b2Vec2,this.m_rA=new t.b2Vec2,this.m_rB=new t.b2Vec2,this.m_localCenterA=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2,this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_length=o.length},e.inherits(t.b2DistanceJoint,t.b2Joint),t.b2DistanceJoint.prototype.m_frequencyHz=0,t.b2DistanceJoint.prototype.m_dampingRatio=0,t.b2DistanceJoint.prototype.m_bias=0,t.b2DistanceJoint.prototype.m_localAnchorA=null,t.b2DistanceJoint.prototype.m_localAnchorB=null,t.b2DistanceJoint.prototype.m_gamma=0,t.b2DistanceJoint.prototype.m_impulse=0,t.b2DistanceJoint.prototype.m_length=0,t.b2DistanceJoint.prototype.m_indexA=0,t.b2DistanceJoint.prototype.m_indexB=0,t.b2DistanceJoint.prototype.m_u=null,t.b2DistanceJoint.prototype.m_rA=null,t.b2DistanceJoint.prototype.m_rB=null,t.b2DistanceJoint.prototype.m_localCenterA=null,t.b2DistanceJoint.prototype.m_localCenterB=null,t.b2DistanceJoint.prototype.m_invMassA=0,t.b2DistanceJoint.prototype.m_invMassB=0,t.b2DistanceJoint.prototype.m_invIA=0,t.b2DistanceJoint.prototype.m_invIB=0,t.b2DistanceJoint.prototype.m_mass=0,t.b2DistanceJoint.prototype.m_qA=null,t.b2DistanceJoint.prototype.m_qB=null,t.b2DistanceJoint.prototype.m_lalcA=null,t.b2DistanceJoint.prototype.m_lalcB=null,t.b2DistanceJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2DistanceJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2DistanceJoint.prototype.GetReactionForce=function(e,t){return t.Set(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},t.b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},t.b2DistanceJoint.prototype.GetLocalAnchorA=function(e){return e.Copy(this.m_localAnchorA)},t.b2DistanceJoint.prototype.GetLocalAnchorB=function(e){return e.Copy(this.m_localAnchorB)},t.b2DistanceJoint.prototype.SetLength=function(e){this.m_length=e},t.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},t.b2DistanceJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e},t.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},t.b2DistanceJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},t.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},t.b2DistanceJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2DistanceJointDef*/ var jd = new box2d.b2DistanceJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t.b2Log("  jd.length = %.15f;\n",this.m_length),t.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t.b2DistanceJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,r=e.positions[this.m_indexB].c,a=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,p=e.velocities[this.m_indexB].w,b=this.m_qA.SetAngleRadians(i),m=this.m_qB.SetAngleRadians(a);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),t.b2MulRV(b,this.m_lalcA,this.m_rA),t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),t.b2MulRV(m,this.m_lalcB,this.m_rB),this.m_u.x=r.x+this.m_rB.x-o.x-this.m_rA.x,this.m_u.y=r.y+this.m_rB.y-o.y-this.m_rA.y;var _=this.m_u.GetLength();_>t.b2_linearSlop?this.m_u.SelfMul(1/_):this.m_u.SetZero();var d=t.b2CrossVV(this.m_rA,this.m_u),h=t.b2CrossVV(this.m_rB,this.m_u),c=this.m_invMassA+this.m_invIA*d*d+this.m_invMassB+this.m_invIB*h*h;if(this.m_mass=0!=c?1/c:0,this.m_frequencyHz>0){var u=_-this.m_length,y=2*t.b2_pi*this.m_frequencyHz,f=2*this.m_mass*this.m_dampingRatio*y,S=this.m_mass*y*y,C=e.step.dt;this.m_gamma=C*(f+C*S),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=u*C*S*this.m_gamma,c+=this.m_gamma,this.m_mass=0!=c?1/c:0}else this.m_gamma=0,this.m_bias=0;if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var v=t.b2MulSV(this.m_impulse,this.m_u,t.b2DistanceJoint.prototype.InitVelocityConstraints.s_P);n.SelfMulSub(this.m_invMassA,v),s-=this.m_invIA*t.b2CrossVV(this.m_rA,v),l.SelfMulAdd(this.m_invMassB,v),p+=this.m_invIB*t.b2CrossVV(this.m_rB,v)}else this.m_impulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=p},t.b2DistanceJoint.prototype.InitVelocityConstraints.s_P=new t.b2Vec2,t.b2DistanceJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=t.b2AddVCrossSV(o,i,this.m_rA,t.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpA),a=t.b2AddVCrossSV(n,s,this.m_rB,t.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpB),l=t.b2DotVV(this.m_u,t.b2SubVV(a,r,t.b2Vec2.s_t0)),p=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=p;var b=t.b2MulSV(p,this.m_u,t.b2DistanceJoint.prototype.SolveVelocityConstraints.s_P);o.SelfMulSub(this.m_invMassA,b),i-=this.m_invIA*t.b2CrossVV(this.m_rA,b),n.SelfMulAdd(this.m_invMassB,b),s+=this.m_invIB*t.b2CrossVV(this.m_rB,b),e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s},t.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpA=new t.b2Vec2,t.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpB=new t.b2Vec2,t.b2DistanceJoint.prototype.SolveVelocityConstraints.s_P=new t.b2Vec2,t.b2DistanceJoint.prototype.SolvePositionConstraints=function(e){if(this.m_frequencyHz>0)return!0;var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.positions[this.m_indexB].c,s=e.positions[this.m_indexB].a,r=(this.m_qA.SetAngleRadians(i),this.m_qB.SetAngleRadians(s),t.b2MulRV(this.m_qA,this.m_lalcA,this.m_rA)),a=t.b2MulRV(this.m_qB,this.m_lalcB,this.m_rB),l=this.m_u;l.x=n.x+a.x-o.x-r.x,l.y=n.y+a.y-o.y-r.y;var p=this.m_u.Normalize(),b=p-this.m_length;b=t.b2Clamp(b,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var m=-this.m_mass*b,_=t.b2MulSV(m,l,t.b2DistanceJoint.prototype.SolvePositionConstraints.s_P);return o.SelfMulSub(this.m_invMassA,_),i-=this.m_invIA*t.b2CrossVV(r,_),n.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*t.b2CrossVV(a,_),e.positions[this.m_indexA].a=i,e.positions[this.m_indexB].a=s,t.b2Abs(b)<t.b2_linearSlop},t.b2DistanceJoint.prototype.SolvePositionConstraints.s_P=new t.b2Vec2,t}(o,s,n,i),V=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Draw&&(t.b2Draw={}),t.b2Color=function(e,t,o){this.r=e,this.g=t,this.b=o},t.b2Color.prototype.r=.5,t.b2Color.prototype.g=.5,t.b2Color.prototype.b=.5,t.b2Color.prototype.SetRGB=function(e,t,o){return this.r=e,this.g=t,this.b=o,this},t.b2Color.prototype.MakeStyleString=function(e){var o=Math.round(Math.max(0,Math.min(255,255*this.r))),i=Math.round(Math.max(0,Math.min(255,255*this.g))),n=Math.round(Math.max(0,Math.min(255,255*this.b))),s="undefined"==typeof e?1:Math.max(0,Math.min(1,e));return t.b2Color.MakeStyleString(o,i,n,s)},t.b2Color.MakeStyleString=function(e,t,o,i){return 1>i?"rgba("+e+","+t+","+o+","+i+")":"rgb("+e+","+t+","+o+")"},t.b2Color.RED=new t.b2Color(1,0,0),t.b2Color.GREEN=new t.b2Color(0,1,0),t.b2Color.BLUE=new t.b2Color(0,0,1),t.b2DrawFlags={e_none:0,e_shapeBit:1,e_jointBit:2,e_aabbBit:4,e_pairBit:8,e_centerOfMassBit:16,e_controllerBit:32,e_all:63},e.exportProperty(t.b2DrawFlags,"e_none",t.b2DrawFlags.e_none),e.exportProperty(t.b2DrawFlags,"e_shapeBit",t.b2DrawFlags.e_shapeBit),e.exportProperty(t.b2DrawFlags,"e_jointBit",t.b2DrawFlags.e_jointBit),e.exportProperty(t.b2DrawFlags,"e_aabbBit",t.b2DrawFlags.e_aabbBit),e.exportProperty(t.b2DrawFlags,"e_pairBit",t.b2DrawFlags.e_pairBit),e.exportProperty(t.b2DrawFlags,"e_centerOfMassBit",t.b2DrawFlags.e_centerOfMassBit),e.exportProperty(t.b2DrawFlags,"e_controllerBit",t.b2DrawFlags.e_controllerBit),e.exportProperty(t.b2DrawFlags,"e_all",t.b2DrawFlags.e_all),t.b2Draw=function(){},t.b2Draw.prototype.m_drawFlags=t.b2DrawFlags.e_none,t.b2Draw.prototype.SetFlags=function(e){this.m_drawFlags=e},t.b2Draw.prototype.GetFlags=function(){return this.m_drawFlags},t.b2Draw.prototype.AppendFlags=function(e){this.m_drawFlags|=e},t.b2Draw.prototype.ClearFlags=function(e){this.m_drawFlags&=~e},t.b2Draw.prototype.PushTransform=function(){},t.b2Draw.prototype.PopTransform=function(){},t.b2Draw.prototype.DrawPolygon=function(){},t.b2Draw.prototype.DrawSolidPolygon=function(){},t.b2Draw.prototype.DrawCircle=function(){},t.b2Draw.prototype.DrawSolidCircle=function(){},t.b2Draw.prototype.DrawSegment=function(){},t.b2Draw.prototype.DrawTransform=function(){},t}(o,i),T=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2FrictionJoint&&(t.b2FrictionJoint={}),t.b2FrictionJointDef=function(){e.base(this,t.b2JointType.e_frictionJoint),this.localAnchorA=new t.b2Vec2,this.localAnchorB=new t.b2Vec2},e.inherits(t.b2FrictionJointDef,t.b2JointDef),t.b2FrictionJointDef.prototype.localAnchorA=null,t.b2FrictionJointDef.prototype.localAnchorB=null,t.b2FrictionJointDef.prototype.maxForce=0,t.b2FrictionJointDef.prototype.maxTorque=0,t.b2FrictionJointDef.prototype.Initialize=function(e,t,o){this.bodyA=e,this.bodyB=t,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB)},t.b2FrictionJoint=function(o){e.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_linearImpulse=(new t.b2Vec2).SetZero(),this.m_maxForce=o.maxForce,this.m_maxTorque=o.maxTorque,this.m_rA=new t.b2Vec2,this.m_rB=new t.b2Vec2,this.m_localCenterA=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_linearMass=(new t.b2Mat22).SetZero(),this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2,this.m_K=new t.b2Mat22},e.inherits(t.b2FrictionJoint,t.b2Joint),t.b2FrictionJoint.prototype.m_localAnchorA=null,t.b2FrictionJoint.prototype.m_localAnchorB=null,t.b2FrictionJoint.prototype.m_linearImpulse=null,t.b2FrictionJoint.prototype.m_angularImpulse=0,t.b2FrictionJoint.prototype.m_maxForce=0,t.b2FrictionJoint.prototype.m_maxTorque=0,t.b2FrictionJoint.prototype.m_indexA=0,t.b2FrictionJoint.prototype.m_indexB=0,t.b2FrictionJoint.prototype.m_rA=null,t.b2FrictionJoint.prototype.m_rB=null,t.b2FrictionJoint.prototype.m_localCenterA=null,t.b2FrictionJoint.prototype.m_localCenterB=null,t.b2FrictionJoint.prototype.m_invMassA=0,t.b2FrictionJoint.prototype.m_invMassB=0,t.b2FrictionJoint.prototype.m_invIA=0,t.b2FrictionJoint.prototype.m_invIB=0,t.b2FrictionJoint.prototype.m_linearMass=null,t.b2FrictionJoint.prototype.m_angularMass=0,t.b2FrictionJoint.prototype.m_qA=null,t.b2FrictionJoint.prototype.m_qB=null,t.b2FrictionJoint.prototype.m_lalcA=null,t.b2FrictionJoint.prototype.m_lalcB=null,t.b2FrictionJoint.prototype.m_K=null,t.b2FrictionJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexA].a,i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,s=e.positions[this.m_indexB].a,r=e.velocities[this.m_indexB].v,a=e.velocities[this.m_indexB].w,l=this.m_qA.SetAngleRadians(o),p=this.m_qB.SetAngleRadians(s);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var b=t.b2MulRV(l,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m=t.b2MulRV(p,this.m_lalcB,this.m_rB),_=this.m_invMassA,d=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,u=this.m_K;if(u.ex.x=_+d+h*b.y*b.y+c*m.y*m.y,u.ex.y=-h*b.x*b.y-c*m.x*m.y,u.ey.x=u.ex.y,u.ey.y=_+d+h*b.x*b.x+c*m.x*m.x,u.GetInverse(this.m_linearMass),this.m_angularMass=h+c,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.step.warmStarting){this.m_linearImpulse.SelfMul(e.step.dtRatio),this.m_angularImpulse*=e.step.dtRatio;var y=this.m_linearImpulse;i.SelfMulSub(_,y),n-=h*(t.b2CrossVV(this.m_rA,y)+this.m_angularImpulse),r.SelfMulAdd(d,y),a+=c*(t.b2CrossVV(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=a},t.b2FrictionJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB,b=e.step.dt,m=s-i,_=-this.m_angularMass*m,d=this.m_angularImpulse,h=b*this.m_maxTorque;this.m_angularImpulse=t.b2Clamp(this.m_angularImpulse+_,-h,h),_=this.m_angularImpulse-d,i-=l*_,s+=p*_;var m=t.b2SubVV(t.b2AddVCrossSV(n,s,this.m_rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(o,i,this.m_rA,t.b2Vec2.s_t1),t.b2FrictionJoint.prototype.SolveVelocityConstraints.s_Cdot),c=t.b2MulMV(this.m_linearMass,m,t.b2FrictionJoint.prototype.SolveVelocityConstraints.s_impulseV).SelfNeg(),u=t.b2FrictionJoint.prototype.SolveVelocityConstraints.s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(c);var h=b*this.m_maxForce;this.m_linearImpulse.GetLengthSquared()>h*h&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(h)),t.b2SubVV(this.m_linearImpulse,u,c),o.SelfMulSub(r,c),i-=l*t.b2CrossVV(this.m_rA,c),n.SelfMulAdd(a,c),s+=p*t.b2CrossVV(this.m_rB,c),e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s},t.b2FrictionJoint.prototype.SolveVelocityConstraints.s_Cdot=new t.b2Vec2,t.b2FrictionJoint.prototype.SolveVelocityConstraints.s_impulseV=new t.b2Vec2,t.b2FrictionJoint.prototype.SolveVelocityConstraints.s_oldImpulseV=new t.b2Vec2,t.b2FrictionJoint.prototype.SolvePositionConstraints=function(){return!0},t.b2FrictionJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2FrictionJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2FrictionJoint.prototype.GetReactionForce=function(e,t){return t.Set(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},t.b2FrictionJoint.prototype.GetReactionTorque=function(e){return e*this.m_angularImpulse},t.b2FrictionJoint.prototype.GetLocalAnchorA=function(e){return e.Copy(this.m_localAnchorA)},t.b2FrictionJoint.prototype.GetLocalAnchorB=function(e){return e.Copy(this.m_localAnchorB)},t.b2FrictionJoint.prototype.SetMaxForce=function(e){this.m_maxForce=e},t.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},t.b2FrictionJoint.prototype.SetMaxTorque=function(e){this.m_maxTorque=e},t.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},t.b2FrictionJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2FrictionJointDef*/ var jd = new box2d.b2FrictionJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t.b2Log("  jd.maxForce = %.15f;\n",this.m_maxForce),t.b2Log("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t}(o,s,n,i),M=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2PrismaticJoint&&(t.b2PrismaticJoint={}),t.b2PrismaticJointDef=function(){e.base(this,t.b2JointType.e_prismaticJoint),this.localAnchorA=new t.b2Vec2,this.localAnchorB=new t.b2Vec2,this.localAxisA=new t.b2Vec2(1,0)},e.inherits(t.b2PrismaticJointDef,t.b2JointDef),t.b2PrismaticJointDef.prototype.localAnchorA=null,t.b2PrismaticJointDef.prototype.localAnchorB=null,t.b2PrismaticJointDef.prototype.localAxisA=null,t.b2PrismaticJointDef.prototype.referenceAngle=0,t.b2PrismaticJointDef.prototype.enableLimit=!1,t.b2PrismaticJointDef.prototype.lowerTranslation=0,t.b2PrismaticJointDef.prototype.upperTranslation=0,t.b2PrismaticJointDef.prototype.enableMotor=!1,t.b2PrismaticJointDef.prototype.maxMotorForce=0,t.b2PrismaticJointDef.prototype.motorSpeed=0,t.b2PrismaticJointDef.prototype.Initialize=function(e,t,o,i){this.bodyA=e,this.bodyB=t,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},t.b2PrismaticJoint=function(o){e.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_localXAxisA=o.localAxisA.Clone().SelfNormalize(),this.m_localYAxisA=t.b2CrossOneV(this.m_localXAxisA,new t.b2Vec2),this.m_referenceAngle=o.referenceAngle,this.m_impulse=new t.b2Vec3(0,0,0),this.m_lowerTranslation=o.lowerTranslation,this.m_upperTranslation=o.upperTranslation,this.m_maxMotorForce=o.maxMotorForce,this.m_motorSpeed=o.motorSpeed,this.m_enableLimit=o.enableLimit,this.m_enableMotor=o.enableMotor,this.m_localCenterA=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_axis=new t.b2Vec2(0,0),this.m_perp=new t.b2Vec2(0,0),this.m_K=new t.b2Mat33,this.m_K3=new t.b2Mat33,this.m_K2=new t.b2Mat22,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2,this.m_rA=new t.b2Vec2,this.m_rB=new t.b2Vec2},e.inherits(t.b2PrismaticJoint,t.b2Joint),t.b2PrismaticJoint.prototype.m_localAnchorA=null,t.b2PrismaticJoint.prototype.m_localAnchorB=null,t.b2PrismaticJoint.prototype.m_localXAxisA=null,t.b2PrismaticJoint.prototype.m_localYAxisA=null,t.b2PrismaticJoint.prototype.m_referenceAngle=0,t.b2PrismaticJoint.prototype.m_impulse=null,t.b2PrismaticJoint.prototype.m_motorImpulse=0,t.b2PrismaticJoint.prototype.m_lowerTranslation=0,t.b2PrismaticJoint.prototype.m_upperTranslation=0,t.b2PrismaticJoint.prototype.m_maxMotorForce=0,t.b2PrismaticJoint.prototype.m_motorSpeed=0,t.b2PrismaticJoint.prototype.m_enableLimit=!1,t.b2PrismaticJoint.prototype.m_enableMotor=!1,t.b2PrismaticJoint.prototype.m_limitState=t.b2LimitState.e_inactiveLimit,t.b2PrismaticJoint.prototype.m_indexA=0,t.b2PrismaticJoint.prototype.m_indexB=0,t.b2PrismaticJoint.prototype.m_localCenterA=null,t.b2PrismaticJoint.prototype.m_localCenterB=null,t.b2PrismaticJoint.prototype.m_invMassA=0,t.b2PrismaticJoint.prototype.m_invMassB=0,t.b2PrismaticJoint.prototype.m_invIA=0,t.b2PrismaticJoint.prototype.m_invIB=0,t.b2PrismaticJoint.prototype.m_axis=null,t.b2PrismaticJoint.prototype.m_perp=null,t.b2PrismaticJoint.prototype.m_s1=0,t.b2PrismaticJoint.prototype.m_s2=0,t.b2PrismaticJoint.prototype.m_a1=0,t.b2PrismaticJoint.prototype.m_a2=0,t.b2PrismaticJoint.prototype.m_K=null,t.b2PrismaticJoint.prototype.m_K3=null,t.b2PrismaticJoint.prototype.m_K2=null,t.b2PrismaticJoint.prototype.m_motorMass=0,t.b2PrismaticJoint.prototype.m_qA=null,t.b2PrismaticJoint.prototype.m_qB=null,t.b2PrismaticJoint.prototype.m_lalcA=null,t.b2PrismaticJoint.prototype.m_lalcB=null,t.b2PrismaticJoint.prototype.m_rA=null,t.b2PrismaticJoint.prototype.m_rB=null,t.b2PrismaticJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,r=e.positions[this.m_indexB].c,a=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,p=e.velocities[this.m_indexB].w,b=this.m_qA.SetAngleRadians(i),m=this.m_qB.SetAngleRadians(a);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=t.b2MulRV(b,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var d=t.b2MulRV(m,this.m_lalcB,this.m_rB),h=t.b2AddVV(t.b2SubVV(r,o,t.b2Vec2.s_t0),t.b2SubVV(d,_,t.b2Vec2.s_t1),t.b2PrismaticJoint.prototype.InitVelocityConstraints.s_d),c=this.m_invMassA,u=this.m_invMassB,y=this.m_invIA,f=this.m_invIB;if(t.b2MulRV(b,this.m_localXAxisA,this.m_axis),this.m_a1=t.b2CrossVV(t.b2AddVV(h,_,t.b2Vec2.s_t0),this.m_axis),this.m_a2=t.b2CrossVV(d,this.m_axis),this.m_motorMass=c+u+y*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),t.b2MulRV(b,this.m_localYAxisA,this.m_perp),this.m_s1=t.b2CrossVV(t.b2AddVV(h,_,t.b2Vec2.s_t0),this.m_perp),this.m_s2=t.b2CrossVV(d,this.m_perp),this.m_K.ex.x=c+u+y*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.ex.y=y*this.m_s1+f*this.m_s2,this.m_K.ex.z=y*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=y+f,0==this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=y*this.m_a1+f*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=c+u+y*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit){var S=t.b2DotVV(this.m_axis,h);t.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=t.b2LimitState.e_equalLimits:S<=this.m_lowerTranslation?this.m_limitState!=t.b2LimitState.e_atLowerLimit&&(this.m_limitState=t.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):S>=this.m_upperTranslation?this.m_limitState!=t.b2LimitState.e_atUpperLimit&&(this.m_limitState=t.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var C=t.b2AddVV(t.b2MulSV(this.m_impulse.x,this.m_perp,t.b2Vec2.s_t0),t.b2MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,t.b2Vec2.s_t1),t.b2PrismaticJoint.prototype.InitVelocityConstraints.s_P),v=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,A=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.SelfMulSub(c,C),s-=y*v,l.SelfMulAdd(u,C),p+=f*A}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=p},t.b2PrismaticJoint.prototype.InitVelocityConstraints.s_d=new t.b2Vec2,t.b2PrismaticJoint.prototype.InitVelocityConstraints.s_P=new t.b2Vec2,t.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=t.b2LimitState.e_equalLimits){var b=t.b2DotVV(this.m_axis,t.b2SubVV(n,o,t.b2Vec2.s_t0))+this.m_a2*s-this.m_a1*i,m=this.m_motorMass*(this.m_motorSpeed-b),_=this.m_motorImpulse,d=e.step.dt*this.m_maxMotorForce;this.m_motorImpulse=t.b2Clamp(this.m_motorImpulse+m,-d,d),m=this.m_motorImpulse-_;var h=t.b2MulSV(m,this.m_axis,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),c=m*this.m_a1,u=m*this.m_a2;o.SelfMulSub(r,h),i-=l*c,n.SelfMulAdd(a,h),s+=p*u}var y=t.b2DotVV(this.m_perp,t.b2SubVV(n,o,t.b2Vec2.s_t0))+this.m_s2*s-this.m_s1*i,f=s-i;if(this.m_enableLimit&&this.m_limitState!=t.b2LimitState.e_inactiveLimit){var S=t.b2DotVV(this.m_axis,t.b2SubVV(n,o,t.b2Vec2.s_t0))+this.m_a2*s-this.m_a1*i,C=t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f1.Copy(this.m_impulse),v=this.m_K.Solve33(-y,-f,-S,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df3);this.m_impulse.SelfAdd(v),this.m_limitState==t.b2LimitState.e_atLowerLimit?this.m_impulse.z=t.b2Max(this.m_impulse.z,0):this.m_limitState==t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=t.b2Min(this.m_impulse.z,0));var A=-y-(this.m_impulse.z-C.z)*this.m_K.ez.x,g=-f-(this.m_impulse.z-C.z)*this.m_K.ez.y,w=this.m_K.Solve22(A,g,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f2r);w.x+=C.x,w.y+=C.y,this.m_impulse.x=w.x,this.m_impulse.y=w.y,v.x=this.m_impulse.x-C.x,v.y=this.m_impulse.y-C.y,v.z=this.m_impulse.z-C.z;var h=t.b2AddVV(t.b2MulSV(v.x,this.m_perp,t.b2Vec2.s_t0),t.b2MulSV(v.z,this.m_axis,t.b2Vec2.s_t1),t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),c=v.x*this.m_s1+v.y+v.z*this.m_a1,u=v.x*this.m_s2+v.y+v.z*this.m_a2;o.SelfMulSub(r,h),i-=l*c,n.SelfMulAdd(a,h),s+=p*u}else{var v=this.m_K.Solve22(-y,-f,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df2);this.m_impulse.x+=v.x,this.m_impulse.y+=v.y;var h=t.b2MulSV(v.x,this.m_perp,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),c=v.x*this.m_s1+v.y,u=v.x*this.m_s2+v.y;o.SelfMulSub(r,h),i-=l*c,n.SelfMulAdd(a,h),s+=p*u}e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s},t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P=new t.b2Vec2,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f2r=new t.b2Vec2,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f1=new t.b2Vec3,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df3=new t.b2Vec3,t.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df2=new t.b2Vec2,t.b2PrismaticJoint.prototype.SolvePositionConstraints=function(e){var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.positions[this.m_indexB].c,s=e.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s),l=this.m_invMassA,p=this.m_invMassB,b=this.m_invIA,m=this.m_invIB,_=t.b2MulRV(r,this.m_lalcA,this.m_rA),d=t.b2MulRV(a,this.m_lalcB,this.m_rB),h=t.b2SubVV(t.b2AddVV(n,d,t.b2Vec2.s_t0),t.b2AddVV(o,_,t.b2Vec2.s_t1),t.b2PrismaticJoint.prototype.SolvePositionConstraints.s_d),c=t.b2MulRV(r,this.m_localXAxisA,this.m_axis),u=t.b2CrossVV(t.b2AddVV(h,_,t.b2Vec2.s_t0),c),y=t.b2CrossVV(d,c),f=t.b2MulRV(r,this.m_localYAxisA,this.m_perp),S=t.b2CrossVV(t.b2AddVV(h,_,t.b2Vec2.s_t0),f),C=t.b2CrossVV(d,f),v=t.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse,A=t.b2DotVV(f,h),g=s-i-this.m_referenceAngle,w=t.b2Abs(A),x=t.b2Abs(g),B=!1,V=0;
if(this.m_enableLimit){var T=t.b2DotVV(c,h);t.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(V=t.b2Clamp(T,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),w=t.b2Max(w,t.b2Abs(T)),B=!0):T<=this.m_lowerTranslation?(V=t.b2Clamp(T-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),w=t.b2Max(w,this.m_lowerTranslation-T),B=!0):T>=this.m_upperTranslation&&(V=t.b2Clamp(T-this.m_upperTranslation-t.b2_linearSlop,0,t.b2_maxLinearCorrection),w=t.b2Max(w,T-this.m_upperTranslation),B=!0)}if(B){var M=l+p+b*S*S+m*C*C,D=b*S+m*C,E=b*S*u+m*C*y,P=b+m;0==P&&(P=1);var R=b*u+m*y,I=l+p+b*u*u+m*y*y,J=this.m_K3;J.ex.Set(M,D,E),J.ey.Set(D,P,R),J.ez.Set(E,R,I),v=J.Solve33(-A,-g,-V,v)}else{var M=l+p+b*S*S+m*C*C,D=b*S+m*C,P=b+m;0==P&&(P=1);var L=this.m_K2;L.ex.Set(M,D),L.ey.Set(D,P);var F=L.Solve(-A,-g,t.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse1);v.x=F.x,v.y=F.y,v.z=0}var G=t.b2AddVV(t.b2MulSV(v.x,f,t.b2Vec2.s_t0),t.b2MulSV(v.z,c,t.b2Vec2.s_t1),t.b2PrismaticJoint.prototype.SolvePositionConstraints.s_P),N=v.x*S+v.y+v.z*u,k=v.x*C+v.y+v.z*y;return o.SelfMulSub(l,G),i-=b*N,n.SelfMulAdd(p,G),s+=m*k,e.positions[this.m_indexA].a=i,e.positions[this.m_indexB].a=s,w<=t.b2_linearSlop&&x<=t.b2_angularSlop},t.b2PrismaticJoint.prototype.SolvePositionConstraints.s_d=new t.b2Vec2,t.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse=new t.b2Vec3,t.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse1=new t.b2Vec2,t.b2PrismaticJoint.prototype.SolvePositionConstraints.s_P=new t.b2Vec2,t.b2PrismaticJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2PrismaticJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2PrismaticJoint.prototype.GetReactionForce=function(e,t){return t.Set(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},t.b2PrismaticJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.y},t.b2PrismaticJoint.prototype.GetLocalAnchorA=function(e){return e.Copy(this.m_localAnchorA)},t.b2PrismaticJoint.prototype.GetLocalAnchorB=function(e){return e.Copy(this.m_localAnchorB)},t.b2PrismaticJoint.prototype.GetLocalAxisA=function(e){return e.Copy(this.m_localXAxisA)},t.b2PrismaticJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},t.b2PrismaticJoint.prototype.GetJointTranslation=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t.b2PrismaticJoint.prototype.GetJointTranslation.s_pA),o=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t.b2PrismaticJoint.prototype.GetJointTranslation.s_pB),i=t.b2SubVV(o,e,t.b2PrismaticJoint.prototype.GetJointTranslation.s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,t.b2PrismaticJoint.prototype.GetJointTranslation.s_axis),s=t.b2DotVV(i,n);return s},t.b2PrismaticJoint.prototype.GetJointTranslation.s_pA=new t.b2Vec2,t.b2PrismaticJoint.prototype.GetJointTranslation.s_pB=new t.b2Vec2,t.b2PrismaticJoint.prototype.GetJointTranslation.s_d=new t.b2Vec2,t.b2PrismaticJoint.prototype.GetJointTranslation.s_axis=new t.b2Vec2,t.b2PrismaticJoint.prototype.GetJointSpeed=function(){var e=this.m_bodyA,o=this.m_bodyB;t.b2SubVV(this.m_localAnchorA,e.m_sweep.localCenter,this.m_lalcA);var i=t.b2MulRV(e.m_xf.q,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,o.m_sweep.localCenter,this.m_lalcB);var n=t.b2MulRV(o.m_xf.q,this.m_lalcB,this.m_rB),s=t.b2AddVV(e.m_sweep.c,i,t.b2Vec2.s_t0),r=t.b2AddVV(o.m_sweep.c,n,t.b2Vec2.s_t1),a=t.b2SubVV(r,s,t.b2Vec2.s_t2),l=e.GetWorldVector(this.m_localXAxisA,this.m_axis),p=e.m_linearVelocity,b=o.m_linearVelocity,m=e.m_angularVelocity,_=o.m_angularVelocity,d=t.b2DotVV(a,t.b2CrossSV(m,l,t.b2Vec2.s_t0))+t.b2DotVV(l,t.b2SubVV(t.b2AddVCrossSV(b,_,n,t.b2Vec2.s_t0),t.b2AddVCrossSV(p,m,i,t.b2Vec2.s_t1),t.b2Vec2.s_t0));return d},t.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},t.b2PrismaticJoint.prototype.EnableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},t.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},t.b2PrismaticJoint.prototype.SetLimits=function(e,t){(e!=this.m_lowerTranslation||t!=this.m_upperTranslation)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t,this.m_impulse.z=0)},t.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},t.b2PrismaticJoint.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},t.b2PrismaticJoint.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},t.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},t.b2PrismaticJoint.prototype.SetMaxMotorForce=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},t.b2PrismaticJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},t.b2PrismaticJoint.prototype.GetMotorForce=function(e){return e*this.m_motorImpulse},t.b2PrismaticJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2PrismaticJointDef*/ var jd = new box2d.b2PrismaticJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t.b2Log("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t.b2Log("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t.b2Log("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t.b2Log("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t.b2Log("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t}(o,s,n,i),D=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2RevoluteJoint&&(t.b2RevoluteJoint={}),t.b2RevoluteJointDef=function(){e.base(this,t.b2JointType.e_revoluteJoint),this.localAnchorA=new t.b2Vec2(0,0),this.localAnchorB=new t.b2Vec2(0,0)},e.inherits(t.b2RevoluteJointDef,t.b2JointDef),t.b2RevoluteJointDef.prototype.localAnchorA=null,t.b2RevoluteJointDef.prototype.localAnchorB=null,t.b2RevoluteJointDef.prototype.referenceAngle=0,t.b2RevoluteJointDef.prototype.enableLimit=!1,t.b2RevoluteJointDef.prototype.lowerAngle=0,t.b2RevoluteJointDef.prototype.upperAngle=0,t.b2RevoluteJointDef.prototype.enableMotor=!1,t.b2RevoluteJointDef.prototype.motorSpeed=0,t.b2RevoluteJointDef.prototype.maxMotorTorque=0,t.b2RevoluteJointDef.prototype.Initialize=function(e,t,o){this.bodyA=e,this.bodyB=t,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},t.b2RevoluteJoint=function(o){e.base(this,o),this.m_localAnchorA=new t.b2Vec2,this.m_localAnchorB=new t.b2Vec2,this.m_impulse=new t.b2Vec3,this.m_rA=new t.b2Vec2,this.m_rB=new t.b2Vec2,this.m_localCenterA=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_mass=new t.b2Mat33,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2,this.m_K=new t.b2Mat22,this.m_localAnchorA.Copy(o.localAnchorA),this.m_localAnchorB.Copy(o.localAnchorB),this.m_referenceAngle=o.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=o.lowerAngle,this.m_upperAngle=o.upperAngle,this.m_maxMotorTorque=o.maxMotorTorque,this.m_motorSpeed=o.motorSpeed,this.m_enableLimit=o.enableLimit,this.m_enableMotor=o.enableMotor,this.m_limitState=t.b2LimitState.e_inactiveLimit},e.inherits(t.b2RevoluteJoint,t.b2Joint),t.b2RevoluteJoint.prototype.m_localAnchorA=null,t.b2RevoluteJoint.prototype.m_localAnchorB=null,t.b2RevoluteJoint.prototype.m_impulse=null,t.b2RevoluteJoint.prototype.m_motorImpulse=0,t.b2RevoluteJoint.prototype.m_enableMotor=!1,t.b2RevoluteJoint.prototype.m_maxMotorTorque=0,t.b2RevoluteJoint.prototype.m_motorSpeed=0,t.b2RevoluteJoint.prototype.m_enableLimit=!1,t.b2RevoluteJoint.prototype.m_referenceAngle=0,t.b2RevoluteJoint.prototype.m_lowerAngle=0,t.b2RevoluteJoint.prototype.m_upperAngle=0,t.b2RevoluteJoint.prototype.m_indexA=0,t.b2RevoluteJoint.prototype.m_indexB=0,t.b2RevoluteJoint.prototype.m_rA=null,t.b2RevoluteJoint.prototype.m_rB=null,t.b2RevoluteJoint.prototype.m_localCenterA=null,t.b2RevoluteJoint.prototype.m_localCenterB=null,t.b2RevoluteJoint.prototype.m_invMassA=0,t.b2RevoluteJoint.prototype.m_invMassB=0,t.b2RevoluteJoint.prototype.m_invIA=0,t.b2RevoluteJoint.prototype.m_invIB=0,t.b2RevoluteJoint.prototype.m_mass=null,t.b2RevoluteJoint.prototype.m_motorMass=0,t.b2RevoluteJoint.prototype.m_limitState=t.b2LimitState.e_inactiveLimit,t.b2RevoluteJoint.prototype.m_qA=null,t.b2RevoluteJoint.prototype.m_qB=null,t.b2RevoluteJoint.prototype.m_lalcA=null,t.b2RevoluteJoint.prototype.m_lalcB=null,t.b2RevoluteJoint.prototype.m_K=null,t.b2RevoluteJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexA].a,i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,s=e.positions[this.m_indexB].a,r=e.velocities[this.m_indexB].v,a=e.velocities[this.m_indexB].w,l=this.m_qA.SetAngleRadians(o),p=this.m_qB.SetAngleRadians(s);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),t.b2MulRV(l,this.m_lalcA,this.m_rA),t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),t.b2MulRV(p,this.m_lalcB,this.m_rB);var b=this.m_invMassA,m=this.m_invMassB,_=this.m_invIA,d=this.m_invIB,h=_+d==0;if(this.m_mass.ex.x=b+m+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*d,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*d,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*d,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=b+m+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*d,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*d,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+d,this.m_motorMass=_+d,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||h)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==h){var c=s-o-this.m_referenceAngle;t.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop?this.m_limitState=t.b2LimitState.e_equalLimits:c<=this.m_lowerAngle?(this.m_limitState!=t.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atLowerLimit):c>=this.m_upperAngle?(this.m_limitState!=t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atUpperLimit):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit;if(e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var u=t.b2RevoluteJoint.prototype.InitVelocityConstraints.s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(b,u),n-=_*(t.b2CrossVV(this.m_rA,u)+this.m_motorImpulse+this.m_impulse.z),r.SelfMulAdd(m,u),a+=d*(t.b2CrossVV(this.m_rB,u)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=a},t.b2RevoluteJoint.prototype.InitVelocityConstraints.s_P=new t.b2Vec2,t.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB,b=l+p==0;if(this.m_enableMotor&&this.m_limitState!=t.b2LimitState.e_equalLimits&&0==b){var m=s-i-this.m_motorSpeed,_=-this.m_motorMass*m,d=this.m_motorImpulse,h=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=t.b2Clamp(this.m_motorImpulse+_,-h,h),_=this.m_motorImpulse-d,i-=l*_,s+=p*_}if(this.m_enableLimit&&this.m_limitState!=t.b2LimitState.e_inactiveLimit&&0==b){var c=t.b2SubVV(t.b2AddVCrossSV(n,s,this.m_rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(o,i,this.m_rA,t.b2Vec2.s_t1),t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot1),u=s-i,_=this.m_mass.Solve33(c.x,c.y,u,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse3).SelfNeg();if(this.m_limitState==t.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(_);else if(this.m_limitState==t.b2LimitState.e_atLowerLimit){var y=this.m_impulse.z+_.z;if(0>y){var f=-c.x+this.m_impulse.z*this.m_mass.ez.x,S=-c.y+this.m_impulse.z*this.m_mass.ez.y,C=this.m_mass.Solve22(f,S,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced);_.x=C.x,_.y=C.y,_.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(_)}else if(this.m_limitState==t.b2LimitState.e_atUpperLimit){var y=this.m_impulse.z+_.z;if(y>0){var f=-c.x+this.m_impulse.z*this.m_mass.ez.x,S=-c.y+this.m_impulse.z*this.m_mass.ez.y,C=this.m_mass.Solve22(f,S,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced);_.x=C.x,_.y=C.y,_.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(_)}var v=t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_P.Set(_.x,_.y);o.SelfMulSub(r,v),i-=l*(t.b2CrossVV(this.m_rA,v)+_.z),n.SelfMulAdd(a,v),s+=p*(t.b2CrossVV(this.m_rB,v)+_.z)}else{var m=t.b2SubVV(t.b2AddVCrossSV(n,s,this.m_rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(o,i,this.m_rA,t.b2Vec2.s_t1),t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot),_=this.m_mass.Solve22(-m.x,-m.y,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse2);this.m_impulse.x+=_.x,this.m_impulse.y+=_.y,o.SelfMulSub(r,_),i-=l*t.b2CrossVV(this.m_rA,_),n.SelfMulAdd(a,_),s+=p*t.b2CrossVV(this.m_rB,_)}e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s},t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_P=new t.b2Vec2,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot=new t.b2Vec2,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot1=new t.b2Vec2,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse3=new t.b2Vec3,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced=new t.b2Vec2,t.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse2=new t.b2Vec2,t.b2RevoluteJoint.prototype.SolvePositionConstraints=function(e){var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.positions[this.m_indexB].c,s=e.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s),l=0,p=0,b=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=t.b2LimitState.e_inactiveLimit&&0==b){var m=s-i-this.m_referenceAngle,_=0;if(this.m_limitState==t.b2LimitState.e_equalLimits){var d=t.b2Clamp(m-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection);_=-this.m_motorMass*d,l=t.b2Abs(d)}else if(this.m_limitState==t.b2LimitState.e_atLowerLimit){var d=m-this.m_lowerAngle;l=-d,d=t.b2Clamp(d+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),_=-this.m_motorMass*d}else if(this.m_limitState==t.b2LimitState.e_atUpperLimit){var d=m-this.m_upperAngle;l=d,d=t.b2Clamp(d-t.b2_angularSlop,0,t.b2_maxAngularCorrection),_=-this.m_motorMass*d}i-=this.m_invIA*_,s+=this.m_invIB*_}r.SetAngleRadians(i),a.SetAngleRadians(s),t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var h=t.b2MulRV(r,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c=t.b2MulRV(a,this.m_lalcB,this.m_rB),d=t.b2SubVV(t.b2AddVV(n,c,t.b2Vec2.s_t0),t.b2AddVV(o,h,t.b2Vec2.s_t1),t.b2RevoluteJoint.prototype.SolvePositionConstraints.s_C);p=d.GetLength();var u=this.m_invMassA,y=this.m_invMassB,f=this.m_invIA,S=this.m_invIB,C=this.m_K;C.ex.x=u+y+f*h.y*h.y+S*c.y*c.y,C.ex.y=-f*h.x*h.y-S*c.x*c.y,C.ey.x=C.ex.y,C.ey.y=u+y+f*h.x*h.x+S*c.x*c.x;var v=C.Solve(d.x,d.y,t.b2RevoluteJoint.prototype.SolvePositionConstraints.s_impulse).SelfNeg();return o.SelfMulSub(u,v),i-=f*t.b2CrossVV(h,v),n.SelfMulAdd(y,v),s+=S*t.b2CrossVV(c,v),e.positions[this.m_indexA].a=i,e.positions[this.m_indexB].a=s,p<=t.b2_linearSlop&&l<=t.b2_angularSlop},t.b2RevoluteJoint.prototype.SolvePositionConstraints.s_C=new t.b2Vec2,t.b2RevoluteJoint.prototype.SolvePositionConstraints.s_impulse=new t.b2Vec2,t.b2RevoluteJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2RevoluteJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2RevoluteJoint.prototype.GetReactionForce=function(e,t){return t.Set(e*this.m_impulse.x,e*this.m_impulse.y)},t.b2RevoluteJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.z},t.b2RevoluteJoint.prototype.GetLocalAnchorA=function(e){return e.Copy(this.m_localAnchorA)},t.b2RevoluteJoint.prototype.GetLocalAnchorB=function(e){return e.Copy(this.m_localAnchorB)},t.b2RevoluteJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},t.b2RevoluteJoint.prototype.GetJointAngleRadians=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},t.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},t.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},t.b2RevoluteJoint.prototype.EnableMotor=function(e){this.m_enableMotor!=e&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e)},t.b2RevoluteJoint.prototype.GetMotorTorque=function(e){return e*this.m_motorImpulse},t.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},t.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(e){this.m_maxMotorTorque=e},t.b2RevoluteJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},t.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},t.b2RevoluteJoint.prototype.EnableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},t.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},t.b2RevoluteJoint.prototype.SetLimits=function(e,t){(e!=this.m_lowerAngle||t!=this.m_upperAngle)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=e,this.m_upperAngle=t)},t.b2RevoluteJoint.prototype.SetMotorSpeed=function(e){this.m_motorSpeed!=e&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e)},t.b2RevoluteJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2RevoluteJointDef*/ var jd = new box2d.b2RevoluteJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t.b2Log("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t.b2Log("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t.b2Log("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t.b2Log("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t}(o,s,n,i),E=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2GearJoint&&(t.b2GearJoint={}),t.b2GearJointDef=function(){e.base(this,t.b2JointType.e_gearJoint)},e.inherits(t.b2GearJointDef,t.b2JointDef),t.b2GearJointDef.prototype.joint1=null,t.b2GearJointDef.prototype.joint2=null,t.b2GearJointDef.prototype.ratio=1,t.b2GearJoint=function(o){e.base(this,o),this.m_joint1=o.joint1,this.m_joint2=o.joint2,this.m_localAnchorA=new t.b2Vec2,this.m_localAnchorB=new t.b2Vec2,this.m_localAnchorC=new t.b2Vec2,this.m_localAnchorD=new t.b2Vec2,this.m_localAxisC=new t.b2Vec2,this.m_localAxisD=new t.b2Vec2,this.m_lcA=new t.b2Vec2,this.m_lcB=new t.b2Vec2,this.m_lcC=new t.b2Vec2,this.m_lcD=new t.b2Vec2,this.m_JvAC=new t.b2Vec2,this.m_JvBD=new t.b2Vec2,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_qC=new t.b2Rot,this.m_qD=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2,this.m_lalcC=new t.b2Vec2,this.m_lalcD=new t.b2Vec2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),t.ENABLE_ASSERTS&&t.b2Assert(this.m_typeA==t.b2JointType.e_revoluteJoint||this.m_typeA==t.b2JointType.e_prismaticJoint),t.ENABLE_ASSERTS&&t.b2Assert(this.m_typeB==t.b2JointType.e_revoluteJoint||this.m_typeB==t.b2JointType.e_prismaticJoint);var i,n;this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();var s=this.m_bodyA.m_xf,r=this.m_bodyA.m_sweep.a,a=this.m_bodyC.m_xf,l=this.m_bodyC.m_sweep.a;if(this.m_typeA==t.b2JointType.e_revoluteJoint){var p=o.joint1;this.m_localAnchorC.Copy(p.m_localAnchorA),this.m_localAnchorA.Copy(p.m_localAnchorB),this.m_referenceAngleA=p.m_referenceAngle,this.m_localAxisC.SetZero(),i=r-l-this.m_referenceAngleA}else{var b=o.joint1;this.m_localAnchorC.Copy(b.m_localAnchorA),this.m_localAnchorA.Copy(b.m_localAnchorB),this.m_referenceAngleA=b.m_referenceAngle,this.m_localAxisC.Copy(b.m_localXAxisA);var m=this.m_localAnchorC,_=t.b2MulTRV(a.q,t.b2AddVV(t.b2MulRV(s.q,this.m_localAnchorA,t.b2Vec2.s_t0),t.b2SubVV(s.p,a.p,t.b2Vec2.s_t1),t.b2Vec2.s_t0),t.b2Vec2.s_t0);i=t.b2DotVV(t.b2SubVV(_,m,t.b2Vec2.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();var d=this.m_bodyB.m_xf,h=this.m_bodyB.m_sweep.a,c=this.m_bodyD.m_xf,u=this.m_bodyD.m_sweep.a;if(this.m_typeB==t.b2JointType.e_revoluteJoint){var p=o.joint2;this.m_localAnchorD.Copy(p.m_localAnchorA),this.m_localAnchorB.Copy(p.m_localAnchorB),this.m_referenceAngleB=p.m_referenceAngle,this.m_localAxisD.SetZero(),n=h-u-this.m_referenceAngleB}else{var b=o.joint2;this.m_localAnchorD.Copy(b.m_localAnchorA),this.m_localAnchorB.Copy(b.m_localAnchorB),this.m_referenceAngleB=b.m_referenceAngle,this.m_localAxisD.Copy(b.m_localXAxisA);var y=this.m_localAnchorD,f=t.b2MulTRV(c.q,t.b2AddVV(t.b2MulRV(d.q,this.m_localAnchorB,t.b2Vec2.s_t0),t.b2SubVV(d.p,c.p,t.b2Vec2.s_t1),t.b2Vec2.s_t0),t.b2Vec2.s_t0);n=t.b2DotVV(t.b2SubVV(f,y,t.b2Vec2.s_t0),this.m_localAxisD)}this.m_ratio=o.ratio,this.m_constant=i+this.m_ratio*n,this.m_impulse=0},e.inherits(t.b2GearJoint,t.b2Joint),t.b2GearJoint.prototype.m_joint1=null,t.b2GearJoint.prototype.m_joint2=null,t.b2GearJoint.prototype.m_typeA=t.b2JointType.e_unknownJoint,t.b2GearJoint.prototype.m_typeB=t.b2JointType.e_unknownJoint,t.b2GearJoint.prototype.m_bodyC=null,t.b2GearJoint.prototype.m_bodyD=null,t.b2GearJoint.prototype.m_localAnchorA=null,t.b2GearJoint.prototype.m_localAnchorB=null,t.b2GearJoint.prototype.m_localAnchorC=null,t.b2GearJoint.prototype.m_localAnchorD=null,t.b2GearJoint.prototype.m_localAxisC=null,t.b2GearJoint.prototype.m_localAxisD=null,t.b2GearJoint.prototype.m_referenceAngleA=0,t.b2GearJoint.prototype.m_referenceAngleB=0,t.b2GearJoint.prototype.m_constant=0,t.b2GearJoint.prototype.m_ratio=0,t.b2GearJoint.prototype.m_impulse=0,t.b2GearJoint.prototype.m_indexA=0,t.b2GearJoint.prototype.m_indexB=0,t.b2GearJoint.prototype.m_indexC=0,t.b2GearJoint.prototype.m_indexD=0,t.b2GearJoint.prototype.m_lcA=null,t.b2GearJoint.prototype.m_lcB=null,t.b2GearJoint.prototype.m_lcC=null,t.b2GearJoint.prototype.m_lcD=null,t.b2GearJoint.prototype.m_mA=0,t.b2GearJoint.prototype.m_mB=0,t.b2GearJoint.prototype.m_mC=0,t.b2GearJoint.prototype.m_mD=0,t.b2GearJoint.prototype.m_iA=0,t.b2GearJoint.prototype.m_iB=0,t.b2GearJoint.prototype.m_iC=0,t.b2GearJoint.prototype.m_iD=0,t.b2GearJoint.prototype.m_JvAC=null,t.b2GearJoint.prototype.m_JvBD=null,t.b2GearJoint.prototype.m_JwA=0,t.b2GearJoint.prototype.m_JwB=0,t.b2GearJoint.prototype.m_JwC=0,t.b2GearJoint.prototype.m_JwD=0,t.b2GearJoint.prototype.m_mass=0,t.b2GearJoint.prototype.m_qA=null,t.b2GearJoint.prototype.m_qB=null,t.b2GearJoint.prototype.m_qC=null,t.b2GearJoint.prototype.m_qD=null,t.b2GearJoint.prototype.m_lalcA=null,t.b2GearJoint.prototype.m_lalcB=null,t.b2GearJoint.prototype.m_lalcC=null,t.b2GearJoint.prototype.m_lalcD=null,t.b2GearJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var o=e.positions[this.m_indexA].a,i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,s=e.positions[this.m_indexB].a,r=e.velocities[this.m_indexB].v,a=e.velocities[this.m_indexB].w,l=e.positions[this.m_indexC].a,p=e.velocities[this.m_indexC].v,b=e.velocities[this.m_indexC].w,m=e.positions[this.m_indexD].a,_=e.velocities[this.m_indexD].v,d=e.velocities[this.m_indexD].w,h=this.m_qA.SetAngleRadians(o),c=this.m_qB.SetAngleRadians(s),u=this.m_qC.SetAngleRadians(l),y=this.m_qD.SetAngleRadians(m);if(this.m_mass=0,this.m_typeA==t.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var f=t.b2MulRV(u,this.m_localAxisC,t.b2GearJoint.prototype.InitVelocityConstraints.s_u);t.b2SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var S=t.b2MulRV(u,this.m_lalcC,t.b2GearJoint.prototype.InitVelocityConstraints.s_rC);t.b2SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var C=t.b2MulRV(h,this.m_lalcA,t.b2GearJoint.prototype.InitVelocityConstraints.s_rA);this.m_JvAC.Copy(f),this.m_JwC=t.b2CrossVV(S,f),this.m_JwA=t.b2CrossVV(C,f),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB==t.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var f=t.b2MulRV(y,this.m_localAxisD,t.b2GearJoint.prototype.InitVelocityConstraints.s_u);t.b2SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var v=t.b2MulRV(y,this.m_lalcD,t.b2GearJoint.prototype.InitVelocityConstraints.s_rD);t.b2SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var A=t.b2MulRV(c,this.m_lalcB,t.b2GearJoint.prototype.InitVelocityConstraints.s_rB);t.b2MulSV(this.m_ratio,f,this.m_JvBD),this.m_JwD=this.m_ratio*t.b2CrossVV(v,f),this.m_JwB=this.m_ratio*t.b2CrossVV(A,f),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(i.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,r.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,p.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),b-=this.m_iC*this.m_impulse*this.m_JwC,_.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),d-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=a,e.velocities[this.m_indexC].w=b,e.velocities[this.m_indexD].w=d},t.b2GearJoint.prototype.InitVelocityConstraints.s_u=new t.b2Vec2,t.b2GearJoint.prototype.InitVelocityConstraints.s_rA=new t.b2Vec2,t.b2GearJoint.prototype.InitVelocityConstraints.s_rB=new t.b2Vec2,t.b2GearJoint.prototype.InitVelocityConstraints.s_rC=new t.b2Vec2,t.b2GearJoint.prototype.InitVelocityConstraints.s_rD=new t.b2Vec2,t.b2GearJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=e.velocities[this.m_indexC].v,a=e.velocities[this.m_indexC].w,l=e.velocities[this.m_indexD].v,p=e.velocities[this.m_indexD].w,b=t.b2DotVV(this.m_JvAC,t.b2SubVV(o,r,t.b2Vec2.s_t0))+t.b2DotVV(this.m_JvBD,t.b2SubVV(n,l,t.b2Vec2.s_t0));b+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*s-this.m_JwD*p);var m=-this.m_mass*b;this.m_impulse+=m,o.SelfMulAdd(this.m_mA*m,this.m_JvAC),i+=this.m_iA*m*this.m_JwA,n.SelfMulAdd(this.m_mB*m,this.m_JvBD),s+=this.m_iB*m*this.m_JwB,r.SelfMulSub(this.m_mC*m,this.m_JvAC),a-=this.m_iC*m*this.m_JwC,l.SelfMulSub(this.m_mD*m,this.m_JvBD),p-=this.m_iD*m*this.m_JwD,e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s,e.velocities[this.m_indexC].w=a,e.velocities[this.m_indexD].w=p},t.b2GearJoint.prototype.SolvePositionConstraints=function(e){var o,i,n,s,r,a,l=e.positions[this.m_indexA].c,p=e.positions[this.m_indexA].a,b=e.positions[this.m_indexB].c,m=e.positions[this.m_indexB].a,_=e.positions[this.m_indexC].c,d=e.positions[this.m_indexC].a,h=e.positions[this.m_indexD].c,c=e.positions[this.m_indexD].a,u=this.m_qA.SetAngleRadians(p),y=this.m_qB.SetAngleRadians(m),f=this.m_qC.SetAngleRadians(d),S=this.m_qD.SetAngleRadians(c),C=0,v=this.m_JvAC,A=this.m_JvBD,g=0;if(this.m_typeA==t.b2JointType.e_revoluteJoint)v.SetZero(),n=1,r=1,g+=this.m_iA+this.m_iC,o=p-d-this.m_referenceAngleA;else{var w=t.b2MulRV(f,this.m_localAxisC,t.b2GearJoint.prototype.SolvePositionConstraints.s_u),x=t.b2MulRV(f,this.m_lalcC,t.b2GearJoint.prototype.SolvePositionConstraints.s_rC),B=t.b2MulRV(u,this.m_lalcA,t.b2GearJoint.prototype.SolvePositionConstraints.s_rA);v.Copy(w),r=t.b2CrossVV(x,w),n=t.b2CrossVV(B,w),g+=this.m_mC+this.m_mA+this.m_iC*r*r+this.m_iA*n*n;var V=this.m_lalcC,T=t.b2MulTRV(f,t.b2AddVV(B,t.b2SubVV(l,_,t.b2Vec2.s_t0),t.b2Vec2.s_t0),t.b2Vec2.s_t0);o=t.b2DotVV(t.b2SubVV(T,V,t.b2Vec2.s_t0),this.m_localAxisC)}if(this.m_typeB==t.b2JointType.e_revoluteJoint)A.SetZero(),s=this.m_ratio,a=this.m_ratio,g+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=m-c-this.m_referenceAngleB;else{var w=t.b2MulRV(S,this.m_localAxisD,t.b2GearJoint.prototype.SolvePositionConstraints.s_u),M=t.b2MulRV(S,this.m_lalcD,t.b2GearJoint.prototype.SolvePositionConstraints.s_rD),D=t.b2MulRV(y,this.m_lalcB,t.b2GearJoint.prototype.SolvePositionConstraints.s_rB);t.b2MulSV(this.m_ratio,w,A),a=this.m_ratio*t.b2CrossVV(M,w),s=this.m_ratio*t.b2CrossVV(D,w),g+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*s*s;var E=this.m_lalcD,P=t.b2MulTRV(S,t.b2AddVV(D,t.b2SubVV(b,h,t.b2Vec2.s_t0),t.b2Vec2.s_t0),t.b2Vec2.s_t0);i=t.b2DotVV(t.b2SubVV(P,E,t.b2Vec2.s_t0),this.m_localAxisD)}var R=o+this.m_ratio*i-this.m_constant,I=0;return g>0&&(I=-R/g),l.SelfMulAdd(this.m_mA*I,v),p+=this.m_iA*I*n,b.SelfMulAdd(this.m_mB*I,A),m+=this.m_iB*I*s,_.SelfMulSub(this.m_mC*I,v),d-=this.m_iC*I*r,h.SelfMulSub(this.m_mD*I,A),c-=this.m_iD*I*a,e.positions[this.m_indexA].a=p,e.positions[this.m_indexB].a=m,e.positions[this.m_indexC].a=d,e.positions[this.m_indexD].a=c,C<t.b2_linearSlop
},t.b2GearJoint.prototype.SolvePositionConstraints.s_u=new t.b2Vec2,t.b2GearJoint.prototype.SolvePositionConstraints.s_rA=new t.b2Vec2,t.b2GearJoint.prototype.SolvePositionConstraints.s_rB=new t.b2Vec2,t.b2GearJoint.prototype.SolvePositionConstraints.s_rC=new t.b2Vec2,t.b2GearJoint.prototype.SolvePositionConstraints.s_rD=new t.b2Vec2,t.b2GearJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2GearJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2GearJoint.prototype.GetReactionForce=function(e,o){return t.b2MulSV(e*this.m_impulse,this.m_JvAC,o)},t.b2GearJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse*this.m_JwA},t.b2GearJoint.prototype.GetJoint1=function(){return this.m_joint1},t.b2GearJoint.prototype.GetJoint2=function(){return this.m_joint2},t.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},t.b2GearJoint.prototype.SetRatio=function(e){t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e)),this.m_ratio=e},t.b2GearJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex,i=this.m_joint1.m_index,n=this.m_joint2.m_index;t.b2Log("  /*box2d.b2GearJointDef*/ var jd = new box2d.b2GearJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.joint1 = joints[%d];\n",i),t.b2Log("  jd.joint2 = joints[%d];\n",n),t.b2Log("  jd.ratio = %.15f;\n",this.m_ratio),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t}(o,s,n,M,D,i),P=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2GravityController&&(t.b2GravityController={}),t.b2GravityController=function(){e.base(this)},e.inherits(t.b2GravityController,t.b2Controller),t.b2GravityController.prototype.G=1,t.b2GravityController.prototype.invSqr=!0,t.b2GravityController.prototype.Step=function(){if(this.invSqr)for(var e=this.m_bodyList;e;e=e.nextBody)for(var o=e.body,i=o.GetWorldCenter(),n=o.GetMass(),s=this.m_bodyList;s!=e;s=s.nextBody){var r=s.body,a=r.GetWorldCenter(),l=r.GetMass(),p=a.x-i.x,b=a.y-i.y,m=p*p+b*b;if(!(m<t.b2_epsilon)){var _=t.b2GravityController.prototype.Step.s_f.Set(p,b);_.SelfMul(this.G/m/t.b2Sqrt(m)*n*l),o.IsAwake()&&o.ApplyForce(_,i),r.IsAwake()&&r.ApplyForce(_.SelfMul(-1),a)}}else for(var e=this.m_bodyList;e;e=e.nextBody)for(var o=e.body,i=o.GetWorldCenter(),n=o.GetMass(),s=this.m_bodyList;s!=e;s=s.nextBody){var r=s.body,a=r.GetWorldCenter(),l=r.GetMass(),p=a.x-i.x,b=a.y-i.y,m=p*p+b*b;if(!(m<t.b2_epsilon)){var _=t.b2GravityController.prototype.Step.s_f.Set(p,b);_.SelfMul(this.G/m*n*l),o.IsAwake()&&o.ApplyForce(_,i),r.IsAwake()&&r.ApplyForce(_.SelfMul(-1),a)}}},t.b2GravityController.prototype.Step.s_f=new t.b2Vec2,t}(o,c,n,i),R=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2MotorJoint&&(t.b2MotorJoint={}),t.b2MotorJointDef=function(){e.base(this,t.b2JointType.e_motorJoint),this.linearOffset=new t.b2Vec2(0,0)},e.inherits(t.b2MotorJointDef,t.b2JointDef),t.b2MotorJointDef.prototype.linearOffset=null,t.b2MotorJointDef.prototype.angularOffset=0,t.b2MotorJointDef.prototype.maxForce=1,t.b2MotorJointDef.prototype.maxTorque=1,t.b2MotorJointDef.prototype.correctionFactor=.3,t.b2MotorJointDef.prototype.Initialize=function(e,t){this.bodyA=e,this.bodyB=t,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var o=this.bodyA.GetAngleRadians(),i=this.bodyB.GetAngleRadians();this.angularOffset=i-o},t.b2MotorJoint=function(o){e.base(this,o),this.m_linearOffset=o.linearOffset.Clone(),this.m_linearImpulse=new t.b2Vec2(0,0),this.m_maxForce=o.maxForce,this.m_maxTorque=o.maxTorque,this.m_correctionFactor=o.correctionFactor,this.m_rA=new t.b2Vec2(0,0),this.m_rB=new t.b2Vec2(0,0),this.m_localCenterA=new t.b2Vec2(0,0),this.m_localCenterB=new t.b2Vec2(0,0),this.m_linearError=new t.b2Vec2(0,0),this.m_linearMass=new t.b2Mat22,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_K=new t.b2Mat22},e.inherits(t.b2MotorJoint,t.b2Joint),t.b2MotorJoint.prototype.m_linearOffset=null,t.b2MotorJoint.prototype.m_angularOffset=0,t.b2MotorJoint.prototype.m_linearImpulse=null,t.b2MotorJoint.prototype.m_angularImpulse=0,t.b2MotorJoint.prototype.m_maxForce=0,t.b2MotorJoint.prototype.m_maxTorque=0,t.b2MotorJoint.prototype.m_correctionFactor=.3,t.b2MotorJoint.prototype.m_indexA=0,t.b2MotorJoint.prototype.m_indexB=0,t.b2MotorJoint.prototype.m_rA=null,t.b2MotorJoint.prototype.m_rB=null,t.b2MotorJoint.prototype.m_localCenterA=null,t.b2MotorJoint.prototype.m_localCenterB=null,t.b2MotorJoint.prototype.m_linearError=null,t.b2MotorJoint.prototype.m_angularError=0,t.b2MotorJoint.prototype.m_invMassA=0,t.b2MotorJoint.prototype.m_invMassB=0,t.b2MotorJoint.prototype.m_invIA=0,t.b2MotorJoint.prototype.m_invIB=0,t.b2MotorJoint.prototype.m_linearMass=null,t.b2MotorJoint.prototype.m_angularMass=0,t.b2MotorJoint.prototype.m_qA=null,t.b2MotorJoint.prototype.m_qB=null,t.b2MotorJoint.prototype.m_K=null,t.b2MotorJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetPosition(e)},t.b2MotorJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetPosition(e)},t.b2MotorJoint.prototype.GetReactionForce=function(e,o){return t.b2MulSV(e,this.m_linearImpulse,o)},t.b2MotorJoint.prototype.GetReactionTorque=function(e){return e*this.m_angularImpulse},t.b2MotorJoint.prototype.SetCorrectionFactor=function(e){t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e)&&e>=0&&1>=e),this._correctionFactor=e},t.b2MotorJoint.prototype.GetCorrectionFactor=function(){return this.m_correctionFactor},t.b2MotorJoint.prototype.SetLinearOffset=function(e){t.b2IsEqualToV(e,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(e))},t.b2MotorJoint.prototype.GetLinearOffset=function(e){return e.Copy(this.m_linearOffset)},t.b2MotorJoint.prototype.SetAngularOffset=function(e){e!=this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=e)},t.b2MotorJoint.prototype.GetAngularOffset=function(){return this.m_angularOffset},t.b2MotorJoint.prototype.SetMaxForce=function(e){t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e)&&e>=0),this.m_maxForce=e},t.b2MotorJoint.prototype.GetMaxForce=function(){return this.m_maxForce},t.b2MotorJoint.prototype.SetMaxTorque=function(e){t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(e)&&e>=0),this.m_maxTorque=e},t.b2MotorJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},t.b2MotorJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,r=e.positions[this.m_indexB].c,a=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,p=e.velocities[this.m_indexB].w,b=this.m_qA.SetAngleRadians(i),m=this.m_qB.SetAngleRadians(a),_=t.b2MulRV(b,t.b2NegV(this.m_localCenterA,t.b2Vec2.s_t0),this.m_rA),d=t.b2MulRV(m,t.b2NegV(this.m_localCenterB,t.b2Vec2.s_t0),this.m_rB),h=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,y=this.m_invIB,f=this.m_K;if(f.ex.x=h+c+u*_.y*_.y+y*d.y*d.y,f.ex.y=-u*_.x*_.y-y*d.x*d.y,f.ey.x=f.ex.y,f.ey.y=h+c+u*_.x*_.x+y*d.x*d.x,f.GetInverse(this.m_linearMass),this.m_angularMass=u+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.b2SubVV(t.b2SubVV(t.b2AddVV(r,d,t.b2Vec2.s_t0),t.b2AddVV(o,_,t.b2Vec2.s_t1),t.b2Vec2.s_t2),t.b2MulRV(b,this.m_linearOffset,t.b2Vec2.s_t3),this.m_linearError),this.m_angularError=a-i-this.m_angularOffset,e.step.warmStarting){this.m_linearImpulse.SelfMul(e.step.dtRatio),this.m_angularImpulse*=e.step.dtRatio;var S=this.m_linearImpulse;n.SelfMulSub(h,S),s-=u*(t.b2CrossVV(_,S)+this.m_angularImpulse),l.SelfMulAdd(c,S),p+=y*(t.b2CrossVV(d,S)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=p},t.b2MotorJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB,b=e.step.dt,m=e.step.inv_dt,_=s-i+m*this.m_correctionFactor*this.m_angularError,d=-this.m_angularMass*_,h=this.m_angularImpulse,c=b*this.m_maxTorque;this.m_angularImpulse=t.b2Clamp(this.m_angularImpulse+d,-c,c),d=this.m_angularImpulse-h,i-=l*d,s+=p*d;var u=this.m_rA,y=this.m_rB,_=t.b2AddVV(t.b2SubVV(t.b2AddVV(n,t.b2CrossSV(s,y,t.b2Vec2.s_t0),t.b2Vec2.s_t0),t.b2AddVV(o,t.b2CrossSV(i,u,t.b2Vec2.s_t1),t.b2Vec2.s_t1),t.b2Vec2.s_t2),t.b2MulSV(m*this.m_correctionFactor,this.m_linearError,t.b2Vec2.s_t3),t.b2MotorJoint.prototype.SolveVelocityConstraints.s_Cdot),d=t.b2MulMV(this.m_linearMass,_,t.b2MotorJoint.prototype.SolveVelocityConstraints.s_impulse).SelfNeg(),h=t.b2MotorJoint.prototype.SolveVelocityConstraints.s_oldImpulse.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(d);var c=b*this.m_maxForce;this.m_linearImpulse.GetLengthSquared()>c*c&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(c)),t.b2SubVV(this.m_linearImpulse,h,d),o.SelfMulSub(r,d),i-=l*t.b2CrossVV(u,d),n.SelfMulAdd(a,d),s+=p*t.b2CrossVV(y,d),e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s},t.b2MotorJoint.prototype.SolveVelocityConstraints.s_Cdot=new t.b2Vec2,t.b2MotorJoint.prototype.SolveVelocityConstraints.s_impulse=new t.b2Vec2,t.b2MotorJoint.prototype.SolveVelocityConstraints.s_oldImpulse=new t.b2Vec2,t.b2MotorJoint.prototype.SolvePositionConstraints=function(){return!0},t.b2MotorJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2MotorJointDef*/ var jd = new box2d.b2MotorJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t.b2Log("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t.b2Log("  jd.maxForce = %.15f;\n",this.m_maxForce),t.b2Log("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t.b2Log("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t}(o,s,n,i),I=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2MouseJoint&&(t.b2MouseJoint={}),t.b2MouseJointDef=function(){e.base(this,t.b2JointType.e_mouseJoint),this.target=new t.b2Vec2},e.inherits(t.b2MouseJointDef,t.b2JointDef),t.b2MouseJointDef.prototype.target=null,t.b2MouseJointDef.prototype.maxForce=0,t.b2MouseJointDef.prototype.frequencyHz=5,t.b2MouseJointDef.prototype.dampingRatio=.7,t.b2MouseJoint=function(o){e.base(this,o),this.m_localAnchorB=new t.b2Vec2,this.m_targetA=new t.b2Vec2,this.m_impulse=new t.b2Vec2,this.m_rB=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_mass=new t.b2Mat22,this.m_C=new t.b2Vec2,this.m_qB=new t.b2Rot,this.m_lalcB=new t.b2Vec2,this.m_K=new t.b2Mat22,t.ENABLE_ASSERTS&&t.b2Assert(o.target.IsValid()),t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(o.maxForce)&&o.maxForce>=0),t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(o.frequencyHz)&&o.frequencyHz>=0),t.ENABLE_ASSERTS&&t.b2Assert(t.b2IsValid(o.dampingRatio)&&o.dampingRatio>=0),this.m_targetA.Copy(o.target),t.b2MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=o.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_beta=0,this.m_gamma=0},e.inherits(t.b2MouseJoint,t.b2Joint),t.b2MouseJoint.prototype.m_localAnchorB=null,t.b2MouseJoint.prototype.m_targetA=null,t.b2MouseJoint.prototype.m_frequencyHz=0,t.b2MouseJoint.prototype.m_dampingRatio=0,t.b2MouseJoint.prototype.m_beta=0,t.b2MouseJoint.prototype.m_impulse=null,t.b2MouseJoint.prototype.m_maxForce=0,t.b2MouseJoint.prototype.m_gamma=0,t.b2MouseJoint.prototype.m_indexA=0,t.b2MouseJoint.prototype.m_indexB=0,t.b2MouseJoint.prototype.m_rB=null,t.b2MouseJoint.prototype.m_localCenterB=null,t.b2MouseJoint.prototype.m_invMassB=0,t.b2MouseJoint.prototype.m_invIB=0,t.b2MouseJoint.prototype.m_mass=null,t.b2MouseJoint.prototype.m_C=null,t.b2MouseJoint.prototype.m_qB=null,t.b2MouseJoint.prototype.m_lalcB=null,t.b2MouseJoint.prototype.m_K=null,t.b2MouseJoint.prototype.SetTarget=function(e){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(e)},t.b2MouseJoint.prototype.GetTarget=function(e){return e.Copy(this.m_targetA)},t.b2MouseJoint.prototype.SetMaxForce=function(e){this.m_maxForce=e},t.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},t.b2MouseJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e},t.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},t.b2MouseJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},t.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},t.b2MouseJoint.prototype.InitVelocityConstraints=function(e){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexB].c,i=e.positions[this.m_indexB].a,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=this.m_qB.SetAngleRadians(i),a=this.m_bodyB.GetMass(),l=2*t.b2_pi*this.m_frequencyHz,p=2*a*this.m_dampingRatio*l,b=a*l*l,m=e.step.dt;t.ENABLE_ASSERTS&&t.b2Assert(p+m*b>t.b2_epsilon),this.m_gamma=m*(p+m*b),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=m*b*this.m_gamma,t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),t.b2MulRV(r,this.m_lalcB,this.m_rB);var _=this.m_K;_.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,_.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,_.GetInverse(this.m_mass),this.m_C.x=o.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=o.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),s*=.98,e.step.warmStarting?(this.m_impulse.SelfMul(e.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,s+=this.m_invIB*t.b2CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),e.velocities[this.m_indexB].w=s},t.b2MouseJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexB].v,i=e.velocities[this.m_indexB].w,n=t.b2AddVCrossSV(o,i,this.m_rB,t.b2MouseJoint.prototype.SolveVelocityConstraints.s_Cdot),s=t.b2MulMV(this.m_mass,t.b2AddVV(n,t.b2AddVV(this.m_C,t.b2MulSV(this.m_gamma,this.m_impulse,t.b2Vec2.s_t0),t.b2Vec2.s_t0),t.b2Vec2.s_t0).SelfNeg(),t.b2MouseJoint.prototype.SolveVelocityConstraints.s_impulse),r=t.b2MouseJoint.prototype.SolveVelocityConstraints.s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(s);var a=e.step.dt*this.m_maxForce;this.m_impulse.GetLengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.GetLength()),t.b2SubVV(this.m_impulse,r,s),o.SelfMulAdd(this.m_invMassB,s),i+=this.m_invIB*t.b2CrossVV(this.m_rB,s),e.velocities[this.m_indexB].w=i},t.b2MouseJoint.prototype.SolveVelocityConstraints.s_Cdot=new t.b2Vec2,t.b2MouseJoint.prototype.SolveVelocityConstraints.s_impulse=new t.b2Vec2,t.b2MouseJoint.prototype.SolveVelocityConstraints.s_oldImpulse=new t.b2Vec2,t.b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0},t.b2MouseJoint.prototype.GetAnchorA=function(e){return e.Copy(this.m_targetA)},t.b2MouseJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2MouseJoint.prototype.GetReactionForce=function(e,o){return t.b2MulSV(e,this.m_impulse,o)},t.b2MouseJoint.prototype.GetReactionTorque=function(){return 0},t.b2MouseJoint.prototype.Dump=function(){t.DEBUG&&t.b2Log("Mouse joint dumping is not supported.\n")},t.b2MouseJoint.prototype.ShiftOrigin=function(e){this.m_targetA.SelfSub(e)},t}(o,s,n,i),J=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2PolygonShape&&(t.b2PolygonShape={}),t.b2PolygonShape=function(){e.base(this,t.b2ShapeType.e_polygonShape,t.b2_polygonRadius),this.m_centroid=new t.b2Vec2(0,0),this.m_vertices=t.b2Vec2.MakeArray(t.b2_maxPolygonVertices),this.m_normals=t.b2Vec2.MakeArray(t.b2_maxPolygonVertices)},e.inherits(t.b2PolygonShape,t.b2Shape),t.b2PolygonShape.prototype.m_centroid=null,t.b2PolygonShape.prototype.m_vertices=null,t.b2PolygonShape.prototype.m_normals=null,t.b2PolygonShape.prototype.m_count=0,t.b2PolygonShape.prototype.Clone=function(){return(new t.b2PolygonShape).Copy(this)},t.b2PolygonShape.prototype.Copy=function(o){e.base(this,"Copy",o),t.ENABLE_ASSERTS&&t.b2Assert(o instanceof t.b2PolygonShape),this.m_centroid.Copy(o.m_centroid),this.m_count=o.m_count;for(var i=0,n=this.m_count;n>i;++i)this.m_vertices[i].Copy(o.m_vertices[i]),this.m_normals[i].Copy(o.m_normals[i]);return this},t.b2PolygonShape.prototype.SetAsBox=function(e,t){return this.m_count=4,this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),this},t.b2PolygonShape.prototype.SetAsOrientedBox=function(e,o,i,n){this.m_count=4,this.m_vertices[0].Set(-e,-o),this.m_vertices[1].Set(e,-o),this.m_vertices[2].Set(e,o),this.m_vertices[3].Set(-e,o),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.Copy(i);var s=new t.b2Transform;s.SetPosition(i),s.SetRotationAngleRadians(n);for(var r=0,a=this.m_count;a>r;++r)t.b2MulXV(s,this.m_vertices[r],this.m_vertices[r]),t.b2MulRV(s.q,this.m_normals[r],this.m_normals[r]);return this},t.b2PolygonShape.prototype.Set=function(e,o){if(void 0===o&&(o=e.length),t.ENABLE_ASSERTS&&t.b2Assert(o>=3&&o<=t.b2_maxPolygonVertices),3>o)return this.SetAsBox(1,1);for(var i=t.b2Min(o,t.b2_maxPolygonVertices),n=t.b2PolygonShape.prototype.Set.s_ps,s=0,r=0;i>r;++r){for(var a=e[r],l=!0,p=0;s>p;++p)if(t.b2DistanceSquaredVV(a,n[p])<.5*t.b2_linearSlop){l=!1;break}l&&n[s++].Copy(a)}if(i=s,3>i)return t.ENABLE_ASSERTS&&t.b2Assert(!1),this.SetAsBox(1,1);for(var b=0,m=n[0].x,r=1;i>r;++r){var _=n[r].x;(_>m||_==m&&n[r].y<n[b].y)&&(b=r,m=_)}for(var d=t.b2PolygonShape.prototype.Set.s_hull,h=0,c=b;;){d[h]=c;for(var u=0,p=1;i>p;++p)if(u!=c){var y=t.b2SubVV(n[u],n[d[h]],t.b2PolygonShape.prototype.Set.s_r),a=t.b2SubVV(n[p],n[d[h]],t.b2PolygonShape.prototype.Set.s_v),f=t.b2CrossVV(y,a);0>f&&(u=p),0==f&&a.GetLengthSquared()>y.GetLengthSquared()&&(u=p)}else u=p;if(++h,c=u,u==b)break}this.m_count=h;for(var r=0;h>r;++r)this.m_vertices[r].Copy(n[d[r]]);for(var r=0,S=h;S>r;++r){var C=this.m_vertices[r],v=this.m_vertices[(r+1)%S],A=t.b2SubVV(v,C,t.b2Vec2.s_t0);t.ENABLE_ASSERTS&&t.b2Assert(A.GetLengthSquared()>t.b2_epsilon_sq),t.b2CrossVOne(A,this.m_normals[r]).SelfNormalize()}return t.b2PolygonShape.ComputeCentroid(this.m_vertices,h,this.m_centroid),this},t.b2PolygonShape.prototype.Set.s_ps=t.b2Vec2.MakeArray(t.b2_maxPolygonVertices),t.b2PolygonShape.prototype.Set.s_hull=t.b2MakeNumberArray(t.b2_maxPolygonVertices),t.b2PolygonShape.prototype.Set.s_r=new t.b2Vec2,t.b2PolygonShape.prototype.Set.s_v=new t.b2Vec2,t.b2PolygonShape.prototype.SetAsVector=function(e,t){return this.Set(e,t),this},t.b2PolygonShape.prototype.SetAsArray=function(e,t){return this.Set(e,t),this},t.b2PolygonShape.prototype.GetChildCount=function(){return 1},t.b2PolygonShape.prototype.TestPoint=function(e,o){for(var i=t.b2MulTXV(e,o,t.b2PolygonShape.prototype.TestPoint.s_pLocal),n=0,s=this.m_count;s>n;++n){var r=t.b2DotVV(this.m_normals[n],t.b2SubVV(i,this.m_vertices[n],t.b2Vec2.s_t0));if(r>0)return!1}return!0},t.b2PolygonShape.prototype.TestPoint.s_pLocal=new t.b2Vec2,t.b2PolygonShape.prototype.RayCast=function(e,o,i){for(var n=t.b2MulTXV(i,o.p1,t.b2PolygonShape.prototype.RayCast.s_p1),s=t.b2MulTXV(i,o.p2,t.b2PolygonShape.prototype.RayCast.s_p2),r=t.b2SubVV(s,n,t.b2PolygonShape.prototype.RayCast.s_d),a=0,l=o.maxFraction,p=-1,b=0,m=this.m_count;m>b;++b){var _=t.b2DotVV(this.m_normals[b],t.b2SubVV(this.m_vertices[b],n,t.b2Vec2.s_t0)),d=t.b2DotVV(this.m_normals[b],r);if(0==d){if(0>_)return!1}else 0>d&&a*d>_?(a=_/d,p=b):d>0&&l*d>_&&(l=_/d);if(a>l)return!1}return t.ENABLE_ASSERTS&&t.b2Assert(a>=0&&a<=o.maxFraction),p>=0?(e.fraction=a,t.b2MulRV(i.q,this.m_normals[p],e.normal),!0):!1},t.b2PolygonShape.prototype.RayCast.s_p1=new t.b2Vec2,t.b2PolygonShape.prototype.RayCast.s_p2=new t.b2Vec2,t.b2PolygonShape.prototype.RayCast.s_d=new t.b2Vec2,t.b2PolygonShape.prototype.ComputeAABB=function(e,o){for(var i=t.b2MulXV(o,this.m_vertices[0],e.lowerBound),n=e.upperBound.Copy(i),s=0,r=this.m_count;r>s;++s){var a=t.b2MulXV(o,this.m_vertices[s],t.b2PolygonShape.prototype.ComputeAABB.s_v);t.b2MinV(a,i,i),t.b2MaxV(a,n,n)}var l=this.m_radius;i.SelfSubXY(l,l),n.SelfAddXY(l,l)},t.b2PolygonShape.prototype.ComputeAABB.s_v=new t.b2Vec2,t.b2PolygonShape.prototype.ComputeMass=function(e,o){t.ENABLE_ASSERTS&&t.b2Assert(this.m_count>=3);for(var i=t.b2PolygonShape.prototype.ComputeMass.s_center.SetZero(),n=0,s=0,r=t.b2PolygonShape.prototype.ComputeMass.s_s.SetZero(),a=0,l=this.m_count;l>a;++a)r.SelfAdd(this.m_vertices[a]);r.SelfMul(1/this.m_count);for(var p=1/3,a=0,l=this.m_count;l>a;++a){var b=t.b2SubVV(this.m_vertices[a],r,t.b2PolygonShape.prototype.ComputeMass.s_e1),m=t.b2SubVV(this.m_vertices[(a+1)%l],r,t.b2PolygonShape.prototype.ComputeMass.s_e2),_=t.b2CrossVV(b,m),d=.5*_;n+=d,i.SelfAdd(t.b2MulSV(d*p,t.b2AddVV(b,m,t.b2Vec2.s_t0),t.b2Vec2.s_t1));var h=b.x,c=b.y,u=m.x,y=m.y,f=h*h+u*h+u*u,S=c*c+y*c+y*y;s+=.25*p*_*(f+S)}e.mass=o*n,t.ENABLE_ASSERTS&&t.b2Assert(n>t.b2_epsilon),i.SelfMul(1/n),t.b2AddVV(i,r,e.center),e.I=o*s,e.I+=e.mass*(t.b2DotVV(e.center,e.center)-t.b2DotVV(i,i))},t.b2PolygonShape.prototype.ComputeMass.s_center=new t.b2Vec2,t.b2PolygonShape.prototype.ComputeMass.s_s=new t.b2Vec2,t.b2PolygonShape.prototype.ComputeMass.s_e1=new t.b2Vec2,t.b2PolygonShape.prototype.ComputeMass.s_e2=new t.b2Vec2,t.b2PolygonShape.prototype.Validate=function(){for(var e=0;e<this.m_count;++e)for(var o=e,i=(e+1)%this.m_count,n=this.m_vertices[o],s=t.b2SubVV(this.m_vertices[i],n,t.b2PolygonShape.prototype.Validate.s_e),r=0;r<this.m_count;++r)if(r!=o&&r!=i){var a=t.b2SubVV(this.m_vertices[r],n,t.b2PolygonShape.prototype.Validate.s_v),l=t.b2CrossVV(s,a);if(0>l)return!1}return!0},t.b2PolygonShape.prototype.Validate.s_e=new t.b2Vec2,t.b2PolygonShape.prototype.Validate.s_v=new t.b2Vec2,t.b2PolygonShape.prototype.SetupDistanceProxy=function(e){e.m_vertices=this.m_vertices,e.m_count=this.m_count,e.m_radius=this.m_radius},t.b2PolygonShape.prototype.ComputeSubmergedArea=function(e,o,i,n){for(var s=t.b2MulTRV(i.q,e,t.b2PolygonShape.prototype.ComputeSubmergedArea.s_normalL),r=o-t.b2DotVV(e,i.p),a=t.b2PolygonShape.prototype.ComputeSubmergedArea.s_depths,l=0,p=-1,b=-1,m=!1,_=0,d=this.m_count;d>_;++_){a[_]=t.b2DotVV(s,this.m_vertices[_])-r;var h=a[_]<-t.b2_epsilon;_>0&&(h?m||(p=_-1,l++):m&&(b=_-1,l++)),m=h}switch(l){case 0:if(m){var c=t.b2PolygonShape.prototype.ComputeSubmergedArea.s_md;return this.ComputeMass(c,1),t.b2MulXV(i,c.center,n),c.mass}return 0;case 1:-1==p?p=this.m_count-1:b=this.m_count-1}for(var u=(p+1)%this.m_count,y=(b+1)%this.m_count,f=(0-a[p])/(a[u]-a[p]),S=(0-a[b])/(a[y]-a[b]),C=t.b2PolygonShape.prototype.ComputeSubmergedArea.s_intoVec.Set(this.m_vertices[p].x*(1-f)+this.m_vertices[u].x*f,this.m_vertices[p].y*(1-f)+this.m_vertices[u].y*f),v=t.b2PolygonShape.prototype.ComputeSubmergedArea.s_outoVec.Set(this.m_vertices[b].x*(1-S)+this.m_vertices[y].x*S,this.m_vertices[b].y*(1-S)+this.m_vertices[y].y*S),A=0,g=t.b2PolygonShape.prototype.ComputeSubmergedArea.s_center.SetZero(),w=this.m_vertices[u],x=null,_=u;_!=y;){_=(_+1)%this.m_count,x=_==y?v:this.m_vertices[_];var B=.5*((w.x-C.x)*(x.y-C.y)-(w.y-C.y)*(x.x-C.x));A+=B,g.x+=B*(C.x+w.x+x.x)/3,g.y+=B*(C.y+w.y+x.y)/3,w=x}return g.SelfMul(1/A),t.b2MulXV(i,g,n),A},t.b2PolygonShape.prototype.ComputeSubmergedArea.s_normalL=new t.b2Vec2,t.b2PolygonShape.prototype.ComputeSubmergedArea.s_depths=t.b2MakeNumberArray(t.b2_maxPolygonVertices),t.b2PolygonShape.prototype.ComputeSubmergedArea.s_md=new t.b2MassData,t.b2PolygonShape.prototype.ComputeSubmergedArea.s_intoVec=new t.b2Vec2,t.b2PolygonShape.prototype.ComputeSubmergedArea.s_outoVec=new t.b2Vec2,t.b2PolygonShape.prototype.ComputeSubmergedArea.s_center=new t.b2Vec2,t.b2PolygonShape.prototype.Dump=function(){t.b2Log("    /*box2d.b2PolygonShape*/ var shape = new box2d.b2PolygonShape();\n"),t.b2Log("    /*box2d.b2Vec2[]*/ var vs = box2d.b2Vec2.MakeArray(%d);\n",t.b2_maxPolygonVertices);for(var e=0;e<this.m_count;++e)t.b2Log("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t.b2Log("    shape.Set(vs, %d);\n",this.m_count)},t.b2PolygonShape.ComputeCentroid=function(e,o,i){t.ENABLE_ASSERTS&&t.b2Assert(o>=3);var n=i;n.SetZero();for(var s=0,r=t.b2PolygonShape.ComputeCentroid.s_pRef.SetZero(),a=1/3,l=0;o>l;++l){var p=r,b=e[l],m=e[(l+1)%o],_=t.b2SubVV(b,p,t.b2PolygonShape.ComputeCentroid.s_e1),d=t.b2SubVV(m,p,t.b2PolygonShape.ComputeCentroid.s_e2),h=t.b2CrossVV(_,d),c=.5*h;s+=c,n.x+=c*a*(p.x+b.x+m.x),n.y+=c*a*(p.y+b.y+m.y)}return t.ENABLE_ASSERTS&&t.b2Assert(s>t.b2_epsilon),n.SelfMul(1/s),n},t.b2PolygonShape.ComputeCentroid.s_pRef=new t.b2Vec2,t.b2PolygonShape.ComputeCentroid.s_e1=new t.b2Vec2,t.b2PolygonShape.ComputeCentroid.s_e2=new t.b2Vec2,t}(o,p),L=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2PulleyJoint&&(t.b2PulleyJoint={}),t.b2_minPulleyLength=2,t.b2PulleyJointDef=function(){e.base(this,t.b2JointType.e_pulleyJoint),this.collideConnected=!0,this.groundAnchorA=new t.b2Vec2(-1,1),this.groundAnchorB=new t.b2Vec2(1,1),this.localAnchorA=new t.b2Vec2(-1,0),this.localAnchorB=new t.b2Vec2(1,0)},e.inherits(t.b2PulleyJointDef,t.b2JointDef),t.b2PulleyJointDef.prototype.groundAnchorA=null,t.b2PulleyJointDef.prototype.groundAnchorB=null,t.b2PulleyJointDef.prototype.localAnchorA=null,t.b2PulleyJointDef.prototype.localAnchorB=null,t.b2PulleyJointDef.prototype.lengthA=0,t.b2PulleyJointDef.prototype.lengthB=0,t.b2PulleyJointDef.prototype.ratio=1,t.b2PulleyJointDef.prototype.Initialize=function(e,o,i,n,s,r,a){this.bodyA=e,this.bodyB=o,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(n),this.bodyA.GetLocalPoint(s,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.lengthA=t.b2DistanceVV(s,i),this.lengthB=t.b2DistanceVV(r,n),this.ratio=a,t.ENABLE_ASSERTS&&t.b2Assert(this.ratio>t.b2_epsilon)},t.b2PulleyJoint=function(o){e.base(this,o),this.m_groundAnchorA=new t.b2Vec2,this.m_groundAnchorB=new t.b2Vec2,this.m_localAnchorA=new t.b2Vec2,this.m_localAnchorB=new t.b2Vec2,this.m_uA=new t.b2Vec2,this.m_uB=new t.b2Vec2,this.m_rA=new t.b2Vec2,this.m_rB=new t.b2Vec2,this.m_localCenterA=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2,this.m_groundAnchorA.Copy(o.groundAnchorA),this.m_groundAnchorB.Copy(o.groundAnchorB),this.m_localAnchorA.Copy(o.localAnchorA),this.m_localAnchorB.Copy(o.localAnchorB),this.m_lengthA=o.lengthA,this.m_lengthB=o.lengthB,t.ENABLE_ASSERTS&&t.b2Assert(0!=o.ratio),this.m_ratio=o.ratio,this.m_constant=o.lengthA+this.m_ratio*o.lengthB,this.m_impulse=0},e.inherits(t.b2PulleyJoint,t.b2Joint),t.b2PulleyJoint.prototype.m_groundAnchorA=null,t.b2PulleyJoint.prototype.m_groundAnchorB=null,t.b2PulleyJoint.prototype.m_lengthA=0,t.b2PulleyJoint.prototype.m_lengthB=0,t.b2PulleyJoint.prototype.m_localAnchorA=null,t.b2PulleyJoint.prototype.m_localAnchorB=null,t.b2PulleyJoint.prototype.m_constant=0,t.b2PulleyJoint.prototype.m_ratio=0,t.b2PulleyJoint.prototype.m_impulse=0,t.b2PulleyJoint.prototype.m_indexA=0,t.b2PulleyJoint.prototype.m_indexB=0,t.b2PulleyJoint.prototype.m_uA=null,t.b2PulleyJoint.prototype.m_uB=null,t.b2PulleyJoint.prototype.m_rA=null,t.b2PulleyJoint.prototype.m_rB=null,t.b2PulleyJoint.prototype.m_localCenterA=null,t.b2PulleyJoint.prototype.m_localCenterB=null,t.b2PulleyJoint.prototype.m_invMassA=0,t.b2PulleyJoint.prototype.m_invMassB=0,t.b2PulleyJoint.prototype.m_invIA=0,t.b2PulleyJoint.prototype.m_invIB=0,t.b2PulleyJoint.prototype.m_mass=0,t.b2PulleyJoint.prototype.m_qA=null,t.b2PulleyJoint.prototype.m_qB=null,t.b2PulleyJoint.prototype.m_lalcA=null,t.b2PulleyJoint.prototype.m_lalcB=null,t.b2PulleyJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,r=e.positions[this.m_indexB].c,a=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,p=e.velocities[this.m_indexB].w,b=this.m_qA.SetAngleRadians(i),m=this.m_qB.SetAngleRadians(a);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),t.b2MulRV(b,this.m_lalcA,this.m_rA),t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),t.b2MulRV(m,this.m_lalcB,this.m_rB),this.m_uA.Copy(o).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(r).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var _=this.m_uA.GetLength(),d=this.m_uB.GetLength();_>10*t.b2_linearSlop?this.m_uA.SelfMul(1/_):this.m_uA.SetZero(),d>10*t.b2_linearSlop?this.m_uB.SelfMul(1/d):this.m_uB.SetZero();var h=t.b2CrossVV(this.m_rA,this.m_uA),c=t.b2CrossVV(this.m_rB,this.m_uB),u=this.m_invMassA+this.m_invIA*h*h,y=this.m_invMassB+this.m_invIB*c*c;if(this.m_mass=u+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var f=t.b2MulSV(-this.m_impulse,this.m_uA,t.b2PulleyJoint.prototype.InitVelocityConstraints.s_PA),S=t.b2MulSV(-this.m_ratio*this.m_impulse,this.m_uB,t.b2PulleyJoint.prototype.InitVelocityConstraints.s_PB);n.SelfMulAdd(this.m_invMassA,f),s+=this.m_invIA*t.b2CrossVV(this.m_rA,f),l.SelfMulAdd(this.m_invMassB,S),p+=this.m_invIB*t.b2CrossVV(this.m_rB,S)}else this.m_impulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=p},t.b2PulleyJoint.prototype.InitVelocityConstraints.s_PA=new t.b2Vec2,t.b2PulleyJoint.prototype.InitVelocityConstraints.s_PB=new t.b2Vec2,t.b2PulleyJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=t.b2AddVCrossSV(o,i,this.m_rA,t.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpA),a=t.b2AddVCrossSV(n,s,this.m_rB,t.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpB),l=-t.b2DotVV(this.m_uA,r)-this.m_ratio*t.b2DotVV(this.m_uB,a),p=-this.m_mass*l;this.m_impulse+=p;var b=t.b2MulSV(-p,this.m_uA,t.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PA),m=t.b2MulSV(-this.m_ratio*p,this.m_uB,t.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PB);o.SelfMulAdd(this.m_invMassA,b),i+=this.m_invIA*t.b2CrossVV(this.m_rA,b),n.SelfMulAdd(this.m_invMassB,m),s+=this.m_invIB*t.b2CrossVV(this.m_rB,m),e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s},t.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpA=new t.b2Vec2,t.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpB=new t.b2Vec2,t.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PA=new t.b2Vec2,t.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PB=new t.b2Vec2,t.b2PulleyJoint.prototype.SolvePositionConstraints=function(e){var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.positions[this.m_indexB].c,s=e.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s);
t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=t.b2MulRV(r,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=t.b2MulRV(a,this.m_lalcB,this.m_rB),b=this.m_uA.Copy(o).SelfAdd(l).SelfSub(this.m_groundAnchorA),m=this.m_uB.Copy(n).SelfAdd(p).SelfSub(this.m_groundAnchorB),_=b.GetLength(),d=m.GetLength();_>10*t.b2_linearSlop?b.SelfMul(1/_):b.SetZero(),d>10*t.b2_linearSlop?m.SelfMul(1/d):m.SetZero();var h=t.b2CrossVV(l,b),c=t.b2CrossVV(p,m),u=this.m_invMassA+this.m_invIA*h*h,y=this.m_invMassB+this.m_invIB*c*c,f=u+this.m_ratio*this.m_ratio*y;f>0&&(f=1/f);var S=this.m_constant-_-this.m_ratio*d,C=t.b2Abs(S),v=-f*S,A=t.b2MulSV(-v,b,t.b2PulleyJoint.prototype.SolvePositionConstraints.s_PA),g=t.b2MulSV(-this.m_ratio*v,m,t.b2PulleyJoint.prototype.SolvePositionConstraints.s_PB);return o.SelfMulAdd(this.m_invMassA,A),i+=this.m_invIA*t.b2CrossVV(l,A),n.SelfMulAdd(this.m_invMassB,g),s+=this.m_invIB*t.b2CrossVV(p,g),e.positions[this.m_indexA].a=i,e.positions[this.m_indexB].a=s,C<t.b2_linearSlop},t.b2PulleyJoint.prototype.SolvePositionConstraints.s_PA=new t.b2Vec2,t.b2PulleyJoint.prototype.SolvePositionConstraints.s_PB=new t.b2Vec2,t.b2PulleyJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2PulleyJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2PulleyJoint.prototype.GetReactionForce=function(e,t){return t.Set(e*this.m_impulse*this.m_uB.x,e*this.m_impulse*this.m_uB.y)},t.b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},t.b2PulleyJoint.prototype.GetGroundAnchorA=function(e){return e.Copy(this.m_groundAnchorA)},t.b2PulleyJoint.prototype.GetGroundAnchorB=function(e){return e.Copy(this.m_groundAnchorB)},t.b2PulleyJoint.prototype.GetLengthA=function(){return this.m_lengthA},t.b2PulleyJoint.prototype.GetLengthB=function(){return this.m_lengthB},t.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},t.b2PulleyJoint.prototype.GetCurrentLengthA=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t.b2PulleyJoint.prototype.GetCurrentLengthA.s_p),o=this.m_groundAnchorA;return t.b2DistanceVV(e,o)},t.b2PulleyJoint.prototype.GetCurrentLengthA.s_p=new t.b2Vec2,t.b2PulleyJoint.prototype.GetCurrentLengthB=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t.b2PulleyJoint.prototype.GetCurrentLengthB.s_p),o=this.m_groundAnchorB;return t.b2DistanceVV(e,o)},t.b2PulleyJoint.prototype.GetCurrentLengthB.s_p=new t.b2Vec2,t.b2PulleyJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2PulleyJointDef*/ var jd = new box2d.b2PulleyJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t.b2Log("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t.b2Log("  jd.lengthA = %.15f;\n",this.m_lengthA),t.b2Log("  jd.lengthB = %.15f;\n",this.m_lengthB),t.b2Log("  jd.ratio = %.15f;\n",this.m_ratio),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t.b2PulleyJoint.prototype.ShiftOrigin=function(e){this.m_groundAnchorA.SelfSub(e),this.m_groundAnchorB.SelfSub(e)},t}(o,s,n,i),F=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Rope&&(t.b2Rope={}),t.b2RopeDef=function(){this.vertices=new Array,this.masses=new Array,this.gravity=new t.b2Vec2},t.b2RopeDef.prototype.vertices=null,t.b2RopeDef.prototype.count=0,t.b2RopeDef.prototype.masses=null,t.b2RopeDef.prototype.gravity=null,t.b2RopeDef.prototype.damping=.1,t.b2RopeDef.prototype.k2=.9,t.b2RopeDef.prototype.k3=.1,t.b2Rope=function(){this.m_gravity=new t.b2Vec2},t.b2Rope.prototype.m_count=0,t.b2Rope.prototype.m_ps=null,t.b2Rope.prototype.m_p0s=null,t.b2Rope.prototype.m_vs=null,t.b2Rope.prototype.m_ims=null,t.b2Rope.prototype.m_Ls=null,t.b2Rope.prototype.m_as=null,t.b2Rope.prototype.m_gravity=null,t.b2Rope.prototype.m_damping=0,t.b2Rope.prototype.m_k2=1,t.b2Rope.prototype.m_k3=.1,t.b2Rope.prototype.GetVertexCount=function(){return this.m_count},t.b2Rope.prototype.GetVertices=function(){return this.m_ps},t.b2Rope.prototype.Initialize=function(e){t.ENABLE_ASSERTS&&t.b2Assert(e.count>=3),this.m_count=e.count,this.m_ps=t.b2Vec2.MakeArray(this.m_count),this.m_p0s=t.b2Vec2.MakeArray(this.m_count),this.m_vs=t.b2Vec2.MakeArray(this.m_count),this.m_ims=t.b2MakeNumberArray(this.m_count);for(var o=0;o<this.m_count;++o){this.m_ps[o].Copy(e.vertices[o]),this.m_p0s[o].Copy(e.vertices[o]),this.m_vs[o].SetZero();var i=e.masses[o];this.m_ims[o]=i>0?1/i:0}var n=this.m_count-1,s=this.m_count-2;this.m_Ls=t.b2MakeNumberArray(n),this.m_as=t.b2MakeNumberArray(s);for(var o=0;n>o;++o){var r=this.m_ps[o],a=this.m_ps[o+1];this.m_Ls[o]=t.b2DistanceVV(r,a)}for(var o=0;s>o;++o){var r=this.m_ps[o],a=this.m_ps[o+1],l=this.m_ps[o+2],p=t.b2SubVV(a,r,t.b2Vec2.s_t0),b=t.b2SubVV(l,a,t.b2Vec2.s_t1),m=t.b2CrossVV(p,b),_=t.b2DotVV(p,b);this.m_as[o]=t.b2Atan2(m,_)}this.m_gravity.Copy(e.gravity),this.m_damping=e.damping,this.m_k2=e.k2,this.m_k3=e.k3},t.b2Rope.prototype.Step=function(e,o){if(0!=e){for(var i=Math.exp(-e*this.m_damping),n=0;n<this.m_count;++n)this.m_p0s[n].Copy(this.m_ps[n]),this.m_ims[n]>0&&this.m_vs[n].SelfMulAdd(e,this.m_gravity),this.m_vs[n].SelfMul(i),this.m_ps[n].SelfMulAdd(e,this.m_vs[n]);for(var n=0;o>n;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var s=1/e,n=0;n<this.m_count;++n)t.b2MulSV(s,t.b2SubVV(this.m_ps[n],this.m_p0s[n],t.b2Vec2.s_t0),this.m_vs[n])}},t.b2Rope.prototype.SolveC2=function(){for(var e=this.m_count-1,o=0;e>o;++o){var i=this.m_ps[o],n=this.m_ps[o+1],s=t.b2SubVV(n,i,t.b2Rope.s_d),r=s.Normalize(),a=this.m_ims[o],l=this.m_ims[o+1];if(a+l!=0){var p=a/(a+l),b=l/(a+l);i.SelfMulSub(this.m_k2*p*(this.m_Ls[o]-r),s),n.SelfMulAdd(this.m_k2*b*(this.m_Ls[o]-r),s)}}},t.b2Rope.s_d=new t.b2Vec2,t.b2Rope.prototype.SetAngleRadians=function(e){for(var t=this.m_count-2,o=0;t>o;++o)this.m_as[o]=e},t.b2Rope.prototype.SolveC3=function(){for(var e=this.m_count-2,o=0;e>o;++o){var i=this.m_ps[o],n=this.m_ps[o+1],s=this.m_ps[o+2],r=this.m_ims[o],a=this.m_ims[o+1],l=this.m_ims[o+2],p=t.b2SubVV(n,i,t.b2Rope.s_d1),b=t.b2SubVV(s,n,t.b2Rope.s_d2),m=p.GetLengthSquared(),_=b.GetLengthSquared();if(m*_!=0){var d=t.b2CrossVV(p,b),h=t.b2DotVV(p,b),c=t.b2Atan2(d,h),u=t.b2MulSV(-1/m,p.SelfSkew(),t.b2Rope.s_Jd1),y=t.b2MulSV(1/_,b.SelfSkew(),t.b2Rope.s_Jd2),f=t.b2NegV(u,t.b2Rope.s_J1),S=t.b2SubVV(u,y,t.b2Rope.s_J2),C=y,v=r*t.b2DotVV(f,f)+a*t.b2DotVV(S,S)+l*t.b2DotVV(C,C);if(0!=v){v=1/v;for(var A=c-this.m_as[o];A>t.b2_pi;)c-=2*t.b2_pi,A=c-this.m_as[o];for(;A<-t.b2_pi;)c+=2*t.b2_pi,A=c-this.m_as[o];var g=-this.m_k3*v*A;i.SelfMulAdd(r*g,f),n.SelfMulAdd(a*g,S),s.SelfMulAdd(l*g,C)}}}},t.b2Rope.s_d1=new t.b2Vec2,t.b2Rope.s_d2=new t.b2Vec2,t.b2Rope.s_Jd1=new t.b2Vec2,t.b2Rope.s_Jd2=new t.b2Vec2,t.b2Rope.s_J1=new t.b2Vec2,t.b2Rope.s_J2=new t.b2Vec2,t.b2Rope.prototype.Draw=function(e){for(var o=new t.b2Color(.4,.5,.7),i=0;i<this.m_count-1;++i)e.DrawSegment(this.m_ps[i],this.m_ps[i+1],o)},t}(o,V,n),G=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2RopeJoint&&(t.b2RopeJoint={}),t.b2RopeJointDef=function(){e.base(this,t.b2JointType.e_ropeJoint),this.localAnchorA=new t.b2Vec2(-1,0),this.localAnchorB=new t.b2Vec2(1,0)},e.inherits(t.b2RopeJointDef,t.b2JointDef),t.b2RopeJointDef.prototype.localAnchorA=null,t.b2RopeJointDef.prototype.localAnchorB=null,t.b2RopeJointDef.prototype.maxLength=0,t.b2RopeJoint=function(o){e.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_maxLength=o.maxLength,this.m_u=new t.b2Vec2,this.m_rA=new t.b2Vec2,this.m_rB=new t.b2Vec2,this.m_localCenterA=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2},e.inherits(t.b2RopeJoint,t.b2Joint),t.b2RopeJoint.prototype.m_localAnchorA=null,t.b2RopeJoint.prototype.m_localAnchorB=null,t.b2RopeJoint.prototype.m_maxLength=0,t.b2RopeJoint.prototype.m_length=0,t.b2RopeJoint.prototype.m_impulse=0,t.b2RopeJoint.prototype.m_indexA=0,t.b2RopeJoint.prototype.m_indexB=0,t.b2RopeJoint.prototype.m_u=null,t.b2RopeJoint.prototype.m_rA=null,t.b2RopeJoint.prototype.m_rB=null,t.b2RopeJoint.prototype.m_localCenterA=null,t.b2RopeJoint.prototype.m_localCenterB=null,t.b2RopeJoint.prototype.m_invMassA=0,t.b2RopeJoint.prototype.m_invMassB=0,t.b2RopeJoint.prototype.m_invIA=0,t.b2RopeJoint.prototype.m_invIB=0,t.b2RopeJoint.prototype.m_mass=0,t.b2RopeJoint.prototype.m_state=t.b2LimitState.e_inactiveLimit,t.b2RopeJoint.prototype.m_qA=null,t.b2RopeJoint.prototype.m_qB=null,t.b2RopeJoint.prototype.m_lalcA=null,t.b2RopeJoint.prototype.m_lalcB=null,t.b2RopeJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,r=e.positions[this.m_indexB].c,a=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,p=e.velocities[this.m_indexB].w,b=this.m_qA.SetAngleRadians(i),m=this.m_qB.SetAngleRadians(a);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),t.b2MulRV(b,this.m_lalcA,this.m_rA),t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),t.b2MulRV(m,this.m_lalcB,this.m_rB),this.m_u.Copy(r).SelfAdd(this.m_rB).SelfSub(o).SelfSub(this.m_rA),this.m_length=this.m_u.GetLength();var _=this.m_length-this.m_maxLength;if(this.m_state=_>0?t.b2LimitState.e_atUpperLimit:t.b2LimitState.e_inactiveLimit,!(this.m_length>t.b2_linearSlop))return this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,void 0;this.m_u.SelfMul(1/this.m_length);var d=t.b2CrossVV(this.m_rA,this.m_u),h=t.b2CrossVV(this.m_rB,this.m_u),c=this.m_invMassA+this.m_invIA*d*d+this.m_invMassB+this.m_invIB*h*h;if(this.m_mass=0!=c?1/c:0,e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var u=t.b2MulSV(this.m_impulse,this.m_u,t.b2RopeJoint.prototype.InitVelocityConstraints.s_P);n.SelfMulSub(this.m_invMassA,u),s-=this.m_invIA*t.b2CrossVV(this.m_rA,u),l.SelfMulAdd(this.m_invMassB,u),p+=this.m_invIB*t.b2CrossVV(this.m_rB,u)}else this.m_impulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=p},t.b2RopeJoint.prototype.InitVelocityConstraints.s_P=new t.b2Vec2,t.b2RopeJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=t.b2AddVCrossSV(o,i,this.m_rA,t.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpA),a=t.b2AddVCrossSV(n,s,this.m_rB,t.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpB),l=this.m_length-this.m_maxLength,p=t.b2DotVV(this.m_u,t.b2SubVV(a,r,t.b2Vec2.s_t0));0>l&&(p+=e.step.inv_dt*l);var b=-this.m_mass*p,m=this.m_impulse;this.m_impulse=t.b2Min(0,this.m_impulse+b),b=this.m_impulse-m;var _=t.b2MulSV(b,this.m_u,t.b2RopeJoint.prototype.SolveVelocityConstraints.s_P);o.SelfMulSub(this.m_invMassA,_),i-=this.m_invIA*t.b2CrossVV(this.m_rA,_),n.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*t.b2CrossVV(this.m_rB,_),e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s},t.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpA=new t.b2Vec2,t.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpB=new t.b2Vec2,t.b2RopeJoint.prototype.SolveVelocityConstraints.s_P=new t.b2Vec2,t.b2RopeJoint.prototype.SolvePositionConstraints=function(e){var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.positions[this.m_indexB].c,s=e.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=t.b2MulRV(r,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=t.b2MulRV(a,this.m_lalcB,this.m_rB),b=this.m_u.Copy(n).SelfAdd(p).SelfSub(o).SelfSub(l),m=b.Normalize(),_=m-this.m_maxLength;_=t.b2Clamp(_,0,t.b2_maxLinearCorrection);var d=-this.m_mass*_,h=t.b2MulSV(d,b,t.b2RopeJoint.prototype.SolvePositionConstraints.s_P);return o.SelfMulSub(this.m_invMassA,h),i-=this.m_invIA*t.b2CrossVV(l,h),n.SelfMulAdd(this.m_invMassB,h),s+=this.m_invIB*t.b2CrossVV(p,h),e.positions[this.m_indexA].a=i,e.positions[this.m_indexB].a=s,m-this.m_maxLength<t.b2_linearSlop},t.b2RopeJoint.prototype.SolvePositionConstraints.s_P=new t.b2Vec2,t.b2RopeJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2RopeJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2RopeJoint.prototype.GetReactionForce=function(e,o){var i=t.b2MulSV(e*this.m_impulse,this.m_u,o);return i},t.b2RopeJoint.prototype.GetReactionTorque=function(){return 0},t.b2RopeJoint.prototype.GetLocalAnchorA=function(e){return e.Copy(this.m_localAnchorA)},t.b2RopeJoint.prototype.GetLocalAnchorB=function(e){return e.Copy(this.m_localAnchorB)},t.b2RopeJoint.prototype.SetMaxLength=function(e){this.m_maxLength=e},t.b2RopeJoint.prototype.GetMaxLength=function(){return this.m_maxLength},t.b2RopeJoint.prototype.GetLimitState=function(){return this.m_state},t.b2RopeJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2RopeJointDef*/ var jd = new box2d.b2RopeJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t.b2Log("  jd.maxLength = %.15f;\n",this.m_maxLength),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t}(o,s,n,i),N=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2TensorDampingController&&(t.b2TensorDampingController={}),t.b2TensorDampingController=function(){e.base(this),this.T=new t.b2Mat22,this.maxTimestep=0},e.inherits(t.b2TensorDampingController,t.b2Controller),t.b2TensorDampingController.prototype.T=new t.b2Mat22,t.b2TensorDampingController.prototype.maxTimestep=0,t.b2TensorDampingController.prototype.Step=function(e){var o=e.dt;if(!(o<=t.b2_epsilon)){o>this.maxTimestep&&this.maxTimestep>0&&(o=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(n.IsAwake()){var s=n.GetWorldVector(t.b2MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity(),t.b2Vec2.s_t0),t.b2Vec2.s_t1),t.b2TensorDampingController.prototype.Step.s_damping);n.SetLinearVelocity(t.b2AddVV(n.GetLinearVelocity(),t.b2MulSV(o,s,t.b2Vec2.s_t0),t.b2Vec2.s_t1))}}}},t.b2TensorDampingController.prototype.Step.s_damping=new t.b2Vec2,t.b2TensorDampingController.prototype.SetAxisAligned=function(e,o){this.T.ex.x=-e,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-o,this.maxTimestep=e>0||o>0?1/t.b2Max(e,o):0},t}(o,c,n,i),k=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2TimeStep&&(t.b2TimeStep={}),t.b2Profile=function(){},t.b2Profile.prototype.step=0,t.b2Profile.prototype.collide=0,t.b2Profile.prototype.solve=0,t.b2Profile.prototype.solveInit=0,t.b2Profile.prototype.solveVelocity=0,t.b2Profile.prototype.solvePosition=0,t.b2Profile.prototype.broadphase=0,t.b2Profile.prototype.solveTOI=0,t.b2Profile.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},t.b2TimeStep=function(){},t.b2TimeStep.prototype.dt=0,t.b2TimeStep.prototype.inv_dt=0,t.b2TimeStep.prototype.dtRatio=0,t.b2TimeStep.prototype.velocityIterations=0,t.b2TimeStep.prototype.positionIterations=0,t.b2TimeStep.prototype.warmStarting=!1,t.b2TimeStep.prototype.Copy=function(e){return this.dt=e.dt,this.inv_dt=e.inv_dt,this.dtRatio=e.dtRatio,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting,this},t.b2Position=function(){this.c=new t.b2Vec2},t.b2Position.prototype.c=null,t.b2Position.prototype.a=0,t.b2Position.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2Position})},t.b2Velocity=function(){this.v=new t.b2Vec2},t.b2Velocity.prototype.v=null,t.b2Velocity.prototype.w=0,t.b2Velocity.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2Velocity})},t.b2SolverData=function(){this.step=new t.b2TimeStep},t.b2SolverData.prototype.step=null,t.b2SolverData.prototype.positions=null,t.b2SolverData.prototype.velocities=null,t}(o,i),O=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2WeldJoint&&(t.b2WeldJoint={}),t.b2WeldJointDef=function(){e.base(this,t.b2JointType.e_weldJoint),this.localAnchorA=new t.b2Vec2,this.localAnchorB=new t.b2Vec2},e.inherits(t.b2WeldJointDef,t.b2JointDef),t.b2WeldJointDef.prototype.localAnchorA=null,t.b2WeldJointDef.prototype.localAnchorB=null,t.b2WeldJointDef.prototype.referenceAngle=0,t.b2WeldJointDef.prototype.frequencyHz=0,t.b2WeldJointDef.prototype.dampingRatio=0,t.b2WeldJointDef.prototype.Initialize=function(e,t,o){this.bodyA=e,this.bodyB=t,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},t.b2WeldJoint=function(o){e.base(this,o),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_referenceAngle=o.referenceAngle,this.m_impulse=new t.b2Vec3(0,0,0),this.m_rA=new t.b2Vec2,this.m_rB=new t.b2Vec2,this.m_localCenterA=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_mass=new t.b2Mat33,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2,this.m_K=new t.b2Mat33},e.inherits(t.b2WeldJoint,t.b2Joint),t.b2WeldJoint.prototype.m_frequencyHz=0,t.b2WeldJoint.prototype.m_dampingRatio=0,t.b2WeldJoint.prototype.m_bias=0,t.b2WeldJoint.prototype.m_localAnchorA=null,t.b2WeldJoint.prototype.m_localAnchorB=null,t.b2WeldJoint.prototype.m_referenceAngle=0,t.b2WeldJoint.prototype.m_gamma=0,t.b2WeldJoint.prototype.m_impulse=null,t.b2WeldJoint.prototype.m_indexA=0,t.b2WeldJoint.prototype.m_indexB=0,t.b2WeldJoint.prototype.m_rA=null,t.b2WeldJoint.prototype.m_rB=null,t.b2WeldJoint.prototype.m_localCenterA=null,t.b2WeldJoint.prototype.m_localCenterB=null,t.b2WeldJoint.prototype.m_invMassA=0,t.b2WeldJoint.prototype.m_invMassB=0,t.b2WeldJoint.prototype.m_invIA=0,t.b2WeldJoint.prototype.m_invIB=0,t.b2WeldJoint.prototype.m_mass=null,t.b2WeldJoint.prototype.m_qA=null,t.b2WeldJoint.prototype.m_qB=null,t.b2WeldJoint.prototype.m_lalcA=null,t.b2WeldJoint.prototype.m_lalcB=null,t.b2WeldJoint.prototype.m_K=null,t.b2WeldJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=e.positions[this.m_indexA].a,i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,s=e.positions[this.m_indexB].a,r=e.velocities[this.m_indexB].v,a=e.velocities[this.m_indexB].w,l=this.m_qA.SetAngleRadians(o),p=this.m_qB.SetAngleRadians(s);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),t.b2MulRV(l,this.m_lalcA,this.m_rA),t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),t.b2MulRV(p,this.m_lalcB,this.m_rB);var b=this.m_invMassA,m=this.m_invMassB,_=this.m_invIA,d=this.m_invIB,h=this.m_K;if(h.ex.x=b+m+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*d,h.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*d,h.ez.x=-this.m_rA.y*_-this.m_rB.y*d,h.ex.y=h.ey.x,h.ey.y=b+m+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*d,h.ez.y=this.m_rA.x*_+this.m_rB.x*d,h.ex.z=h.ez.x,h.ey.z=h.ez.y,h.ez.z=_+d,this.m_frequencyHz>0){h.GetInverse22(this.m_mass);var c=_+d,u=c>0?1/c:0,y=s-o-this.m_referenceAngle,f=2*t.b2_pi*this.m_frequencyHz,S=2*u*this.m_dampingRatio*f,C=u*f*f,v=e.step.dt;this.m_gamma=v*(S+v*C),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*v*C*this.m_gamma,c+=this.m_gamma,this.m_mass.ez.z=0!=c?1/c:0}else h.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio);var A=t.b2WeldJoint.prototype.InitVelocityConstraints.s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(b,A),n-=_*(t.b2CrossVV(this.m_rA,A)+this.m_impulse.z),r.SelfMulAdd(m,A),a+=d*(t.b2CrossVV(this.m_rB,A)+this.m_impulse.z)}else this.m_impulse.SetZero();e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=a},t.b2WeldJoint.prototype.InitVelocityConstraints.s_P=new t.b2Vec2,t.b2WeldJoint.prototype.SolveVelocityConstraints=function(e){var o=e.velocities[this.m_indexA].v,i=e.velocities[this.m_indexA].w,n=e.velocities[this.m_indexB].v,s=e.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB;if(this.m_frequencyHz>0){var b=s-i,m=-this.m_mass.ez.z*(b+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=m,i-=l*m,s+=p*m;var _=t.b2SubVV(t.b2AddVCrossSV(n,s,this.m_rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(o,i,this.m_rA,t.b2Vec2.s_t1),t.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1),d=t.b2MulM33XY(this.m_mass,_.x,_.y,t.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse1).SelfNeg();this.m_impulse.x+=d.x,this.m_impulse.y+=d.y;var h=d;o.SelfMulSub(r,h),i-=l*t.b2CrossVV(this.m_rA,h),n.SelfMulAdd(a,h),s+=p*t.b2CrossVV(this.m_rB,h)}else{var _=t.b2SubVV(t.b2AddVCrossSV(n,s,this.m_rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(o,i,this.m_rA,t.b2Vec2.s_t1),t.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1),b=s-i,c=t.b2MulM33XYZ(this.m_mass,_.x,_.y,b,t.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse).SelfNeg();this.m_impulse.SelfAdd(c);var h=t.b2WeldJoint.prototype.SolveVelocityConstraints.s_P.Set(c.x,c.y);o.SelfMulSub(r,h),i-=l*(t.b2CrossVV(this.m_rA,h)+c.z),n.SelfMulAdd(a,h),s+=p*(t.b2CrossVV(this.m_rB,h)+c.z)}e.velocities[this.m_indexA].w=i,e.velocities[this.m_indexB].w=s},t.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1=new t.b2Vec2,t.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse1=new t.b2Vec2,t.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse=new t.b2Vec3,t.b2WeldJoint.prototype.SolveVelocityConstraints.s_P=new t.b2Vec2,t.b2WeldJoint.prototype.SolvePositionConstraints=function(e){var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.positions[this.m_indexB].c,s=e.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s),l=this.m_invMassA,p=this.m_invMassB,b=this.m_invIA,m=this.m_invIB;t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=t.b2MulRV(r,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var d,h,c=t.b2MulRV(a,this.m_lalcB,this.m_rB),u=this.m_K;if(u.ex.x=l+p+_.y*_.y*b+c.y*c.y*m,u.ey.x=-_.y*_.x*b-c.y*c.x*m,u.ez.x=-_.y*b-c.y*m,u.ex.y=u.ey.x,u.ey.y=l+p+_.x*_.x*b+c.x*c.x*m,u.ez.y=_.x*b+c.x*m,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=b+m,this.m_frequencyHz>0){var y=t.b2SubVV(t.b2AddVV(n,c,t.b2Vec2.s_t0),t.b2AddVV(o,_,t.b2Vec2.s_t1),t.b2WeldJoint.prototype.SolvePositionConstraints.s_C1);d=y.GetLength(),h=0;var f=u.Solve22(y.x,y.y,t.b2WeldJoint.prototype.SolvePositionConstraints.s_P).SelfNeg();o.SelfMulSub(l,f),i-=b*t.b2CrossVV(_,f),n.SelfMulAdd(p,f),s+=m*t.b2CrossVV(c,f)}else{var y=t.b2SubVV(t.b2AddVV(n,c,t.b2Vec2.s_t0),t.b2AddVV(o,_,t.b2Vec2.s_t1),t.b2WeldJoint.prototype.SolvePositionConstraints.s_C1),S=s-i-this.m_referenceAngle;d=y.GetLength(),h=t.b2Abs(S);var C=u.Solve33(y.x,y.y,S,t.b2WeldJoint.prototype.SolvePositionConstraints.s_impulse).SelfNeg(),f=t.b2WeldJoint.prototype.SolvePositionConstraints.s_P.Set(C.x,C.y);o.SelfMulSub(l,f),i-=b*(t.b2CrossVV(this.m_rA,f)+C.z),n.SelfMulAdd(p,f),s+=m*(t.b2CrossVV(this.m_rB,f)+C.z)}return e.positions[this.m_indexA].a=i,e.positions[this.m_indexB].a=s,d<=t.b2_linearSlop&&h<=t.b2_angularSlop},t.b2WeldJoint.prototype.SolvePositionConstraints.s_C1=new t.b2Vec2,t.b2WeldJoint.prototype.SolvePositionConstraints.s_P=new t.b2Vec2,t.b2WeldJoint.prototype.SolvePositionConstraints.s_impulse=new t.b2Vec3,t.b2WeldJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2WeldJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2WeldJoint.prototype.GetReactionForce=function(e,t){return t.Set(e*this.m_impulse.x,e*this.m_impulse.y)},t.b2WeldJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.z},t.b2WeldJoint.prototype.GetLocalAnchorA=function(e){return e.Copy(this.m_localAnchorA)},t.b2WeldJoint.prototype.GetLocalAnchorB=function(e){return e.Copy(this.m_localAnchorB)},t.b2WeldJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},t.b2WeldJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e},t.b2WeldJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},t.b2WeldJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},t.b2WeldJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},t.b2WeldJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2WeldJointDef*/ var jd = new box2d.b2WeldJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t}(o,s,n,i),W=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2WheelJoint&&(t.b2WheelJoint={}),t.b2WheelJointDef=function(){e.base(this,t.b2JointType.e_wheelJoint),this.localAnchorA=new t.b2Vec2(0,0),this.localAnchorB=new t.b2Vec2(0,0),this.localAxisA=new t.b2Vec2(1,0)},e.inherits(t.b2WheelJointDef,t.b2JointDef),t.b2WheelJointDef.prototype.localAnchorA=null,t.b2WheelJointDef.prototype.localAnchorB=null,t.b2WheelJointDef.prototype.localAxisA=null,t.b2WheelJointDef.prototype.enableMotor=!1,t.b2WheelJointDef.prototype.maxMotorTorque=0,t.b2WheelJointDef.prototype.motorSpeed=0,t.b2WheelJointDef.prototype.frequencyHz=2,t.b2WheelJointDef.prototype.dampingRatio=.7,t.b2WheelJointDef.prototype.Initialize=function(e,t,o,i){this.bodyA=e,this.bodyB=t,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA)},t.b2WheelJoint=function(o){e.base(this,o),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_localXAxisA=o.localAxisA.Clone(),this.m_localYAxisA=t.b2CrossOneV(this.m_localXAxisA,new t.b2Vec2),this.m_maxMotorTorque=o.maxMotorTorque,this.m_motorSpeed=o.motorSpeed,this.m_enableMotor=o.enableMotor,this.m_localCenterA=new t.b2Vec2,this.m_localCenterB=new t.b2Vec2,this.m_ax=new t.b2Vec2,this.m_ay=new t.b2Vec2,this.m_qA=new t.b2Rot,this.m_qB=new t.b2Rot,this.m_lalcA=new t.b2Vec2,this.m_lalcB=new t.b2Vec2,this.m_rA=new t.b2Vec2,this.m_rB=new t.b2Vec2,this.m_ax.SetZero(),this.m_ay.SetZero()},e.inherits(t.b2WheelJoint,t.b2Joint),t.b2WheelJoint.prototype.m_frequencyHz=0,t.b2WheelJoint.prototype.m_dampingRatio=0,t.b2WheelJoint.prototype.m_localAnchorA=null,t.b2WheelJoint.prototype.m_localAnchorB=null,t.b2WheelJoint.prototype.m_localXAxisA=null,t.b2WheelJoint.prototype.m_localYAxisA=null,t.b2WheelJoint.prototype.m_impulse=0,t.b2WheelJoint.prototype.m_motorImpulse=0,t.b2WheelJoint.prototype.m_springImpulse=0,t.b2WheelJoint.prototype.m_maxMotorTorque=0,t.b2WheelJoint.prototype.m_motorSpeed=0,t.b2WheelJoint.prototype.m_enableMotor=!1,t.b2WheelJoint.prototype.m_indexA=0,t.b2WheelJoint.prototype.m_indexB=0,t.b2WheelJoint.prototype.m_localCenterA=null,t.b2WheelJoint.prototype.m_localCenterB=null,t.b2WheelJoint.prototype.m_invMassA=0,t.b2WheelJoint.prototype.m_invMassB=0,t.b2WheelJoint.prototype.m_invIA=0,t.b2WheelJoint.prototype.m_invIB=0,t.b2WheelJoint.prototype.m_ax=null,t.b2WheelJoint.prototype.m_ay=null,t.b2WheelJoint.prototype.m_sAx=0,t.b2WheelJoint.prototype.m_sBx=0,t.b2WheelJoint.prototype.m_sAy=0,t.b2WheelJoint.prototype.m_sBy=0,t.b2WheelJoint.prototype.m_mass=0,t.b2WheelJoint.prototype.m_motorMass=0,t.b2WheelJoint.prototype.m_springMass=0,t.b2WheelJoint.prototype.m_bias=0,t.b2WheelJoint.prototype.m_gamma=0,t.b2WheelJoint.prototype.m_qA=null,t.b2WheelJoint.prototype.m_qB=null,t.b2WheelJoint.prototype.m_lalcA=null,t.b2WheelJoint.prototype.m_lalcB=null,t.b2WheelJoint.prototype.m_rA=null,t.b2WheelJoint.prototype.m_rB=null,t.b2WheelJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},t.b2WheelJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},t.b2WheelJoint.prototype.SetSpringFrequencyHz=function(e){this.m_frequencyHz=e},t.b2WheelJoint.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},t.b2WheelJoint.prototype.SetSpringDampingRatio=function(e){this.m_dampingRatio=e},t.b2WheelJoint.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},t.b2WheelJoint.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,r=e.positions[this.m_indexA].c,a=e.positions[this.m_indexA].a,l=e.velocities[this.m_indexA].v,p=e.velocities[this.m_indexA].w,b=e.positions[this.m_indexB].c,m=e.positions[this.m_indexB].a,_=e.velocities[this.m_indexB].v,d=e.velocities[this.m_indexB].w,h=this.m_qA.SetAngleRadians(a),c=this.m_qB.SetAngleRadians(m);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=t.b2MulRV(h,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y=t.b2MulRV(c,this.m_lalcB,this.m_rB),f=t.b2SubVV(t.b2AddVV(b,y,t.b2Vec2.s_t0),t.b2AddVV(r,u,t.b2Vec2.s_t1),t.b2WheelJoint.prototype.InitVelocityConstraints.s_d);if(t.b2MulRV(h,this.m_localYAxisA,this.m_ay),this.m_sAy=t.b2CrossVV(t.b2AddVV(f,u,t.b2Vec2.s_t0),this.m_ay),this.m_sBy=t.b2CrossVV(y,this.m_ay),this.m_mass=o+i+n*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){t.b2MulRV(h,this.m_localXAxisA,this.m_ax),this.m_sAx=t.b2CrossVV(t.b2AddVV(f,u,t.b2Vec2.s_t0),this.m_ax),this.m_sBx=t.b2CrossVV(y,this.m_ax);var S=o+i+n*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;
if(S>0){this.m_springMass=1/S;var C=t.b2DotVV(f,this.m_ax),v=2*t.b2_pi*this.m_frequencyHz,A=2*this.m_springMass*this.m_dampingRatio*v,g=this.m_springMass*v*v,w=e.step.dt;this.m_gamma=w*(A+w*g),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=C*w*g*this.m_gamma,this.m_springMass=S+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse*=e.step.dtRatio,this.m_springImpulse*=e.step.dtRatio,this.m_motorImpulse*=e.step.dtRatio;var x=t.b2AddVV(t.b2MulSV(this.m_impulse,this.m_ay,t.b2Vec2.s_t0),t.b2MulSV(this.m_springImpulse,this.m_ax,t.b2Vec2.s_t1),t.b2WheelJoint.prototype.InitVelocityConstraints.s_P),B=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,V=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.SelfMulSub(this.m_invMassA,x),p-=this.m_invIA*B,_.SelfMulAdd(this.m_invMassB,x),d+=this.m_invIB*V}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;e.velocities[this.m_indexA].w=p,e.velocities[this.m_indexB].w=d},t.b2WheelJoint.prototype.InitVelocityConstraints.s_d=new t.b2Vec2,t.b2WheelJoint.prototype.InitVelocityConstraints.s_P=new t.b2Vec2,t.b2WheelJoint.prototype.SolveVelocityConstraints=function(e){var o=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,r=e.velocities[this.m_indexA].v,a=e.velocities[this.m_indexA].w,l=e.velocities[this.m_indexB].v,p=e.velocities[this.m_indexB].w,b=t.b2DotVV(this.m_ax,t.b2SubVV(l,r,t.b2Vec2.s_t0))+this.m_sBx*p-this.m_sAx*a,m=-this.m_springMass*(b+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=m;var _=t.b2MulSV(m,this.m_ax,t.b2WheelJoint.prototype.SolveVelocityConstraints.s_P),d=m*this.m_sAx,h=m*this.m_sBx;r.SelfMulSub(o,_),a-=n*d,l.SelfMulAdd(i,_),p+=s*h;var b=p-a-this.m_motorSpeed,m=-this.m_motorMass*b,c=this.m_motorImpulse,u=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=t.b2Clamp(this.m_motorImpulse+m,-u,u),m=this.m_motorImpulse-c,a-=n*m,p+=s*m;var b=t.b2DotVV(this.m_ay,t.b2SubVV(l,r,t.b2Vec2.s_t0))+this.m_sBy*p-this.m_sAy*a,m=-this.m_mass*b;this.m_impulse+=m;var _=t.b2MulSV(m,this.m_ay,t.b2WheelJoint.prototype.SolveVelocityConstraints.s_P),d=m*this.m_sAy,h=m*this.m_sBy;r.SelfMulSub(o,_),a-=n*d,l.SelfMulAdd(i,_),p+=s*h,e.velocities[this.m_indexA].w=a,e.velocities[this.m_indexB].w=p},t.b2WheelJoint.prototype.SolveVelocityConstraints.s_P=new t.b2Vec2,t.b2WheelJoint.prototype.SolvePositionConstraints=function(e){var o=e.positions[this.m_indexA].c,i=e.positions[this.m_indexA].a,n=e.positions[this.m_indexB].c,s=e.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s);t.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=t.b2MulRV(r,this.m_lalcA,this.m_rA);t.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p,b=t.b2MulRV(a,this.m_lalcB,this.m_rB),m=t.b2AddVV(t.b2SubVV(n,o,t.b2Vec2.s_t0),t.b2SubVV(b,l,t.b2Vec2.s_t1),t.b2WheelJoint.prototype.SolvePositionConstraints.s_d),_=t.b2MulRV(r,this.m_localYAxisA,this.m_ay),d=t.b2CrossVV(t.b2AddVV(m,l,t.b2Vec2.s_t0),_),h=t.b2CrossVV(b,_),c=t.b2DotVV(m,this.m_ay),u=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;p=0!=u?-c/u:0;var y=t.b2MulSV(p,_,t.b2WheelJoint.prototype.SolvePositionConstraints.s_P),f=p*d,S=p*h;return o.SelfMulSub(this.m_invMassA,y),i-=this.m_invIA*f,n.SelfMulAdd(this.m_invMassB,y),s+=this.m_invIB*S,e.positions[this.m_indexA].a=i,e.positions[this.m_indexB].a=s,t.b2Abs(c)<=t.b2_linearSlop},t.b2WheelJoint.prototype.SolvePositionConstraints.s_d=new t.b2Vec2,t.b2WheelJoint.prototype.SolvePositionConstraints.s_P=new t.b2Vec2,t.b2WheelJoint.prototype.GetDefinition=function(e){return t.ENABLE_ASSERTS&&t.b2Assert(!1),e},t.b2WheelJoint.prototype.GetAnchorA=function(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)},t.b2WheelJoint.prototype.GetAnchorB=function(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)},t.b2WheelJoint.prototype.GetReactionForce=function(e,t){return t.x=e*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),t.y=e*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),t},t.b2WheelJoint.prototype.GetReactionTorque=function(e){return e*this.m_motorImpulse},t.b2WheelJoint.prototype.GetLocalAnchorA=function(e){return e.Copy(this.m_localAnchorA)},t.b2WheelJoint.prototype.GetLocalAnchorB=function(e){return e.Copy(this.m_localAnchorB)},t.b2WheelJoint.prototype.GetLocalAxisA=function(e){return e.Copy(this.m_localXAxisA)},t.b2WheelJoint.prototype.GetJointTranslation=function(){var e=this.m_bodyA,o=this.m_bodyB,i=e.GetWorldPoint(this.m_localAnchorA,new t.b2Vec2),n=o.GetWorldPoint(this.m_localAnchorB,new t.b2Vec2),s=t.b2SubVV(n,i,new t.b2Vec2),r=e.GetWorldVector(this.m_localXAxisA,new t.b2Vec2),a=t.b2DotVV(s,r);return a},t.b2WheelJoint.prototype.GetJointSpeed=function(){var e=this.m_bodyA.m_angularVelocity,t=this.m_bodyB.m_angularVelocity;return t-e},t.b2WheelJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},t.b2WheelJoint.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},t.b2WheelJoint.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},t.b2WheelJoint.prototype.SetMaxMotorTorque=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=e},t.b2WheelJoint.prototype.GetMotorTorque=function(e){return e*this.m_motorImpulse},t.b2WheelJoint.prototype.Dump=function(){if(t.DEBUG){var e=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;t.b2Log("  /*box2d.b2WheelJointDef*/ var jd = new box2d.b2WheelJointDef();\n"),t.b2Log("  jd.bodyA = bodies[%d];\n",e),t.b2Log("  jd.bodyB = bodies[%d];\n",o),t.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t.b2Log("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t.b2Log("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},t}(o,s,n,i),z=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2ContactFactory&&(t.b2ContactFactory={}),t.b2ContactRegister=function(){},t.b2ContactRegister.prototype.createFcn=null,t.b2ContactRegister.prototype.destroyFcn=null,t.b2ContactRegister.prototype.primary=!1,t.b2ContactFactory=function(e){this.m_allocator=e,this.InitializeRegisters()},t.b2ContactFactory.prototype.m_allocator=null,t.b2ContactFactory.prototype.AddType=function(e,o,i,n){var s=t.b2MakeArray(256,function(){return e()}),r=function(t){return s.length>0?s.pop():e(t)},a=function(e){s.push(e)};this.m_registers[i][n].pool=s,this.m_registers[i][n].createFcn=r,this.m_registers[i][n].destroyFcn=a,this.m_registers[i][n].primary=!0,i!=n&&(this.m_registers[n][i].pool=s,this.m_registers[n][i].createFcn=r,this.m_registers[n][i].destroyFcn=a,this.m_registers[n][i].primary=!1)},t.b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=new Array(t.b2ShapeType.e_shapeTypeCount);for(var e=0;e<t.b2ShapeType.e_shapeTypeCount;e++){this.m_registers[e]=new Array(t.b2ShapeType.e_shapeTypeCount);for(var o=0;o<t.b2ShapeType.e_shapeTypeCount;o++)this.m_registers[e][o]=new t.b2ContactRegister}this.AddType(t.b2CircleContact.Create,t.b2CircleContact.Destroy,t.b2ShapeType.e_circleShape,t.b2ShapeType.e_circleShape),this.AddType(t.b2PolygonAndCircleContact.Create,t.b2PolygonAndCircleContact.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_circleShape),this.AddType(t.b2PolygonContact.Create,t.b2PolygonContact.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_polygonShape),this.AddType(t.b2EdgeAndCircleContact.Create,t.b2EdgeAndCircleContact.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_circleShape),this.AddType(t.b2EdgeAndPolygonContact.Create,t.b2EdgeAndPolygonContact.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_polygonShape),this.AddType(t.b2ChainAndCircleContact.Create,t.b2ChainAndCircleContact.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_circleShape),this.AddType(t.b2ChainAndPolygonContact.Create,t.b2ChainAndPolygonContact.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_polygonShape)},t.b2ContactFactory.prototype.Create=function(e,o,i,n){var s=e.GetType(),r=i.GetType();t.ENABLE_ASSERTS&&t.b2Assert(s>=0&&s<t.b2ShapeType.e_shapeTypeCount),t.ENABLE_ASSERTS&&t.b2Assert(r>=0&&r<t.b2ShapeType.e_shapeTypeCount);var a=this.m_registers[s][r],l=a.createFcn;if(null!=l){if(a.primary){var p=l(this.m_allocator);return p.Reset(e,o,i,n),p}var p=l(this.m_allocator);return p.Reset(i,n,e,o),p}return null},t.b2ContactFactory.prototype.Destroy=function(e){var o=e.m_fixtureA,i=e.m_fixtureB;e.m_manifold.pointCount>0&&0==o.IsSensor()&&0==i.IsSensor()&&(o.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));var n=o.GetType(),s=i.GetType();t.ENABLE_ASSERTS&&t.b2Assert(n>=0&&s<t.b2ShapeType.e_shapeTypeCount),t.ENABLE_ASSERTS&&t.b2Assert(n>=0&&s<t.b2ShapeType.e_shapeTypeCount);var r=this.m_registers[n][s],a=r.destroyFcn;a(e,this.m_allocator)},t}(o,x,i),q=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2ContactManager&&(t.b2ContactManager={}),t.b2ContactManager=function(){this.m_broadPhase=new t.b2BroadPhase,this.m_contactFactory=new t.b2ContactFactory(this.m_allocator)},t.b2ContactManager.prototype.m_broadPhase=null,t.b2ContactManager.prototype.m_contactList=null,t.b2ContactManager.prototype.m_contactCount=0,t.b2ContactManager.prototype.m_contactFilter=t.b2ContactFilter.b2_defaultFilter,t.b2ContactManager.prototype.m_contactListener=t.b2ContactListener.b2_defaultListener,t.b2ContactManager.prototype.m_allocator=null,t.b2ContactManager.prototype.m_contactFactory=null,t.b2ContactManager.prototype.Destroy=function(e){var t=e.GetFixtureA(),o=e.GetFixtureB(),i=t.GetBody(),n=o.GetBody();this.m_contactListener&&e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_contactList&&(this.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==i.m_contactList&&(i.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==n.m_contactList&&(n.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},t.b2ContactManager.prototype.Collide=function(){for(var e=this.m_contactList;e;){var o=e.GetFixtureA(),i=e.GetFixtureB(),n=e.GetChildIndexA(),s=e.GetChildIndexB(),r=o.GetBody(),a=i.GetBody();if(e.m_flags&t.b2ContactFlag.e_filterFlag){if(0==a.ShouldCollide(r)){var l=e;e=l.m_next,this.Destroy(l);continue}if(this.m_contactFilter&&0==this.m_contactFilter.ShouldCollide(o,i)){l=e,e=l.m_next,this.Destroy(l);continue}e.m_flags&=~t.b2ContactFlag.e_filterFlag}var p=r.IsAwake()&&r.m_type!=t.b2BodyType.b2_staticBody,b=a.IsAwake()&&a.m_type!=t.b2BodyType.b2_staticBody;if(0!=p||0!=b){var m=o.m_proxies[n].proxy,_=i.m_proxies[s].proxy,d=this.m_broadPhase.TestOverlap(m,_);0!=d?(e.Update(this.m_contactListener),e=e.m_next):(l=e,e=l.m_next,this.Destroy(l))}else e=e.m_next}},t.b2ContactManager.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(this)},t.b2ContactManager.prototype.AddPair=function(e,o){t.ENABLE_ASSERTS&&t.b2Assert(e instanceof t.b2FixtureProxy),t.ENABLE_ASSERTS&&t.b2Assert(o instanceof t.b2FixtureProxy);var i=e,n=o,s=i.fixture,r=n.fixture,a=i.childIndex,l=n.childIndex,p=s.GetBody(),b=r.GetBody();if(p!=b){for(var m=b.GetContactList();m;){if(m.other==p){var _=m.contact.GetFixtureA(),d=m.contact.GetFixtureB(),h=m.contact.GetChildIndexA(),c=m.contact.GetChildIndexB();if(_==s&&d==r&&h==a&&c==l)return;if(_==r&&d==s&&h==l&&c==a)return}m=m.next}if(0!=b.ShouldCollide(p)&&(!this.m_contactFilter||0!=this.m_contactFilter.ShouldCollide(s,r))){var u=this.m_contactFactory.Create(s,a,r,l);null!=u&&(s=u.GetFixtureA(),r=u.GetFixtureB(),a=u.GetChildIndexA(),l=u.GetChildIndexB(),p=s.m_body,b=r.m_body,u.m_prev=null,u.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=u),this.m_contactList=u,u.m_nodeA.contact=u,u.m_nodeA.other=b,u.m_nodeA.prev=null,u.m_nodeA.next=p.m_contactList,null!=p.m_contactList&&(p.m_contactList.prev=u.m_nodeA),p.m_contactList=u.m_nodeA,u.m_nodeB.contact=u,u.m_nodeB.other=p,u.m_nodeB.prev=null,u.m_nodeB.next=b.m_contactList,null!=b.m_contactList&&(b.m_contactList.prev=u.m_nodeB),b.m_contactList=u.m_nodeB,0==s.IsSensor()&&0==r.IsSensor()&&(p.SetAwake(!0),b.SetAwake(!0)),++this.m_contactCount)}}},t}(o,h,l,z,n,i),K=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2CollideEdge&&(t.b2CollideEdge={}),t.b2CollideEdgeAndCircle=function(e,o,i,n,s){e.pointCount=0;var r=t.b2MulTXV(i,t.b2MulXV(s,n.m_p,t.b2Vec2.s_t0),t.b2CollideEdgeAndCircle.s_Q),a=o.m_vertex1,l=o.m_vertex2,p=t.b2SubVV(l,a,t.b2CollideEdgeAndCircle.s_e),b=t.b2DotVV(p,t.b2SubVV(l,r,t.b2Vec2.s_t0)),m=t.b2DotVV(p,t.b2SubVV(r,a,t.b2Vec2.s_t0)),_=o.m_radius+n.m_radius,d=t.b2CollideEdgeAndCircle.s_id;if(d.cf.indexB=0,d.cf.typeB=t.b2ContactFeatureType.e_vertex,0>=m){var h=a,c=t.b2SubVV(r,h,t.b2CollideEdgeAndCircle.s_d),u=t.b2DotVV(c,c);if(u>_*_)return;if(o.m_hasVertex0){var y=o.m_vertex0,f=a,S=t.b2SubVV(f,y,t.b2CollideEdgeAndCircle.s_e1),C=t.b2DotVV(S,t.b2SubVV(f,r,t.b2Vec2.s_t0));if(C>0)return}return d.cf.indexA=0,d.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(h),e.points[0].id.Copy(d),e.points[0].localPoint.Copy(n.m_p),void 0}if(0>=b){var h=l,c=t.b2SubVV(r,h,t.b2CollideEdgeAndCircle.s_d),u=t.b2DotVV(c,c);if(u>_*_)return;if(o.m_hasVertex3){var v=o.m_vertex3,A=l,g=t.b2SubVV(v,A,t.b2CollideEdgeAndCircle.s_e2),w=t.b2DotVV(g,t.b2SubVV(r,A,t.b2Vec2.s_t0));if(w>0)return}return d.cf.indexA=1,d.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(h),e.points[0].id.Copy(d),e.points[0].localPoint.Copy(n.m_p),void 0}var x=t.b2DotVV(p,p);t.ENABLE_ASSERTS&&t.b2Assert(x>0);var h=t.b2CollideEdgeAndCircle.s_P;h.x=1/x*(b*a.x+m*l.x),h.y=1/x*(b*a.y+m*l.y);var c=t.b2SubVV(r,h,t.b2CollideEdgeAndCircle.s_d),u=t.b2DotVV(c,c);if(!(u>_*_)){var B=t.b2CollideEdgeAndCircle.s_n.Set(-p.y,p.x);t.b2DotVV(B,t.b2SubVV(r,a,t.b2Vec2.s_t0))<0&&B.Set(-B.x,-B.y),B.Normalize(),d.cf.indexA=0,d.cf.typeA=t.b2ContactFeatureType.e_face,e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(B),e.localPoint.Copy(a),e.points[0].id.Copy(d),e.points[0].localPoint.Copy(n.m_p)}},t.b2CollideEdgeAndCircle.s_Q=new t.b2Vec2,t.b2CollideEdgeAndCircle.s_e=new t.b2Vec2,t.b2CollideEdgeAndCircle.s_d=new t.b2Vec2,t.b2CollideEdgeAndCircle.s_e1=new t.b2Vec2,t.b2CollideEdgeAndCircle.s_e2=new t.b2Vec2,t.b2CollideEdgeAndCircle.s_P=new t.b2Vec2,t.b2CollideEdgeAndCircle.s_n=new t.b2Vec2,t.b2CollideEdgeAndCircle.s_id=new t.b2ContactID,t.b2EPAxisType={e_unknown:0,e_edgeA:1,e_edgeB:2},e.exportProperty(t.b2EPAxisType,"e_unknown",t.b2EPAxisType.e_unknown),e.exportProperty(t.b2EPAxisType,"e_edgeA",t.b2EPAxisType.e_edgeA),e.exportProperty(t.b2EPAxisType,"e_edgeB",t.b2EPAxisType.e_edgeB),t.b2EPAxis=function(){},t.b2EPAxis.prototype.type=t.b2EPAxisType.e_unknown,t.b2EPAxis.prototype.index=0,t.b2EPAxis.prototype.separation=0,t.b2TempPolygon=function(){this.vertices=t.b2Vec2.MakeArray(t.b2_maxPolygonVertices),this.normals=t.b2Vec2.MakeArray(t.b2_maxPolygonVertices),this.count=0},t.b2TempPolygon.prototype.vertices=null,t.b2TempPolygon.prototype.normals=null,t.b2TempPolygon.prototype.count=0,t.b2ReferenceFace=function(){this.i1=0,this.i2=0,this.v1=new t.b2Vec2,this.v2=new t.b2Vec2,this.normal=new t.b2Vec2,this.sideNormal1=new t.b2Vec2,this.sideOffset1=0,this.sideNormal2=new t.b2Vec2,this.sideOffset2=0},t.b2ReferenceFace.prototype.i1=0,t.b2ReferenceFace.prototype.i2=0,t.b2ReferenceFace.prototype.v1=null,t.b2ReferenceFace.prototype.v2=null,t.b2ReferenceFace.prototype.normal=null,t.b2ReferenceFace.prototype.sideNormal1=null,t.b2ReferenceFace.prototype.sideOffset1=0,t.b2ReferenceFace.prototype.sideNormal2=null,t.b2ReferenceFace.prototype.sideOffset2=0,t.b2EPColliderVertexType={e_isolated:0,e_concave:1,e_convex:2},e.exportProperty(t.b2EPColliderVertexType,"e_isolated",t.b2EPColliderVertexType.e_isolated),e.exportProperty(t.b2EPColliderVertexType,"e_concave",t.b2EPColliderVertexType.e_concave),e.exportProperty(t.b2EPColliderVertexType,"e_convex",t.b2EPColliderVertexType.e_convex),t.b2EPCollider=function(){this.m_polygonB=new t.b2TempPolygon,this.m_xf=new t.b2Transform,this.m_centroidB=new t.b2Vec2,this.m_v0=new t.b2Vec2,this.m_v1=new t.b2Vec2,this.m_v2=new t.b2Vec2,this.m_v3=new t.b2Vec2,this.m_normal0=new t.b2Vec2,this.m_normal1=new t.b2Vec2,this.m_normal2=new t.b2Vec2,this.m_normal=new t.b2Vec2,this.m_type1=t.b2EPColliderVertexType.e_isolated,this.m_type2=t.b2EPColliderVertexType.e_isolated,this.m_lowerLimit=new t.b2Vec2,this.m_upperLimit=new t.b2Vec2,this.m_radius=0,this.m_front=!1},t.b2EPCollider.prototype.m_polygonB=null,t.b2EPCollider.prototype.m_xf=null,t.b2EPCollider.prototype.m_centroidB=null,t.b2EPCollider.prototype.m_v0=null,t.b2EPCollider.prototype.m_v1=null,t.b2EPCollider.prototype.m_v2=null,t.b2EPCollider.prototype.m_v3=null,t.b2EPCollider.prototype.m_normal0=null,t.b2EPCollider.prototype.m_normal1=null,t.b2EPCollider.prototype.m_normal2=null,t.b2EPCollider.prototype.m_normal=null,t.b2EPCollider.prototype.m_type1=t.b2EPColliderVertexType.e_isolated,t.b2EPCollider.prototype.m_type2=t.b2EPColliderVertexType.e_isolated,t.b2EPCollider.prototype.m_lowerLimit=null,t.b2EPCollider.prototype.m_upperLimit=null,t.b2EPCollider.prototype.m_radius=0,t.b2EPCollider.prototype.m_front=!1,t.b2EPCollider.prototype.Collide=function(e,o,i,n,s){t.b2MulTXX(i,s,this.m_xf),t.b2MulXV(this.m_xf,n.m_centroid,this.m_centroidB),this.m_v0.Copy(o.m_vertex0),this.m_v1.Copy(o.m_vertex1),this.m_v2.Copy(o.m_vertex2),this.m_v3.Copy(o.m_vertex3);var r=o.m_hasVertex0,a=o.m_hasVertex3,l=t.b2SubVV(this.m_v2,this.m_v1,t.b2EPCollider.s_edge1);l.Normalize(),this.m_normal1.Set(l.y,-l.x);var p=t.b2DotVV(this.m_normal1,t.b2SubVV(this.m_centroidB,this.m_v1,t.b2Vec2.s_t0)),b=0,m=0,_=!1,d=!1;if(r){var h=t.b2SubVV(this.m_v1,this.m_v0,t.b2EPCollider.s_edge0);h.Normalize(),this.m_normal0.Set(h.y,-h.x),_=t.b2CrossVV(h,l)>=0,b=t.b2DotVV(this.m_normal0,t.b2SubVV(this.m_centroidB,this.m_v0,t.b2Vec2.s_t0))}if(a){var c=t.b2SubVV(this.m_v3,this.m_v2,t.b2EPCollider.s_edge2);c.Normalize(),this.m_normal2.Set(c.y,-c.x),d=t.b2CrossVV(l,c)>0,m=t.b2DotVV(this.m_normal2,t.b2SubVV(this.m_centroidB,this.m_v2,t.b2Vec2.s_t0))}r&&a?_&&d?(this.m_front=b>=0||p>=0||m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):_?(this.m_front=b>=0||p>=0&&m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=m>=0||b>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=b>=0&&p>=0&&m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):r?_?(this.m_front=b>=0||p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=b>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?d?(this.m_front=p>=0||m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0&&m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=n.m_count;for(var u=0,y=n.m_count;y>u;++u)t.b2MulXV(this.m_xf,n.m_vertices[u],this.m_polygonB.vertices[u]),t.b2MulRV(this.m_xf.q,n.m_normals[u],this.m_polygonB.normals[u]);this.m_radius=2*t.b2_polygonRadius,e.pointCount=0;var f=this.ComputeEdgeSeparation(t.b2EPCollider.s_edgeAxis);if(f.type!=t.b2EPAxisType.e_unknown&&!(f.separation>this.m_radius)){var S=this.ComputePolygonSeparation(t.b2EPCollider.s_polygonAxis);if(!(S.type!=t.b2EPAxisType.e_unknown&&S.separation>this.m_radius)){var C,v=.98,A=.001;C=S.type==t.b2EPAxisType.e_unknown?f:S.separation>v*f.separation+A?S:f;var g=t.b2EPCollider.s_ie,w=t.b2EPCollider.s_rf;if(C.type==t.b2EPAxisType.e_edgeA){e.type=t.b2ManifoldType.e_faceA;for(var x=0,B=t.b2DotVV(this.m_normal,this.m_polygonB.normals[0]),u=1,y=this.m_polygonB.count;y>u;++u){var V=t.b2DotVV(this.m_normal,this.m_polygonB.normals[u]);B>V&&(B=V,x=u)}var T=x,M=(T+1)%this.m_polygonB.count,D=g[0];D.v.Copy(this.m_polygonB.vertices[T]),D.id.cf.indexA=0,D.id.cf.indexB=T,D.id.cf.typeA=t.b2ContactFeatureType.e_face,D.id.cf.typeB=t.b2ContactFeatureType.e_vertex;var E=g[1];E.v.Copy(this.m_polygonB.vertices[M]),E.id.cf.indexA=0,E.id.cf.indexB=M,E.id.cf.typeA=t.b2ContactFeatureType.e_face,E.id.cf.typeB=t.b2ContactFeatureType.e_vertex,this.m_front?(w.i1=0,w.i2=1,w.v1.Copy(this.m_v1),w.v2.Copy(this.m_v2),w.normal.Copy(this.m_normal1)):(w.i1=1,w.i2=0,w.v1.Copy(this.m_v2),w.v2.Copy(this.m_v1),w.normal.Copy(this.m_normal1).SelfNeg())}else{e.type=t.b2ManifoldType.e_faceB;var D=g[0];D.v.Copy(this.m_v1),D.id.cf.indexA=0,D.id.cf.indexB=C.index,D.id.cf.typeA=t.b2ContactFeatureType.e_vertex,D.id.cf.typeB=t.b2ContactFeatureType.e_face;var E=g[1];E.v.Copy(this.m_v2),E.id.cf.indexA=0,E.id.cf.indexB=C.index,E.id.cf.typeA=t.b2ContactFeatureType.e_vertex,E.id.cf.typeB=t.b2ContactFeatureType.e_face,w.i1=C.index,w.i2=(w.i1+1)%this.m_polygonB.count,w.v1.Copy(this.m_polygonB.vertices[w.i1]),w.v2.Copy(this.m_polygonB.vertices[w.i2]),w.normal.Copy(this.m_polygonB.normals[w.i1])}w.sideNormal1.Set(w.normal.y,-w.normal.x),w.sideNormal2.Copy(w.sideNormal1).SelfNeg(),w.sideOffset1=t.b2DotVV(w.sideNormal1,w.v1),w.sideOffset2=t.b2DotVV(w.sideNormal2,w.v2);var P=t.b2EPCollider.s_clipPoints1,R=t.b2EPCollider.s_clipPoints2,I=0;if(I=t.b2ClipSegmentToLine(P,g,w.sideNormal1,w.sideOffset1,w.i1),!(I<t.b2_maxManifoldPoints||(I=t.b2ClipSegmentToLine(R,P,w.sideNormal2,w.sideOffset2,w.i2),I<t.b2_maxManifoldPoints))){C.type==t.b2EPAxisType.e_edgeA?(e.localNormal.Copy(w.normal),e.localPoint.Copy(w.v1)):(e.localNormal.Copy(n.m_normals[w.i1]),e.localPoint.Copy(n.m_vertices[w.i1]));for(var J=0,u=0,y=t.b2_maxManifoldPoints;y>u;++u){var L;if(L=t.b2DotVV(w.normal,t.b2SubVV(R[u].v,w.v1,t.b2Vec2.s_t0)),L<=this.m_radius){var F=e.points[J];C.type==t.b2EPAxisType.e_edgeA?(t.b2MulTXV(this.m_xf,R[u].v,F.localPoint),F.id=R[u].id):(F.localPoint.Copy(R[u].v),F.id.cf.typeA=R[u].id.cf.typeB,F.id.cf.typeB=R[u].id.cf.typeA,F.id.cf.indexA=R[u].id.cf.indexB,F.id.cf.indexB=R[u].id.cf.indexA),++J}}e.pointCount=J}}}},t.b2EPCollider.s_edge1=new t.b2Vec2,t.b2EPCollider.s_edge0=new t.b2Vec2,t.b2EPCollider.s_edge2=new t.b2Vec2,t.b2EPCollider.s_ie=t.b2ClipVertex.MakeArray(2),t.b2EPCollider.s_rf=new t.b2ReferenceFace,t.b2EPCollider.s_clipPoints1=t.b2ClipVertex.MakeArray(2),t.b2EPCollider.s_clipPoints2=t.b2ClipVertex.MakeArray(2),t.b2EPCollider.s_edgeAxis=new t.b2EPAxis,t.b2EPCollider.s_polygonAxis=new t.b2EPAxis,t.b2EPCollider.prototype.ComputeEdgeSeparation=function(e){var o=e;o.type=t.b2EPAxisType.e_edgeA,o.index=this.m_front?0:1,o.separation=t.b2_maxFloat;for(var i=0,n=this.m_polygonB.count;n>i;++i){var s=t.b2DotVV(this.m_normal,t.b2SubVV(this.m_polygonB.vertices[i],this.m_v1,t.b2Vec2.s_t0));s<o.separation&&(o.separation=s)}return o},t.b2EPCollider.prototype.ComputePolygonSeparation=function(e){var o=e;o.type=t.b2EPAxisType.e_unknown,o.index=-1,o.separation=-t.b2_maxFloat;for(var i=t.b2EPCollider.s_perp.Set(-this.m_normal.y,this.m_normal.x),n=0,s=this.m_polygonB.count;s>n;++n){var r=t.b2NegV(this.m_polygonB.normals[n],t.b2EPCollider.s_n),a=t.b2DotVV(r,t.b2SubVV(this.m_polygonB.vertices[n],this.m_v1,t.b2Vec2.s_t0)),l=t.b2DotVV(r,t.b2SubVV(this.m_polygonB.vertices[n],this.m_v2,t.b2Vec2.s_t0)),p=t.b2Min(a,l);if(p>this.m_radius)return o.type=t.b2EPAxisType.e_edgeB,o.index=n,o.separation=p,o;if(t.b2DotVV(r,i)>=0){if(t.b2DotVV(t.b2SubVV(r,this.m_upperLimit,t.b2Vec2.s_t0),this.m_normal)<-t.b2_angularSlop)continue}else if(t.b2DotVV(t.b2SubVV(r,this.m_lowerLimit,t.b2Vec2.s_t0),this.m_normal)<-t.b2_angularSlop)continue;p>o.separation&&(o.type=t.b2EPAxisType.e_edgeB,o.index=n,o.separation=p)}return o},t.b2EPCollider.s_n=new t.b2Vec2,t.b2EPCollider.s_perp=new t.b2Vec2,t.b2CollideEdgeAndPolygon=function(e,o,i,n,s){var r=t.b2CollideEdgeAndPolygon.s_collider;r.Collide(e,o,i,n,s)},t.b2CollideEdgeAndPolygon.s_collider=new t.b2EPCollider,t}(o,l),j=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2ChainAndCircleContact&&(t.b2ChainAndCircleContact={}),t.b2ChainAndCircleContact=function(){e.base(this)},e.inherits(t.b2ChainAndCircleContact,t.b2Contact),t.b2ChainAndCircleContact.Create=function(){return new t.b2ChainAndCircleContact},t.b2ChainAndCircleContact.Destroy=function(){},t.b2ChainAndCircleContact.prototype.Reset=function(o,i,n,s){e.base(this,"Reset",o,i,n,s),t.ENABLE_ASSERTS&&t.b2Assert(o.GetType()==t.b2ShapeType.e_chainShape),t.ENABLE_ASSERTS&&t.b2Assert(n.GetType()==t.b2ShapeType.e_circleShape)},t.b2ChainAndCircleContact.prototype.Evaluate=function(e,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.ENABLE_ASSERTS&&t.b2Assert(n instanceof t.b2ChainShape),t.ENABLE_ASSERTS&&t.b2Assert(s instanceof t.b2CircleShape);var r=n instanceof t.b2ChainShape?n:null,a=t.b2ChainAndCircleContact.prototype.Evaluate.s_edge;r.GetChildEdge(a,this.m_indexA),t.b2CollideEdgeAndCircle(e,a,o,s instanceof t.b2CircleShape?s:null,i)},t.b2ChainAndCircleContact.prototype.Evaluate.s_edge=new t.b2EdgeShape,t}(o,K,x,i),U=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2ChainAndPolygonContact&&(t.b2ChainAndPolygonContact={}),t.b2ChainAndPolygonContact=function(){e.base(this)},e.inherits(t.b2ChainAndPolygonContact,t.b2Contact),t.b2ChainAndPolygonContact.Create=function(){return new t.b2ChainAndPolygonContact},t.b2ChainAndPolygonContact.Destroy=function(){},t.b2ChainAndPolygonContact.prototype.Reset=function(o,i,n,s){e.base(this,"Reset",o,i,n,s),t.ENABLE_ASSERTS&&t.b2Assert(o.GetType()==t.b2ShapeType.e_chainShape),t.ENABLE_ASSERTS&&t.b2Assert(n.GetType()==t.b2ShapeType.e_polygonShape)},t.b2ChainAndPolygonContact.prototype.Evaluate=function(e,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.ENABLE_ASSERTS&&t.b2Assert(n instanceof t.b2ChainShape),t.ENABLE_ASSERTS&&t.b2Assert(s instanceof t.b2PolygonShape);var r=n instanceof t.b2ChainShape?n:null,a=t.b2ChainAndPolygonContact.prototype.Evaluate.s_edge;r.GetChildEdge(a,this.m_indexA),t.b2CollideEdgeAndPolygon(e,a,o,s instanceof t.b2PolygonShape?s:null,i)},t.b2ChainAndPolygonContact.prototype.Evaluate.s_edge=new t.b2EdgeShape,t}(o,S,K,x,J,i),H=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2CollideCircle&&(t.b2CollideCircle={}),t.b2CollideCircles=function(e,o,i,n,s){e.pointCount=0;var r=t.b2MulXV(i,o.m_p,t.b2CollideCircles.s_pA),a=t.b2MulXV(s,n.m_p,t.b2CollideCircles.s_pB),l=t.b2DistanceSquaredVV(r,a),p=o.m_radius+n.m_radius;l>p*p||(e.type=t.b2ManifoldType.e_circles,e.localPoint.Copy(o.m_p),e.localNormal.SetZero(),e.pointCount=1,e.points[0].localPoint.Copy(n.m_p),e.points[0].id.key=0)},t.b2CollideCircles.s_pA=new t.b2Vec2,t.b2CollideCircles.s_pB=new t.b2Vec2,t.b2CollidePolygonAndCircle=function(e,o,i,n,s){e.pointCount=0;for(var r=t.b2MulXV(s,n.m_p,t.b2CollidePolygonAndCircle.s_c),a=t.b2MulTXV(i,r,t.b2CollidePolygonAndCircle.s_cLocal),l=0,p=-t.b2_maxFloat,b=o.m_radius+n.m_radius,m=o.m_count,_=o.m_vertices,d=o.m_normals,h=0;m>h;++h){var c=t.b2DotVV(d[h],t.b2SubVV(a,_[h],t.b2Vec2.s_t0));if(c>b)return;c>p&&(p=c,l=h)}var u=l,y=(u+1)%m,f=_[u],S=_[y];if(p<t.b2_epsilon)return e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(d[l]),t.b2MidVV(f,S,e.localPoint),e.points[0].localPoint.Copy(n.m_p),e.points[0].id.key=0,void 0;var C=t.b2DotVV(t.b2SubVV(a,f,t.b2Vec2.s_t0),t.b2SubVV(S,f,t.b2Vec2.s_t1)),v=t.b2DotVV(t.b2SubVV(a,S,t.b2Vec2.s_t0),t.b2SubVV(f,S,t.b2Vec2.s_t1));if(0>=C){if(t.b2DistanceSquaredVV(a,f)>b*b)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,t.b2SubVV(a,f,e.localNormal).SelfNormalize(),e.localPoint.Copy(f),e.points[0].localPoint.Copy(n.m_p),e.points[0].id.key=0}else if(0>=v){if(t.b2DistanceSquaredVV(a,S)>b*b)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,t.b2SubVV(a,S,e.localNormal).SelfNormalize(),e.localPoint.Copy(S),e.points[0].localPoint.Copy(n.m_p),e.points[0].id.key=0}else{var A=t.b2MidVV(f,S,t.b2CollidePolygonAndCircle.s_faceCenter);if(p=t.b2DotVV(t.b2SubVV(a,A,t.b2Vec2.s_t1),d[u]),p>b)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(d[u]).SelfNormalize(),e.localPoint.Copy(A),e.points[0].localPoint.Copy(n.m_p),e.points[0].id.key=0}},t.b2CollidePolygonAndCircle.s_c=new t.b2Vec2,t.b2CollidePolygonAndCircle.s_cLocal=new t.b2Vec2,t.b2CollidePolygonAndCircle.s_faceCenter=new t.b2Vec2,t}(o,l),X=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2CircleContact&&(t.b2CircleContact={}),t.b2CircleContact=function(){e.base(this)},e.inherits(t.b2CircleContact,t.b2Contact),t.b2CircleContact.Create=function(){return new t.b2CircleContact},t.b2CircleContact.Destroy=function(){},t.b2CircleContact.prototype.Reset=function(t,o,i,n){e.base(this,"Reset",t,o,i,n)},t.b2CircleContact.prototype.Evaluate=function(e,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.ENABLE_ASSERTS&&t.b2Assert(n instanceof t.b2CircleShape),t.ENABLE_ASSERTS&&t.b2Assert(s instanceof t.b2CircleShape),t.b2CollideCircles(e,n instanceof t.b2CircleShape?n:null,o,s instanceof t.b2CircleShape?s:null,i)},t}(o,H,x,i),Z=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2EdgeAndCircleContact&&(t.b2EdgeAndCircleContact={}),t.b2EdgeAndCircleContact=function(){e.base(this)
},e.inherits(t.b2EdgeAndCircleContact,t.b2Contact),t.b2EdgeAndCircleContact.Create=function(){return new t.b2EdgeAndCircleContact},t.b2EdgeAndCircleContact.Destroy=function(){},t.b2EdgeAndCircleContact.prototype.Reset=function(o,i,n,s){e.base(this,"Reset",o,i,n,s),t.ENABLE_ASSERTS&&t.b2Assert(o.GetType()==t.b2ShapeType.e_edgeShape),t.ENABLE_ASSERTS&&t.b2Assert(n.GetType()==t.b2ShapeType.e_circleShape)},t.b2EdgeAndCircleContact.prototype.Evaluate=function(e,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.ENABLE_ASSERTS&&t.b2Assert(n instanceof t.b2EdgeShape),t.ENABLE_ASSERTS&&t.b2Assert(s instanceof t.b2CircleShape),t.b2CollideEdgeAndCircle(e,n instanceof t.b2EdgeShape?n:null,o,s instanceof t.b2CircleShape?s:null,i)},t}(o,K,x,i),Y=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2EdgeAndPolygonContact&&(t.b2EdgeAndPolygonContact={}),t.b2EdgeAndPolygonContact=function(){e.base(this)},e.inherits(t.b2EdgeAndPolygonContact,t.b2Contact),t.b2EdgeAndPolygonContact.Create=function(){return new t.b2EdgeAndPolygonContact},t.b2EdgeAndPolygonContact.Destroy=function(){},t.b2EdgeAndPolygonContact.prototype.Reset=function(o,i,n,s){e.base(this,"Reset",o,i,n,s),t.ENABLE_ASSERTS&&t.b2Assert(o.GetType()==t.b2ShapeType.e_edgeShape),t.ENABLE_ASSERTS&&t.b2Assert(n.GetType()==t.b2ShapeType.e_polygonShape)},t.b2EdgeAndPolygonContact.prototype.Evaluate=function(e,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.ENABLE_ASSERTS&&t.b2Assert(n instanceof t.b2EdgeShape),t.ENABLE_ASSERTS&&t.b2Assert(s instanceof t.b2PolygonShape),t.b2CollideEdgeAndPolygon(e,n instanceof t.b2EdgeShape?n:null,o,s instanceof t.b2PolygonShape?s:null,i)},t}(o,x,i),Q=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2PolygonAndCircleContact&&(t.b2PolygonAndCircleContact={}),t.b2PolygonAndCircleContact=function(){e.base(this)},e.inherits(t.b2PolygonAndCircleContact,t.b2Contact),t.b2PolygonAndCircleContact.Create=function(){return new t.b2PolygonAndCircleContact},t.b2PolygonAndCircleContact.Destroy=function(){},t.b2PolygonAndCircleContact.prototype.Reset=function(o,i,n,s){e.base(this,"Reset",o,i,n,s),t.ENABLE_ASSERTS&&t.b2Assert(o.GetType()==t.b2ShapeType.e_polygonShape),t.ENABLE_ASSERTS&&t.b2Assert(n.GetType()==t.b2ShapeType.e_circleShape)},t.b2PolygonAndCircleContact.prototype.Evaluate=function(e,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.ENABLE_ASSERTS&&t.b2Assert(n instanceof t.b2PolygonShape),t.ENABLE_ASSERTS&&t.b2Assert(s instanceof t.b2CircleShape),t.b2CollidePolygonAndCircle(e,n instanceof t.b2PolygonShape?n:null,o,s instanceof t.b2CircleShape?s:null,i)},t}(o,x,i),$=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2CollidePolygon&&(t.b2CollidePolygon={}),t.b2FindMaxSeparation=function(e,o,i,n,s){for(var r=o.m_count,a=n.m_count,l=o.m_normals,p=o.m_vertices,b=n.m_vertices,m=t.b2MulTXX(s,i,t.b2FindMaxSeparation.s_xf),_=0,d=-t.b2_maxFloat,h=0;r>h;++h){for(var c=t.b2MulRV(m.q,l[h],t.b2FindMaxSeparation.s_n),u=t.b2MulXV(m,p[h],t.b2FindMaxSeparation.s_v1),y=t.b2_maxFloat,f=0;a>f;++f){var S=t.b2DotVV(c,t.b2SubVV(b[f],u,t.b2Vec2.s_t0));y>S&&(y=S)}y>d&&(d=y,_=h)}return e[0]=_,d},t.b2FindMaxSeparation.s_xf=new t.b2Transform,t.b2FindMaxSeparation.s_n=new t.b2Vec2,t.b2FindMaxSeparation.s_v1=new t.b2Vec2,t.b2FindIncidentEdge=function(e,o,i,n,s,r){var a=o.m_count,l=o.m_normals,p=s.m_count,b=s.m_vertices,m=s.m_normals;t.ENABLE_ASSERTS&&t.b2Assert(n>=0&&a>n);for(var _=t.b2MulTRV(r.q,t.b2MulRV(i.q,l[n],t.b2Vec2.s_t0),t.b2FindIncidentEdge.s_normal1),d=0,h=t.b2_maxFloat,c=0;p>c;++c){var u=t.b2DotVV(_,m[c]);h>u&&(h=u,d=c)}var y=d,f=(y+1)%p,S=e[0];t.b2MulXV(r,b[y],S.v);var C=S.id.cf;C.indexA=n,C.indexB=y,C.typeA=t.b2ContactFeatureType.e_face,C.typeB=t.b2ContactFeatureType.e_vertex;var v=e[1];t.b2MulXV(r,b[f],v.v);var A=v.id.cf;A.indexA=n,A.indexB=f,A.typeA=t.b2ContactFeatureType.e_face,A.typeB=t.b2ContactFeatureType.e_vertex},t.b2FindIncidentEdge.s_normal1=new t.b2Vec2,t.b2CollidePolygons=function(e,o,i,n,s){e.pointCount=0;var r=o.m_radius+n.m_radius,a=t.b2CollidePolygons.s_edgeA;a[0]=0;var l=t.b2FindMaxSeparation(a,o,i,n,s);if(!(l>r)){var p=t.b2CollidePolygons.s_edgeB;p[0]=0;var b=t.b2FindMaxSeparation(p,n,s,o,i);if(!(b>r)){var m,_,d,h,c=0,u=0,y=.98,f=.001;b>y*l+f?(m=n,_=o,d=s,h=i,c=p[0],e.type=t.b2ManifoldType.e_faceB,u=1):(m=o,_=n,d=i,h=s,c=a[0],e.type=t.b2ManifoldType.e_faceA,u=0);var S=t.b2CollidePolygons.s_incidentEdge;t.b2FindIncidentEdge(S,m,d,c,_,h);var C=m.m_count,v=m.m_vertices,A=c,g=(c+1)%C,w=v[A],x=v[g],B=t.b2SubVV(x,w,t.b2CollidePolygons.s_localTangent);B.Normalize();var V,T=t.b2CrossVOne(B,t.b2CollidePolygons.s_localNormal),M=t.b2MidVV(w,x,t.b2CollidePolygons.s_planePoint),D=t.b2MulRV(d.q,B,t.b2CollidePolygons.s_tangent),E=t.b2CrossVOne(D,t.b2CollidePolygons.s_normal),P=t.b2MulXV(d,w,t.b2CollidePolygons.s_v11),R=t.b2MulXV(d,x,t.b2CollidePolygons.s_v12),I=t.b2DotVV(E,P),J=-t.b2DotVV(D,P)+r,L=t.b2DotVV(D,R)+r,F=t.b2CollidePolygons.s_clipPoints1,G=t.b2CollidePolygons.s_clipPoints2,N=t.b2NegV(D,t.b2CollidePolygons.s_ntangent);if(V=t.b2ClipSegmentToLine(F,S,N,J,A),!(2>V||(V=t.b2ClipSegmentToLine(G,F,D,L,g),2>V))){e.localNormal.Copy(T),e.localPoint.Copy(M);for(var k=0,O=0;O<t.b2_maxManifoldPoints;++O){var W=G[O],z=t.b2DotVV(E,W.v)-I;if(r>=z){var q=e.points[k];if(t.b2MulTXV(h,W.v,q.localPoint),q.id.Copy(W.id),u){var K=q.id.cf;q.id.cf.indexA=K.indexB,q.id.cf.indexB=K.indexA,q.id.cf.typeA=K.typeB,q.id.cf.typeB=K.typeA}++k}}e.pointCount=k}}}},t.b2CollidePolygons.s_incidentEdge=t.b2ClipVertex.MakeArray(2),t.b2CollidePolygons.s_clipPoints1=t.b2ClipVertex.MakeArray(2),t.b2CollidePolygons.s_clipPoints2=t.b2ClipVertex.MakeArray(2),t.b2CollidePolygons.s_edgeA=t.b2MakeNumberArray(1),t.b2CollidePolygons.s_edgeB=t.b2MakeNumberArray(1),t.b2CollidePolygons.s_localTangent=new t.b2Vec2,t.b2CollidePolygons.s_localNormal=new t.b2Vec2,t.b2CollidePolygons.s_planePoint=new t.b2Vec2,t.b2CollidePolygons.s_normal=new t.b2Vec2,t.b2CollidePolygons.s_tangent=new t.b2Vec2,t.b2CollidePolygons.s_ntangent=new t.b2Vec2,t.b2CollidePolygons.s_v11=new t.b2Vec2,t.b2CollidePolygons.s_v12=new t.b2Vec2,t}(o,l),et=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2PolygonContact&&(t.b2PolygonContact={}),t.b2PolygonContact=function(){e.base(this)},e.inherits(t.b2PolygonContact,t.b2Contact),t.b2PolygonContact.Create=function(){return new t.b2PolygonContact},t.b2PolygonContact.Destroy=function(){},t.b2PolygonContact.prototype.Reset=function(t,o,i,n){e.base(this,"Reset",t,o,i,n)},t.b2PolygonContact.prototype.Evaluate=function(e,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.ENABLE_ASSERTS&&t.b2Assert(n instanceof t.b2PolygonShape),t.ENABLE_ASSERTS&&t.b2Assert(s instanceof t.b2PolygonShape),t.b2CollidePolygons(e,n instanceof t.b2PolygonShape?n:null,o,s instanceof t.b2PolygonShape?s:null,i)},t}(o,$,x,i),tt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2ContactSolver&&(t.b2ContactSolver={}),t.b2VelocityConstraintPoint=function(){this.rA=new t.b2Vec2,this.rB=new t.b2Vec2},t.b2VelocityConstraintPoint.prototype.rA=null,t.b2VelocityConstraintPoint.prototype.rB=null,t.b2VelocityConstraintPoint.prototype.normalImpulse=0,t.b2VelocityConstraintPoint.prototype.tangentImpulse=0,t.b2VelocityConstraintPoint.prototype.normalMass=0,t.b2VelocityConstraintPoint.prototype.tangentMass=0,t.b2VelocityConstraintPoint.prototype.velocityBias=0,t.b2VelocityConstraintPoint.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2VelocityConstraintPoint})},t.b2ContactVelocityConstraint=function(){this.points=t.b2VelocityConstraintPoint.MakeArray(t.b2_maxManifoldPoints),this.normal=new t.b2Vec2,this.tangent=new t.b2Vec2,this.normalMass=new t.b2Mat22,this.K=new t.b2Mat22},t.b2ContactVelocityConstraint.prototype.points=null,t.b2ContactVelocityConstraint.prototype.normal=null,t.b2ContactVelocityConstraint.prototype.tangent=null,t.b2ContactVelocityConstraint.prototype.normalMass=null,t.b2ContactVelocityConstraint.prototype.K=null,t.b2ContactVelocityConstraint.prototype.indexA=0,t.b2ContactVelocityConstraint.prototype.indexB=0,t.b2ContactVelocityConstraint.prototype.invMassA=0,t.b2ContactVelocityConstraint.prototype.invMassB=0,t.b2ContactVelocityConstraint.prototype.invIA=0,t.b2ContactVelocityConstraint.prototype.invIB=0,t.b2ContactVelocityConstraint.prototype.friction=0,t.b2ContactVelocityConstraint.prototype.restitution=0,t.b2ContactVelocityConstraint.prototype.tangentSpeed=0,t.b2ContactVelocityConstraint.prototype.pointCount=0,t.b2ContactVelocityConstraint.prototype.contactIndex=0,t.b2ContactVelocityConstraint.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2ContactVelocityConstraint})},t.b2ContactPositionConstraint=function(){this.localPoints=t.b2Vec2.MakeArray(t.b2_maxManifoldPoints),this.localNormal=new t.b2Vec2,this.localPoint=new t.b2Vec2,this.localCenterA=new t.b2Vec2,this.localCenterB=new t.b2Vec2},t.b2ContactPositionConstraint.prototype.localPoints=null,t.b2ContactPositionConstraint.prototype.localNormal=null,t.b2ContactPositionConstraint.prototype.localPoint=null,t.b2ContactPositionConstraint.prototype.indexA=0,t.b2ContactPositionConstraint.prototype.indexB=0,t.b2ContactPositionConstraint.prototype.invMassA=0,t.b2ContactPositionConstraint.prototype.invMassB=0,t.b2ContactPositionConstraint.prototype.localCenterA=null,t.b2ContactPositionConstraint.prototype.localCenterB=null,t.b2ContactPositionConstraint.prototype.invIA=0,t.b2ContactPositionConstraint.prototype.invIB=0,t.b2ContactPositionConstraint.prototype.type=t.b2ManifoldType.e_unknown,t.b2ContactPositionConstraint.prototype.radiusA=0,t.b2ContactPositionConstraint.prototype.radiusB=0,t.b2ContactPositionConstraint.prototype.pointCount=0,t.b2ContactPositionConstraint.MakeArray=function(e){return t.b2MakeArray(e,function(){return new t.b2ContactPositionConstraint})},t.b2ContactSolverDef=function(){this.step=new t.b2TimeStep},t.b2ContactSolverDef.prototype.step=null,t.b2ContactSolverDef.prototype.contacts=null,t.b2ContactSolverDef.prototype.count=0,t.b2ContactSolverDef.prototype.positions=null,t.b2ContactSolverDef.prototype.velocities=null,t.b2ContactSolverDef.prototype.allocator=null,t.b2ContactSolver=function(){this.m_step=new t.b2TimeStep,this.m_positionConstraints=t.b2ContactPositionConstraint.MakeArray(1024),this.m_velocityConstraints=t.b2ContactVelocityConstraint.MakeArray(1024)},t.b2ContactSolver.prototype.m_step=null,t.b2ContactSolver.prototype.m_positions=null,t.b2ContactSolver.prototype.m_velocities=null,t.b2ContactSolver.prototype.m_allocator=null,t.b2ContactSolver.prototype.m_positionConstraints=null,t.b2ContactSolver.prototype.m_velocityConstraints=null,t.b2ContactSolver.prototype.m_contacts=null,t.b2ContactSolver.prototype.m_count=0,t.b2ContactSolver.prototype.Initialize=function(e){if(this.m_step.Copy(e.step),this.m_allocator=e.allocator,this.m_count=e.count,this.m_positionConstraints.length<this.m_count){var o=t.b2Max(2*this.m_positionConstraints.length,this.m_count);for(t.DEBUG&&window.console.log("box2d.b2ContactSolver.m_positionConstraints: "+o);this.m_positionConstraints.length<o;)this.m_positionConstraints[this.m_positionConstraints.length]=new t.b2ContactPositionConstraint}if(this.m_velocityConstraints.length<this.m_count){var o=t.b2Max(2*this.m_velocityConstraints.length,this.m_count);for(t.DEBUG&&window.console.log("box2d.b2ContactSolver.m_velocityConstraints: "+o);this.m_velocityConstraints.length<o;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new t.b2ContactVelocityConstraint}this.m_positions=e.positions,this.m_velocities=e.velocities,this.m_contacts=e.contacts;var i,n,s,r,a,l,p,b,m,_,d,h,c,u,y,f,S,C,v;for(i=0,n=this.m_count;n>i;++i)for(a=this.m_contacts[i],l=a.m_fixtureA,p=a.m_fixtureB,b=l.GetShape(),m=p.GetShape(),_=b.m_radius,d=m.m_radius,h=l.GetBody(),c=p.GetBody(),u=a.GetManifold(),y=u.pointCount,t.ENABLE_ASSERTS&&t.b2Assert(y>0),f=this.m_velocityConstraints[i],f.friction=a.m_friction,f.restitution=a.m_restitution,f.tangentSpeed=a.m_tangentSpeed,f.indexA=h.m_islandIndex,f.indexB=c.m_islandIndex,f.invMassA=h.m_invMass,f.invMassB=c.m_invMass,f.invIA=h.m_invI,f.invIB=c.m_invI,f.contactIndex=i,f.pointCount=y,f.K.SetZero(),f.normalMass.SetZero(),S=this.m_positionConstraints[i],S.indexA=h.m_islandIndex,S.indexB=c.m_islandIndex,S.invMassA=h.m_invMass,S.invMassB=c.m_invMass,S.localCenterA.Copy(h.m_sweep.localCenter),S.localCenterB.Copy(c.m_sweep.localCenter),S.invIA=h.m_invI,S.invIB=c.m_invI,S.localNormal.Copy(u.localNormal),S.localPoint.Copy(u.localPoint),S.pointCount=y,S.radiusA=_,S.radiusB=d,S.type=u.type,s=0,r=y;r>s;++s)C=u.points[s],v=f.points[s],this.m_step.warmStarting?(v.normalImpulse=this.m_step.dtRatio*C.normalImpulse,v.tangentImpulse=this.m_step.dtRatio*C.tangentImpulse):(v.normalImpulse=0,v.tangentImpulse=0),v.rA.SetZero(),v.rB.SetZero(),v.normalMass=0,v.tangentMass=0,v.velocityBias=0,S.localPoints[s].Copy(C.localPoint);return this},t.b2ContactSolver.prototype.InitializeVelocityConstraints=function(){var e,o,i,n,s,r,a,l,p,b,m,_,d,h,c,u,y,f,S,C,v,A,g,w,x,B,V,T,M,D,E,P,R,I,J,L,F,G,N,k,O,W,z,q,K=t.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfA,j=t.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfB,U=t.b2ContactSolver.prototype.InitializeVelocityConstraints.s_worldManifold,H=1e3;for(e=0,o=this.m_count;o>e;++e){for(s=this.m_velocityConstraints[e],r=this.m_positionConstraints[e],a=r.radiusA,l=r.radiusB,p=this.m_contacts[s.contactIndex].GetManifold(),b=s.indexA,m=s.indexB,_=s.invMassA,d=s.invMassB,h=s.invIA,c=s.invIB,u=r.localCenterA,y=r.localCenterB,f=this.m_positions[b].c,S=this.m_positions[b].a,C=this.m_velocities[b].v,v=this.m_velocities[b].w,A=this.m_positions[m].c,g=this.m_positions[m].a,w=this.m_velocities[m].v,x=this.m_velocities[m].w,t.ENABLE_ASSERTS&&t.b2Assert(p.pointCount>0),K.q.SetAngleRadians(S),j.q.SetAngleRadians(g),t.b2SubVV(f,t.b2MulRV(K.q,u,t.b2Vec2.s_t0),K.p),t.b2SubVV(A,t.b2MulRV(j.q,y,t.b2Vec2.s_t0),j.p),U.Initialize(p,K,a,j,l),s.normal.Copy(U.normal),t.b2CrossVOne(s.normal,s.tangent),B=s.pointCount,i=0,n=B;n>i;++i)V=s.points[i],t.b2SubVV(U.points[i],f,V.rA),t.b2SubVV(U.points[i],A,V.rB),T=t.b2CrossVV(V.rA,s.normal),M=t.b2CrossVV(V.rB,s.normal),D=_+d+h*T*T+c*M*M,V.normalMass=D>0?1/D:0,E=s.tangent,P=t.b2CrossVV(V.rA,E),R=t.b2CrossVV(V.rB,E),I=_+d+h*P*P+c*R*R,V.tangentMass=I>0?1/I:0,V.velocityBias=0,J=t.b2DotVV(s.normal,t.b2SubVV(t.b2AddVCrossSV(w,x,V.rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(C,v,V.rA,t.b2Vec2.s_t1),t.b2Vec2.s_t0)),J<-t.b2_velocityThreshold&&(V.velocityBias+=-s.restitution*J);2==s.pointCount&&(L=s.points[0],F=s.points[1],G=t.b2CrossVV(L.rA,s.normal),N=t.b2CrossVV(L.rB,s.normal),k=t.b2CrossVV(F.rA,s.normal),O=t.b2CrossVV(F.rB,s.normal),W=_+d+h*G*G+c*N*N,z=_+d+h*k*k+c*O*O,q=_+d+h*G*k+c*N*O,H*(W*z-q*q)>W*W?(s.K.ex.Set(W,q),s.K.ey.Set(q,z),s.K.GetInverse(s.normalMass)):s.pointCount=1)}},t.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfA=new t.b2Transform,t.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfB=new t.b2Transform,t.b2ContactSolver.prototype.InitializeVelocityConstraints.s_worldManifold=new t.b2WorldManifold,t.b2ContactSolver.prototype.WarmStart=function(){var e,o,i,n,s,r,a,l,p,b,m,_,d,h,c,u,y,f,S,C=t.b2ContactSolver.prototype.WarmStart.s_P;for(e=0,o=this.m_count;o>e;++e){for(s=this.m_velocityConstraints[e],r=s.indexA,a=s.indexB,l=s.invMassA,p=s.invIA,b=s.invMassB,m=s.invIB,_=s.pointCount,d=this.m_velocities[r].v,h=this.m_velocities[r].w,c=this.m_velocities[a].v,u=this.m_velocities[a].w,y=s.normal,f=s.tangent,i=0,n=_;n>i;++i)S=s.points[i],t.b2AddVV(t.b2MulSV(S.normalImpulse,y,t.b2Vec2.s_t0),t.b2MulSV(S.tangentImpulse,f,t.b2Vec2.s_t1),C),h-=p*t.b2CrossVV(S.rA,C),d.SelfMulSub(l,C),u+=m*t.b2CrossVV(S.rB,C),c.SelfMulAdd(b,C);this.m_velocities[r].w=h,this.m_velocities[a].w=u}},t.b2ContactSolver.prototype.WarmStart.s_P=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints=function(){var e,o,i,n,s,r,a,l,p,b,m,_,d,h,c,u,y,f,S,C,v,A,g,w,x,B,V,T,M,D=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv,E=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv1,P=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv2,R=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_P,I=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_a,J=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_b,L=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_x,F=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_d,G=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1,N=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_P2,k=t.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1P2;for(e=0,o=this.m_count;o>e;++e){for(s=this.m_velocityConstraints[e],r=s.indexA,a=s.indexB,l=s.invMassA,p=s.invIA,b=s.invMassB,m=s.invIB,_=s.pointCount,d=this.m_velocities[r].v,h=this.m_velocities[r].w,c=this.m_velocities[a].v,u=this.m_velocities[a].w,y=s.normal,f=s.tangent,S=s.friction,t.ENABLE_ASSERTS&&t.b2Assert(1==_||2==_),i=0,n=_;n>i;++i)C=s.points[i],t.b2SubVV(t.b2AddVCrossSV(c,u,C.rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(d,h,C.rA,t.b2Vec2.s_t1),D),v=t.b2DotVV(D,f)-s.tangentSpeed,g=C.tangentMass*-v,w=S*C.normalImpulse,x=t.b2Clamp(C.tangentImpulse+g,-w,w),g=x-C.tangentImpulse,C.tangentImpulse=x,t.b2MulSV(g,f,R),d.SelfMulSub(l,R),h-=p*t.b2CrossVV(C.rA,R),c.SelfMulAdd(b,R),u+=m*t.b2CrossVV(C.rB,R);if(1==s.pointCount)C=s.points[0],t.b2SubVV(t.b2AddVCrossSV(c,u,C.rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(d,h,C.rA,t.b2Vec2.s_t1),D),A=t.b2DotVV(D,y),g=-C.normalMass*(A-C.velocityBias),x=t.b2Max(C.normalImpulse+g,0),g=x-C.normalImpulse,C.normalImpulse=x,t.b2MulSV(g,y,R),d.SelfMulSub(l,R),h-=p*t.b2CrossVV(C.rA,R),c.SelfMulAdd(b,R),u+=m*t.b2CrossVV(C.rB,R);else for(B=s.points[0],V=s.points[1],I.Set(B.normalImpulse,V.normalImpulse),t.ENABLE_ASSERTS&&t.b2Assert(I.x>=0&&I.y>=0),t.b2SubVV(t.b2AddVCrossSV(c,u,B.rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(d,h,B.rA,t.b2Vec2.s_t1),E),t.b2SubVV(t.b2AddVCrossSV(c,u,V.rB,t.b2Vec2.s_t0),t.b2AddVCrossSV(d,h,V.rA,t.b2Vec2.s_t1),P),T=t.b2DotVV(E,y),M=t.b2DotVV(P,y),J.x=T-B.velocityBias,J.y=M-V.velocityBias,J.SelfSub(t.b2MulMV(s.K,I,t.b2Vec2.s_t0));;){if(t.b2MulMV(s.normalMass,J,L).SelfNeg(),L.x>=0&&L.y>=0){t.b2SubVV(L,I,F),t.b2MulSV(F.x,y,G),t.b2MulSV(F.y,y,N),t.b2AddVV(G,N,k),d.SelfMulSub(l,k),h-=p*(t.b2CrossVV(B.rA,G)+t.b2CrossVV(V.rA,N)),c.SelfMulAdd(b,k),u+=m*(t.b2CrossVV(B.rB,G)+t.b2CrossVV(V.rB,N)),B.normalImpulse=L.x,V.normalImpulse=L.y;break}if(L.x=-B.normalMass*J.x,L.y=0,T=0,M=s.K.ex.y*L.x+J.y,L.x>=0&&M>=0){t.b2SubVV(L,I,F),t.b2MulSV(F.x,y,G),t.b2MulSV(F.y,y,N),t.b2AddVV(G,N,k),d.SelfMulSub(l,k),h-=p*(t.b2CrossVV(B.rA,G)+t.b2CrossVV(V.rA,N)),c.SelfMulAdd(b,k),u+=m*(t.b2CrossVV(B.rB,G)+t.b2CrossVV(V.rB,N)),B.normalImpulse=L.x,V.normalImpulse=L.y;break}if(L.x=0,L.y=-V.normalMass*J.y,T=s.K.ey.x*L.y+J.x,M=0,L.y>=0&&T>=0){t.b2SubVV(L,I,F),t.b2MulSV(F.x,y,G),t.b2MulSV(F.y,y,N),t.b2AddVV(G,N,k),d.SelfMulSub(l,k),h-=p*(t.b2CrossVV(B.rA,G)+t.b2CrossVV(V.rA,N)),c.SelfMulAdd(b,k),u+=m*(t.b2CrossVV(B.rB,G)+t.b2CrossVV(V.rB,N)),B.normalImpulse=L.x,V.normalImpulse=L.y;break}if(L.x=0,L.y=0,T=J.x,M=J.y,T>=0&&M>=0){t.b2SubVV(L,I,F),t.b2MulSV(F.x,y,G),t.b2MulSV(F.y,y,N),t.b2AddVV(G,N,k),d.SelfMulSub(l,k),h-=p*(t.b2CrossVV(B.rA,G)+t.b2CrossVV(V.rA,N)),c.SelfMulAdd(b,k),u+=m*(t.b2CrossVV(B.rB,G)+t.b2CrossVV(V.rB,N)),B.normalImpulse=L.x,V.normalImpulse=L.y;break}break}this.m_velocities[r].w=h,this.m_velocities[a].w=u}},t.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv1=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv2=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_P=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_a=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_b=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_x=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_d=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_P2=new t.b2Vec2,t.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1P2=new t.b2Vec2,t.b2ContactSolver.prototype.StoreImpulses=function(){var e,t,o,i,n,s;for(e=0,t=this.m_count;t>e;++e)for(n=this.m_velocityConstraints[e],s=this.m_contacts[n.contactIndex].GetManifold(),o=0,i=n.pointCount;i>o;++o)s.points[o].normalImpulse=n.points[o].normalImpulse,s.points[o].tangentImpulse=n.points[o].tangentImpulse},t.b2PositionSolverManifold=function(){this.normal=new t.b2Vec2,this.point=new t.b2Vec2},t.b2PositionSolverManifold.prototype.normal=null,t.b2PositionSolverManifold.prototype.point=null,t.b2PositionSolverManifold.prototype.separation=0,t.b2PositionSolverManifold.prototype.Initialize=function(e,o,i,n){var s=t.b2PositionSolverManifold.prototype.Initialize.s_pointA,r=t.b2PositionSolverManifold.prototype.Initialize.s_pointB,a=t.b2PositionSolverManifold.prototype.Initialize.s_planePoint,l=t.b2PositionSolverManifold.prototype.Initialize.s_clipPoint;switch(t.ENABLE_ASSERTS&&t.b2Assert(e.pointCount>0),e.type){case t.b2ManifoldType.e_circles:t.b2MulXV(o,e.localPoint,s),t.b2MulXV(i,e.localPoints[0],r),t.b2SubVV(r,s,this.normal).SelfNormalize(),t.b2MidVV(s,r,this.point),this.separation=t.b2DotVV(t.b2SubVV(r,s,t.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB;break;case t.b2ManifoldType.e_faceA:t.b2MulRV(o.q,e.localNormal,this.normal),t.b2MulXV(o,e.localPoint,a),t.b2MulXV(i,e.localPoints[n],l),this.separation=t.b2DotVV(t.b2SubVV(l,a,t.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l);break;case t.b2ManifoldType.e_faceB:t.b2MulRV(i.q,e.localNormal,this.normal),t.b2MulXV(i,e.localPoint,a),t.b2MulXV(o,e.localPoints[n],l),this.separation=t.b2DotVV(t.b2SubVV(l,a,t.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l),this.normal.SelfNeg()}},t.b2PositionSolverManifold.prototype.Initialize.s_pointA=new t.b2Vec2,t.b2PositionSolverManifold.prototype.Initialize.s_pointB=new t.b2Vec2,t.b2PositionSolverManifold.prototype.Initialize.s_planePoint=new t.b2Vec2,t.b2PositionSolverManifold.prototype.Initialize.s_clipPoint=new t.b2Vec2,t.b2ContactSolver.prototype.SolvePositionConstraints=function(){var e,o,i,n,s,r,a,l,p,b,m,_,d,h,c,u,y,f,S,C,v,A,g,w,x,B,V=t.b2ContactSolver.prototype.SolvePositionConstraints.s_xfA,T=t.b2ContactSolver.prototype.SolvePositionConstraints.s_xfB,M=t.b2ContactSolver.prototype.SolvePositionConstraints.s_psm,D=t.b2ContactSolver.prototype.SolvePositionConstraints.s_rA,E=t.b2ContactSolver.prototype.SolvePositionConstraints.s_rB,P=t.b2ContactSolver.prototype.SolvePositionConstraints.s_P,R=0;for(e=0,o=this.m_count;o>e;++e){for(s=this.m_positionConstraints[e],r=s.indexA,a=s.indexB,l=s.localCenterA,p=s.invMassA,b=s.invIA,m=s.localCenterB,_=s.invMassB,d=s.invIB,h=s.pointCount,c=this.m_positions[r].c,u=this.m_positions[r].a,y=this.m_positions[a].c,f=this.m_positions[a].a,i=0,n=h;n>i;++i)V.q.SetAngleRadians(u),T.q.SetAngleRadians(f),t.b2SubVV(c,t.b2MulRV(V.q,l,t.b2Vec2.s_t0),V.p),t.b2SubVV(y,t.b2MulRV(T.q,m,t.b2Vec2.s_t0),T.p),M.Initialize(s,V,T,i),S=M.normal,C=M.point,v=M.separation,t.b2SubVV(C,c,D),t.b2SubVV(C,y,E),R=t.b2Min(R,v),A=t.b2Clamp(t.b2_baumgarte*(v+t.b2_linearSlop),-t.b2_maxLinearCorrection,0),g=t.b2CrossVV(D,S),w=t.b2CrossVV(E,S),x=p+_+b*g*g+d*w*w,B=x>0?-A/x:0,t.b2MulSV(B,S,P),c.SelfMulSub(p,P),u-=b*t.b2CrossVV(D,P),y.SelfMulAdd(_,P),f+=d*t.b2CrossVV(E,P);this.m_positions[r].a=u,this.m_positions[a].a=f}return R>-3*t.b2_linearSlop},t.b2ContactSolver.prototype.SolvePositionConstraints.s_xfA=new t.b2Transform,t.b2ContactSolver.prototype.SolvePositionConstraints.s_xfB=new t.b2Transform,t.b2ContactSolver.prototype.SolvePositionConstraints.s_psm=new t.b2PositionSolverManifold,t.b2ContactSolver.prototype.SolvePositionConstraints.s_rA=new t.b2Vec2,t.b2ContactSolver.prototype.SolvePositionConstraints.s_rB=new t.b2Vec2,t.b2ContactSolver.prototype.SolvePositionConstraints.s_P=new t.b2Vec2,t.b2ContactSolver.prototype.SolveTOIPositionConstraints=function(e,o){var i,n,s,r,a,l,p,b,m,_,d,h,c,u,y,f,S,C,v,A,g,w,x,B,V,T,M=t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfA,D=t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfB,E=t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_psm,P=t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rA,R=t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rB,I=t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_P,J=0;for(i=0,n=this.m_count;n>i;++i){for(a=this.m_positionConstraints[i],l=a.indexA,p=a.indexB,b=a.localCenterA,m=a.localCenterB,_=a.pointCount,d=0,h=0,(l==e||l==o)&&(d=a.invMassA,h=a.invIA),c=0,u=0,(p==e||p==o)&&(c=a.invMassB,u=a.invIB),y=this.m_positions[l].c,f=this.m_positions[l].a,S=this.m_positions[p].c,C=this.m_positions[p].a,s=0,r=_;r>s;++s)M.q.SetAngleRadians(f),D.q.SetAngleRadians(C),t.b2SubVV(y,t.b2MulRV(M.q,b,t.b2Vec2.s_t0),M.p),t.b2SubVV(S,t.b2MulRV(D.q,m,t.b2Vec2.s_t0),D.p),E.Initialize(a,M,D,s),v=E.normal,A=E.point,g=E.separation,t.b2SubVV(A,y,P),t.b2SubVV(A,S,R),J=t.b2Min(J,g),w=t.b2Clamp(t.b2_toiBaumgarte*(g+t.b2_linearSlop),-t.b2_maxLinearCorrection,0),x=t.b2CrossVV(P,v),B=t.b2CrossVV(R,v),V=d+c+h*x*x+u*B*B,T=V>0?-w/V:0,t.b2MulSV(T,v,I),y.SelfMulSub(d,I),f-=h*t.b2CrossVV(P,I),S.SelfMulAdd(c,I),C+=u*t.b2CrossVV(R,I);this.m_positions[l].a=f,this.m_positions[p].a=C}return J>=-1.5*t.b2_linearSlop},t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfA=new t.b2Transform,t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfB=new t.b2Transform,t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_psm=new t.b2PositionSolverManifold,t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rA=new t.b2Vec2,t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rB=new t.b2Vec2,t.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_P=new t.b2Vec2,t}(o,j,U,X,l,Z,Y,n,Q,et,i),ot=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Island&&(t.b2Island={}),t.b2Island=function(){this.m_bodies=new Array(1024),this.m_contacts=new Array(1024),this.m_joints=new Array(1024),this.m_positions=t.b2Position.MakeArray(1024),this.m_velocities=t.b2Velocity.MakeArray(1024)},t.b2Island.prototype.m_allocator=null,t.b2Island.prototype.m_listener=null,t.b2Island.prototype.m_bodies=null,t.b2Island.prototype.m_contacts=null,t.b2Island.prototype.m_joints=null,t.b2Island.prototype.m_positions=null,t.b2Island.prototype.m_velocities=null,t.b2Island.prototype.m_bodyCount=0,t.b2Island.prototype.m_jointCount=0,t.b2Island.prototype.m_contactCount=0,t.b2Island.prototype.m_bodyCapacity=0,t.b2Island.prototype.m_contactCapacity=0,t.b2Island.prototype.m_jointCapacity=0,t.b2Island.prototype.Initialize=function(e,o,i,n,s){for(this.m_bodyCapacity=e,this.m_contactCapacity=o,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=n,this.m_listener=s;this.m_bodies.length<e;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<o;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<i;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<e){var r=t.b2Max(2*this.m_positions.length,e);for(t.DEBUG&&window.console.log("box2d.b2Island.m_positions: "+r);this.m_positions.length<r;)this.m_positions[this.m_positions.length]=new t.b2Position}if(this.m_velocities.length<e){var r=t.b2Max(2*this.m_velocities.length,e);for(t.DEBUG&&window.console.log("box2d.b2Island.m_velocities: "+r);this.m_velocities.length<r;)this.m_velocities[this.m_velocities.length]=new t.b2Velocity}},t.b2Island.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},t.b2Island.prototype.AddBody=function(e){t.ENABLE_ASSERTS&&t.b2Assert(this.m_bodyCount<this.m_bodyCapacity),e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},t.b2Island.prototype.AddContact=function(e){t.ENABLE_ASSERTS&&t.b2Assert(this.m_contactCount<this.m_contactCapacity),this.m_contacts[this.m_contactCount++]=e},t.b2Island.prototype.AddJoint=function(e){t.ENABLE_ASSERTS&&t.b2Assert(this.m_jointCount<this.m_jointCapacity),this.m_joints[this.m_jointCount++]=e},t.b2Island.prototype.Solve=function(e,o,i,n){for(var s=t.b2Island.s_timer.Reset(),r=o.dt,a=0;a<this.m_bodyCount;++a){var l=this.m_bodies[a],p=this.m_positions[a].c.Copy(l.m_sweep.c),b=l.m_sweep.a,m=this.m_velocities[a].v.Copy(l.m_linearVelocity),_=l.m_angularVelocity;l.m_sweep.c0.Copy(l.m_sweep.c),l.m_sweep.a0=l.m_sweep.a,l.m_type==t.b2BodyType.b2_dynamicBody&&(m.x+=r*(l.m_gravityScale*i.x+l.m_invMass*l.m_force.x),m.y+=r*(l.m_gravityScale*i.y+l.m_invMass*l.m_force.y),_+=r*l.m_invI*l.m_torque,m.SelfMul(1/(1+r*l.m_linearDamping)),_*=1/(1+r*l.m_angularDamping)),this.m_positions[a].a=b,this.m_velocities[a].w=_}s.Reset();var d=t.b2Island.s_solverData;d.step.Copy(o),d.positions=this.m_positions,d.velocities=this.m_velocities;var h=t.b2Island.s_contactSolverDef;h.step.Copy(o),h.contacts=this.m_contacts,h.count=this.m_contactCount,h.positions=this.m_positions,h.velocities=this.m_velocities,h.allocator=this.m_allocator;var c=t.b2Island.s_contactSolver.Initialize(h);c.InitializeVelocityConstraints(),o.warmStarting&&c.WarmStart();for(var a=0;a<this.m_jointCount;++a)this.m_joints[a].InitVelocityConstraints(d);e.solveInit=s.GetMilliseconds(),s.Reset();for(var a=0;a<o.velocityIterations;++a){for(var u=0;u<this.m_jointCount;++u)this.m_joints[u].SolveVelocityConstraints(d);c.SolveVelocityConstraints()}c.StoreImpulses(),e.solveVelocity=s.GetMilliseconds();for(var a=0;a<this.m_bodyCount;++a){var p=this.m_positions[a].c,b=this.m_positions[a].a,m=this.m_velocities[a].v,_=this.m_velocities[a].w,y=t.b2MulSV(r,m,t.b2Island.s_translation);if(t.b2DotVV(y,y)>t.b2_maxTranslationSquared){var f=t.b2_maxTranslation/y.GetLength();m.SelfMul(f)}var S=r*_;if(S*S>t.b2_maxRotationSquared){var f=t.b2_maxRotation/t.b2Abs(S);_*=f}p.x+=r*m.x,p.y+=r*m.y,b+=r*_,this.m_positions[a].a=b,this.m_velocities[a].w=_}s.Reset();for(var C=!1,a=0;a<o.positionIterations;++a){for(var v=c.SolvePositionConstraints(),A=!0,u=0;u<this.m_jointCount;++u){var g=this.m_joints[u].SolvePositionConstraints(d);A=A&&g}if(v&&A){C=!0;break}}for(var a=0;a<this.m_bodyCount;++a){var w=this.m_bodies[a];w.m_sweep.c.Copy(this.m_positions[a].c),w.m_sweep.a=this.m_positions[a].a,w.m_linearVelocity.Copy(this.m_velocities[a].v),w.m_angularVelocity=this.m_velocities[a].w,w.SynchronizeTransform()}if(e.solvePosition=s.GetMilliseconds(),this.Report(c.m_velocityConstraints),n){for(var x=t.b2_maxFloat,B=t.b2_linearSleepTolerance*t.b2_linearSleepTolerance,V=t.b2_angularSleepTolerance*t.b2_angularSleepTolerance,a=0;a<this.m_bodyCount;++a){var l=this.m_bodies[a];l.GetType()!=t.b2BodyType.b2_staticBody&&(0==(l.m_flags&t.b2BodyFlag.e_autoSleepFlag)||l.m_angularVelocity*l.m_angularVelocity>V||t.b2DotVV(l.m_linearVelocity,l.m_linearVelocity)>B?(l.m_sleepTime=0,x=0):(l.m_sleepTime+=r,x=t.b2Min(x,l.m_sleepTime)))}if(x>=t.b2_timeToSleep&&C)for(var a=0;a<this.m_bodyCount;++a){var l=this.m_bodies[a];l.SetAwake(!1)}}},t.b2Island.prototype.SolveTOI=function(e,o,i){t.ENABLE_ASSERTS&&t.b2Assert(o<this.m_bodyCount),t.ENABLE_ASSERTS&&t.b2Assert(i<this.m_bodyCount);for(var n=0;n<this.m_bodyCount;++n){var s=this.m_bodies[n];this.m_positions[n].c.Copy(s.m_sweep.c),this.m_positions[n].a=s.m_sweep.a,this.m_velocities[n].v.Copy(s.m_linearVelocity),this.m_velocities[n].w=s.m_angularVelocity}var r=t.b2Island.s_contactSolverDef;r.contacts=this.m_contacts,r.count=this.m_contactCount,r.allocator=this.m_allocator,r.step.Copy(e),r.positions=this.m_positions,r.velocities=this.m_velocities;for(var a=t.b2Island.s_contactSolver.Initialize(r),n=0;n<e.positionIterations;++n){var l=a.SolveTOIPositionConstraints(o,i);if(l)break}this.m_bodies[o].m_sweep.c0.Copy(this.m_positions[o].c),this.m_bodies[o].m_sweep.a0=this.m_positions[o].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,a.InitializeVelocityConstraints();
for(var n=0;n<e.velocityIterations;++n)a.SolveVelocityConstraints();for(var p=e.dt,n=0;n<this.m_bodyCount;++n){var b=this.m_positions[n].c,m=this.m_positions[n].a,_=this.m_velocities[n].v,d=this.m_velocities[n].w,h=t.b2MulSV(p,_,t.b2Island.s_translation);if(t.b2DotVV(h,h)>t.b2_maxTranslationSquared){var c=t.b2_maxTranslation/h.GetLength();_.SelfMul(c)}var u=p*d;if(u*u>t.b2_maxRotationSquared){var c=t.b2_maxRotation/t.b2Abs(u);d*=c}b.SelfMulAdd(p,_),m+=p*d,this.m_positions[n].a=m,this.m_velocities[n].w=d;var y=this.m_bodies[n];y.m_sweep.c.Copy(b),y.m_sweep.a=m,y.m_linearVelocity.Copy(_),y.m_angularVelocity=d,y.SynchronizeTransform()}this.Report(a.m_velocityConstraints)},t.b2Island.prototype.Report=function(e){if(null!=this.m_listener)for(var o=0;o<this.m_contactCount;++o){var i=this.m_contacts[o];if(i){var n=e[o],s=t.b2Island.s_impulse;s.count=n.pointCount;for(var r=0;r<n.pointCount;++r)s.normalImpulses[r]=n.points[r].normalImpulse,s.tangentImpulses[r]=n.points[r].tangentImpulse;this.m_listener.PostSolve(i,s)}}},t.b2Island.s_timer=new t.b2Timer,t.b2Island.s_solverData=new t.b2SolverData,t.b2Island.s_contactSolverDef=new t.b2ContactSolverDef,t.b2Island.s_contactSolver=new t.b2ContactSolver,t.b2Island.s_translation=new t.b2Vec2,t.b2Island.s_impulse=new t.b2ContactImpulse,t}(o,tt,i,k,g,u),it=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2JointFactory&&(t.b2JointFactory={}),t.b2JointFactory.Create=function(e){var o=null;switch(e.type){case t.b2JointType.e_distanceJoint:o=new t.b2DistanceJoint(e instanceof t.b2DistanceJointDef?e:null);break;case t.b2JointType.e_mouseJoint:o=new t.b2MouseJoint(e instanceof t.b2MouseJointDef?e:null);break;case t.b2JointType.e_prismaticJoint:o=new t.b2PrismaticJoint(e instanceof t.b2PrismaticJointDef?e:null);break;case t.b2JointType.e_revoluteJoint:o=new t.b2RevoluteJoint(e instanceof t.b2RevoluteJointDef?e:null);break;case t.b2JointType.e_pulleyJoint:o=new t.b2PulleyJoint(e instanceof t.b2PulleyJointDef?e:null);break;case t.b2JointType.e_gearJoint:o=new t.b2GearJoint(e instanceof t.b2GearJointDef?e:null);break;case t.b2JointType.e_wheelJoint:o=new t.b2WheelJoint(e instanceof t.b2WheelJointDef?e:null);break;case t.b2JointType.e_weldJoint:o=new t.b2WeldJoint(e instanceof t.b2WeldJointDef?e:null);break;case t.b2JointType.e_frictionJoint:o=new t.b2FrictionJoint(e instanceof t.b2FrictionJointDef?e:null);break;case t.b2JointType.e_ropeJoint:o=new t.b2RopeJoint(e instanceof t.b2RopeJointDef?e:null);break;case t.b2JointType.e_motorJoint:o=new t.b2MotorJoint(e instanceof t.b2MotorJointDef?e:null);break;case t.b2JointType.e_areaJoint:o=new t.b2AreaJoint(e instanceof t.b2AreaJointDef?e:null);break;default:t.ENABLE_ASSERTS&&t.b2Assert(!1)}return o},t.b2JointFactory.Destroy=function(){},t}(o,s,n,i),nt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2World&&(t.b2World={}),t.b2WorldFlag={e_none:0,e_newFixture:1,e_locked:2,e_clearForces:4},e.exportProperty(t.b2WorldFlag,"e_none",t.b2WorldFlag.e_none),e.exportProperty(t.b2WorldFlag,"e_newFixture",t.b2WorldFlag.e_newFixture),e.exportProperty(t.b2WorldFlag,"e_locked",t.b2WorldFlag.e_locked),e.exportProperty(t.b2WorldFlag,"e_clearForces",t.b2WorldFlag.e_clearForces),t.b2World=function(e){this.m_flags=t.b2WorldFlag.e_clearForces,this.m_contactManager=new t.b2ContactManager,this.m_gravity=e.Clone(),this.m_out_gravity=new t.b2Vec2,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new t.b2Profile,this.m_island=new t.b2Island,this.s_stack=new Array},t.b2World.prototype.m_flags=t.b2WorldFlag.e_none,t.b2World.prototype.m_contactManager=null,t.b2World.prototype.m_bodyList=null,t.b2World.prototype.m_jointList=null,t.b2World.prototype.m_bodyCount=0,t.b2World.prototype.m_jointCount=0,t.b2World.prototype.m_gravity=null,t.b2World.prototype.m_out_gravity=null,t.b2World.prototype.m_allowSleep=!0,t.b2World.prototype.m_destructionListener=null,t.b2World.prototype.m_debugDraw=null,t.b2World.prototype.m_inv_dt0=0,t.b2World.prototype.m_warmStarting=!0,t.b2World.prototype.m_continuousPhysics=!0,t.b2World.prototype.m_subStepping=!1,t.b2World.prototype.m_stepComplete=!0,t.b2World.prototype.m_profile=null,t.b2World.prototype.m_island=null,t.b2World.prototype.s_stack=null,t.b2World.prototype.m_controllerList=null,t.b2World.prototype.m_controllerCount=0,t.b2World.prototype.SetAllowSleeping=function(e){if(e!=this.m_allowSleep&&(this.m_allowSleep=e,0==this.m_allowSleep))for(var t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)},t.b2World.prototype.GetAllowSleeping=function(){return this.m_allowSleep},t.b2World.prototype.SetWarmStarting=function(e){this.m_warmStarting=e},t.b2World.prototype.GetWarmStarting=function(){return this.m_warmStarting},t.b2World.prototype.SetContinuousPhysics=function(e){this.m_continuousPhysics=e},t.b2World.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},t.b2World.prototype.SetSubStepping=function(e){this.m_subStepping=e},t.b2World.prototype.GetSubStepping=function(){return this.m_subStepping},t.b2World.prototype.GetBodyList=function(){return this.m_bodyList},t.b2World.prototype.GetJointList=function(){return this.m_jointList},t.b2World.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},t.b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},t.b2World.prototype.GetJointCount=function(){return this.m_jointCount},t.b2World.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},t.b2World.prototype.SetGravity=function(e,t){if(t=t||!0,(this.m_gravity.x!==e.x||this.m_gravity.y!==e.y)&&(this.m_gravity.Copy(e),t))for(var o=this.m_bodyList;o;o=o.m_next)o.SetAwake(!0)},t.b2World.prototype.GetGravity=function(e){return e=e||this.m_out_gravity,e.Copy(this.m_gravity)},t.b2World.prototype.IsLocked=function(){return(this.m_flags&t.b2WorldFlag.e_locked)>0},t.b2World.prototype.SetAutoClearForces=function(e){e?this.m_flags|=t.b2WorldFlag.e_clearForces:this.m_flags&=~t.b2WorldFlag.e_clearForces},t.b2World.prototype.GetAutoClearForces=function(){return(this.m_flags&t.b2WorldFlag.e_clearForces)==t.b2WorldFlag.e_clearForces},t.b2World.prototype.GetContactManager=function(){return this.m_contactManager},t.b2World.prototype.GetProfile=function(){return this.m_profile},t.b2World.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},t.b2World.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},t.b2World.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},t.b2World.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},t.b2World.prototype.CreateBody=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.IsLocked()),this.IsLocked())return null;var o=new t.b2Body(e,this);return o.m_prev=null,o.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=o),this.m_bodyList=o,++this.m_bodyCount,o},t.b2World.prototype.DestroyBody=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(this.m_bodyCount>0),t.ENABLE_ASSERTS&&t.b2Assert(0==this.IsLocked()),!this.IsLocked()){for(var o=e.m_jointList;o;){var i=o;o=o.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),e.m_jointList=o}e.m_jointList=null;for(var n=e.m_controllerList;n;){var s=n;n=n.nextController,s.controller.RemoveBody(e)}for(var r=e.m_contactList;r;){var a=r;r=r.next,this.m_contactManager.Destroy(a.contact)}e.m_contactList=null;for(var l=e.m_fixtureList;l;){var p=l;l=l.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(p),p.DestroyProxies(this.m_contactManager.m_broadPhase),p.Destroy(),e.m_fixtureList=l,e.m_fixtureCount-=1}e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount}},t.b2World.prototype.CreateJoint=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.IsLocked()),this.IsLocked())return null;var o=t.b2JointFactory.Create(e,null);o.m_prev=null,o.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=o),this.m_jointList=o,++this.m_jointCount,o.m_edgeA.joint=o,o.m_edgeA.other=o.m_bodyB,o.m_edgeA.prev=null,o.m_edgeA.next=o.m_bodyA.m_jointList,o.m_bodyA.m_jointList&&(o.m_bodyA.m_jointList.prev=o.m_edgeA),o.m_bodyA.m_jointList=o.m_edgeA,o.m_edgeB.joint=o,o.m_edgeB.other=o.m_bodyA,o.m_edgeB.prev=null,o.m_edgeB.next=o.m_bodyB.m_jointList,o.m_bodyB.m_jointList&&(o.m_bodyB.m_jointList.prev=o.m_edgeB),o.m_bodyB.m_jointList=o.m_edgeB;var i=e.bodyA,n=e.bodyB;if(0==e.collideConnected)for(var s=n.GetContactList();s;)s.other==i&&s.contact.FlagForFiltering(),s=s.next;return o},t.b2World.prototype.DestroyJoint=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.IsLocked()),!this.IsLocked()){var o=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var i=e.m_bodyA,n=e.m_bodyB;if(i.SetAwake(!0),n.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==i.m_jointList&&(i.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==n.m_jointList&&(n.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,t.b2JointFactory.Destroy(e,null),t.ENABLE_ASSERTS&&t.b2Assert(this.m_jointCount>0),--this.m_jointCount,0==o)for(var s=n.GetContactList();s;)s.other==i&&s.contact.FlagForFiltering(),s=s.next}},t.b2World.prototype.Solve=function(e){for(var o=this.m_controllerList;o;o=o.m_next)o.Step(e);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var i=this.m_island;i.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(var n=this.m_bodyList;n;n=n.m_next)n.m_flags&=~t.b2BodyFlag.e_islandFlag;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_flags&=~t.b2ContactFlag.e_islandFlag;for(var r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(var a=this.m_bodyCount,l=this.s_stack,p=this.m_bodyList;p;p=p.m_next)if(!(p.m_flags&t.b2BodyFlag.e_islandFlag)&&0!=p.IsAwake()&&0!=p.IsActive()&&p.GetType()!=t.b2BodyType.b2_staticBody){i.Clear();var b=0;for(l[b++]=p,p.m_flags|=t.b2BodyFlag.e_islandFlag;b>0;){var n=l[--b];if(t.ENABLE_ASSERTS&&t.b2Assert(1==n.IsActive()),i.AddBody(n),n.SetAwake(!0),n.GetType()!=t.b2BodyType.b2_staticBody){for(var m=n.m_contactList;m;m=m.next){var _=m.contact;if(!(_.m_flags&t.b2ContactFlag.e_islandFlag)&&0!=_.IsEnabled()&&0!=_.IsTouching()){var d=_.m_fixtureA.m_isSensor,h=_.m_fixtureB.m_isSensor;if(!d&&!h){i.AddContact(_),_.m_flags|=t.b2ContactFlag.e_islandFlag;var c=m.other;c.m_flags&t.b2BodyFlag.e_islandFlag||(t.ENABLE_ASSERTS&&t.b2Assert(a>b),l[b++]=c,c.m_flags|=t.b2BodyFlag.e_islandFlag)}}}for(var u=n.m_jointList;u;u=u.next)if(1!=u.joint.m_islandFlag){var c=u.other;0!=c.IsActive()&&(i.AddJoint(u.joint),u.joint.m_islandFlag=!0,c.m_flags&t.b2BodyFlag.e_islandFlag||(t.ENABLE_ASSERTS&&t.b2Assert(a>b),l[b++]=c,c.m_flags|=t.b2BodyFlag.e_islandFlag))}}}var y=new t.b2Profile;i.Solve(y,e,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=y.solveInit,this.m_profile.solveVelocity+=y.solveVelocity,this.m_profile.solvePosition+=y.solvePosition;for(var f=0;f<i.m_bodyCount;++f){var n=i.m_bodies[f];n.GetType()==t.b2BodyType.b2_staticBody&&(n.m_flags&=~t.b2BodyFlag.e_islandFlag)}}for(var f=0;f<l.length&&l[f];++f)l[f]=null;for(var S=new t.b2Timer,n=this.m_bodyList;n;n=n.m_next)0!=(n.m_flags&t.b2BodyFlag.e_islandFlag)&&n.GetType()!=t.b2BodyType.b2_staticBody&&n.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=S.GetMilliseconds()},t.b2World.prototype.SolveTOI=function(e){var o=this.m_island;if(o.Initialize(2*t.b2_maxTOIContacts,t.b2_maxTOIContacts,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~t.b2BodyFlag.e_islandFlag,i.m_sweep.alpha0=0;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_flags&=~(t.b2ContactFlag.e_toiFlag|t.b2ContactFlag.e_islandFlag),n.m_toiCount=0,n.m_toi=1}for(;;){for(var s=null,r=1,n=this.m_contactManager.m_contactList;n;n=n.m_next)if(0!=n.IsEnabled()&&!(n.m_toiCount>t.b2_maxSubSteps)){var a=1;if(n.m_flags&t.b2ContactFlag.e_toiFlag)a=n.m_toi;else{var l=n.GetFixtureA(),p=n.GetFixtureB();if(l.IsSensor()||p.IsSensor())continue;var b=l.GetBody(),m=p.GetBody(),_=b.m_type,d=m.m_type;t.ENABLE_ASSERTS&&t.b2Assert(_==t.b2BodyType.b2_dynamicBody||d==t.b2BodyType.b2_dynamicBody);var h=b.IsAwake()&&_!=t.b2BodyType.b2_staticBody,c=m.IsAwake()&&d!=t.b2BodyType.b2_staticBody;if(0==h&&0==c)continue;var u=b.IsBullet()||_!=t.b2BodyType.b2_dynamicBody,y=m.IsBullet()||d!=t.b2BodyType.b2_dynamicBody;if(0==u&&0==y)continue;var f=b.m_sweep.alpha0;b.m_sweep.alpha0<m.m_sweep.alpha0?(f=m.m_sweep.alpha0,b.m_sweep.Advance(f)):m.m_sweep.alpha0<b.m_sweep.alpha0&&(f=b.m_sweep.alpha0,m.m_sweep.Advance(f)),t.ENABLE_ASSERTS&&t.b2Assert(1>f);var S=n.GetChildIndexA(),C=n.GetChildIndexB(),v=t.b2World.prototype.SolveTOI.s_toi_input;v.proxyA.SetShape(l.GetShape(),S),v.proxyB.SetShape(p.GetShape(),C),v.sweepA.Copy(b.m_sweep),v.sweepB.Copy(m.m_sweep),v.tMax=1;var A=t.b2World.prototype.SolveTOI.s_toi_output;t.b2TimeOfImpact(A,v);var g=A.t;a=A.state==t.b2TOIOutputState.e_touching?t.b2Min(f+(1-f)*g,1):1,n.m_toi=a,n.m_flags|=t.b2ContactFlag.e_toiFlag}r>a&&(s=n,r=a)}if(null==s||1-10*t.b2_epsilon<r){this.m_stepComplete=!0;break}var l=s.GetFixtureA(),p=s.GetFixtureB(),b=l.GetBody(),m=p.GetBody(),w=t.b2World.prototype.SolveTOI.s_backup1.Copy(b.m_sweep),x=t.b2World.prototype.SolveTOI.s_backup2.Copy(m.m_sweep);if(b.Advance(r),m.Advance(r),s.Update(this.m_contactManager.m_contactListener),s.m_flags&=~t.b2ContactFlag.e_toiFlag,++s.m_toiCount,0!=s.IsEnabled()&&0!=s.IsTouching()){b.SetAwake(!0),m.SetAwake(!0),o.Clear(),o.AddBody(b),o.AddBody(m),o.AddContact(s),b.m_flags|=t.b2BodyFlag.e_islandFlag,m.m_flags|=t.b2BodyFlag.e_islandFlag,s.m_flags|=t.b2ContactFlag.e_islandFlag;for(var B=0;2>B;++B){var V=0==B?b:m;if(V.m_type==t.b2BodyType.b2_dynamicBody)for(var T=V.m_contactList;T&&o.m_bodyCount!=o.m_bodyCapacity&&o.m_contactCount!=o.m_contactCapacity;T=T.next){var M=T.contact;if(!(M.m_flags&t.b2ContactFlag.e_islandFlag)){var D=T.other;if(D.m_type!=t.b2BodyType.b2_dynamicBody||0!=V.IsBullet()||0!=D.IsBullet()){var E=M.m_fixtureA.m_isSensor,P=M.m_fixtureB.m_isSensor;if(!E&&!P){var R=t.b2World.prototype.SolveTOI.s_backup.Copy(D.m_sweep);0==(D.m_flags&t.b2BodyFlag.e_islandFlag)&&D.Advance(r),M.Update(this.m_contactManager.m_contactListener),0!=M.IsEnabled()?0!=M.IsTouching()?(M.m_flags|=t.b2ContactFlag.e_islandFlag,o.AddContact(M),D.m_flags&t.b2BodyFlag.e_islandFlag||(D.m_flags|=t.b2BodyFlag.e_islandFlag,D.m_type!=t.b2BodyType.b2_staticBody&&D.SetAwake(!0),o.AddBody(D))):(D.m_sweep.Copy(R),D.SynchronizeTransform()):(D.m_sweep.Copy(R),D.SynchronizeTransform())}}}}}var I=t.b2World.prototype.SolveTOI.s_subStep;I.dt=(1-r)*e.dt,I.inv_dt=1/I.dt,I.dtRatio=1,I.positionIterations=20,I.velocityIterations=e.velocityIterations,I.warmStarting=!1,o.SolveTOI(I,b.m_islandIndex,m.m_islandIndex);for(var B=0;B<o.m_bodyCount;++B){var V=o.m_bodies[B];if(V.m_flags&=~t.b2BodyFlag.e_islandFlag,V.m_type==t.b2BodyType.b2_dynamicBody){V.SynchronizeFixtures();for(var T=V.m_contactList;T;T=T.next)T.contact.m_flags&=~(t.b2ContactFlag.e_toiFlag|t.b2ContactFlag.e_islandFlag)}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else s.SetEnabled(!1),b.m_sweep.Copy(w),m.m_sweep.Copy(x),b.SynchronizeTransform(),m.SynchronizeTransform()}},t.b2World.prototype.SolveTOI.s_subStep=new t.b2TimeStep,t.b2World.prototype.SolveTOI.s_backup=new t.b2Sweep,t.b2World.prototype.SolveTOI.s_backup1=new t.b2Sweep,t.b2World.prototype.SolveTOI.s_backup2=new t.b2Sweep,t.b2World.prototype.SolveTOI.s_toi_input=new t.b2TOIInput,t.b2World.prototype.SolveTOI.s_toi_output=new t.b2TOIOutput,t.b2World.prototype.Step=function(e,o,i){var n=new t.b2Timer;this.m_flags&t.b2WorldFlag.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~t.b2WorldFlag.e_newFixture),this.m_flags|=t.b2WorldFlag.e_locked;var s=t.b2World.prototype.Step.s_step;s.dt=e,s.velocityIterations=o,s.positionIterations=i,s.inv_dt=e>0?1/e:0,s.dtRatio=this.m_inv_dt0*e,s.warmStarting=this.m_warmStarting;var r=new t.b2Timer;if(this.m_contactManager.Collide(),this.m_profile.collide=r.GetMilliseconds(),this.m_stepComplete&&s.dt>0){var r=new t.b2Timer;this.Solve(s),this.m_profile.solve=r.GetMilliseconds()}if(this.m_continuousPhysics&&s.dt>0){var r=new t.b2Timer;this.SolveTOI(s),this.m_profile.solveTOI=r.GetMilliseconds()}s.dt>0&&(this.m_inv_dt0=s.inv_dt),this.m_flags&t.b2WorldFlag.e_clearForces&&this.ClearForces(),this.m_flags&=~t.b2WorldFlag.e_locked,this.m_profile.step=n.GetMilliseconds()},t.b2World.prototype.Step.s_step=new t.b2TimeStep,t.b2World.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},t.b2World.prototype.QueryAABB=function(e,o){var i=this.m_contactManager.m_broadPhase,n=function(o){var n=i.GetUserData(o);t.ENABLE_ASSERTS&&t.b2Assert(n instanceof t.b2FixtureProxy);{var s=n.fixture;n.childIndex}return e instanceof t.b2QueryCallback?e.ReportFixture(s):e(s)};i.Query(n,o)},t.b2World.prototype.QueryShape=function(e,o,i){var n=this.m_contactManager.m_broadPhase,s=function(s){var r=n.GetUserData(s);t.ENABLE_ASSERTS&&t.b2Assert(r instanceof t.b2FixtureProxy);{var a=r.fixture;r.childIndex}return t.b2TestOverlapShape(o,0,a.GetShape(),0,i,a.GetBody().GetTransform())?e instanceof t.b2QueryCallback?e.ReportFixture(a):e(a):!0},r=t.b2World.prototype.QueryShape.s_aabb;o.ComputeAABB(r,i,0),n.Query(s,r)},t.b2World.prototype.QueryShape.s_aabb=new t.b2AABB,t.b2World.prototype.QueryPoint=function(e,o){var i=this.m_contactManager.m_broadPhase,n=function(n){var s=i.GetUserData(n);t.ENABLE_ASSERTS&&t.b2Assert(s instanceof t.b2FixtureProxy);{var r=s.fixture;s.childIndex}return r.TestPoint(o)?e instanceof t.b2QueryCallback?e.ReportFixture(r):e(r):!0},s=t.b2World.prototype.QueryPoint.s_aabb;s.lowerBound.Set(o.x-t.b2_linearSlop,o.y-t.b2_linearSlop),s.upperBound.Set(o.x+t.b2_linearSlop,o.y+t.b2_linearSlop),i.Query(n,s)},t.b2World.prototype.QueryPoint.s_aabb=new t.b2AABB,t.b2World.prototype.RayCast=function(e,o,i){var n=this.m_contactManager.m_broadPhase,s=function(s,r){var a=n.GetUserData(r);t.ENABLE_ASSERTS&&t.b2Assert(a instanceof t.b2FixtureProxy);var l=a.fixture,p=a.childIndex,b=t.b2World.prototype.RayCast.s_output,m=l.RayCast(b,s,p);if(m){var _=b.fraction,d=t.b2World.prototype.RayCast.s_point;return d.Set((1-_)*o.x+_*i.x,(1-_)*o.y+_*i.y),e instanceof t.b2RayCastCallback?e.ReportFixture(l,d,b.normal,_):e(l,d,b.normal,_)}return s.maxFraction},r=t.b2World.prototype.RayCast.s_input;r.maxFraction=1,r.p1.Copy(o),r.p2.Copy(i),n.RayCast(s,r)},t.b2World.prototype.RayCast.s_input=new t.b2RayCastInput,t.b2World.prototype.RayCast.s_output=new t.b2RayCastOutput,t.b2World.prototype.RayCast.s_point=new t.b2Vec2,t.b2World.prototype.RayCastOne=function(e,t){function o(e,t,o,s){return n>s&&(n=s,i=e),n}var i=null,n=1;return this.RayCast(o,e,t),i},t.b2World.prototype.RayCastAll=function(e,t,o){function i(e){return o.push(e),1}return o.length=0,this.RayCast(i,e,t),o},t.b2World.prototype.DrawShape=function(e,o){var i=e.GetShape();switch(i.m_type){case t.b2ShapeType.e_circleShape:var n=i instanceof t.b2CircleShape?i:null,s=n.m_p,r=n.m_radius,a=t.b2Vec2.UNITX;this.m_debugDraw.DrawSolidCircle(s,r,a,o);break;case t.b2ShapeType.e_edgeShape:var l=i instanceof t.b2EdgeShape?i:null,p=l.m_vertex1,b=l.m_vertex2;this.m_debugDraw.DrawSegment(p,b,o);break;case t.b2ShapeType.e_chainShape:var m=i instanceof t.b2ChainShape?i:null,_=m.m_count,d=m.m_vertices,p=d[0];this.m_debugDraw.DrawCircle(p,.05,o);for(var h=1;_>h;++h){var b=d[h];this.m_debugDraw.DrawSegment(p,b,o),this.m_debugDraw.DrawCircle(b,.05,o),p=b}break;case t.b2ShapeType.e_polygonShape:var c=i instanceof t.b2PolygonShape?i:null,u=c.m_count,d=c.m_vertices;this.m_debugDraw.DrawSolidPolygon(d,u,o)}},t.b2World.prototype.DrawJoint=function(e){var o=e.GetBodyA(),i=e.GetBodyB(),n=o.m_xf,s=i.m_xf,r=n.p,a=s.p,l=e.GetAnchorA(t.b2World.prototype.DrawJoint.s_p1),p=e.GetAnchorB(t.b2World.prototype.DrawJoint.s_p2),b=t.b2World.prototype.DrawJoint.s_color.SetRGB(.5,.8,.8);switch(e.m_type){case t.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(l,p,b);break;case t.b2JointType.e_pulleyJoint:var m=e instanceof t.b2PulleyJoint?e:null,_=m.GetGroundAnchorA(t.b2World.prototype.DrawJoint.s_s1),d=m.GetGroundAnchorB(t.b2World.prototype.DrawJoint.s_s2);this.m_debugDraw.DrawSegment(_,l,b),this.m_debugDraw.DrawSegment(d,p,b),this.m_debugDraw.DrawSegment(_,d,b);break;case t.b2JointType.e_mouseJoint:this.m_debugDraw.DrawSegment(l,p,b);break;default:this.m_debugDraw.DrawSegment(r,l,b),this.m_debugDraw.DrawSegment(l,p,b),this.m_debugDraw.DrawSegment(a,p,b)}},t.b2World.prototype.DrawJoint.s_p1=new t.b2Vec2,t.b2World.prototype.DrawJoint.s_p2=new t.b2Vec2,t.b2World.prototype.DrawJoint.s_color=new t.b2Color(.5,.8,.8),t.b2World.prototype.DrawJoint.s_s1=new t.b2Vec2,t.b2World.prototype.DrawJoint.s_s2=new t.b2Vec2,t.b2World.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){var e=this.m_debugDraw.GetFlags(),o=t.b2World.prototype.DrawDebugData.s_color.SetRGB(0,0,0);if(e&t.b2DrawFlags.e_shapeBit)for(var i=this.m_bodyList;i;i=i.m_next){var n=i.m_xf;this.m_debugDraw.PushTransform(n);for(var s=i.GetFixtureList();s;s=s.m_next)0==i.IsActive()?(o.SetRGB(.5,.5,.3),this.DrawShape(s,o)):i.GetType()==t.b2BodyType.b2_staticBody?(o.SetRGB(.5,.9,.5),this.DrawShape(s,o)):i.GetType()==t.b2BodyType.b2_kinematicBody?(o.SetRGB(.5,.5,.9),this.DrawShape(s,o)):0==i.IsAwake()?(o.SetRGB(.6,.6,.6),this.DrawShape(s,o)):(o.SetRGB(.9,.7,.7),this.DrawShape(s,o));this.m_debugDraw.PopTransform(n)}if(e&t.b2DrawFlags.e_jointBit)for(var r=this.m_jointList;r;r=r.m_next)this.DrawJoint(r);if(e&t.b2DrawFlags.e_aabbBit){o.SetRGB(.9,.3,.9);for(var a=this.m_contactManager.m_broadPhase,l=t.b2World.prototype.DrawDebugData.s_vs,i=this.m_bodyList;i;i=i.m_next)if(0!=i.IsActive())for(var s=i.GetFixtureList();s;s=s.m_next)for(var p=0;p<s.m_proxyCount;++p){var b=s.m_proxies[p],m=a.GetFatAABB(b.proxy);l[0].Set(m.lowerBound.x,m.lowerBound.y),l[1].Set(m.upperBound.x,m.lowerBound.y),l[2].Set(m.upperBound.x,m.upperBound.y),l[3].Set(m.lowerBound.x,m.upperBound.y),this.m_debugDraw.DrawPolygon(l,4,o)}}if(e&t.b2DrawFlags.e_centerOfMassBit)for(var i=this.m_bodyList;i;i=i.m_next){var n=t.b2World.prototype.DrawDebugData.s_xf;n.q.Copy(i.m_xf.q),n.p.Copy(i.GetWorldCenter()),this.m_debugDraw.DrawTransform(n)}if(e&t.b2DrawFlags.e_controllerBit)for(var _=this.m_controllerList;_;_=_.m_next)_.Draw(this.m_debugDraw)}},t.b2World.prototype.DrawDebugData.s_color=new t.b2Color(0,0,0),t.b2World.prototype.DrawDebugData.s_vs=t.b2Vec2.MakeArray(4),t.b2World.prototype.DrawDebugData.s_xf=new t.b2Transform,t.b2World.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var o=this.m_bodyList;o;o=o.m_next)for(var i=o.m_fixtureList;i;i=i.m_next)i.m_proxy=e.CreateProxy(t.GetFatAABB(i.m_proxy),i)},t.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},t.b2World.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},t.b2World.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},t.b2World.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},t.b2World.prototype.ShiftOrigin=function(e){if(t.ENABLE_ASSERTS&&t.b2Assert(0==this.IsLocked()),!this.IsLocked()){for(var o=this.m_bodyList;o;o=o.m_next)o.m_xf.p.SelfSub(e),o.m_sweep.c0.SelfSub(e),o.m_sweep.c.SelfSub(e);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(e);this.m_contactManager.m_broadPhase.ShiftOrigin(e)}},t.b2World.prototype.Dump=function(){if(t.DEBUG){if((this.m_flags&t.b2WorldFlag.e_locked)==t.b2WorldFlag.e_locked)return;t.b2Log("/** @type {box2d.b2Vec2} */ var g = new box2d.b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t.b2Log("this.m_world.SetGravity(g);\n"),t.b2Log("/** @type {Array.<box2d.b2Body>} */ var bodies = new Array(%d);\n",this.m_bodyCount),t.b2Log("/** @type {Array.<box2d.b2Joint>} */ var joints = new Array(%d);\n",this.m_jointCount);for(var e=0,o=this.m_bodyList;o;o=o.m_next)o.m_islandIndex=e,o.Dump(),++e;e=0;for(var i=this.m_jointList;i;i=i.m_next)i.m_index=e,++e;for(var i=this.m_jointList;i;i=i.m_next)i.m_type!=t.b2JointType.e_gearJoint&&(t.b2Log("if (true)\n"),t.b2Log("{\n"),i.Dump(),t.b2Log("}\n"));for(var i=this.m_jointList;i;i=i.m_next)i.m_type==t.b2JointType.e_gearJoint&&(t.b2Log("if (true)\n"),t.b2Log("{\n"),i.Dump(),t.b2Log("}\n"))}},t.b2World.prototype.AddController=function(e){return t.ENABLE_ASSERTS&&t.b2Assert(null===e.m_world,"Controller can only be a member of one world"),e.m_world=this,e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e},t.b2World.prototype.RemoveController=function(e){t.ENABLE_ASSERTS&&t.b2Assert(e.m_world===this,"Controller is not a member of this world"),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),--this.m_controllerCount,e.m_prev=null,e.m_next=null,e.m_world=null},t}(o,m,l,q,tt,V,ot,it,n,i,k,u),st=function(e,t){return"undefined"==typeof t&&(t={}),t}(o,r,m,h,y,S,C,v,A,x,a,B,V,d,f,b,T,E,P,R,I,J,M,L,D,F,G,i,N,w,k,g,O,W,nt,u),rt=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.string&&(e.string={}),"undefined"==typeof e&&(e={}),"undefined"==typeof e.string&&(e.string={}),"undefined"==typeof e.string.Unicode&&(e.string.Unicode={}),e.string.Unicode={NBSP:""},e.string.startsWith=function(e,t){return 0==e.lastIndexOf(t,0)},e.string.endsWith=function(e,t){var o=e.length-t.length;return o>=0&&e.indexOf(t,o)==o},e.string.caseInsensitiveStartsWith=function(t,o){return 0==e.string.caseInsensitiveCompare(o,t.substr(0,o.length))},e.string.caseInsensitiveEndsWith=function(t,o){return 0==e.string.caseInsensitiveCompare(o,t.substr(t.length-o.length,o.length))},e.string.caseInsensitiveEquals=function(e,t){return e.toLowerCase()==t.toLowerCase()},e.string.subs=function(e){for(var t=e.split("%s"),o="",i=Array.prototype.slice.call(arguments,1);i.length&&t.length>1;)o+=t.shift()+i.shift();return o+t.join("%s")},e.string.collapseWhitespace=function(e){return e.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},e.string.isEmpty=function(e){return/^[\s\xa0]*$/.test(e)},e.string.isEmptySafe=function(t){return e.string.isEmpty(e.string.makeSafe(t))},e.string.isBreakingWhitespace=function(e){return!/[^\t\n\r ]/.test(e)},e.string.isAlpha=function(e){return!/[^a-zA-Z]/.test(e)},e.string.isNumeric=function(e){return!/[^0-9]/.test(e)},e.string.isAlphaNumeric=function(e){return!/[^a-zA-Z0-9]/.test(e)},e.string.isSpace=function(e){return" "==e},e.string.isUnicodeChar=function(e){return 1==e.length&&e>=" "&&"~">=e||e>=""&&"">=e},e.string.stripNewlines=function(e){return e.replace(/(\r\n|\r|\n)+/g," ")},e.string.canonicalizeNewlines=function(e){return e.replace(/(\r\n|\r|\n)/g,"\n")},e.string.normalizeWhitespace=function(e){return e.replace(/\xa0|\s/g," ")},e.string.normalizeSpaces=function(e){return e.replace(/\xa0|[ \t]+/g," ")},e.string.collapseBreakingSpaces=function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},e.string.trim=function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},e.string.trimLeft=function(e){return e.replace(/^[\s\xa0]+/,"")},e.string.trimRight=function(e){return e.replace(/[\s\xa0]+$/,"")},e.string.caseInsensitiveCompare=function(e,t){var o=String(e).toLowerCase(),i=String(t).toLowerCase();return i>o?-1:o==i?0:1},e.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,e.string.numerateCompare=function(t,o){if(t==o)return 0;if(!t)return-1;if(!o)return 1;for(var i=t.toLowerCase().match(e.string.numerateCompareRegExp_),n=o.toLowerCase().match(e.string.numerateCompareRegExp_),s=Math.min(i.length,n.length),r=0;s>r;r++){var a=i[r],l=n[r];if(a!=l){var p=parseInt(a,10);if(!isNaN(p)){var b=parseInt(l,10);if(!isNaN(b)&&p-b)return p-b}return l>a?-1:1}}return i.length!=n.length?i.length-n.length:o>t?-1:1},e.string.urlEncode=function(e){return encodeURIComponent(String(e))},e.string.urlDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},e.string.newLineToBr=function(e,t){return e.replace(/(\r\n|\r|\n)/g,t?"<br />":"<br>")},e.string.htmlEscape=function(t,o){return o?t.replace(e.string.amperRe_,"&amp;").replace(e.string.ltRe_,"&lt;").replace(e.string.gtRe_,"&gt;").replace(e.string.quotRe_,"&quot;"):e.string.allRe_.test(t)?(-1!=t.indexOf("&")&&(t=t.replace(e.string.amperRe_,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(e.string.ltRe_,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(e.string.gtRe_,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(e.string.quotRe_,"&quot;")),t):t},e.string.amperRe_=/&/g,e.string.ltRe_=/</g,e.string.gtRe_=/>/g,e.string.quotRe_=/\"/g,e.string.allRe_=/[&<>\"]/,e.string.unescapeEntities=function(t){return e.string.contains(t,"&")?"document"in e.global?e.string.unescapeEntitiesUsingDom_(t):e.string.unescapePureXmlEntities_(t):t},e.string.unescapeEntitiesUsingDom_=function(t){var o={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},i=document.createElement("div");return t.replace(e.string.HTML_ENTITY_PATTERN_,function(e,t){var n=o[e];if(n)return n;if("#"==t.charAt(0)){var s=Number("0"+t.substr(1));isNaN(s)||(n=String.fromCharCode(s))}return n||(i.innerHTML=e+" ",n=i.firstChild.nodeValue.slice(0,-1)),o[e]=n})},e.string.unescapePureXmlEntities_=function(e){return e.replace(/&([^;]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==t.charAt(0)){var o=Number("0"+t.substr(1));if(!isNaN(o))return String.fromCharCode(o)}return e}})},e.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,e.string.whitespaceEscape=function(t,o){return e.string.newLineToBr(t.replace(/  /g," &#160;"),o)},e.string.stripQuotes=function(e,t){for(var o=t.length,i=0;o>i;i++){var n=1==o?t:t.charAt(i);if(e.charAt(0)==n&&e.charAt(e.length-1)==n)return e.substring(1,e.length-1)}return e},e.string.truncate=function(t,o,i){return i&&(t=e.string.unescapeEntities(t)),t.length>o&&(t=t.substring(0,o-3)+"..."),i&&(t=e.string.htmlEscape(t)),t},e.string.truncateMiddle=function(t,o,i,n){if(i&&(t=e.string.unescapeEntities(t)),n&&t.length>o){n>o&&(n=o);var s=t.length-n,r=o-n;t=t.substring(0,r)+"..."+t.substring(s)}else if(t.length>o){var a=Math.floor(o/2),l=t.length-a;a+=o%2,t=t.substring(0,a)+"..."+t.substring(l)}return i&&(t=e.string.htmlEscape(t)),t},e.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},e.string.jsEscapeCache_={"'":"\\'"},e.string.quote=function(t){if(t=String(t),t.quote)return t.quote();for(var o=['"'],i=0;i<t.length;i++){var n=t.charAt(i),s=n.charCodeAt(0);o[i+1]=e.string.specialEscapeChars_[n]||(s>31&&127>s?n:e.string.escapeChar(n))}return o.push('"'),o.join("")},e.string.escapeString=function(t){for(var o=[],i=0;i<t.length;i++)o[i]=e.string.escapeChar(t.charAt(i));return o.join("")},e.string.escapeChar=function(t){if(t in e.string.jsEscapeCache_)return e.string.jsEscapeCache_[t];if(t in e.string.specialEscapeChars_)return e.string.jsEscapeCache_[t]=e.string.specialEscapeChars_[t];var o=t,i=t.charCodeAt(0);return i>31&&127>i?o=t:(256>i?(o="\\x",(16>i||i>256)&&(o+="0")):(o="\\u",4096>i&&(o+="0")),o+=i.toString(16).toUpperCase()),e.string.jsEscapeCache_[t]=o
},e.string.toMap=function(e){for(var t={},o=0;o<e.length;o++)t[e.charAt(o)]=!0;return t},e.string.contains=function(e,t){return-1!=e.indexOf(t)},e.string.countOf=function(e,t){return e&&t?e.split(t).length-1:0},e.string.removeAt=function(e,t,o){var i=e;return t>=0&&t<e.length&&o>0&&(i=e.substr(0,t)+e.substr(t+o,e.length-t-o)),i},e.string.remove=function(t,o){var i=new RegExp(e.string.regExpEscape(o),"");return t.replace(i,"")},e.string.removeAll=function(t,o){var i=new RegExp(e.string.regExpEscape(o),"g");return t.replace(i,"")},e.string.regExpEscape=function(e){return String(e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},e.string.repeat=function(e,t){return new Array(t+1).join(e)},e.string.padNumber=function(t,o,i){var n=e.isDef(i)?t.toFixed(i):String(t),s=n.indexOf(".");return-1==s&&(s=n.length),e.string.repeat("0",Math.max(0,o-s))+n},e.string.makeSafe=function(e){return null==e?"":String(e)},e.string.buildString=function(){return Array.prototype.join.call(arguments,"")},e.string.getRandomString=function(){var t=2147483648;return Math.floor(Math.random()*t).toString(36)+Math.abs(Math.floor(Math.random()*t)^e.now()).toString(36)},e.string.compareVersions=function(t,o){for(var i=0,n=e.string.trim(String(t)).split("."),s=e.string.trim(String(o)).split("."),r=Math.max(n.length,s.length),a=0;0==i&&r>a;a++){var l=n[a]||"",p=s[a]||"",b=new RegExp("(\\d*)(\\D*)","g"),m=new RegExp("(\\d*)(\\D*)","g");do{var _=b.exec(l)||["","",""],d=m.exec(p)||["","",""];if(0==_[0].length&&0==d[0].length)break;var h=0==_[1].length?0:parseInt(_[1],10),c=0==d[1].length?0:parseInt(d[1],10);i=e.string.compareElements_(h,c)||e.string.compareElements_(0==_[2].length,0==d[2].length)||e.string.compareElements_(_[2],d[2])}while(0==i)}return i},e.string.compareElements_=function(e,t){return t>e?-1:e>t?1:0},e.string.HASHCODE_MAX_=4294967296,e.string.hashCode=function(t){for(var o=0,i=0;i<t.length;++i)o=31*o+t.charCodeAt(i),o%=e.string.HASHCODE_MAX_;return o},e.string.uniqueStringCounter_=2147483648*Math.random()|0,e.string.createUniqueString=function(){return"goog_"+e.string.uniqueStringCounter_++},e.string.toNumber=function(t){var o=Number(t);return 0==o&&e.string.isEmpty(t)?0/0:o},e.string.isLowerCamelCase=function(e){return/^[a-z]+([A-Z][a-z]*)*$/.test(e)},e.string.isUpperCamelCase=function(e){return/^([A-Z][a-z]*)+$/.test(e)},e.string.toCamelCase=function(e){return String(e).replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})},e.string.toSelectorCase=function(e){return String(e).replace(/([A-Z])/g,"-$1").toLowerCase()},e.string.toTitleCase=function(t,o){var i=e.isString(o)?e.string.regExpEscape(o):"\\s";i=i?"|["+i+"]+":"";var n=new RegExp("(^"+i+")([a-z])","g");return t.replace(n,function(e,t,o){return t+o.toUpperCase()})},e.string.parseInt=function(t){return isFinite(t)&&(t=String(t)),e.isString(t)?/^\s*-?0x/i.test(t)?parseInt(t,16):parseInt(t,10):0/0},e.string.splitLimit=function(e,t,o){for(var i=e.split(t),n=[];o>0&&i.length;)n.push(i.shift()),o--;return i.length&&n.push(i.join(t)),n},e}(o),at=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.string&&(e.string={}),"undefined"==typeof e.string.format&&(e.string.format={}),e.string.format=function(){function t(t,i,n,s,r,a){if("%"==a)return"%";var l=o.shift();if("undefined"==typeof l)throw Error("[goog.string.format] Not enough arguments");return arguments[0]=l,e.string.format.demuxes_[a].apply(null,arguments)}var o=Array.prototype.slice.call(arguments),i=o.shift();if("undefined"==typeof i)throw Error("[goog.string.format] Template required");var n=/%([0\-\ \+]*)(\d+)?(\.(\d+))?([%sfdiu])/g;return i.replace(n,t)},e.string.format.demuxes_={},e.string.format.demuxes_.s=function(t,o,i){var n=t;return isNaN(i)||""==i||n.length>=i?n:(o.indexOf("-",0)>-1?n+=e.string.repeat(" ",i-n.length):n=e.string.repeat(" ",i-n.length)+n,n)},e.string.format.demuxes_.f=function(t,o,i,n,s){var r=t.toString();isNaN(s)||""==s||(r=t.toFixed(s));var a;if(a=0>t?"-":o.indexOf("+")>=0?"+":o.indexOf(" ")>=0?" ":"",t>=0&&(r=a+r),isNaN(i)||r.length>=i)return r;r=isNaN(s)?Math.abs(t).toString():Math.abs(t).toFixed(s);var l=i-r.length-a.length;if(o.indexOf("-",0)>=0)r=a+r+e.string.repeat(" ",l);else{var p=o.indexOf("0",0)>=0?"0":" ";r=a+e.string.repeat(p,l)+r}return r},e.string.format.demuxes_.d=function(t,o,i,n,s,r,a,l){return e.string.format.demuxes_.f(parseInt(t,10),o,i,n,0,r,a,l)},e.string.format.demuxes_.i=e.string.format.demuxes_.d,e.string.format.demuxes_.u=e.string.format.demuxes_.d,e}(rt),lt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Render&&(t.Testbed.Render={}),t.Testbed.DebugDraw=function(t,o){e.base(this),this.m_canvas=t,this.m_ctx=this.m_canvas.getContext("2d"),this.m_settings=o},e.inherits(t.Testbed.DebugDraw,t.b2Draw),t.Testbed.DebugDraw.prototype.m_canvas=null,t.Testbed.DebugDraw.prototype.m_ctx=null,t.Testbed.DebugDraw.prototype.m_settings=null,t.Testbed.DebugDraw.prototype.PushTransform=function(e){var t=this.m_ctx;t.save(),t.translate(e.p.x,e.p.y),t.rotate(e.q.GetAngleRadians())},t.Testbed.DebugDraw.prototype.PopTransform=function(){var e=this.m_ctx;e.restore()},t.Testbed.DebugDraw.prototype.DrawPolygon=function(e,t,o){if(t){var i=this.m_ctx;i.beginPath(),i.moveTo(e[0].x,e[0].y);for(var n=1;t>n;n++)i.lineTo(e[n].x,e[n].y);i.closePath(),i.strokeStyle=o.MakeStyleString(1),i.stroke()}},t.Testbed.DebugDraw.prototype.DrawSolidPolygon=function(e,t,o){if(t){var i=this.m_ctx;i.beginPath(),i.moveTo(e[0].x,e[0].y);for(var n=1;t>n;n++)i.lineTo(e[n].x,e[n].y);i.closePath(),i.fillStyle=o.MakeStyleString(.5),i.fill(),i.strokeStyle=o.MakeStyleString(1),i.stroke()}},t.Testbed.DebugDraw.prototype.DrawCircle=function(e,o,i){if(o){var n=this.m_ctx;n.beginPath(),n.arc(e.x,e.y,o,0,2*t.b2_pi,!0),n.strokeStyle=i.MakeStyleString(1),n.stroke()}},t.Testbed.DebugDraw.prototype.DrawSolidCircle=function(e,o,i,n){if(o){var s=this.m_ctx,r=e.x,a=e.y;s.beginPath(),s.arc(r,a,o,0,2*t.b2_pi,!0),s.moveTo(r,a),s.lineTo(r+i.x*o,a+i.y*o),s.fillStyle=n.MakeStyleString(.5),s.fill(),s.strokeStyle=n.MakeStyleString(1),s.stroke()}},t.Testbed.DebugDraw.prototype.DrawSegment=function(e,t,o){var i=this.m_ctx;i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.strokeStyle=o.MakeStyleString(1),i.stroke()},t.Testbed.DebugDraw.prototype.DrawTransform=function(e){var o=this.m_ctx;this.PushTransform(e),o.beginPath(),o.moveTo(0,0),o.lineTo(1,0),o.strokeStyle=t.b2Color.RED.MakeStyleString(1),o.stroke(),o.beginPath(),o.moveTo(0,0),o.lineTo(0,1),o.strokeStyle=t.b2Color.GREEN.MakeStyleString(1),o.stroke(),this.PopTransform(e)},t.Testbed.DebugDraw.prototype.DrawPoint=function(e,t,o){var i=this.m_ctx;i.fillStyle=o.MakeStyleString(),t/=this.m_settings.viewZoom,t/=this.m_settings.canvasScale;var n=t/2;i.fillRect(e.x-n,e.y-n,t,t)},t.Testbed.DebugDraw.prototype.DrawString=function(o,i){var n=this.m_ctx,s=Array.prototype.slice.call(arguments),r=e.string.format.apply(null,s.slice(2));n.save(),n.setTransform(1,0,0,1,0,0),n.font="18pt helvetica";var a=t.Testbed.DebugDraw.prototype.DrawString.s_color;n.fillStyle=a.MakeStyleString(),n.fillText(r,o,i),n.restore()},t.Testbed.DebugDraw.prototype.DrawString.s_color=new t.b2Color(.9,.6,.6),t.Testbed.DebugDraw.prototype.DrawStringWorld=function(o,i){var n=t.Testbed.DebugDraw.prototype.DrawStringWorld.s_p.Set(o,i),s=this.m_settings.viewCenter;t.b2SubVV(n,s,n);var r=this.m_settings.viewRotation;t.b2MulTRV(r,n,n);var a=this.m_settings.viewZoom;t.b2MulSV(a,n,n);var l=this.m_settings.canvasScale;t.b2MulSV(l,n,n),n.y*=-1;var p=t.Testbed.DebugDraw.prototype.DrawStringWorld.s_cc.Set(.5*this.m_canvas.width,.5*this.m_canvas.height);t.b2AddVV(n,p,n);var b=this.m_ctx,m=Array.prototype.slice.call(arguments),_=e.string.format.apply(null,m.slice(2));b.save(),b.setTransform(1,0,0,1,0,0),b.font="18pt helvetica";var d=t.Testbed.DebugDraw.prototype.DrawStringWorld.s_color;b.fillStyle=d.MakeStyleString(),b.fillText(_,n.x,n.y),b.restore()},t.Testbed.DebugDraw.prototype.DrawStringWorld.s_p=new t.b2Vec2,t.Testbed.DebugDraw.prototype.DrawStringWorld.s_cc=new t.b2Vec2,t.Testbed.DebugDraw.prototype.DrawStringWorld.s_color=new t.b2Color(.5,.9,.5),t.Testbed.DebugDraw.prototype.DrawAABB=function(e,t){var o=this.m_ctx;o.strokeStyle=t.MakeStyleString();var i=e.lowerBound.x,n=e.lowerBound.y,s=e.upperBound.x-e.lowerBound.x,r=e.upperBound.y-e.lowerBound.y;o.strokeRect(i,n,s,r)},t}(o,st,at),pt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Test&&(t.Testbed.Test={}),t.Testbed.DRAW_STRING_NEW_LINE=25,t.Testbed.Settings=function(){this.viewCenter=new t.b2Vec2(0,20),this.viewRotation=new t.b2Rot(t.b2DegToRad(0))},t.Testbed.Settings.prototype.canvasScale=10,t.Testbed.Settings.prototype.viewZoom=1,t.Testbed.Settings.prototype.viewCenter=null,t.Testbed.Settings.prototype.viewRotation=null,t.Testbed.Settings.prototype.hz=60,t.Testbed.Settings.prototype.velocityIterations=8,t.Testbed.Settings.prototype.positionIterations=3,t.Testbed.Settings.prototype.drawShapes=!0,t.Testbed.Settings.prototype.drawJoints=!0,t.Testbed.Settings.prototype.drawAABBs=!1,t.Testbed.Settings.prototype.drawContactPoints=!1,t.Testbed.Settings.prototype.drawContactNormals=!1,t.Testbed.Settings.prototype.drawContactImpulse=!1,t.Testbed.Settings.prototype.drawFrictionImpulse=!1,t.Testbed.Settings.prototype.drawCOMs=!1,t.Testbed.Settings.prototype.drawControllers=!0,t.Testbed.Settings.prototype.drawStats=!1,t.Testbed.Settings.prototype.drawProfile=!1,t.Testbed.Settings.prototype.enableWarmStarting=!0,t.Testbed.Settings.prototype.enableContinuous=!0,t.Testbed.Settings.prototype.enableSubStepping=!1,t.Testbed.Settings.prototype.enableSleep=!0,t.Testbed.Settings.prototype.pause=!1,t.Testbed.Settings.prototype.singleStep=!1,t.Testbed.TestEntry=function(e,t){this.name=e,this.createFcn=t},t.Testbed.TestEntry.prototype.name="unknown",t.Testbed.TestEntry.prototype.createFcn=function(){},t.Testbed.DestructionListener=function(t){e.base(this),this.test=t},e.inherits(t.Testbed.DestructionListener,t.b2DestructionListener),t.Testbed.DestructionListener.prototype.test=null,t.Testbed.DestructionListener.prototype.SayGoodbyeJoint=function(e){this.test.m_mouseJoint==e?this.test.m_mouseJoint=null:this.test.JointDestroyed(e)},t.Testbed.DestructionListener.prototype.SayGoodbyeFixture=function(){},t.Testbed.ContactPoint=function(){this.normal=new t.b2Vec2,this.position=new t.b2Vec2},t.Testbed.ContactPoint.prototype.fixtureA=null,t.Testbed.ContactPoint.prototype.fixtureB=null,t.Testbed.ContactPoint.prototype.normal=new t.b2Vec2,t.Testbed.ContactPoint.prototype.position=new t.b2Vec2,t.Testbed.ContactPoint.prototype.state=t.b2PointState.b2_nullState,t.Testbed.ContactPoint.prototype.normalImpulse=0,t.Testbed.ContactPoint.prototype.tangentImpulse=0,t.Testbed.ContactPoint.prototype.separation=0,t.Testbed.Test=function(o,i){e.base(this);var n=new t.b2Vec2(0,-10);this.m_world=new t.b2World(n),this.m_bomb=null,this.m_textLine=30,this.m_mouseJoint=null,this.m_points=new Array(t.Testbed.Test.k_maxContactPoints);for(var s=0;s<t.Testbed.Test.k_maxContactPoints;++s)this.m_points[s]=new t.Testbed.ContactPoint;this.m_pointCount=0,this.m_destructionListener=new t.Testbed.DestructionListener(this),this.m_world.SetDestructionListener(this.m_destructionListener),this.m_world.SetContactListener(this),this.m_debugDraw=new t.Testbed.DebugDraw(o,i),this.m_world.SetDebugDraw(this.m_debugDraw),this.m_bombSpawnPoint=new t.b2Vec2,this.m_bombSpawning=!1,this.m_mouseWorld=new t.b2Vec2,this.m_stepCount=0,this.m_maxProfile=new t.b2Profile,this.m_totalProfile=new t.b2Profile;var r=new t.b2BodyDef;this.m_groundBody=this.m_world.CreateBody(r)},e.inherits(t.Testbed.Test,t.b2ContactListener),t.Testbed.Test.k_maxContactPoints=2048,t.Testbed.Test.prototype.m_world=null,t.Testbed.Test.prototype.m_bomb=null,t.Testbed.Test.prototype.m_textLine=30,t.Testbed.Test.prototype.m_mouseJoint=null,t.Testbed.Test.prototype.m_points=null,t.Testbed.Test.prototype.m_pointCount=0,t.Testbed.Test.prototype.m_destructionListener=null,t.Testbed.Test.prototype.m_debugDraw=null,t.Testbed.Test.prototype.m_bombSpawnPoint=null,t.Testbed.Test.prototype.m_bombSpawning=!1,t.Testbed.Test.prototype.m_mouseWorld=null,t.Testbed.Test.prototype.m_stepCount=0,t.Testbed.Test.prototype.m_maxProfile=null,t.Testbed.Test.prototype.m_totalProfile=null,t.Testbed.Test.prototype.m_groundBody=null,t.Testbed.Test.prototype.JointDestroyed=function(){},t.Testbed.Test.prototype.BeginContact=function(){},t.Testbed.Test.prototype.EndContact=function(){},t.Testbed.Test.prototype.PreSolve=function(e,o){var i=e.GetManifold();if(0!=i.pointCount){var n=e.GetFixtureA(),s=e.GetFixtureB(),r=t.Testbed.Test.prototype.PreSolve.s_state1,a=t.Testbed.Test.prototype.PreSolve.s_state2;t.b2GetPointStates(r,a,o,i);var l=t.Testbed.Test.prototype.PreSolve.s_worldManifold;e.GetWorldManifold(l);for(var p=0;p<i.pointCount&&this.m_pointCount<t.Testbed.Test.k_maxContactPoints;++p){var b=this.m_points[this.m_pointCount];b.fixtureA=n,b.fixtureB=s,b.position.Copy(l.points[p]),b.normal.Copy(l.normal),b.state=a[p],b.normalImpulse=i.points[p].normalImpulse,b.tangentImpulse=i.points[p].tangentImpulse,b.separation=l.separations[p],++this.m_pointCount}}},t.Testbed.Test.prototype.PreSolve.s_state1=new Array(t.b2_maxManifoldPoints),t.Testbed.Test.prototype.PreSolve.s_state2=new Array(t.b2_maxManifoldPoints),t.Testbed.Test.prototype.PreSolve.s_worldManifold=new t.b2WorldManifold,t.Testbed.Test.prototype.PostSolve=function(){},t.Testbed.Test.prototype.Keyboard=function(){},t.Testbed.Test.prototype.KeyboardUp=function(){},t.Testbed.Test.prototype.SetTextLine=function(e){this.m_textLine=e},t.Testbed.Test.prototype.DrawTitle=function(e){this.m_debugDraw.DrawString(5,t.Testbed.DRAW_STRING_NEW_LINE,e),this.m_textLine=2*t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Test.prototype.MouseDown=function(e){if(this.m_mouseWorld.Copy(e),null===this.m_mouseJoint){var o=new t.b2AABB,i=new t.b2Vec2;i.Set(.001,.001),t.b2SubVV(e,i,o.lowerBound),t.b2AddVV(e,i,o.upperBound);var n=this,s=null,r=function(e){var o=e.GetBody();if(o.GetType()==t.b2BodyType.b2_dynamicBody){var i=e.TestPoint(n.m_mouseWorld);if(i)return s=e,!1}return!0};if(this.m_world.QueryAABB(r,o),s){var a=s.GetBody(),l=new t.b2MouseJointDef;l.bodyA=this.m_groundBody,l.bodyB=a,l.target.Copy(e),l.maxForce=1e3*a.GetMass(),this.m_mouseJoint=this.m_world.CreateJoint(l),a.SetAwake(!0)}}},t.Testbed.Test.prototype.SpawnBomb=function(e){this.m_bombSpawnPoint.Copy(e),this.m_bombSpawning=!0},t.Testbed.Test.prototype.CompleteBombSpawn=function(e){if(0!=this.m_bombSpawning){var o=30,i=t.b2SubVV(this.m_bombSpawnPoint,e,new t.b2Vec2);i.SelfMul(o),this.LaunchBombAt(this.m_bombSpawnPoint,i),this.m_bombSpawning=!1}},t.Testbed.Test.prototype.ShiftMouseDown=function(e){this.m_mouseWorld.Copy(e),null==this.m_mouseJoint&&this.SpawnBomb(e)},t.Testbed.Test.prototype.MouseUp=function(e){this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null),this.m_bombSpawning&&this.CompleteBombSpawn(e)},t.Testbed.Test.prototype.MouseMove=function(e){this.m_mouseWorld.Copy(e),this.m_mouseJoint&&this.m_mouseJoint.SetTarget(e)},t.Testbed.Test.prototype.LaunchBomb=function(){var e=new t.b2Vec2(t.b2RandomRange(-15,15),30),o=t.b2MulSV(-5,e,new t.b2Vec2);this.LaunchBombAt(e,o)},t.Testbed.Test.prototype.LaunchBombAt=function(e,o){this.m_bomb&&(this.m_world.DestroyBody(this.m_bomb),this.m_bomb=null);var i=new t.b2BodyDef;i.type=t.b2BodyType.b2_dynamicBody,i.position.Copy(e),i.bullet=!0,this.m_bomb=this.m_world.CreateBody(i),this.m_bomb.SetLinearVelocity(o);var n=new t.b2CircleShape;n.m_radius=.3;var s=new t.b2FixtureDef;s.shape=n,s.density=20,s.restitution=0,this.m_bomb.CreateFixture(s)},t.Testbed.Test.prototype.Step=function(e){var o=e.hz>0?1/e.hz:0;e.pause&&(e.singleStep?e.singleStep=!1:o=0,this.m_debugDraw.DrawString(5,this.m_textLine,"****PAUSED****"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE);var i=t.b2DrawFlags.e_none;if(e.drawShapes&&(i|=t.b2DrawFlags.e_shapeBit),e.drawJoints&&(i|=t.b2DrawFlags.e_jointBit),e.drawAABBs&&(i|=t.b2DrawFlags.e_aabbBit),e.drawCOMs&&(i|=t.b2DrawFlags.e_centerOfMassBit),e.drawControllers&&(i|=t.b2DrawFlags.e_controllerBit),this.m_debugDraw.SetFlags(i),this.m_world.SetAllowSleeping(e.enableSleep),this.m_world.SetWarmStarting(e.enableWarmStarting),this.m_world.SetContinuousPhysics(e.enableContinuous),this.m_world.SetSubStepping(e.enableSubStepping),this.m_pointCount=0,this.m_world.Step(o,e.velocityIterations,e.positionIterations),this.m_world.DrawDebugData(),o>0&&++this.m_stepCount,e.drawStats){var n=this.m_world.GetBodyCount(),s=this.m_world.GetContactCount(),r=this.m_world.GetJointCount();this.m_debugDraw.DrawString(5,this.m_textLine,"bodies/contacts/joints = %d/%d/%d",n,s,r),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;var a=this.m_world.GetProxyCount(),l=this.m_world.GetTreeHeight(),p=this.m_world.GetTreeBalance(),b=this.m_world.GetTreeQuality();this.m_debugDraw.DrawString(5,this.m_textLine,"proxies/height/balance/quality = %d/%d/%d/%4.2f",a,l,p,b),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE}var m=this.m_world.GetProfile();if(this.m_maxProfile.step=t.b2Max(this.m_maxProfile.step,m.step),this.m_maxProfile.collide=t.b2Max(this.m_maxProfile.collide,m.collide),this.m_maxProfile.solve=t.b2Max(this.m_maxProfile.solve,m.solve),this.m_maxProfile.solveInit=t.b2Max(this.m_maxProfile.solveInit,m.solveInit),this.m_maxProfile.solveVelocity=t.b2Max(this.m_maxProfile.solveVelocity,m.solveVelocity),this.m_maxProfile.solvePosition=t.b2Max(this.m_maxProfile.solvePosition,m.solvePosition),this.m_maxProfile.solveTOI=t.b2Max(this.m_maxProfile.solveTOI,m.solveTOI),this.m_maxProfile.broadphase=t.b2Max(this.m_maxProfile.broadphase,m.broadphase),this.m_totalProfile.step+=m.step,this.m_totalProfile.collide+=m.collide,this.m_totalProfile.solve+=m.solve,this.m_totalProfile.solveInit+=m.solveInit,this.m_totalProfile.solveVelocity+=m.solveVelocity,this.m_totalProfile.solvePosition+=m.solvePosition,this.m_totalProfile.solveTOI+=m.solveTOI,this.m_totalProfile.broadphase+=m.broadphase,e.drawProfile){var m=this.m_world.GetProfile(),_=new t.b2Profile;if(this.m_stepCount>0){var d=1/this.m_stepCount;_.step=d*this.m_totalProfile.step,_.collide=d*this.m_totalProfile.collide,_.solve=d*this.m_totalProfile.solve,_.solveInit=d*this.m_totalProfile.solveInit,_.solveVelocity=d*this.m_totalProfile.solveVelocity,_.solvePosition=d*this.m_totalProfile.solvePosition,_.solveTOI=d*this.m_totalProfile.solveTOI,_.broadphase=d*this.m_totalProfile.broadphase}this.m_debugDraw.DrawString(5,this.m_textLine,"step [ave] (max) = %5.2f [%6.2f] (%6.2f)",m.step,_.step,this.m_maxProfile.step),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"collide [ave] (max) = %5.2f [%6.2f] (%6.2f)",m.collide,_.collide,this.m_maxProfile.collide),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"solve [ave] (max) = %5.2f [%6.2f] (%6.2f)",m.solve,_.solve,this.m_maxProfile.solve),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"solve init [ave] (max) = %5.2f [%6.2f] (%6.2f)",m.solveInit,_.solveInit,this.m_maxProfile.solveInit),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"solve velocity [ave] (max) = %5.2f [%6.2f] (%6.2f)",m.solveVelocity,_.solveVelocity,this.m_maxProfile.solveVelocity),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"solve position [ave] (max) = %5.2f [%6.2f] (%6.2f)",m.solvePosition,_.solvePosition,this.m_maxProfile.solvePosition),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"solveTOI [ave] (max) = %5.2f [%6.2f] (%6.2f)",m.solveTOI,_.solveTOI,this.m_maxProfile.solveTOI),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"broad-phase [ave] (max) = %5.2f [%6.2f] (%6.2f)",m.broadphase,_.broadphase,this.m_maxProfile.broadphase),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE}if(this.m_mouseJoint){var h=this.m_mouseJoint.GetAnchorB(new t.b2Vec2),c=this.m_mouseJoint.GetTarget(new t.b2Vec2),u=new t.b2Color(0,1,0);this.m_debugDraw.DrawPoint(h,4,u),this.m_debugDraw.DrawPoint(c,4,u),u.SetRGB(.8,.8,.8),this.m_debugDraw.DrawSegment(h,c,u)}if(this.m_bombSpawning){var u=new t.b2Color(0,0,1);this.m_debugDraw.DrawPoint(this.m_bombSpawnPoint,4,u),u.SetRGB(.8,.8,.8),this.m_debugDraw.DrawSegment(this.m_mouseWorld,this.m_bombSpawnPoint,u)}if(e.drawContactPoints)for(var y=.1,f=.3,S=0;S<this.m_pointCount;++S){var C=this.m_points[S];if(C.state==t.b2PointState.b2_addState?this.m_debugDraw.DrawPoint(C.position,10,new t.b2Color(.3,.95,.3)):C.state==t.b2PointState.b2_persistState&&this.m_debugDraw.DrawPoint(C.position,5,new t.b2Color(.3,.3,.95)),1==e.drawContactNormals){var h=C.position,c=t.b2AddVV(h,t.b2MulSV(f,C.normal,t.b2Vec2.s_t0),new t.b2Vec2);this.m_debugDraw.DrawSegment(h,c,new t.b2Color(.9,.9,.9))}else if(1==e.drawContactImpulse){var h=C.position,c=t.b2AddVMulSV(h,y*C.normalImpulse,C.normal,new t.b2Vec2);this.m_debugDraw.DrawSegment(h,c,new t.b2Color(.9,.9,.3))}if(1==e.drawFrictionImpulse){var v=t.b2CrossVOne(C.normal,new t.b2Vec2),h=C.position,c=t.b2AddVMulSV(h,y*C.tangentImpulse,v,new t.b2Vec2);this.m_debugDraw.DrawSegment(h,c,new t.b2Color(.9,.9,.3))}}},t.Testbed.Test.prototype.ShiftOrigin=function(e){this.m_world.ShiftOrigin(e)},t}(o,st,lt),bt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.AddPair&&(t.Testbed.AddPair={}),t.Testbed.AddPair=function(o,i){e.base(this,o,i),this.m_world.SetGravity(new t.b2Vec2(0,0));var n=new t.b2CircleShape;n.m_p.SetZero(),n.m_radius=.1;for(var s=-6,r=0,a=4,l=6,p=0;400>p;++p){var b=new t.b2BodyDef;b.type=t.b2BodyType.b2_dynamicBody,b.position=new t.b2Vec2(t.b2RandomRange(s,r),t.b2RandomRange(a,l));var m=this.m_world.CreateBody(b);m.CreateFixture2(n,.01)}var n=new t.b2PolygonShape;n.SetAsBox(1.5,1.5);var b=new t.b2BodyDef;b.type=t.b2BodyType.b2_dynamicBody,b.position.Set(-40,5),b.bullet=!0;var m=this.m_world.CreateBody(b);m.CreateFixture2(n,1),m.SetLinearVelocity(new t.b2Vec2(150,0))},e.inherits(t.Testbed.AddPair,t.Testbed.Test),t.Testbed.AddPair.Create=function(e,o){return new t.Testbed.AddPair(e,o)},t}(o,pt),mt=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.userAgent&&(e.userAgent={}),e.define("goog.userAgent.ASSUME_IE",!1),e.define("goog.userAgent.ASSUME_GECKO",!1),e.define("goog.userAgent.ASSUME_WEBKIT",!1),e.define("goog.userAgent.ASSUME_MOBILE_WEBKIT",!1),e.define("goog.userAgent.ASSUME_OPERA",!1),e.define("goog.userAgent.ASSUME_ANY_VERSION",!1),e.userAgent.BROWSER_KNOWN_=e.userAgent.ASSUME_IE||e.userAgent.ASSUME_GECKO||e.userAgent.ASSUME_MOBILE_WEBKIT||e.userAgent.ASSUME_WEBKIT||e.userAgent.ASSUME_OPERA,e.userAgent.getUserAgentString=function(){return e.global.navigator?e.global.navigator.userAgent:null},e.userAgent.getNavigator=function(){return e.global.navigator},e.userAgent.init_=function(){e.userAgent.detectedOpera_=!1,e.userAgent.detectedIe_=!1,e.userAgent.detectedWebkit_=!1,e.userAgent.detectedMobile_=!1,e.userAgent.detectedGecko_=!1;var t;if(!e.userAgent.BROWSER_KNOWN_&&(t=e.userAgent.getUserAgentString())){var o=e.userAgent.getNavigator();e.userAgent.detectedOpera_=e.string.startsWith(t,"Opera"),e.userAgent.detectedIe_=!e.userAgent.detectedOpera_&&(e.string.contains(t,"MSIE")||e.string.contains(t,"Trident")),e.userAgent.detectedWebkit_=!e.userAgent.detectedOpera_&&e.string.contains(t,"WebKit"),e.userAgent.detectedMobile_=e.userAgent.detectedWebkit_&&e.string.contains(t,"Mobile"),e.userAgent.detectedGecko_=!e.userAgent.detectedOpera_&&!e.userAgent.detectedWebkit_&&!e.userAgent.detectedIe_&&"Gecko"==o.product}},e.userAgent.BROWSER_KNOWN_||e.userAgent.init_(),e.userAgent.OPERA=e.userAgent.BROWSER_KNOWN_?e.userAgent.ASSUME_OPERA:e.userAgent.detectedOpera_,e.userAgent.IE=e.userAgent.BROWSER_KNOWN_?e.userAgent.ASSUME_IE:e.userAgent.detectedIe_,e.userAgent.GECKO=e.userAgent.BROWSER_KNOWN_?e.userAgent.ASSUME_GECKO:e.userAgent.detectedGecko_,e.userAgent.WEBKIT=e.userAgent.BROWSER_KNOWN_?e.userAgent.ASSUME_WEBKIT||e.userAgent.ASSUME_MOBILE_WEBKIT:e.userAgent.detectedWebkit_,e.userAgent.MOBILE=e.userAgent.ASSUME_MOBILE_WEBKIT||e.userAgent.detectedMobile_,e.userAgent.SAFARI=e.userAgent.WEBKIT,e.userAgent.determinePlatform_=function(){var t=e.userAgent.getNavigator();return t&&t.platform||""},e.userAgent.PLATFORM=e.userAgent.determinePlatform_(),e.define("goog.userAgent.ASSUME_MAC",!1),e.define("goog.userAgent.ASSUME_WINDOWS",!1),e.define("goog.userAgent.ASSUME_LINUX",!1),e.define("goog.userAgent.ASSUME_X11",!1),e.define("goog.userAgent.ASSUME_ANDROID",!1),e.define("goog.userAgent.ASSUME_IPHONE",!1),e.define("goog.userAgent.ASSUME_IPAD",!1),e.userAgent.PLATFORM_KNOWN_=e.userAgent.ASSUME_MAC||e.userAgent.ASSUME_WINDOWS||e.userAgent.ASSUME_LINUX||e.userAgent.ASSUME_X11||e.userAgent.ASSUME_ANDROID||e.userAgent.ASSUME_IPHONE||e.userAgent.ASSUME_IPAD,e.userAgent.initPlatform_=function(){e.userAgent.detectedMac_=e.string.contains(e.userAgent.PLATFORM,"Mac"),e.userAgent.detectedWindows_=e.string.contains(e.userAgent.PLATFORM,"Win"),e.userAgent.detectedLinux_=e.string.contains(e.userAgent.PLATFORM,"Linux"),e.userAgent.detectedX11_=!!e.userAgent.getNavigator()&&e.string.contains(e.userAgent.getNavigator().appVersion||"","X11");var t=e.userAgent.getUserAgentString();e.userAgent.detectedAndroid_=!!t&&e.string.contains(t,"Android"),e.userAgent.detectedIPhone_=!!t&&e.string.contains(t,"iPhone"),e.userAgent.detectedIPad_=!!t&&e.string.contains(t,"iPad")},e.userAgent.PLATFORM_KNOWN_||e.userAgent.initPlatform_(),e.userAgent.MAC=e.userAgent.PLATFORM_KNOWN_?e.userAgent.ASSUME_MAC:e.userAgent.detectedMac_,e.userAgent.WINDOWS=e.userAgent.PLATFORM_KNOWN_?e.userAgent.ASSUME_WINDOWS:e.userAgent.detectedWindows_,e.userAgent.LINUX=e.userAgent.PLATFORM_KNOWN_?e.userAgent.ASSUME_LINUX:e.userAgent.detectedLinux_,e.userAgent.X11=e.userAgent.PLATFORM_KNOWN_?e.userAgent.ASSUME_X11:e.userAgent.detectedX11_,e.userAgent.ANDROID=e.userAgent.PLATFORM_KNOWN_?e.userAgent.ASSUME_ANDROID:e.userAgent.detectedAndroid_,e.userAgent.IPHONE=e.userAgent.PLATFORM_KNOWN_?e.userAgent.ASSUME_IPHONE:e.userAgent.detectedIPhone_,e.userAgent.IPAD=e.userAgent.PLATFORM_KNOWN_?e.userAgent.ASSUME_IPAD:e.userAgent.detectedIPad_,e.userAgent.determineVersion_=function(){var t,o="";if(e.userAgent.OPERA&&e.global.opera){var i=e.global.opera.version;o="function"==typeof i?i():i}else if(e.userAgent.GECKO?t=/rv\:([^\);]+)(\)|;)/:e.userAgent.IE?t=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:e.userAgent.WEBKIT&&(t=/WebKit\/(\S+)/),t){var n=t.exec(e.userAgent.getUserAgentString());o=n?n[1]:""}if(e.userAgent.IE){var s=e.userAgent.getDocumentMode_();if(s>parseFloat(o))return String(s)}return o},e.userAgent.getDocumentMode_=function(){var t=e.global.document;return t?t.documentMode:void 0},e.userAgent.VERSION=e.userAgent.determineVersion_(),e.userAgent.compare=function(t,o){return e.string.compareVersions(t,o)},e.userAgent.isVersionOrHigherCache_={},e.userAgent.isVersionOrHigher=function(t){return e.userAgent.ASSUME_ANY_VERSION||e.userAgent.isVersionOrHigherCache_[t]||(e.userAgent.isVersionOrHigherCache_[t]=e.string.compareVersions(e.userAgent.VERSION,t)>=0)},e.userAgent.isVersion=e.userAgent.isVersionOrHigher,e.userAgent.isDocumentModeOrHigher=function(t){return e.userAgent.IE&&e.userAgent.DOCUMENT_MODE>=t},e.userAgent.isDocumentMode=e.userAgent.isDocumentModeOrHigher,e.userAgent.DOCUMENT_MODE=function(){var t=e.global.document;if(!t||!e.userAgent.IE)return void 0;var o=e.userAgent.getDocumentMode_();return o||("CSS1Compat"==t.compatMode?parseInt(e.userAgent.VERSION,10):5)}(),e}(rt),_t=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.events&&(e.events={}),"undefined"==typeof e.events.KeyCodes&&(e.events.KeyCodes={}),e.events.KeyCodes={WIN_KEY_FF_LINUX:0,MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,FF_SEMICOLON:59,FF_EQUALS:61,FF_DASH:173,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,FIRST_MEDIA_KEY:166,LAST_MEDIA_KEY:183,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,TILDE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,MAC_WK_CMD_LEFT:91,MAC_WK_CMD_RIGHT:93,WIN_IME:229,PHANTOM:255},e.events.KeyCodes.isTextModifyingKeyEvent=function(t){if(t.altKey&&!t.ctrlKey||t.metaKey||t.keyCode>=e.events.KeyCodes.F1&&t.keyCode<=e.events.KeyCodes.F12)return!1;switch(t.keyCode){case e.events.KeyCodes.ALT:case e.events.KeyCodes.CAPS_LOCK:case e.events.KeyCodes.CONTEXT_MENU:case e.events.KeyCodes.CTRL:case e.events.KeyCodes.DOWN:case e.events.KeyCodes.END:case e.events.KeyCodes.ESC:case e.events.KeyCodes.HOME:case e.events.KeyCodes.INSERT:case e.events.KeyCodes.LEFT:case e.events.KeyCodes.MAC_FF_META:case e.events.KeyCodes.META:case e.events.KeyCodes.NUMLOCK:case e.events.KeyCodes.NUM_CENTER:case e.events.KeyCodes.PAGE_DOWN:case e.events.KeyCodes.PAGE_UP:case e.events.KeyCodes.PAUSE:case e.events.KeyCodes.PHANTOM:case e.events.KeyCodes.PRINT_SCREEN:case e.events.KeyCodes.RIGHT:case e.events.KeyCodes.SCROLL_LOCK:case e.events.KeyCodes.SHIFT:case e.events.KeyCodes.UP:case e.events.KeyCodes.WIN_KEY:case e.events.KeyCodes.WIN_KEY_RIGHT:return!1;case e.events.KeyCodes.WIN_KEY_FF_LINUX:return!e.userAgent.GECKO;default:return t.keyCode<e.events.KeyCodes.FIRST_MEDIA_KEY||t.keyCode>e.events.KeyCodes.LAST_MEDIA_KEY}},e.events.KeyCodes.firesKeyPressEvent=function(t,o,i,n,s){if(!(e.userAgent.IE||e.userAgent.WEBKIT&&e.userAgent.isVersionOrHigher("525")))return!0;if(e.userAgent.MAC&&s)return e.events.KeyCodes.isCharacterKey(t);if(s&&!n)return!1;if(e.isNumber(o)&&(o=e.events.KeyCodes.normalizeKeyCode(o)),!i&&(o==e.events.KeyCodes.CTRL||o==e.events.KeyCodes.ALT||e.userAgent.MAC&&o==e.events.KeyCodes.META))return!1;if(e.userAgent.WEBKIT&&n&&i)switch(t){case e.events.KeyCodes.BACKSLASH:case e.events.KeyCodes.OPEN_SQUARE_BRACKET:case e.events.KeyCodes.CLOSE_SQUARE_BRACKET:case e.events.KeyCodes.TILDE:case e.events.KeyCodes.SEMICOLON:case e.events.KeyCodes.DASH:case e.events.KeyCodes.EQUALS:case e.events.KeyCodes.COMMA:case e.events.KeyCodes.PERIOD:case e.events.KeyCodes.SLASH:case e.events.KeyCodes.APOSTROPHE:case e.events.KeyCodes.SINGLE_QUOTE:return!1}if(e.userAgent.IE&&n&&o==t)return!1;switch(t){case e.events.KeyCodes.ENTER:return!(e.userAgent.IE&&e.userAgent.isDocumentModeOrHigher(9));case e.events.KeyCodes.ESC:return!e.userAgent.WEBKIT}return e.events.KeyCodes.isCharacterKey(t)},e.events.KeyCodes.isCharacterKey=function(t){if(t>=e.events.KeyCodes.ZERO&&t<=e.events.KeyCodes.NINE)return!0;if(t>=e.events.KeyCodes.NUM_ZERO&&t<=e.events.KeyCodes.NUM_MULTIPLY)return!0;if(t>=e.events.KeyCodes.A&&t<=e.events.KeyCodes.Z)return!0;if(e.userAgent.WEBKIT&&0==t)return!0;switch(t){case e.events.KeyCodes.SPACE:case e.events.KeyCodes.QUESTION_MARK:case e.events.KeyCodes.NUM_PLUS:case e.events.KeyCodes.NUM_MINUS:case e.events.KeyCodes.NUM_PERIOD:case e.events.KeyCodes.NUM_DIVISION:case e.events.KeyCodes.SEMICOLON:case e.events.KeyCodes.FF_SEMICOLON:case e.events.KeyCodes.DASH:case e.events.KeyCodes.EQUALS:case e.events.KeyCodes.FF_EQUALS:case e.events.KeyCodes.COMMA:case e.events.KeyCodes.PERIOD:case e.events.KeyCodes.SLASH:case e.events.KeyCodes.APOSTROPHE:case e.events.KeyCodes.SINGLE_QUOTE:case e.events.KeyCodes.OPEN_SQUARE_BRACKET:case e.events.KeyCodes.BACKSLASH:case e.events.KeyCodes.CLOSE_SQUARE_BRACKET:return!0;
default:return!1}},e.events.KeyCodes.normalizeKeyCode=function(t){return e.userAgent.GECKO?e.events.KeyCodes.normalizeGeckoKeyCode(t):e.userAgent.MAC&&e.userAgent.WEBKIT?e.events.KeyCodes.normalizeMacWebKitKeyCode(t):t},e.events.KeyCodes.normalizeGeckoKeyCode=function(t){switch(t){case e.events.KeyCodes.FF_EQUALS:return e.events.KeyCodes.EQUALS;case e.events.KeyCodes.FF_SEMICOLON:return e.events.KeyCodes.SEMICOLON;case e.events.KeyCodes.FF_DASH:return e.events.KeyCodes.DASH;case e.events.KeyCodes.MAC_FF_META:return e.events.KeyCodes.META;case e.events.KeyCodes.WIN_KEY_FF_LINUX:return e.events.KeyCodes.WIN_KEY;default:return t}},e.events.KeyCodes.normalizeMacWebKitKeyCode=function(t){switch(t){case e.events.KeyCodes.MAC_WK_CMD_RIGHT:return e.events.KeyCodes.META;default:return t}},e}(mt),dt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.ApplyForce&&(t.Testbed.ApplyForce={}),t.Testbed.ApplyForce=function(o,i){e.base(this,o,i),this.m_body=null,this.m_world.SetGravity(new t.b2Vec2(0,0));var n=.4,s=null,r=new t.b2BodyDef;r.position.Set(0,20),s=this.m_world.CreateBody(r);var a=new t.b2EdgeShape,l=new t.b2FixtureDef;l.shape=a,l.density=0,l.restitution=n,a.SetAsEdge(new t.b2Vec2(-20,-20),new t.b2Vec2(-20,20)),s.CreateFixture(l),a.SetAsEdge(new t.b2Vec2(20,-20),new t.b2Vec2(20,20)),s.CreateFixture(l),a.SetAsEdge(new t.b2Vec2(-20,20),new t.b2Vec2(20,20)),s.CreateFixture(l),a.SetAsEdge(new t.b2Vec2(-20,-20),new t.b2Vec2(20,-20)),s.CreateFixture(l);var p=new t.b2Transform;p.q.SetAngleRadians(.3524*t.b2_pi),p.p.Copy(t.b2MulRV(p.q,new t.b2Vec2(1,0),new t.b2Vec2));var b=new Array;b[0]=t.b2MulXV(p,new t.b2Vec2(-1,0),new t.b2Vec2),b[1]=t.b2MulXV(p,new t.b2Vec2(1,0),new t.b2Vec2),b[2]=t.b2MulXV(p,new t.b2Vec2(0,.5),new t.b2Vec2);var m=new t.b2PolygonShape;m.SetAsArray(b,3);var _=new t.b2FixtureDef;_.shape=m,_.density=4;var d=new t.b2Transform;d.q.SetAngleRadians(-.3524*t.b2_pi),d.p.Copy(t.b2MulRV(d.q,new t.b2Vec2(-1,0),new t.b2Vec2)),b[0]=t.b2MulXV(d,new t.b2Vec2(-1,0),new t.b2Vec2),b[1]=t.b2MulXV(d,new t.b2Vec2(1,0),new t.b2Vec2),b[2]=t.b2MulXV(d,new t.b2Vec2(0,.5),new t.b2Vec2);var h=new t.b2PolygonShape;h.SetAsArray(b,3);var c=new t.b2FixtureDef;c.shape=h,c.density=2;var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.angularDamping=2,r.linearDamping=.5,r.position.Set(0,2),r.angle=t.b2_pi,r.allowSleep=!1,this.m_body=this.m_world.CreateBody(r),this.m_body.CreateFixture(_),this.m_body.CreateFixture(c);var a=new t.b2PolygonShape;a.SetAsBox(.5,.5);var u=new t.b2FixtureDef;u.shape=a,u.density=1,u.friction=.3;for(var y=0;10>y;++y){var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(0,5+1.54*y);var f=this.m_world.CreateBody(r);f.CreateFixture(u);var S=10,C=f.GetInertia(),v=f.GetMass(),A=t.b2Sqrt(2*C/v),g=new t.b2FrictionJointDef;g.localAnchorA.SetZero(),g.localAnchorB.SetZero(),g.bodyA=s,g.bodyB=f,g.collideConnected=!0,g.maxForce=v*S,g.maxTorque=v*A*S,this.m_world.CreateJoint(g)}},e.inherits(t.Testbed.ApplyForce,t.Testbed.Test),t.Testbed.ApplyForce.prototype.m_body=null,t.Testbed.ApplyForce.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.W:var i=this.m_body.GetWorldVector(new t.b2Vec2(0,-200),new t.b2Vec2),n=this.m_body.GetWorldPoint(new t.b2Vec2(0,2),new t.b2Vec2);this.m_body.ApplyForce(i,n);break;case e.events.KeyCodes.A:this.m_body.ApplyTorque(50);break;case e.events.KeyCodes.D:this.m_body.ApplyTorque(-50)}e.base(this,"Keyboard",o)},t.Testbed.ApplyForce.Create=function(e,o){return new t.Testbed.ApplyForce(e,o)},t}(o,pt,_t),ht=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.BlobTest&&(t.Testbed.BlobTest={}),t.Testbed.BlobTest=function(o,i){e.base(this,o,i);var n=this.m_world.CreateBody(new t.b2BodyDef),s=new t.b2EdgeShape;s.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),n.CreateFixture2(s,0),s.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(-40,25)),n.CreateFixture2(s,0),s.SetAsEdge(new t.b2Vec2(40,0),new t.b2Vec2(40,25)),n.CreateFixture2(s,0);var r=new t.b2AreaJointDef;r.world=this.m_world;for(var a=0,l=10,p=5,b=5,m=20,_=.5,d=0;m>d;++d){var h=2*d*Math.PI/m,c=new t.b2BodyDef;c.fixedRotation=!0;var u=a+p*Math.cos(h),y=l+b*Math.sin(h);c.position.Set(u,y),c.type=t.b2BodyType.b2_dynamicBody;var f=this.m_world.CreateBody(c),S=new t.b2FixtureDef;S.shape=new t.b2CircleShape(_),S.density=1,f.CreateFixture(S),r.AddBody(f)}r.frquencyHz=10,r.dampingRatio=1,this.m_world.CreateJoint(r)},e.inherits(t.Testbed.BlobTest,t.Testbed.Test),t.Testbed.BlobTest.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.A:}},t.Testbed.BlobTest.prototype.Step=function(t){e.base(this,"Step",t)},t.Testbed.BlobTest.Create=function(e,o){return new t.Testbed.BlobTest(e,o)},t}(o,pt),ct=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.BodyTypes&&(t.Testbed.BodyTypes={}),t.Testbed.BodyTypes=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-20,0),new t.b2Vec2(20,0));var a=new t.b2FixtureDef;a.shape=r,n.CreateFixture(a);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(0,3),this.m_attachment=this.m_world.CreateBody(s);var r=new t.b2PolygonShape;r.SetAsBox(.5,2),this.m_attachment.CreateFixture2(r,2);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-4,5),this.m_platform=this.m_world.CreateBody(s);var r=new t.b2PolygonShape;r.SetAsOrientedBox(.5,4,new t.b2Vec2(4,0),.5*t.b2_pi);var a=new t.b2FixtureDef;a.shape=r,a.friction=.6,a.density=2,this.m_platform.CreateFixture(a);var l=new t.b2RevoluteJointDef;l.Initialize(this.m_attachment,this.m_platform,new t.b2Vec2(0,5)),l.maxMotorTorque=50,l.enableMotor=!0,this.m_world.CreateJoint(l);var p=new t.b2PrismaticJointDef;p.Initialize(n,this.m_platform,new t.b2Vec2(0,5),new t.b2Vec2(1,0)),p.maxMotorForce=1e3,p.enableMotor=!0,p.lowerTranslation=-10,p.upperTranslation=10,p.enableLimit=!0,this.m_world.CreateJoint(p),this.m_speed=3;var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(0,8);var b=this.m_world.CreateBody(s),r=new t.b2PolygonShape;r.SetAsBox(.75,.75);var a=new t.b2FixtureDef;a.shape=r,a.friction=.6,a.density=2,b.CreateFixture(a)},e.inherits(t.Testbed.BodyTypes,t.Testbed.Test),t.Testbed.BodyTypes.prototype.m_attachment=null,t.Testbed.BodyTypes.prototype.m_platform=null,t.Testbed.BodyTypes.prototype.m_speed=0,t.Testbed.BodyTypes.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.D:this.m_platform.SetType(t.b2BodyType.b2_dynamicBody);break;case e.events.KeyCodes.S:this.m_platform.SetType(t.b2BodyType.b2_staticBody);break;case e.events.KeyCodes.K:this.m_platform.SetType(t.b2BodyType.b2_kinematicBody),this.m_platform.SetLinearVelocity(new t.b2Vec2(-this.m_speed,0)),this.m_platform.SetAngularVelocity(0)}},t.Testbed.BodyTypes.prototype.Step=function(o){if(this.m_platform.GetType()==t.b2BodyType.b2_kinematicBody){var i=this.m_platform.GetTransform().p,n=this.m_platform.GetLinearVelocity();(i.x<-10&&n.x<0||i.x>10&&n.x>0)&&(n.x=-n.x,this.m_platform.SetLinearVelocity(n))}e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Keys: (d) dynamic, (s) static, (k) kinematic"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.BodyTypes.Create=function(e,o){return new t.Testbed.BodyTypes(e,o)},t}(o,pt),ut=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Breakable&&(t.Testbed.Breakable={}),t.Testbed.Breakable=function(o,i){e.base(this,o,i),this.m_velocity=new t.b2Vec2,this.m_shape1=new t.b2PolygonShape,this.m_shape2=new t.b2PolygonShape;var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0);var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(0,40),n.angle=.25*t.b2_pi,this.m_body1=this.m_world.CreateBody(n),this.m_shape1=new t.b2PolygonShape,this.m_shape1.SetAsOrientedBox(.5,.5,new t.b2Vec2(-.5,0),0),this.m_piece1=this.m_body1.CreateFixture2(this.m_shape1,1),this.m_shape2=new t.b2PolygonShape,this.m_shape2.SetAsOrientedBox(.5,.5,new t.b2Vec2(.5,0),0),this.m_piece2=this.m_body1.CreateFixture2(this.m_shape2,1)},e.inherits(t.Testbed.Breakable,t.Testbed.Test),t.Testbed.Breakable.e_count=7,t.Testbed.Breakable.prototype.m_body1=null,t.Testbed.Breakable.prototype.m_velocity=null,t.Testbed.Breakable.prototype.m_angularVelocity=0,t.Testbed.Breakable.prototype.m_shape1=null,t.Testbed.Breakable.prototype.m_shape2=null,t.Testbed.Breakable.prototype.m_piece1=null,t.Testbed.Breakable.prototype.m_piece2=null,t.Testbed.Breakable.prototype.m_broke=!1,t.Testbed.Breakable.prototype.m_break=!1,t.Testbed.Breakable.prototype.PostSolve=function(e,o){if(!this.m_broke){for(var i=e.GetManifold().pointCount,n=0,s=0;i>s;++s)n=t.b2Max(n,o.normalImpulses[s]);n>40&&(this.m_break=!0)}},t.Testbed.Breakable.prototype.Break=function(){var e=this.m_piece1.GetBody(),o=e.GetWorldCenter();e.DestroyFixture(this.m_piece2),this.m_piece2=null;var i=new t.b2BodyDef;i.type=t.b2BodyType.b2_dynamicBody,i.position=e.GetPosition(),i.angle=e.GetAngleRadians();var n=this.m_world.CreateBody(i);this.m_piece2=n.CreateFixture2(this.m_shape2,1);var s=e.GetWorldCenter(),r=n.GetWorldCenter(),a=t.b2AddVCrossSV(this.m_velocity,this.m_angularVelocity,t.b2SubVV(s,o,t.b2Vec2.s_t0),new t.b2Vec2),l=t.b2AddVCrossSV(this.m_velocity,this.m_angularVelocity,t.b2SubVV(r,o,t.b2Vec2.s_t0),new t.b2Vec2);e.SetAngularVelocity(this.m_angularVelocity),e.SetLinearVelocity(a),n.SetAngularVelocity(this.m_angularVelocity),n.SetLinearVelocity(l)},t.Testbed.Breakable.prototype.Step=function(t){this.m_break&&(this.Break(),this.m_broke=!0,this.m_break=!1),0==this.m_broke&&(this.m_velocity=this.m_body1.GetLinearVelocity(),this.m_angularVelocity=this.m_body1.GetAngularVelocity()),e.base(this,"Step",t)},t.Testbed.Breakable.Create=function(e,o){return new t.Testbed.Breakable(e,o)},t}(o,pt),yt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Bridge&&(t.Testbed.Bridge={}),t.Testbed.Bridge=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),n.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(.5,.125);var a=new t.b2FixtureDef;a.shape=r,a.density=20,a.friction=.2;for(var l=new t.b2RevoluteJointDef,p=n,b=0;b<t.Testbed.Bridge.e_count;++b){var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-14.5+1*b,5);var m=this.m_world.CreateBody(s);m.CreateFixture(a);var _=new t.b2Vec2(-15+1*b,5);l.Initialize(p,m,_),this.m_world.CreateJoint(l),b==t.Testbed.Bridge.e_count>>1&&(this.m_middle=m),p=m}var _=new t.b2Vec2(-15+1*t.Testbed.Bridge.e_count,5);l.Initialize(p,n,_),this.m_world.CreateJoint(l);for(var b=0;2>b;++b){var d=new Array;d[0]=new t.b2Vec2(-.5,0),d[1]=new t.b2Vec2(.5,0),d[2]=new t.b2Vec2(0,1.5);var r=new t.b2PolygonShape;r.SetAsArray(d);var a=new t.b2FixtureDef;a.shape=r,a.density=1;var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-8+8*b,12);var m=this.m_world.CreateBody(s);m.CreateFixture(a)}for(var b=0;3>b;++b){var r=new t.b2CircleShape;r.m_radius=.5;var a=new t.b2FixtureDef;a.shape=r,a.density=1;var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-6+6*b,10);var m=this.m_world.CreateBody(s);m.CreateFixture(a)}},e.inherits(t.Testbed.Bridge,t.Testbed.Test),t.Testbed.Bridge.e_count=30,t.Testbed.Bridge.prototype.m_middle=null,t.Testbed.Bridge.Create=function(e,o){return new t.Testbed.Bridge(e,o)},t}(o,pt),ft=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.BulletTest&&(t.Testbed.BulletTest={}),t.Testbed.BulletTest=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef;n.position.Set(0,0);var s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-10,0),new t.b2Vec2(10,0)),s.CreateFixture2(r,0);var a=new t.b2PolygonShape;a.SetAsOrientedBox(.2,1,new t.b2Vec2(.5,1),0),s.CreateFixture2(a,0);var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(0,4);var l=new t.b2PolygonShape;l.SetAsBox(2,.1),this.m_body=this.m_world.CreateBody(n),this.m_body.CreateFixture2(l,1),l.SetAsBox(.25,.25),this.m_x=.20352793,n.position.Set(this.m_x,10),n.bullet=!0,this.m_bullet=this.m_world.CreateBody(n),this.m_bullet.CreateFixture2(l,100),this.m_bullet.SetLinearVelocity(new t.b2Vec2(0,-50))},e.inherits(t.Testbed.BulletTest,t.Testbed.Test),t.Testbed.BulletTest.prototype.m_body=null,t.Testbed.BulletTest.prototype.m_bullet=null,t.Testbed.BulletTest.prototype.m_x=0,t.Testbed.BulletTest.prototype.Launch=function(){this.m_body.SetTransformVecRadians(new t.b2Vec2(0,4),0),this.m_body.SetLinearVelocity(t.b2Vec2_zero),this.m_body.SetAngularVelocity(0),this.m_x=t.b2RandomRange(-1,1),this.m_bullet.SetTransformVecRadians(new t.b2Vec2(this.m_x,10),0),this.m_bullet.SetLinearVelocity(new t.b2Vec2(0,-50)),this.m_bullet.SetAngularVelocity(0),t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0},t.Testbed.BulletTest.prototype.Step=function(o){e.base(this,"Step",o),t.b2_gjkCalls>0&&(this.m_debugDraw.DrawString(5,this.m_textLine,"gjk calls = %d, ave gjk iters = %3.1f, max gjk iters = %d",t.b2_gjkCalls,t.b2_gjkIters/t.b2_gjkCalls,t.b2_gjkMaxIters),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE),t.b2_toiCalls>0&&(this.m_debugDraw.DrawString(5,this.m_textLine,"toi calls = %d, ave toi iters = %3.1f, max toi iters = %d",t.b2_toiCalls,t.b2_toiIters/t.b2_toiCalls,t.b2_toiMaxRootIters),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"ave toi root iters = %3.1f, max toi root iters = %d",t.b2_toiRootIters/t.b2_toiCalls,t.b2_toiMaxRootIters),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE),this.m_stepCount%60==0&&this.Launch()},t.Testbed.BulletTest.Create=function(e,o){return new t.Testbed.BulletTest(e,o)},t}(o,pt),St=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.BuoyancyTest&&(t.Testbed.BuoyancyTest={}),t.Testbed.BuoyancyTest=function(o,i){e.base(this,o,i),this.m_bodies=new Array;var n=new t.b2BuoyancyController;this.m_controller=n,n.normal.Set(0,1),n.offset=20,n.density=2,n.linearDrag=5,n.angularDrag=2;var s=this.m_world.CreateBody(new t.b2BodyDef),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0),r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(-40,25)),s.CreateFixture2(r,0),r.SetAsEdge(new t.b2Vec2(40,0),new t.b2Vec2(40,25)),s.CreateFixture2(r,0);for(var a=0;5>a;a++){var l=new t.b2BodyDef;l.type=t.b2BodyType.b2_dynamicBody,l.position.Set(40*Math.random()-20,15*Math.random()+5),l.angle=Math.random()*Math.PI;var p=this.m_world.CreateBody(l),b=new t.b2FixtureDef;b.density=1,b.friction=.3,b.restitution=.1,b.shape=new t.b2PolygonShape,b.shape.SetAsBox(.5*Math.random()+1,.5*Math.random()+1),p.CreateFixture(b),this.m_bodies.push(p)}for(var a=0;5>a;a++){var l=new t.b2BodyDef;l.type=t.b2BodyType.b2_dynamicBody,l.position.Set(40*Math.random()-20,15*Math.random()+5),l.angle=Math.random()*Math.PI;var p=this.m_world.CreateBody(l),b=new t.b2FixtureDef;b.density=1,b.friction=.3,b.restitution=.1,b.shape=new t.b2CircleShape(.5*Math.random()+1),p.CreateFixture(b),this.m_bodies.push(p)}for(var a=0;15>a;a++){var l=new t.b2BodyDef;l.type=t.b2BodyType.b2_dynamicBody,l.position.Set(40*Math.random()-20,15*Math.random()+5),l.angle=Math.random()*Math.PI;var p=this.m_world.CreateBody(l),b=new t.b2FixtureDef;if(b.density=1,b.friction=.3,b.restitution=.1,b.shape=new t.b2PolygonShape,Math.random()>.66)b.shape.SetAsArray([new t.b2Vec2(-1-1*Math.random(),1+1*Math.random()),new t.b2Vec2(-.5-1*Math.random(),-1-1*Math.random()),new t.b2Vec2(.5+1*Math.random(),-1-1*Math.random()),new t.b2Vec2(1+1*Math.random(),1+1*Math.random())]);else if(Math.random()>.5){var m=[];m[0]=new t.b2Vec2(0,1+1*Math.random()),m[2]=new t.b2Vec2(-.5-1*Math.random(),-1-1*Math.random()),m[3]=new t.b2Vec2(.5+1*Math.random(),-1-1*Math.random()),m[1]=new t.b2Vec2(m[0].x+m[2].x,m[0].y+m[2].y),m[1].SelfMul(Math.random()/2+.8),m[4]=new t.b2Vec2(m[3].x+m[0].x,m[3].y+m[0].y),m[4].SelfMul(Math.random()/2+.8),b.shape.SetAsArray(m)}else b.shape.SetAsArray([new t.b2Vec2(0,1+1*Math.random()),new t.b2Vec2(-.5-1*Math.random(),-1-1*Math.random()),new t.b2Vec2(.5+1*Math.random(),-1-1*Math.random())]);p.CreateFixture(b),this.m_bodies.push(p)}var l=new t.b2BodyDef;l.type=t.b2BodyType.b2_dynamicBody,l.position.Set(0,40),l.angle=0;var p=this.m_world.CreateBody(l),b=new t.b2FixtureDef;b.density=3,b.shape=new t.b2PolygonShape,b.shape.SetAsBox(4,1),p.CreateFixture(b),this.m_bodies.push(p);var l=new t.b2BodyDef;l.type=t.b2BodyType.b2_dynamicBody,l.position.Set(0,30);var p=this.m_world.CreateBody(l),b=new t.b2FixtureDef;if(b.density=2,b.shape=new t.b2CircleShape(.7),b.shape.m_p.Set(3,0),p.CreateFixture(b),b.shape.m_p.Set(-3,0),p.CreateFixture(b),b.shape.m_p.Set(0,3),p.CreateFixture(b),b.shape.m_p.Set(0,-3),p.CreateFixture(b),b.density=2,b.shape=new t.b2PolygonShape,b.shape.SetAsBox(3,.2),p.CreateFixture(b),b.shape.SetAsBox(.2,3),p.CreateFixture(b),this.m_bodies.push(p),t.DEBUG){for(var _ in this.m_bodies)this.m_controller.AddBody(this.m_bodies[_]);for(var _ in this.m_bodies)this.m_controller.RemoveBody(this.m_bodies[_])}for(var _ in this.m_bodies)this.m_controller.AddBody(this.m_bodies[_]);t.DEBUG&&(this.m_world.AddController(this.m_controller),this.m_world.RemoveController(this.m_controller)),this.m_world.AddController(this.m_controller)},e.inherits(t.Testbed.BuoyancyTest,t.Testbed.Test),t.Testbed.BuoyancyTest.prototype.m_bodies=null,t.Testbed.BuoyancyTest.prototype.m_controller=null,t.Testbed.BuoyancyTest.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.A:}},t.Testbed.BuoyancyTest.prototype.Step=function(t){e.base(this,"Step",t)},t.Testbed.BuoyancyTest.Create=function(e,o){return new t.Testbed.BuoyancyTest(e,o)},t}(o,pt),Ct=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Cantilever&&(t.Testbed.Cantilever={}),t.Testbed.Cantilever=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),n.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(.5,.125);var a=new t.b2FixtureDef;a.shape=r,a.density=20;for(var l=new t.b2WeldJointDef,p=n,b=0;b<t.Testbed.Cantilever.e_count;++b){var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-14.5+1*b,5);var m=this.m_world.CreateBody(s);m.CreateFixture(a);var _=new t.b2Vec2(-15+1*b,5);l.Initialize(p,m,_),this.m_world.CreateJoint(l),p=m}var r=new t.b2PolygonShape;r.SetAsBox(1,.125);var a=new t.b2FixtureDef;a.shape=r,a.density=20;var l=new t.b2WeldJointDef;l.frequencyHz=5,l.dampingRatio=.7;for(var p=n,b=0;3>b;++b){var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-14+2*b,15);var m=this.m_world.CreateBody(s);m.CreateFixture(a);var _=new t.b2Vec2(-15+2*b,15);l.Initialize(p,m,_),this.m_world.CreateJoint(l),p=m}var r=new t.b2PolygonShape;r.SetAsBox(.5,.125);var a=new t.b2FixtureDef;a.shape=r,a.density=20;for(var l=new t.b2WeldJointDef,p=n,b=0;b<t.Testbed.Cantilever.e_count;++b){var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-4.5+1*b,15);var m=this.m_world.CreateBody(s);if(m.CreateFixture(a),b>0){var _=new t.b2Vec2(-5+1*b,15);l.Initialize(p,m,_),this.m_world.CreateJoint(l)}p=m}var r=new t.b2PolygonShape;r.SetAsBox(.5,.125);var a=new t.b2FixtureDef;a.shape=r,a.density=20;var l=new t.b2WeldJointDef;l.frequencyHz=8,l.dampingRatio=.7;for(var p=n,b=0;b<t.Testbed.Cantilever.e_count;++b){var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(5.5+1*b,10);var m=this.m_world.CreateBody(s);if(m.CreateFixture(a),b>0){var _=new t.b2Vec2(5+1*b,10);l.Initialize(p,m,_),this.m_world.CreateJoint(l)}p=m}for(var b=0;2>b;++b){var d=new Array;d[0]=new t.b2Vec2(-.5,0),d[1]=new t.b2Vec2(.5,0),d[2]=new t.b2Vec2(0,1.5);var r=new t.b2PolygonShape;r.SetAsArray(d);var a=new t.b2FixtureDef;a.shape=r,a.density=1;var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-8+8*b,12);var m=this.m_world.CreateBody(s);m.CreateFixture(a)}for(var b=0;2>b;++b){var r=new t.b2CircleShape;r.m_radius=.5;var a=new t.b2FixtureDef;a.shape=r,a.density=1;var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-6+6*b,10);var m=this.m_world.CreateBody(s);m.CreateFixture(a)}},e.inherits(t.Testbed.Cantilever,t.Testbed.Test),t.Testbed.Cantilever.e_count=8,t.Testbed.Cantilever.Create=function(e,o){return new t.Testbed.Cantilever(e,o)},t}(o,pt),vt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Car&&(t.Testbed.Car={}),t.Testbed.Car=function(o,i){e.base(this,o,i),this.m_hz=4,this.m_zeta=.7,this.m_speed=50;var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape,a=new t.b2FixtureDef;a.shape=r,a.density=0,a.friction=.6,r.SetAsEdge(new t.b2Vec2(-20,0),new t.b2Vec2(20,0)),n.CreateFixture(a);for(var l=[.25,1,4,0,0,-1,-2,-2,-1.25,0],p=20,b=0,m=5,_=0;10>_;++_){var d=l[_];r.SetAsEdge(new t.b2Vec2(p,b),new t.b2Vec2(p+m,d)),n.CreateFixture(a),b=d,p+=m}for(var _=0;10>_;++_){var d=l[_];r.SetAsEdge(new t.b2Vec2(p,b),new t.b2Vec2(p+m,d)),n.CreateFixture(a),b=d,p+=m}r.SetAsEdge(new t.b2Vec2(p,0),new t.b2Vec2(p+40,0)),n.CreateFixture(a),p+=80,r.SetAsEdge(new t.b2Vec2(p,0),new t.b2Vec2(p+40,0)),n.CreateFixture(a),p+=40,r.SetAsEdge(new t.b2Vec2(p,0),new t.b2Vec2(p+10,5)),n.CreateFixture(a),p+=20,r.SetAsEdge(new t.b2Vec2(p,0),new t.b2Vec2(p+40,0)),n.CreateFixture(a),p+=40,r.SetAsEdge(new t.b2Vec2(p,0),new t.b2Vec2(p,20)),n.CreateFixture(a);var s=new t.b2BodyDef;s.position.Set(140,1),s.type=t.b2BodyType.b2_dynamicBody;var h=this.m_world.CreateBody(s),c=new t.b2PolygonShape;c.SetAsBox(10,.25),h.CreateFixture2(c,1);var u=new t.b2RevoluteJointDef;u.Initialize(n,h,h.GetPosition()),u.lowerAngle=-8*t.b2_pi/180,u.upperAngle=8*t.b2_pi/180,u.enableLimit=!0,this.m_world.CreateJoint(u),h.ApplyAngularImpulse(100);var y=20,r=new t.b2PolygonShape;r.SetAsBox(1,.125);var a=new t.b2FixtureDef;a.shape=r,a.density=1,a.friction=.6;for(var u=new t.b2RevoluteJointDef,f=n,_=0;y>_;++_){var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(161+2*_,-.125);var h=this.m_world.CreateBody(s);h.CreateFixture(a);var S=new t.b2Vec2(160+2*_,-.125);u.Initialize(f,h,S),this.m_world.CreateJoint(u),f=h}var S=new t.b2Vec2(160+2*y,-.125);u.Initialize(f,n,S),this.m_world.CreateJoint(u);var c=new t.b2PolygonShape;c.SetAsBox(.5,.5);var h=null,s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(230,.5),h=this.m_world.CreateBody(s),h.CreateFixture2(c,.5),s.position.Set(230,1.5),h=this.m_world.CreateBody(s),h.CreateFixture2(c,.5),s.position.Set(230,2.5),h=this.m_world.CreateBody(s),h.CreateFixture2(c,.5),s.position.Set(230,3.5),h=this.m_world.CreateBody(s),h.CreateFixture2(c,.5),s.position.Set(230,4.5),h=this.m_world.CreateBody(s),h.CreateFixture2(c,.5);var C=new t.b2PolygonShape,v=t.b2Vec2.MakeArray(8);v[0].Set(-1.5,-.5),v[1].Set(1.5,-.5),v[2].Set(1.5,0),v[3].Set(0,.9),v[4].Set(-1.15,.9),v[5].Set(-1.5,.2),C.SetAsVector(v,6);var A=new t.b2CircleShape;A.m_radius=.4;var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(0,1),this.m_car=this.m_world.CreateBody(s),this.m_car.CreateFixture2(C,1);var a=new t.b2FixtureDef;a.shape=A,a.density=1,a.friction=.9,s.position.Set(-1,.35),this.m_wheel1=this.m_world.CreateBody(s),this.m_wheel1.CreateFixture(a),s.position.Set(1,.4),this.m_wheel2=this.m_world.CreateBody(s),this.m_wheel2.CreateFixture(a);var u=new t.b2WheelJointDef,g=new t.b2Vec2(0,1);u.Initialize(this.m_car,this.m_wheel1,this.m_wheel1.GetPosition(),g),u.motorSpeed=0,u.maxMotorTorque=20,u.enableMotor=!0,u.frequencyHz=this.m_hz,u.dampingRatio=this.m_zeta,this.m_spring1=this.m_world.CreateJoint(u),u.Initialize(this.m_car,this.m_wheel2,this.m_wheel2.GetPosition(),g),u.motorSpeed=0,u.maxMotorTorque=10,u.enableMotor=!1,u.frequencyHz=this.m_hz,u.dampingRatio=this.m_zeta,this.m_spring2=this.m_world.CreateJoint(u)},e.inherits(t.Testbed.Car,t.Testbed.Test),t.Testbed.Car.prototype.m_car=null,t.Testbed.Car.prototype.m_wheel1=null,t.Testbed.Car.prototype.m_wheel2=null,t.Testbed.Car.prototype.m_hz=0,t.Testbed.Car.prototype.m_zeta=0,t.Testbed.Car.prototype.m_speed=0,t.Testbed.Car.prototype.m_spring1=null,t.Testbed.Car.prototype.m_spring2=null,t.Testbed.Car.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.A:this.m_spring1.SetMotorSpeed(this.m_speed);break;case e.events.KeyCodes.S:this.m_spring1.SetMotorSpeed(0);break;case e.events.KeyCodes.D:this.m_spring1.SetMotorSpeed(-this.m_speed);break;case e.events.KeyCodes.Q:this.m_hz=t.b2Max(0,this.m_hz-1),this.m_spring1.SetSpringFrequencyHz(this.m_hz),this.m_spring2.SetSpringFrequencyHz(this.m_hz);break;case e.events.KeyCodes.E:this.m_hz+=1,this.m_spring1.SetSpringFrequencyHz(this.m_hz),this.m_spring2.SetSpringFrequencyHz(this.m_hz)}},t.Testbed.Car.prototype.Step=function(o){this.m_debugDraw.DrawString(5,this.m_textLine,"Keys: left = a, brake = s, right = d, hz down = q, hz up = e"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"frequency = %4.2f hz, damping ratio = %4.2f",this.m_hz,this.m_zeta),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,o.viewCenter.x=this.m_car.GetPosition().x,e.base(this,"Step",o)},t.Testbed.Car.Create=function(e,o){return new t.Testbed.Car(e,o)},t}(o,pt),At=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Chain&&(t.Testbed.Chain={}),t.Testbed.Chain=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),n.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(.6,.125);var a=new t.b2FixtureDef;a.shape=r,a.density=20,a.friction=.2;var l=new t.b2RevoluteJointDef;l.collideConnected=!1;for(var p=25,b=n,m=0;m<t.Testbed.Chain.e_count;++m){var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(.5+m,p);var _=this.m_world.CreateBody(s);_.CreateFixture(a);var d=new t.b2Vec2(m,p);l.Initialize(b,_,d),this.m_world.CreateJoint(l),b=_}},e.inherits(t.Testbed.Chain,t.Testbed.Test),t.Testbed.Chain.e_count=30,t.Testbed.Chain.Create=function(e,o){return new t.Testbed.Chain(e,o)},t}(o,pt),gt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.CharacterCollision&&(t.Testbed.CharacterCollision={}),t.Testbed.CharacterCollision=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-20,0),new t.b2Vec2(20,0)),s.CreateFixture2(r,0);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-8,1),new t.b2Vec2(-6,1)),s.CreateFixture2(r,0),r.SetAsEdge(new t.b2Vec2(-6,1),new t.b2Vec2(-4,1)),s.CreateFixture2(r,0),r.SetAsEdge(new t.b2Vec2(-4,1),new t.b2Vec2(-2,1)),s.CreateFixture2(r,0);var n=new t.b2BodyDef;n.angle=.25*t.b2_pi;var s=this.m_world.CreateBody(n),a=t.b2Vec2.MakeArray(4);a[0].Set(5,7),a[1].Set(6,8),a[2].Set(7,8),a[3].Set(8,7);var r=new t.b2ChainShape;r.CreateChain(a,4),s.CreateFixture2(r,0);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2PolygonShape;r.SetAsOrientedBox(1,1,new t.b2Vec2(4,3),0),s.CreateFixture2(r,0),r.SetAsOrientedBox(1,1,new t.b2Vec2(6,3),0),s.CreateFixture2(r,0),r.SetAsOrientedBox(1,1,new t.b2Vec2(8,3),0),s.CreateFixture2(r,0);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),a=t.b2Vec2.MakeArray(4);a[0].Set(-1,3),a[1].Set(1,3),a[2].Set(1,5),a[3].Set(-1,5);var r=new t.b2ChainShape;r.CreateChain(a,4),s.CreateFixture2(r,0);var n=new t.b2BodyDef;n.position.Set(-10,4);var s=this.m_world.CreateBody(n),a=t.b2Vec2.MakeArray(10);a[0].Set(0,0),a[1].Set(6,0),a[2].Set(6,2),a[3].Set(4,1),a[4].Set(2,2),a[5].Set(0,2),a[6].Set(-2,2),a[7].Set(-4,3),a[8].Set(-6,2),a[9].Set(-6,0);var r=new t.b2ChainShape;r.CreateChain(a,10),s.CreateFixture2(r,0);var n=new t.b2BodyDef;n.position.Set(-3,8),n.type=t.b2BodyType.b2_dynamicBody,n.fixedRotation=!0,n.allowSleep=!1;var l=this.m_world.CreateBody(n),r=new t.b2PolygonShape;r.SetAsBox(.5,.5);var p=new t.b2FixtureDef;p.shape=r,p.density=20,l.CreateFixture(p);var n=new t.b2BodyDef;n.position.Set(-5,5),n.type=t.b2BodyType.b2_dynamicBody,n.fixedRotation=!0,n.allowSleep=!1;var l=this.m_world.CreateBody(n),r=new t.b2PolygonShape;r.SetAsBox(.25,.25);var p=new t.b2FixtureDef;p.shape=r,p.density=20,l.CreateFixture(p);var n=new t.b2BodyDef;n.position.Set(-5,8),n.type=t.b2BodyType.b2_dynamicBody,n.fixedRotation=!0,n.allowSleep=!1;for(var l=this.m_world.CreateBody(n),b=0,m=t.b2_pi/3,_=t.b2Vec2.MakeArray(6),d=0;6>d;++d)_[d].Set(.5*t.b2Cos(b),.5*t.b2Sin(b)),b+=m;var r=new t.b2PolygonShape;r.SetAsVector(_,6);var p=new t.b2FixtureDef;p.shape=r,p.density=20,l.CreateFixture(p);var n=new t.b2BodyDef;n.position.Set(3,5),n.type=t.b2BodyType.b2_dynamicBody,n.fixedRotation=!0,n.allowSleep=!1;var l=this.m_world.CreateBody(n),r=new t.b2CircleShape;r.m_radius=.5;var p=new t.b2FixtureDef;p.shape=r,p.density=20,l.CreateFixture(p);var n=new t.b2BodyDef;n.position.Set(-7,6),n.type=t.b2BodyType.b2_dynamicBody,n.allowSleep=!1,this.m_character=this.m_world.CreateBody(n);var r=new t.b2CircleShape;r.m_radius=.25;var p=new t.b2FixtureDef;p.shape=r,p.density=20,p.friction=1,this.m_character.CreateFixture(p)},e.inherits(t.Testbed.CharacterCollision,t.Testbed.Test),t.Testbed.CharacterCollision.prototype.m_character=null,t.Testbed.CharacterCollision.prototype.Step=function(o){var i=this.m_character.GetLinearVelocity().Clone();i.x=-5,this.m_character.SetLinearVelocity(i),e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"This tests various character collision shapes"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"Limitation: square and hexagon can snag on aligned boxes."),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"Feature: edge chains have smooth collision inside and out."),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.CharacterCollision.Create=function(e,o){return new t.Testbed.CharacterCollision(e,o)},t}(o,pt),wt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.CollisionFiltering&&(t.Testbed.CollisionFiltering={}),t.Testbed.CollisionFiltering=function(o,i){e.base(this,o,i);var n=new t.b2EdgeShape;n.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0));var s=new t.b2FixtureDef;s.shape=n,s.friction=.3;var r=new t.b2BodyDef,a=this.m_world.CreateBody(r);a.CreateFixture(s);var l=new Array;l[0]=new t.b2Vec2(-1,0),l[1]=new t.b2Vec2(1,0),l[2]=new t.b2Vec2(0,2);var p=new t.b2PolygonShape;p.SetAsArray(l,3);var b=new t.b2FixtureDef;b.shape=p,b.density=1,b.filter.groupIndex=t.Testbed.CollisionFiltering.k_smallGroup,b.filter.categoryBits=t.Testbed.CollisionFiltering.k_triangleCategory,b.filter.maskBits=t.Testbed.CollisionFiltering.k_triangleMask;var m=new t.b2BodyDef;m.type=t.b2BodyType.b2_dynamicBody,m.position.Set(-5,2);var _=this.m_world.CreateBody(m);_.CreateFixture(b),l[0].SelfMul(2),l[1].SelfMul(2),l[2].SelfMul(2),p.SetAsArray(l,3),b.filter.groupIndex=t.Testbed.CollisionFiltering.k_largeGroup,m.position.Set(-5,6),m.fixedRotation=!0;var d=this.m_world.CreateBody(m);d.CreateFixture(b);var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(-5,10);
var h=this.m_world.CreateBody(r),c=new t.b2PolygonShape;c.SetAsBox(.5,1),h.CreateFixture2(c,1);var u=new t.b2PrismaticJointDef;u.bodyA=d,u.bodyB=h,u.enableLimit=!0,u.localAnchorA.Set(0,4),u.localAnchorB.SetZero(),u.localAxisA.Set(0,1),u.lowerTranslation=-1,u.upperTranslation=1,this.m_world.CreateJoint(u),p.SetAsBox(1,.5);var y=new t.b2FixtureDef;y.shape=p,y.density=1,y.restitution=.1,y.filter.groupIndex=t.Testbed.CollisionFiltering.k_smallGroup,y.filter.categoryBits=t.Testbed.CollisionFiltering.k_boxCategory,y.filter.maskBits=t.Testbed.CollisionFiltering.k_boxMask;var f=new t.b2BodyDef;f.type=t.b2BodyType.b2_dynamicBody,f.position.Set(0,2);var S=this.m_world.CreateBody(f);S.CreateFixture(y),p.SetAsBox(2,1),y.filter.groupIndex=t.Testbed.CollisionFiltering.k_largeGroup,f.position.Set(0,6);var C=this.m_world.CreateBody(f);C.CreateFixture(y);var v=new t.b2CircleShape;v.m_radius=1;var A=new t.b2FixtureDef;A.shape=v,A.density=1,A.filter.groupIndex=t.Testbed.CollisionFiltering.k_smallGroup,A.filter.categoryBits=t.Testbed.CollisionFiltering.k_circleCategory,A.filter.maskBits=t.Testbed.CollisionFiltering.k_circleMask;var g=new t.b2BodyDef;g.type=t.b2BodyType.b2_dynamicBody,g.position.Set(5,2);var w=this.m_world.CreateBody(g);w.CreateFixture(A),v.m_radius*=2,A.filter.groupIndex=t.Testbed.CollisionFiltering.k_largeGroup,g.position.Set(5,6);var x=this.m_world.CreateBody(g);x.CreateFixture(A)},e.inherits(t.Testbed.CollisionFiltering,t.Testbed.Test),t.Testbed.CollisionFiltering.k_smallGroup=1,t.Testbed.CollisionFiltering.k_largeGroup=-1,t.Testbed.CollisionFiltering.k_defaultCategory=1,t.Testbed.CollisionFiltering.k_triangleCategory=2,t.Testbed.CollisionFiltering.k_boxCategory=4,t.Testbed.CollisionFiltering.k_circleCategory=8,t.Testbed.CollisionFiltering.k_triangleMask=65535,t.Testbed.CollisionFiltering.k_boxMask=65535^t.Testbed.CollisionFiltering.k_triangleCategory,t.Testbed.CollisionFiltering.k_circleMask=65535,t.Testbed.CollisionFiltering.Create=function(e,o){return new t.Testbed.CollisionFiltering(e,o)},t}(o,pt),xt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.CollisionProcessing&&(t.Testbed.CollisionProcessing={}),t.Testbed.CollisionProcessing=function(o,i){e.base(this,o,i);var n=new t.b2EdgeShape;n.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0));var s=new t.b2FixtureDef;s.shape=n;var r=new t.b2BodyDef,r=new t.b2BodyDef,a=(this.m_world.CreateBody(r),-5),l=5,p=2,b=35,m=new Array(3);m[0]=new t.b2Vec2(-1,0),m[1]=new t.b2Vec2(1,0),m[2]=new t.b2Vec2(0,2);var _=new t.b2PolygonShape;_.SetAsArray(m,3);var d=new t.b2FixtureDef;d.shape=_,d.density=1;var h=new t.b2BodyDef;h.type=t.b2BodyType.b2_dynamicBody,h.position.Set(t.b2RandomRange(a,l),t.b2RandomRange(p,b));var c=this.m_world.CreateBody(h);c.CreateFixture(d),m[0].SelfMul(2),m[1].SelfMul(2),m[2].SelfMul(2),_.SetAsArray(m,3),h.position.Set(t.b2RandomRange(a,l),t.b2RandomRange(p,b));var u=this.m_world.CreateBody(h);u.CreateFixture(d),_.SetAsBox(1,.5);var y=new t.b2FixtureDef;y.shape=_,y.density=1;var f=new t.b2BodyDef;f.type=t.b2BodyType.b2_dynamicBody,f.position.Set(t.b2RandomRange(a,l),t.b2RandomRange(p,b));var S=this.m_world.CreateBody(f);S.CreateFixture(y),_.SetAsBox(2,1),f.position.Set(t.b2RandomRange(a,l),t.b2RandomRange(p,b));var C=this.m_world.CreateBody(f);C.CreateFixture(y);var v=new t.b2CircleShape;v.m_radius=1;var A=new t.b2FixtureDef;A.shape=v,A.density=1;var g=new t.b2BodyDef;g.type=t.b2BodyType.b2_dynamicBody,g.position.Set(t.b2RandomRange(a,l),t.b2RandomRange(p,b));var w=this.m_world.CreateBody(g);w.CreateFixture(A),v.m_radius*=2,g.position.Set(t.b2RandomRange(a,l),t.b2RandomRange(p,b));var x=this.m_world.CreateBody(g);x.CreateFixture(A)},e.inherits(t.Testbed.CollisionProcessing,t.Testbed.Test),t.Testbed.CollisionProcessing.prototype.Step=function(t){e.base(this,"Step",t);for(var o=6,i=new Array(o),n=0,s=0;s<this.m_pointCount;++s){var r=this.m_points[s],a=r.fixtureA.GetBody(),l=r.fixtureB.GetBody(),p=a.GetMass(),b=l.GetMass();if(p>0&&b>0&&(i[n++]=b>p?a:l,n==o))break}i.sort(function(e,t){return e-t});for(var s=0;n>s;){for(var m=i[s++];n>s&&i[s]==m;)++s;m!=this.m_bomb&&this.m_world.DestroyBody(m)}},t.Testbed.CollisionProcessing.Create=function(e,o){return new t.Testbed.CollisionProcessing(e,o)},t}(o,pt),Bt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.CompoundShapes&&(t.Testbed.CompoundShapes={}),t.Testbed.CompoundShapes=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(50,0),new t.b2Vec2(-50,0)),s.CreateFixture2(r,0);var a=new t.b2CircleShape;a.m_radius=.5,a.m_p.Set(-.5,.5);var l=new t.b2CircleShape;l.m_radius=.5,l.m_p.Set(.5,.5);for(var p=0;10>p;++p){var b=t.b2RandomRange(-.1,.1),n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(b+5,1.05+2.5*p),n.angle=t.b2RandomRange(-t.b2_pi,t.b2_pi);var s=this.m_world.CreateBody(n);s.CreateFixture2(a,2),s.CreateFixture2(l,0)}var m=new t.b2PolygonShape;m.SetAsBox(.25,.5);var _=new t.b2PolygonShape;_.SetAsOrientedBox(.25,.5,new t.b2Vec2(0,-.5),.5*t.b2_pi);for(var p=0;10>p;++p){var b=t.b2RandomRange(-.1,.1),n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(b-5,1.05+2.5*p),n.angle=t.b2RandomRange(-t.b2_pi,t.b2_pi);var s=this.m_world.CreateBody(n);s.CreateFixture2(m,2),s.CreateFixture2(_,2)}var d=new t.b2Transform;d.q.SetAngleRadians(.3524*t.b2_pi),d.p.Copy(t.b2MulRV(d.q,new t.b2Vec2(1,0),new t.b2Vec2));var h=new Array,c=new t.b2PolygonShape;h[0]=t.b2MulXV(d,new t.b2Vec2(-1,0),new t.b2Vec2),h[1]=t.b2MulXV(d,new t.b2Vec2(1,0),new t.b2Vec2),h[2]=t.b2MulXV(d,new t.b2Vec2(0,.5),new t.b2Vec2),c.SetAsArray(h,3);var u=new t.b2Transform;u.q.SetAngleRadians(-.3524*t.b2_pi),u.p.Copy(t.b2MulRV(u.q,new t.b2Vec2(-1,0),new t.b2Vec2));var y=new t.b2PolygonShape;h[0]=t.b2MulXV(u,new t.b2Vec2(-1,0),new t.b2Vec2),h[1]=t.b2MulXV(u,new t.b2Vec2(1,0),new t.b2Vec2),h[2]=t.b2MulXV(u,new t.b2Vec2(0,.5),new t.b2Vec2),y.SetAsArray(h,3);for(var p=0;10>p;++p){var b=t.b2RandomRange(-.1,.1),n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(b,2.05+2.5*p),n.angle=0;var s=this.m_world.CreateBody(n);s.CreateFixture2(c,2),s.CreateFixture2(y,2)}var f=new t.b2PolygonShape;f.SetAsBox(1.5,.15);var S=new t.b2PolygonShape;S.SetAsOrientedBox(.15,2.7,new t.b2Vec2(-1.45,2.35),.2);var C=new t.b2PolygonShape;C.SetAsOrientedBox(.15,2.7,new t.b2Vec2(1.45,2.35),-.2);var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(0,2);var s=this.m_world.CreateBody(n);s.CreateFixture2(f,4),s.CreateFixture2(S,4),s.CreateFixture2(C,4)},e.inherits(t.Testbed.CompoundShapes,t.Testbed.Test),t.Testbed.CompoundShapes.Create=function(e,o){return new t.Testbed.CompoundShapes(e,o)},t}(o,pt),Vt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Confined&&(t.Testbed.Confined={}),t.Testbed.Confined=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-10,0),new t.b2Vec2(10,0)),s.CreateFixture2(r,0),r.SetAsEdge(new t.b2Vec2(-10,0),new t.b2Vec2(-10,20)),s.CreateFixture2(r,0),r.SetAsEdge(new t.b2Vec2(10,0),new t.b2Vec2(10,20)),s.CreateFixture2(r,0),r.SetAsEdge(new t.b2Vec2(-10,20),new t.b2Vec2(10,20)),s.CreateFixture2(r,0);var a=.5,r=new t.b2CircleShape;r.m_p.SetZero(),r.m_radius=a;var l=new t.b2FixtureDef;l.shape=r,l.density=1,l.friction=.1;for(var p=0;p<t.Testbed.Confined.e_columnCount;++p)for(var b=0;b<t.Testbed.Confined.e_rowCount;++b){var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(-10+(2.1*p+1+.01*b)*a,(2*b+1)*a);var m=this.m_world.CreateBody(n);m.CreateFixture(l)}this.m_world.SetGravity(new t.b2Vec2(0,0))},e.inherits(t.Testbed.Confined,t.Testbed.Test),t.Testbed.Confined.e_columnCount=0,t.Testbed.Confined.e_rowCount=0,t.Testbed.Confined.prototype.CreateCircle=function(){var e=2,o=new t.b2CircleShape;o.m_p.SetZero(),o.m_radius=e;var i=new t.b2FixtureDef;i.shape=o,i.density=1,i.friction=0;var n=new t.b2Vec2(t.b2Random(),3+t.b2Random()),s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Copy(n);var r=this.m_world.CreateBody(s);r.CreateFixture(i)},t.Testbed.Confined.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.C:this.CreateCircle()}},t.Testbed.Confined.prototype.Step=function(o){for(var i=!0,n=this.m_world.GetBodyList();n;n=n.m_next)n.GetType()==t.b2BodyType.b2_dynamicBody&&n.IsAwake()&&(i=!1);180==this.m_stepCount&&(this.m_stepCount+=0),e.base(this,"Step",o);for(var n=this.m_world.GetBodyList();n;n=n.m_next)if(n.GetType()==t.b2BodyType.b2_dynamicBody){var s=n.GetPosition();(s.x<=-10||10<=s.x||s.y<=0||20<=s.y)&&(s.x+=0)}this.m_debugDraw.DrawString(5,this.m_textLine,"Press 'c' to create a circle."),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Confined.Create=function(e,o){return new t.Testbed.Confined(e,o)},t}(o,pt),Tt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.ContinuousTest&&(t.Testbed.ContinuousTest={}),t.Testbed.ContinuousTest=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef;n.position.Set(0,0);var s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-10,0),new t.b2Vec2(10,0)),s.CreateFixture2(r,0);var a=new t.b2PolygonShape;a.SetAsOrientedBox(.2,1,new t.b2Vec2(.5,1),0),s.CreateFixture2(a,0);var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(0,20);var a=new t.b2PolygonShape;a.SetAsBox(2,.1),this.m_body=this.m_world.CreateBody(n),this.m_body.CreateFixture2(a,1),this.m_angularVelocity=t.b2RandomRange(-50,50),this.m_body.SetLinearVelocity(new t.b2Vec2(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity),t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0,t.b2_toiTime=0,t.b2_toiMaxTime=0},e.inherits(t.Testbed.ContinuousTest,t.Testbed.Test),t.Testbed.ContinuousTest.prototype.m_body=null,t.Testbed.ContinuousTest.prototype.m_angularVelocity=0,t.Testbed.ContinuousTest.prototype.Launch=function(){t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0,t.b2_toiTime=0,t.b2_toiMaxTime=0,this.m_body.SetTransformVecRadians(new t.b2Vec2(0,20),0),this.m_angularVelocity=t.b2RandomRange(-50,50),this.m_body.SetLinearVelocity(new t.b2Vec2(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity)},t.Testbed.ContinuousTest.prototype.Step=function(o){e.base(this,"Step",o),t.b2_gjkCalls>0&&(this.m_debugDraw.DrawString(5,this.m_textLine,"gjk calls = %d, ave gjk iters = %3.1f, max gjk iters = %d",t.b2_gjkCalls,t.b2_gjkIters/t.b2_gjkCalls,t.b2_gjkMaxIters),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE),t.b2_toiCalls>0&&(this.m_debugDraw.DrawString(5,this.m_textLine,"toi [max] calls = %d, ave toi iters = %3.1f [%d]",t.b2_toiCalls,t.b2_toiIters/t.b2_toiCalls,t.b2_toiMaxRootIters),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"ave [max] toi root iters = %3.1f [%d]",t.b2_toiRootIters/t.b2_toiCalls,t.b2_toiMaxRootIters),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"ave [max] toi time = %.1f [%.1f] (microseconds)",1e3*t.b2_toiTime/t.b2_toiCalls,1e3*t.b2_toiMaxTime),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE),this.m_stepCount%60==0&&this.Launch()},t.Testbed.ContinuousTest.Create=function(e,o){return new t.Testbed.ContinuousTest(e,o)},t}(o,pt),Mt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.ConvexHull&&(t.Testbed.ConvexHull={}),t.Testbed.ConvexHull=function(o,i){e.base(this,o,i),this.m_test_points=t.b2Vec2.MakeArray(t.b2_maxPolygonVertices),this.Generate(),this.m_auto=!1},e.inherits(t.Testbed.ConvexHull,t.Testbed.Test),t.Testbed.ConvexHull.e_count=t.b2_maxPolygonVertices,t.Testbed.ConvexHull.prototype.m_test_points=null,t.Testbed.ConvexHull.prototype.m_count=0,t.Testbed.ConvexHull.prototype.m_auto=!1,t.Testbed.ConvexHull.prototype.Generate=function(){for(var e=0;e<t.Testbed.ConvexHull.e_count;++e){var o=t.b2RandomRange(-10,10),i=t.b2RandomRange(-10,10);o=t.b2Clamp(o,-8,8),i=t.b2Clamp(i,-8,8),this.m_test_points[e].Set(o,i)}this.m_count=t.Testbed.ConvexHull.e_count},t.Testbed.ConvexHull.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.A:this.m_auto=!this.m_auto;break;case e.events.KeyCodes.G:this.Generate()}},t.Testbed.ConvexHull.prototype.Step=function(o){e.base(this,"Step",o);var i=new t.b2PolygonShape;i.SetAsVector(this.m_test_points,this.m_count),this.m_debugDraw.DrawString(5,this.m_textLine,"Press g to generate a new random convex hull"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawPolygon(i.m_vertices,i.m_count,new t.b2Color(.9,.9,.9));for(var n=0;n<this.m_count;++n)this.m_debugDraw.DrawPoint(this.m_test_points[n],2,new t.b2Color(.9,.5,.5)),this.m_debugDraw.DrawStringWorld(this.m_test_points[n].x+.05,this.m_test_points[n].y+.05,"%d",n);0==i.Validate()&&(this.m_textLine+=0),this.m_auto&&this.Generate()},t.Testbed.ConvexHull.Create=function(e,o){return new t.Testbed.ConvexHull(e,o)},t}(o,pt),Dt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.ConveyorBelt&&(t.Testbed.ConveyorBelt={}),t.Testbed.ConveyorBelt=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-20,0),new t.b2Vec2(20,0)),s.CreateFixture2(r,0);var n=new t.b2BodyDef;n.position.Set(-5,5);var a=this.m_world.CreateBody(n),r=new t.b2PolygonShape;r.SetAsBox(10,.5);var l=new t.b2FixtureDef;l.shape=r,l.friction=.8,this.m_platform=a.CreateFixture(l);for(var p=0;5>p;++p){var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(-10+2*p,7);var a=this.m_world.CreateBody(n),r=new t.b2PolygonShape;r.SetAsBox(.5,.5),a.CreateFixture2(r,20)}},e.inherits(t.Testbed.ConveyorBelt,t.Testbed.Test),t.Testbed.ConveyorBelt.prototype.m_platform=null,t.Testbed.ConveyorBelt.prototype.PreSolve=function(t,o){e.base(this,"PreSolve",t,o);var i=t.GetFixtureA(),n=t.GetFixtureB();i==this.m_platform&&t.SetTangentSpeed(5),n==this.m_platform&&t.SetTangentSpeed(-5)},t.Testbed.ConveyorBelt.prototype.Step=function(t){e.base(this,"Step",t)},t.Testbed.ConveyorBelt.Create=function(e,o){return new t.Testbed.ConveyorBelt(e,o)},t}(o,pt),Et=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.DistanceTest&&(t.Testbed.DistanceTest={}),t.Testbed.DistanceTest=function(o,i){e.base(this,o,i),this.m_positionB=new t.b2Vec2,this.m_transformA=new t.b2Transform,this.m_transformB=new t.b2Transform,this.m_polygonA=new t.b2PolygonShape,this.m_polygonB=new t.b2PolygonShape,this.m_transformA.SetIdentity(),this.m_transformA.p.Set(0,-.2),this.m_polygonA.SetAsBox(10,.2),this.m_positionB.Set(12.017401,.13678508),this.m_angleB=-.0109265,this.m_transformB.SetPositionAngleRadians(this.m_positionB,this.m_angleB),this.m_polygonB.SetAsBox(2,.1)},e.inherits(t.Testbed.DistanceTest,t.Testbed.Test),t.Testbed.DistanceTest.prototype.m_positionB=null,t.Testbed.DistanceTest.prototype.m_angleB=0,t.Testbed.DistanceTest.prototype.m_transformA=null,t.Testbed.DistanceTest.prototype.m_transformB=null,t.Testbed.DistanceTest.prototype.m_polygonA=null,t.Testbed.DistanceTest.prototype.m_polygonB=null,t.Testbed.DistanceTest.prototype.Step=function(o){e.base(this,"Step",o);var i=new t.b2DistanceInput;i.proxyA.SetShape(this.m_polygonA,0),i.proxyB.SetShape(this.m_polygonB,0),i.transformA.Copy(this.m_transformA),i.transformB.Copy(this.m_transformB),i.useRadii=!0;var n=new t.b2SimplexCache;n.count=0;var s=new t.b2DistanceOutput;t.b2Distance(s,n,i),this.m_debugDraw.DrawString(5,this.m_textLine,"distance = %4.2f",s.distance),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"iterations = %d",s.iterations),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;for(var r=new t.b2Color(.9,.9,.9),a=new Array(t.b2_maxPolygonVertices),l=0;l<this.m_polygonA.m_count;++l)a[l]=t.b2MulXV(this.m_transformA,this.m_polygonA.m_vertices[l],new t.b2Vec2);this.m_debugDraw.DrawPolygon(a,this.m_polygonA.m_count,r);for(var l=0;l<this.m_polygonB.m_count;++l)a[l]=t.b2MulXV(this.m_transformB,this.m_polygonB.m_vertices[l],new t.b2Vec2);this.m_debugDraw.DrawPolygon(a,this.m_polygonB.m_count,r);var p=s.pointA,b=s.pointB,m=new t.b2Color(1,0,0);this.m_debugDraw.DrawPoint(p,4,m);var _=new t.b2Color(1,1,0);this.m_debugDraw.DrawPoint(b,4,_)},t.Testbed.DistanceTest.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.A:this.m_positionB.x-=.1;break;case e.events.KeyCodes.D:this.m_positionB.x+=.1;break;case e.events.KeyCodes.S:this.m_positionB.y-=.1;break;case e.events.KeyCodes.W:this.m_positionB.y+=.1;break;case e.events.KeyCodes.Q:this.m_angleB+=.1*t.b2_pi;break;case e.events.KeyCodes.E:this.m_angleB-=.1*t.b2_pi}this.m_transformB.SetPositionAngleRadians(this.m_positionB,this.m_angleB)},t.Testbed.DistanceTest.Create=function(e,o){return new t.Testbed.DistanceTest(e,o)},t}(o,pt),Pt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Dominos&&(t.Testbed.Dominos={}),t.Testbed.Dominos=function(o,i){e.base(this,o,i);var n=null,s=new t.b2EdgeShape;s.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0));var r=new t.b2BodyDef;n=this.m_world.CreateBody(r),n.CreateFixture2(s,0);var s=new t.b2PolygonShape;s.SetAsBox(6,.25);var r=new t.b2BodyDef;r.position.Set(-1.5,10);var a=this.m_world.CreateBody(r);a.CreateFixture2(s,0);var s=new t.b2PolygonShape;s.SetAsBox(.1,1);var l=new t.b2FixtureDef;l.shape=s,l.density=20,l.friction=.1;for(var p=0;10>p;++p){var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(-6+1*p,11.25);var b=this.m_world.CreateBody(r);b.CreateFixture(l)}var s=new t.b2PolygonShape;s.SetAsOrientedBox(7,.25,t.b2Vec2_zero,.3);var r=new t.b2BodyDef;r.position.Set(1,6);var a=this.m_world.CreateBody(r);a.CreateFixture2(s,0);var m=null,s=new t.b2PolygonShape;s.SetAsBox(.25,1.5);var r=new t.b2BodyDef;r.position.Set(-7,4),m=this.m_world.CreateBody(r),m.CreateFixture2(s,0);var _=null,s=new t.b2PolygonShape;s.SetAsBox(6,.125);var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(-.9,1),r.angle=-.15,_=this.m_world.CreateBody(r),_.CreateFixture2(s,10);var d=new t.b2RevoluteJointDef,h=new t.b2Vec2;h.Set(-2,1),d.Initialize(n,_,h),d.collideConnected=!0,this.m_world.CreateJoint(d);var c=null,s=new t.b2PolygonShape;s.SetAsBox(.25,.25);var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(-10,15),c=this.m_world.CreateBody(r),c.CreateFixture2(s,10),h.Set(-7,15),d.Initialize(m,c,h),this.m_world.CreateJoint(d);var u=null,r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(6.5,3),u=this.m_world.CreateBody(r);var s=new t.b2PolygonShape,l=new t.b2FixtureDef;l.shape=s,l.density=10,l.friction=.1,s.SetAsOrientedBox(1,.1,new t.b2Vec2(0,-.9),0),u.CreateFixture(l),s.SetAsOrientedBox(.1,1,new t.b2Vec2(-.9,0),0),u.CreateFixture(l),s.SetAsOrientedBox(.1,1,new t.b2Vec2(.9,0),0),u.CreateFixture(l),h.Set(6,2),d.Initialize(n,u,h),this.m_world.CreateJoint(d);var y=null,s=new t.b2PolygonShape;s.SetAsBox(1,.1);var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(6.5,4.1),y=this.m_world.CreateBody(r),y.CreateFixture2(s,30),h.Set(7.5,4),d.Initialize(u,y,h),this.m_world.CreateJoint(d);var f=null,s=new t.b2PolygonShape;s.SetAsBox(.1,1);var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(7.4,1),f=this.m_world.CreateBody(r),f.CreateFixture2(s,10);var S=new t.b2DistanceJointDef;S.bodyA=_,S.bodyB=f,S.localAnchorA.Set(6,0),S.localAnchorB.Set(0,-1);var C=t.b2SubVV(S.bodyB.GetWorldPoint(S.localAnchorB,new t.b2Vec2),S.bodyA.GetWorldPoint(S.localAnchorA,new t.b2Vec2),new t.b2Vec2);S.length=C.GetLength(),this.m_world.CreateJoint(S);var v=.2,s=new t.b2CircleShape;s.m_radius=v;for(var p=0;4>p;++p){var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Set(5.9+2*v*p,2.4);var b=this.m_world.CreateBody(r);b.CreateFixture2(s,10)}},e.inherits(t.Testbed.Dominos,t.Testbed.Test),t.Testbed.Dominos.Create=function(e,o){return new t.Testbed.Dominos(e,o)},t}(o,pt),Rt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.DumpShell&&(t.Testbed.DumpShell={}),t.Testbed.DumpShell=function(o,i){e.base(this,o,i);var n=new t.b2Vec2(0,0);this.m_world.SetGravity(n);var s=new Array(4),r=new Array(2),a=new t.b2BodyDef;a.type=t.b2BodyType.b2_staticBody,a.position.Set(0,0),a.angle=0,a.linearVelocity.Set(0,0),a.angularVelocity=0,a.linearDamping=0,a.angularDamping=0,a.allowSleep=!0,a.awake=!0,a.fixedRotation=!1,a.bullet=!1,a.active=!0,a.gravityScale=1,s[0]=this.m_world.CreateBody(a);var l=new t.b2FixtureDef;l.friction=10,l.restitution=0,l.density=0,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var p=new t.b2EdgeShape;p.m_radius=.009999999776483,p.m_vertex0.Set(0,0),p.m_vertex1.Set(0,0),p.m_vertex2.Set(44.5217399597168,0),p.m_vertex3.Set(0,0),p.m_hasVertex0=!1,p.m_hasVertex3=!1,l.shape=p,s[0].CreateFixture(l);var l=new t.b2FixtureDef;l.friction=10,l.restitution=0,l.density=0,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var p=new t.b2EdgeShape;p.m_radius=.009999999776483,p.m_vertex0.Set(0,0),p.m_vertex1.Set(0,16.69565200805664),p.m_vertex2.Set(44.5217399597168,16.69565200805664),p.m_vertex3.Set(0,0),p.m_hasVertex0=!1,p.m_hasVertex3=!1,l.shape=p,s[0].CreateFixture(l);var l=new t.b2FixtureDef;l.friction=10,l.restitution=0,l.density=0,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var p=new t.b2EdgeShape;p.m_radius=.009999999776483,p.m_vertex0.Set(0,0),p.m_vertex1.Set(0,16.69565200805664),p.m_vertex2.Set(0,0),p.m_vertex3.Set(0,0),p.m_hasVertex0=!1,p.m_hasVertex3=!1,l.shape=p,s[0].CreateFixture(l);var l=new t.b2FixtureDef;l.friction=10,l.restitution=0,l.density=0,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var p=new t.b2EdgeShape;p.m_radius=.009999999776483,p.m_vertex0.Set(0,0),p.m_vertex1.Set(44.5217399597168,16.69565200805664),p.m_vertex2.Set(44.5217399597168,0),p.m_vertex3.Set(0,0),p.m_hasVertex0=!1,p.m_hasVertex3=!1,l.shape=p,s[0].CreateFixture(l);var a=new t.b2BodyDef;a.type=t.b2BodyType.b2_dynamicBody,a.position.Set(.847826063632965,2.5),a.angle=0,a.linearVelocity.Set(0,0),a.angularVelocity=0,a.linearDamping=.5,a.angularDamping=.5,a.allowSleep=!0,a.awake=!0,a.fixedRotation=!1,a.bullet=!1,a.active=!0,a.gravityScale=1,s[1]=this.m_world.CreateBody(a);var l=new t.b2FixtureDef;l.friction=1,l.restitution=.5,l.density=10,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var p=new t.b2PolygonShape,b=t.b2Vec2.MakeArray(8);b[0].Set(6.907599925994873,.327199995517731),b[1].Set(-.322800010442734,.282599985599518),b[2].Set(-.322800010442734,-.295700013637543),b[3].Set(6.885900020599365,-.364100009202957),p.SetAsVector(b,4),l.shape=p,s[1].CreateFixture(l);var a=new t.b2BodyDef;a.type=t.b2BodyType.b2_dynamicBody,a.position.Set(13.04347801208496,2.5),a.angle=0,a.linearVelocity.Set(0,0),a.angularVelocity=0,a.linearDamping=.5,a.angularDamping=.5,a.allowSleep=!0,a.awake=!0,a.fixedRotation=!1,a.bullet=!1,a.active=!0,a.gravityScale=1,s[2]=this.m_world.CreateBody(a);var l=new t.b2FixtureDef;l.friction=1,l.restitution=.5,l.density=10,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var p=new t.b2PolygonShape,b=t.b2Vec2.MakeArray(8);b[0].Set(.200000002980232,-.300000011920929),b[1].Set(.200000002980232,.200000002980232),b[2].Set(-6.900000095367432,.200000002980232),b[3].Set(-6.900000095367432,-.300000011920929),p.SetAsVector(b,4),l.shape=p,s[2].CreateFixture(l);var a=new t.b2BodyDef;a.type=t.b2BodyType.b2_staticBody,a.position.Set(0,0),a.angle=0,a.linearVelocity.Set(0,0),a.angularVelocity=0,a.linearDamping=0,a.angularDamping=0,a.allowSleep=!0,a.awake=!0,a.fixedRotation=!1,a.bullet=!1,a.active=!0,a.gravityScale=1,s[3]=this.m_world.CreateBody(a);var m=new t.b2RevoluteJointDef;m.bodyA=s[1],m.bodyB=s[0],m.collideConnected=!1,m.localAnchorA.Set(0,0),m.localAnchorB.Set(.847826063632965,2.5),m.referenceAngle=0,m.enableLimit=!1,m.lowerAngle=0,m.upperAngle=0,m.enableMotor=!1,m.motorSpeed=0,m.maxMotorTorque=0,r[0]=this.m_world.CreateJoint(m);var m=new t.b2PrismaticJointDef;m.bodyA=s[1],m.bodyB=s[2],m.collideConnected=!1,m.localAnchorA.Set(0,0),m.localAnchorB.Set(-12.19565200805664,0),m.localAxisA.Set(-1,0),m.referenceAngle=0,m.enableLimit=!0,m.lowerTranslation=-20,m.upperTranslation=0,m.enableMotor=!0,m.motorSpeed=0,m.maxMotorForce=10,r[1]=this.m_world.CreateJoint(m)},e.inherits(t.Testbed.DumpShell,t.Testbed.Test),t.Testbed.DumpShell.Create=function(e,o){return new t.Testbed.DumpShell(e,o)},t}(o,pt),It=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.DynamicTreeTest&&(t.Testbed.DynamicTreeTest={}),t.Testbed.Actor=function(){this.aabb=new t.b2AABB},t.Testbed.Actor.prototype.aabb=null,t.Testbed.Actor.prototype.fraction=0,t.Testbed.Actor.prototype.overlap=!1,t.Testbed.Actor.prototype.proxyId=null,t.Testbed.DynamicTreeTest=function(o,i){e.base(this,o,i),this.m_tree=new t.b2DynamicTree,this.m_queryAABB=new t.b2AABB,this.m_rayCastInput=new t.b2RayCastInput,this.m_rayCastOutput=new t.b2RayCastOutput,this.m_actors=new Array(t.Testbed.DynamicTreeTest.e_actorCount);for(var n=0;n<t.Testbed.DynamicTreeTest.e_actorCount;++n)this.m_actors[n]=new t.Testbed.Actor;this.m_worldExtent=15,this.m_proxyExtent=.5;for(var n=0;n<t.Testbed.DynamicTreeTest.e_actorCount;++n){var s=this.m_actors[n];this.GetRandomAABB(s.aabb),s.proxyId=this.m_tree.CreateProxy(s.aabb,s)}this.m_stepCount=0;var r=this.m_worldExtent;this.m_queryAABB.lowerBound.Set(-3,-4+r),this.m_queryAABB.upperBound.Set(5,6+r),this.m_rayCastInput.p1.Set(-5,5+r),this.m_rayCastInput.p2.Set(7,-4+r),this.m_rayCastInput.maxFraction=1,this.m_automated=!1},e.inherits(t.Testbed.DynamicTreeTest,t.Testbed.Test),t.Testbed.DynamicTreeTest.e_actorCount=128,t.Testbed.DynamicTreeTest.prototype.m_worldExtent=0,t.Testbed.DynamicTreeTest.prototype.m_proxyExtent=0,t.Testbed.DynamicTreeTest.prototype.m_tree=null,t.Testbed.DynamicTreeTest.prototype.m_queryAABB=null,t.Testbed.DynamicTreeTest.prototype.m_rayCastInput=null,t.Testbed.DynamicTreeTest.prototype.m_rayCastOutput=null,t.Testbed.DynamicTreeTest.prototype.m_actor=null,t.Testbed.DynamicTreeTest.prototype.m_actors=null,t.Testbed.DynamicTreeTest.prototype.m_stepCount=0,t.Testbed.DynamicTreeTest.prototype.m_automated=!1,t.Testbed.DynamicTreeTest.prototype.Step=function(o){e.base(this,"Step",o),this.m_rayActor=null;for(var i=0;i<t.Testbed.DynamicTreeTest.e_actorCount;++i)this.m_actors[i].fraction=1,this.m_actors[i].overlap=!1;if(1==this.m_automated)for(var n=t.b2Max(1,t.Testbed.DynamicTreeTest.e_actorCount>>2),i=0;n>i;++i)this.Action();this.Query(),this.RayCast();for(var i=0;i<t.Testbed.DynamicTreeTest.e_actorCount;++i){var s=this.m_actors[i];if(null!=s.proxyId){var r=new t.b2Color(.9,.9,.9);s==this.m_rayActor&&s.overlap?r.SetRGB(.9,.6,.6):s==this.m_rayActor?r.SetRGB(.6,.9,.6):s.overlap&&r.SetRGB(.6,.6,.9),this.m_debugDraw.DrawAABB(s.aabb,r)}}var r=new t.b2Color(.7,.7,.7);this.m_debugDraw.DrawAABB(this.m_queryAABB,r),this.m_debugDraw.DrawSegment(this.m_rayCastInput.p1,this.m_rayCastInput.p2,r);var a=new t.b2Color(.2,.9,.2),l=new t.b2Color(.9,.2,.2);if(this.m_debugDraw.DrawPoint(this.m_rayCastInput.p1,6,a),this.m_debugDraw.DrawPoint(this.m_rayCastInput.p2,6,l),this.m_rayActor){var p=new t.b2Color(.2,.2,.9),b=t.b2AddVV(this.m_rayCastInput.p1,t.b2MulSV(this.m_rayActor.fraction,t.b2SubVV(this.m_rayCastInput.p2,this.m_rayCastInput.p1,new t.b2Vec2),new t.b2Vec2),new t.b2Vec2);this.m_debugDraw.DrawPoint(b,6,p)}var m=this.m_tree.GetHeight();this.m_debugDraw.DrawString(5,this.m_textLine,"dynamic tree height = %d",m),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,++this.m_stepCount},t.Testbed.DynamicTreeTest.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.A:this.m_automated=!this.m_automated;break;case e.events.KeyCodes.C:this.CreateProxy();break;case e.events.KeyCodes.D:this.DestroyProxy();break;case e.events.KeyCodes.M:this.MoveProxy()}},t.Testbed.DynamicTreeTest.prototype.GetRandomAABB=function(e){var o=new t.b2Vec2;o.Set(2*this.m_proxyExtent,2*this.m_proxyExtent),e.lowerBound.x=t.b2RandomRange(-this.m_worldExtent,this.m_worldExtent),e.lowerBound.y=t.b2RandomRange(0,2*this.m_worldExtent),e.upperBound.Copy(e.lowerBound),e.upperBound.SelfAdd(o)},t.Testbed.DynamicTreeTest.prototype.MoveAABB=function(e){var o=new t.b2Vec2;o.x=t.b2RandomRange(-.5,.5),o.y=t.b2RandomRange(-.5,.5),e.lowerBound.SelfAdd(o),e.upperBound.SelfAdd(o);var i=t.b2MulSV(.5,t.b2AddVV(e.lowerBound,e.upperBound,t.b2Vec2.s_t0),new t.b2Vec2),n=new t.b2Vec2(-this.m_worldExtent,0),s=new t.b2Vec2(this.m_worldExtent,2*this.m_worldExtent),r=t.b2ClampV(i,n,s,new t.b2Vec2);e.lowerBound.SelfAdd(t.b2SubVV(r,i,new t.b2Vec2)),e.upperBound.SelfAdd(t.b2SubVV(r,i,new t.b2Vec2))},t.Testbed.DynamicTreeTest.prototype.CreateProxy=function(){for(var e=0;e<t.Testbed.DynamicTreeTest.e_actorCount;++e){var o=0|t.b2RandomRange(0,t.Testbed.DynamicTreeTest.e_actorCount),i=this.m_actors[o];if(null==i.proxyId)return this.GetRandomAABB(i.aabb),i.proxyId=this.m_tree.CreateProxy(i.aabb,i),void 0}},t.Testbed.DynamicTreeTest.prototype.DestroyProxy=function(){for(var e=0;e<t.Testbed.DynamicTreeTest.e_actorCount;++e){var o=0|t.b2RandomRange(0,t.Testbed.DynamicTreeTest.e_actorCount),i=this.m_actors[o];if(null!=i.proxyId)return this.m_tree.DestroyProxy(i.proxyId),i.proxyId=null,void 0}},t.Testbed.DynamicTreeTest.prototype.MoveProxy=function(){for(var e=0;e<t.Testbed.DynamicTreeTest.e_actorCount;++e){var o=0|t.b2RandomRange(0,t.Testbed.DynamicTreeTest.e_actorCount),i=this.m_actors[o];if(null!=i.proxyId){var n=new t.b2AABB;n.Copy(i.aabb),this.MoveAABB(i.aabb);var s=t.b2SubVV(i.aabb.GetCenter(),n.GetCenter(),new t.b2Vec2);return this.m_tree.MoveProxy(i.proxyId,i.aabb,s),void 0}}},t.Testbed.DynamicTreeTest.prototype.Action=function(){var e=0|t.b2RandomRange(0,20);switch(e){case 0:this.CreateProxy();break;case 1:this.DestroyProxy();break;default:this.MoveProxy()}},t.Testbed.DynamicTreeTest.prototype.Query=function(){var e=this,o=function(o){var i=e.m_tree.GetUserData(o);return i.overlap=t.b2TestOverlapAABB(e.m_queryAABB,i.aabb),!0};this.m_tree.Query(o,this.m_queryAABB);for(var i=0;i<t.Testbed.DynamicTreeTest.e_actorCount;++i)if(null!=this.m_actors[i].proxyId){var n=t.b2TestOverlapAABB(this.m_queryAABB,this.m_actors[i].aabb);t.ENABLE_ASSERTS&&t.b2Assert(n==this.m_actors[i].overlap)}},t.Testbed.DynamicTreeTest.prototype.RayCast=function(){var e=this,o=function(o,i){var n=e.m_tree.GetUserData(i),s=new t.b2RayCastOutput,r=n.aabb.RayCast(s,o);return r?(e.m_rayCastOutput=s,e.m_rayActor=n,e.m_rayActor.fraction=s.fraction,s.fraction):o.maxFraction};this.m_rayActor=null;var i=new t.b2RayCastInput;i.Copy(this.m_rayCastInput),this.m_tree.RayCast(o,i);for(var n=null,s=new t.b2RayCastOutput,r=0;r<t.Testbed.DynamicTreeTest.e_actorCount;++r)if(null!=this.m_actors[r].proxyId){var a=new t.b2RayCastOutput,l=this.m_actors[r].aabb.RayCast(a,i);l&&(n=this.m_actors[r],s=a,i.maxFraction=a.fraction)}},t.Testbed.DynamicTreeTest.Create=function(e,o){return new t.Testbed.DynamicTreeTest(e,o)},t}(o,pt),Jt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.EdgeShapes&&(t.Testbed.EdgeShapes={}),t.Testbed.EdgeShapesCallback=function(){e.base(this),this.m_point=new t.b2Vec2,this.m_normal=new t.b2Vec2
},e.inherits(t.Testbed.EdgeShapesCallback,t.b2RayCastCallback),t.Testbed.EdgeShapesCallback.prototype.m_fixture=null,t.Testbed.EdgeShapesCallback.prototype.m_point=null,t.Testbed.EdgeShapesCallback.prototype.m_normal=null,t.Testbed.EdgeShapesCallback.prototype.ReportFixture=function(e,t,o,i){return this.m_fixture=e,this.m_point.Copy(t),this.m_normal.Copy(o),i},t.Testbed.EdgeShapes=function(o,i){e.base(this,o,i),this.m_bodyIndex=0,this.m_bodies=new Array(t.Testbed.EdgeShapes.e_maxBodies),this.m_polygons=new Array(4);for(var n=0;4>n;++n)this.m_polygons[n]=new t.b2PolygonShape;this.m_circle=new t.b2CircleShape,this.m_angle=0;for(var s=new t.b2BodyDef,r=this.m_world.CreateBody(s),a=-20,l=2*t.b2Cos(a/10*t.b2_pi),n=0;80>n;++n){var p=a+.5,b=2*t.b2Cos(p/10*t.b2_pi),m=new t.b2EdgeShape;m.SetAsEdge(new t.b2Vec2(a,l),new t.b2Vec2(p,b)),r.CreateFixture2(m,0),a=p,l=b}var _=new Array(3);_[0]=new t.b2Vec2(-.5,0),_[1]=new t.b2Vec2(.5,0),_[2]=new t.b2Vec2(0,1.5),this.m_polygons[0].SetAsArray(_,3);var _=new Array(3);_[0]=new t.b2Vec2(-.1,0),_[1]=new t.b2Vec2(.1,0),_[2]=new t.b2Vec2(0,1.5),this.m_polygons[1].SetAsArray(_,3);var d=1,h=d/(2+t.b2Sqrt(2)),c=t.b2Sqrt(2)*h,_=new Array(8);_[0]=new t.b2Vec2(.5*c,0),_[1]=new t.b2Vec2(.5*d,h),_[2]=new t.b2Vec2(.5*d,h+c),_[3]=new t.b2Vec2(.5*c,d),_[4]=new t.b2Vec2(-.5*c,d),_[5]=new t.b2Vec2(-.5*d,h+c),_[6]=new t.b2Vec2(-.5*d,h),_[7]=new t.b2Vec2(-.5*c,0),this.m_polygons[2].SetAsArray(_,8),this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5;for(var n=0;n<t.Testbed.EdgeShapes.e_maxBodies;++n)this.m_bodies[n]=null},e.inherits(t.Testbed.EdgeShapes,t.Testbed.Test),t.Testbed.EdgeShapes.e_maxBodies=256,t.Testbed.EdgeShapes.prototype.m_bodyIndex=0,t.Testbed.EdgeShapes.prototype.m_bodies=null,t.Testbed.EdgeShapes.prototype.m_polygons=null,t.Testbed.EdgeShapes.prototype.m_circle=null,t.Testbed.EdgeShapes.prototype.m_angle=0,t.Testbed.EdgeShapes.prototype.CreateBody=function(e){null!=this.m_bodies[this.m_bodyIndex]&&(this.m_world.DestroyBody(this.m_bodies[this.m_bodyIndex]),this.m_bodies[this.m_bodyIndex]=null);var o=new t.b2BodyDef,i=t.b2RandomRange(-10,10),n=t.b2RandomRange(10,20);if(o.position.Set(i,n),o.angle=t.b2RandomRange(-t.b2_pi,t.b2_pi),o.type=t.b2BodyType.b2_dynamicBody,4==e&&(o.angularDamping=.02),this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(o),4>e){var s=new t.b2FixtureDef;s.shape=this.m_polygons[e],s.friction=.3,s.density=20,this.m_bodies[this.m_bodyIndex].CreateFixture(s)}else{var s=new t.b2FixtureDef;s.shape=this.m_circle,s.friction=.3,s.density=20,this.m_bodies[this.m_bodyIndex].CreateFixture(s)}this.m_bodyIndex=(this.m_bodyIndex+1)%t.Testbed.EdgeShapes.e_maxBodies},t.Testbed.EdgeShapes.prototype.DestroyBody=function(){for(var e=0;e<t.Testbed.EdgeShapes.e_maxBodies;++e)if(null!=this.m_bodies[e])return this.m_world.DestroyBody(this.m_bodies[e]),this.m_bodies[e]=null,void 0},t.Testbed.EdgeShapes.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.ONE:case e.events.KeyCodes.TWO:case e.events.KeyCodes.THREE:case e.events.KeyCodes.FOUR:case e.events.KeyCodes.FIVE:this.CreateBody(t-e.events.KeyCodes.ONE);break;case e.events.KeyCodes.D:this.DestroyBody()}},t.Testbed.EdgeShapes.prototype.Step=function(o){var i=0==o.pause||o.singleStep;e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Press 1-5 to drop stuff, m to change the mode"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;var n=25,s=new t.b2Vec2(0,10),r=new t.b2Vec2(n*t.b2Cos(this.m_angle),-n*t.b2Abs(t.b2Sin(this.m_angle))),a=t.b2AddVV(s,r,new t.b2Vec2),l=new t.Testbed.EdgeShapesCallback;if(this.m_world.RayCast(l,s,a),l.m_fixture){this.m_debugDraw.DrawPoint(l.m_point,5,new t.b2Color(.4,.9,.4)),this.m_debugDraw.DrawSegment(s,l.m_point,new t.b2Color(.8,.8,.8));var p=t.b2AddVV(l.m_point,t.b2MulSV(.5,l.m_normal,t.b2Vec2.s_t0),new t.b2Vec2);this.m_debugDraw.DrawSegment(l.m_point,p,new t.b2Color(.9,.9,.4))}else this.m_debugDraw.DrawSegment(s,a,new t.b2Color(.8,.8,.8));i&&(this.m_angle+=.25*t.b2_pi/180)},t.Testbed.EdgeShapes.Create=function(e,o){return new t.Testbed.EdgeShapes(e,o)},t}(o,pt),Lt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.EdgeTest&&(t.Testbed.EdgeTest={}),t.Testbed.EdgeTest=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2Vec2(-10,0),a=new t.b2Vec2(-7,-2),l=new t.b2Vec2(-4,0),p=new t.b2Vec2(0,0),b=new t.b2Vec2(4,0),m=new t.b2Vec2(7,2),_=new t.b2Vec2(10,0),d=new t.b2EdgeShape;d.SetAsEdge(r,a),d.m_hasVertex3=!0,d.m_vertex3.Copy(l),s.CreateFixture2(d,0),d.SetAsEdge(a,l),d.m_hasVertex0=!0,d.m_hasVertex3=!0,d.m_vertex0.Copy(r),d.m_vertex3.Copy(p),s.CreateFixture2(d,0),d.SetAsEdge(l,p),d.m_hasVertex0=!0,d.m_hasVertex3=!0,d.m_vertex0.Copy(a),d.m_vertex3.Copy(b),s.CreateFixture2(d,0),d.SetAsEdge(p,b),d.m_hasVertex0=!0,d.m_hasVertex3=!0,d.m_vertex0.Copy(l),d.m_vertex3.Copy(m),s.CreateFixture2(d,0),d.SetAsEdge(b,m),d.m_hasVertex0=!0,d.m_hasVertex3=!0,d.m_vertex0.Copy(p),d.m_vertex3.Copy(_),s.CreateFixture2(d,0),d.SetAsEdge(m,_),d.m_hasVertex0=!0,d.m_vertex0.Copy(b),s.CreateFixture2(d,0);var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(-.5,.6),n.allowSleep=!1;var h=this.m_world.CreateBody(n),d=new t.b2CircleShape;d.m_radius=.5,h.CreateFixture2(d,1);var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(1,.6),n.allowSleep=!1;var h=this.m_world.CreateBody(n),d=new t.b2PolygonShape;d.SetAsBox(.5,.5),h.CreateFixture2(d,1)},e.inherits(t.Testbed.EdgeTest,t.Testbed.Test),t.Testbed.EdgeTest.Create=function(e,o){return new t.Testbed.EdgeTest(e,o)},t}(o,pt),Ft=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Gears&&(t.Testbed.Gears={}),t.Testbed.Gears=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-50,0),new t.b2Vec2(50,0)),n.CreateFixture2(r,0);var a=new t.b2CircleShape;a.m_radius=1;var l=new t.b2PolygonShape;l.SetAsBox(.5,5);var p=new t.b2CircleShape;p.m_radius=2;var b=new t.b2BodyDef;b.type=t.b2BodyType.b2_staticBody,b.position.Set(10,9);var m=this.m_world.CreateBody(b);m.CreateFixture2(a,5);var _=new t.b2BodyDef;_.type=t.b2BodyType.b2_dynamicBody,_.position.Set(10,8);var d=this.m_world.CreateBody(_);d.CreateFixture2(l,5);var h=new t.b2BodyDef;h.type=t.b2BodyType.b2_dynamicBody,h.position.Set(10,6);var c=this.m_world.CreateBody(h);c.CreateFixture2(p,5);var u=new t.b2RevoluteJointDef;u.Initialize(d,m,b.position);var y=this.m_world.CreateJoint(u),f=new t.b2RevoluteJointDef;f.Initialize(d,c,h.position);var S=this.m_world.CreateJoint(f),C=new t.b2GearJointDef;C.bodyA=m,C.bodyB=c,C.joint1=y,C.joint2=S,C.ratio=p.m_radius/a.m_radius,this.m_world.CreateJoint(C);var a=new t.b2CircleShape;a.m_radius=1;var p=new t.b2CircleShape;p.m_radius=2;var l=new t.b2PolygonShape;l.SetAsBox(.5,5);var b=new t.b2BodyDef;b.type=t.b2BodyType.b2_dynamicBody,b.position.Set(-3,12);var m=this.m_world.CreateBody(b);m.CreateFixture2(a,5);var u=new t.b2RevoluteJointDef;u.bodyA=n,u.bodyB=m,n.GetLocalPoint(b.position,u.localAnchorA),m.GetLocalPoint(b.position,u.localAnchorB),u.referenceAngle=m.GetAngleRadians()-n.GetAngleRadians(),this.m_joint1=this.m_world.CreateJoint(u);var _=new t.b2BodyDef;_.type=t.b2BodyType.b2_dynamicBody,_.position.Set(0,12);var d=this.m_world.CreateBody(_);d.CreateFixture2(p,5);var f=new t.b2RevoluteJointDef;f.Initialize(n,d,_.position),this.m_joint2=this.m_world.CreateJoint(f);var h=new t.b2BodyDef;h.type=t.b2BodyType.b2_dynamicBody,h.position.Set(2.5,12);var c=this.m_world.CreateBody(h);c.CreateFixture2(l,5);var v=new t.b2PrismaticJointDef;v.Initialize(n,c,h.position,new t.b2Vec2(0,1)),v.lowerTranslation=-5,v.upperTranslation=5,v.enableLimit=!0,this.m_joint3=this.m_world.CreateJoint(v);var C=new t.b2GearJointDef;C.bodyA=m,C.bodyB=d,C.joint1=this.m_joint1,C.joint2=this.m_joint2,C.ratio=p.m_radius/a.m_radius,this.m_joint4=this.m_world.CreateJoint(C);var A=new t.b2GearJointDef;A.bodyA=d,A.bodyB=c,A.joint1=this.m_joint2,A.joint2=this.m_joint3,A.ratio=-1/p.m_radius,this.m_joint5=this.m_world.CreateJoint(A)},e.inherits(t.Testbed.Gears,t.Testbed.Test),t.Testbed.Gears.prototype.m_joint1=null,t.Testbed.Gears.prototype.m_joint2=null,t.Testbed.Gears.prototype.m_joint3=null,t.Testbed.Gears.prototype.m_joint4=null,t.Testbed.Gears.prototype.m_joint5=null,t.Testbed.Gears.prototype.Keyboard=function(e){switch(e){case 0:}},t.Testbed.Gears.prototype.Step=function(o){e.base(this,"Step",o);var i,n;i=this.m_joint4.GetRatio(),n=this.m_joint1.GetJointAngleRadians()+i*this.m_joint2.GetJointAngleRadians(),this.m_debugDraw.DrawString(5,this.m_textLine,"theta1 + %4.2f * theta2 = %4.2f",i,n),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,i=this.m_joint5.GetRatio(),n=this.m_joint2.GetJointAngleRadians()+i*this.m_joint3.GetJointTranslation(),this.m_debugDraw.DrawString(5,this.m_textLine,"theta2 + %4.2f * delta = %4.2f",i,n),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Gears.Create=function(e,o){return new t.Testbed.Gears(e,o)},t}(o,pt),Gt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Mobile&&(t.Testbed.Mobile={}),t.Testbed.Mobile=function(o,i){e.base(this,o,i);var n,s=new t.b2BodyDef;s.position.Set(0,20),n=this.m_world.CreateBody(s);var r=.5,a=new t.b2Vec2(0,r),l=this.AddNode(n,t.b2Vec2_zero,0,3,r),p=new t.b2RevoluteJointDef;p.bodyA=n,p.bodyB=l,p.localAnchorA.SetZero(),p.localAnchorB.Copy(a),this.m_world.CreateJoint(p)},e.inherits(t.Testbed.Mobile,t.Testbed.Test),t.Testbed.Mobile.e_depth=4,t.Testbed.Mobile.prototype.AddNode=function(e,o,i,n,s){var r=20,a=new t.b2Vec2(0,s),l=e.GetPosition().Clone().SelfAdd(o).SelfSub(a),p=new t.b2BodyDef;p.type=t.b2BodyType.b2_dynamicBody,p.position.Copy(l);var b=this.m_world.CreateBody(p),m=new t.b2PolygonShape;if(m.SetAsBox(.25*s,s),b.CreateFixture2(m,r),i==t.Testbed.Mobile.e_depth)return b;var _=new t.b2Vec2(n,-s),d=new t.b2Vec2(-n,-s),h=this.AddNode(b,_,i+1,.5*n,s),c=this.AddNode(b,d,i+1,.5*n,s),u=new t.b2RevoluteJointDef;return u.bodyA=b,u.localAnchorB.Copy(a),u.localAnchorA.Copy(_),u.bodyB=h,this.m_world.CreateJoint(u),u.localAnchorA.Copy(d),u.bodyB=c,this.m_world.CreateJoint(u),b},t.Testbed.Mobile.Create=function(e,o){return new t.Testbed.Mobile(e,o)},t}(o,pt),Nt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.MobileBalanced&&(t.Testbed.MobileBalanced={}),t.Testbed.MobileBalanced=function(o,i){e.base(this,o,i);var n,s=new t.b2BodyDef;s.position.Set(0,20),n=this.m_world.CreateBody(s);var r=.5,a=new t.b2Vec2(0,r),l=this.AddNode(n,t.b2Vec2_zero,0,3,r),p=new t.b2RevoluteJointDef;p.bodyA=n,p.bodyB=l,p.localAnchorA.SetZero(),p.localAnchorB.Copy(a),this.m_world.CreateJoint(p)},e.inherits(t.Testbed.MobileBalanced,t.Testbed.Test),t.Testbed.MobileBalanced.e_depth=4,t.Testbed.MobileBalanced.prototype.AddNode=function(e,o,i,n,s){var r=20,a=new t.b2Vec2(0,s),l=e.GetPosition().Clone().SelfAdd(o).SelfSub(a),p=new t.b2BodyDef;p.type=t.b2BodyType.b2_dynamicBody,p.position.Copy(l);var b=this.m_world.CreateBody(p),m=new t.b2PolygonShape;if(m.SetAsBox(.25*s,s),b.CreateFixture2(m,r),i==t.Testbed.MobileBalanced.e_depth)return b;m.SetAsOrientedBox(n,.25*s,new t.b2Vec2(0,-s),0),b.CreateFixture2(m,r);var _=new t.b2Vec2(n,-s),d=new t.b2Vec2(-n,-s),h=this.AddNode(b,_,i+1,.5*n,s),c=this.AddNode(b,d,i+1,.5*n,s),u=new t.b2RevoluteJointDef;return u.bodyA=b,u.localAnchorB.Copy(a),u.localAnchorA.Copy(_),u.bodyB=h,this.m_world.CreateJoint(u),u.localAnchorA.Copy(d),u.bodyB=c,this.m_world.CreateJoint(u),b},t.Testbed.MobileBalanced.Create=function(e,o){return new t.Testbed.MobileBalanced(e,o)},t}(o,pt),kt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.MotorJoint&&(t.Testbed.MotorJoint={}),t.Testbed.MotorJoint=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-20,0),new t.b2Vec2(20,0));var a=new t.b2FixtureDef;a.shape=r,n.CreateFixture(a);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(0,8);var l=this.m_world.CreateBody(s),r=new t.b2PolygonShape;r.SetAsBox(2,.5);var a=new t.b2FixtureDef;a.shape=r,a.friction=.6,a.density=2,l.CreateFixture(a);var p=new t.b2MotorJointDef;p.Initialize(n,l),p.maxForce=1e3,p.maxTorque=1e3,this.m_joint=this.m_world.CreateJoint(p),this.m_go=!1,this.m_time=0},e.inherits(t.Testbed.MotorJoint,t.Testbed.Test),t.Testbed.MotorJoint.prototype.m_joint=null,t.Testbed.MotorJoint.prototype.m_time=0,t.Testbed.MotorJoint.prototype.m_go=!1,t.Testbed.MotorJoint.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.S:this.m_go=!this.m_go}},t.Testbed.MotorJoint.prototype.Step=function(o){this.m_go&&o.hz>0&&(this.m_time+=1/o.hz);var i=new t.b2Vec2;i.x=6*t.b2Sin(2*this.m_time),i.y=8+4*t.b2Sin(1*this.m_time);var n=4*this.m_time;this.m_joint.SetLinearOffset(i),this.m_joint.SetAngularOffset(n),this.m_debugDraw.DrawPoint(i,4,new t.b2Color(.9,.9,.9)),e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Keys: (s) pause"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.MotorJoint.Create=function(e,o){return new t.Testbed.MotorJoint(e,o)},t}(o,pt),Ot=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.OneSidedPlatform&&(t.Testbed.OneSidedPlatform={}),t.Testbed.OneSidedPlatform=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0);var n=new t.b2BodyDef;n.position.Set(0,10);var a=this.m_world.CreateBody(n),r=new t.b2PolygonShape;r.SetAsBox(3,.5),this.m_platform=a.CreateFixture2(r,0),this.m_bottom=9.5,this.m_top=10.5;var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(0,12);var a=this.m_world.CreateBody(n);this.m_radius=.5;var r=new t.b2CircleShape;r.m_radius=this.m_radius,this.m_character=a.CreateFixture2(r,20),a.SetLinearVelocity(new t.b2Vec2(0,-50)),this.m_state=t.Testbed.OneSidedPlatform.e_unknown},e.inherits(t.Testbed.OneSidedPlatform,t.Testbed.Test),t.Testbed.OneSidedPlatform.e_unknown=0,t.Testbed.OneSidedPlatform.e_above=1,t.Testbed.OneSidedPlatform.e_below=2,t.Testbed.OneSidedPlatform.prototype.m_radius=0,t.Testbed.OneSidedPlatform.prototype.m_top=0,t.Testbed.OneSidedPlatform.prototype.m_bottom=0,t.Testbed.OneSidedPlatform.prototype.m_state=t.Testbed.OneSidedPlatform.e_unknown,t.Testbed.OneSidedPlatform.prototype.m_platform=null,t.Testbed.OneSidedPlatform.prototype.m_character=null,t.Testbed.OneSidedPlatform.prototype.PreSolve=function(o,i){e.base(this,"PreSolve",o,i);var n=o.GetFixtureA(),s=o.GetFixtureB();if(!(n!=this.m_platform&&n!=this.m_character||s!=this.m_platform&&s!=this.m_character)){var r=this.m_character.GetBody().GetPosition();r.y<this.m_top+this.m_radius-3*t.b2_linearSlop&&o.SetEnabled(!1)}},t.Testbed.OneSidedPlatform.prototype.Step=function(o){e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Press: (c) create a shape, (d) destroy a shape."),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;var i=this.m_character.GetBody().GetLinearVelocity();this.m_debugDraw.DrawString(5,this.m_textLine,"Character Linear Velocity: %f",i.y),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.OneSidedPlatform.Create=function(e,o){return new t.Testbed.OneSidedPlatform(e,o)},t}(o,pt),Wt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Pinball&&(t.Testbed.Pinball={}),t.Testbed.Pinball=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=t.b2Vec2.MakeArray(5);r[0].Set(0,-2),r[1].Set(8,6),r[2].Set(8,20),r[3].Set(-8,20),r[4].Set(-8,6);var a=new t.b2ChainShape;a.CreateLoop(r,5);var l=new t.b2FixtureDef;l.shape=a,l.density=0,n.CreateFixture(l);var p=new t.b2Vec2(-2,0),b=new t.b2Vec2(2,0),s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position=p;var m=this.m_world.CreateBody(s);s.position=b;var _=this.m_world.CreateBody(s),d=new t.b2PolygonShape;d.SetAsBox(1.75,.1);var l=new t.b2FixtureDef;l.shape=d,l.density=1,m.CreateFixture(l),_.CreateFixture(l);var h=new t.b2RevoluteJointDef;h.bodyA=n,h.localAnchorB.SetZero(),h.enableMotor=!0,h.maxMotorTorque=1e3,h.enableLimit=!0,h.motorSpeed=0,h.localAnchorA.Copy(p),h.bodyB=m,h.lowerAngle=-30*t.b2_pi/180,h.upperAngle=5*t.b2_pi/180,this.m_leftJoint=this.m_world.CreateJoint(h),h.motorSpeed=0,h.localAnchorA.Copy(b),h.bodyB=_,h.lowerAngle=-5*t.b2_pi/180,h.upperAngle=30*t.b2_pi/180,this.m_rightJoint=this.m_world.CreateJoint(h);var s=new t.b2BodyDef;s.position.Set(1,15),s.type=t.b2BodyType.b2_dynamicBody,s.bullet=!0,this.m_ball=this.m_world.CreateBody(s);var c=new t.b2CircleShape;c.m_radius=.2;var l=new t.b2FixtureDef;l.shape=c,l.density=1,this.m_ball.CreateFixture(l),this.m_button=!1},e.inherits(t.Testbed.Pinball,t.Testbed.Test),t.Testbed.Pinball.prototype.m_leftJoint=null,t.Testbed.Pinball.prototype.m_rightJoint=null,t.Testbed.Pinball.prototype.m_ball=null,t.Testbed.Pinball.prototype.m_button=!1,t.Testbed.Pinball.prototype.Step=function(o){this.m_button?(this.m_leftJoint.SetMotorSpeed(20),this.m_rightJoint.SetMotorSpeed(-20)):(this.m_leftJoint.SetMotorSpeed(-10),this.m_rightJoint.SetMotorSpeed(10)),e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Press 'a' to control the flippers"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Pinball.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.A:this.m_button=!0}},t.Testbed.Pinball.prototype.KeyboardUp=function(t){switch(t){case e.events.KeyCodes.A:this.m_button=!1}},t.Testbed.Pinball.Create=function(e,o){return new t.Testbed.Pinball(e,o)},t}(o,pt),zt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.PolyCollision&&(t.Testbed.PolyCollision={}),t.Testbed.PolyCollision=function(o,i){e.base(this,o,i),this.m_polygonA=new t.b2PolygonShape,this.m_polygonB=new t.b2PolygonShape,this.m_transformA=new t.b2Transform,this.m_transformB=new t.b2Transform,this.m_positionB=new t.b2Vec2,this.m_polygonA.SetAsBox(.2,.4),this.m_transformA.SetPositionAngleRadians(new t.b2Vec2(0,0),0),this.m_polygonB.SetAsBox(.5,.5),this.m_positionB.Set(19.345284,1.5632932),this.m_angleB=1.9160721,this.m_transformB.SetPositionAngleRadians(this.m_positionB,this.m_angleB)},e.inherits(t.Testbed.PolyCollision,t.Testbed.Test),t.Testbed.PolyCollision.prototype.m_polygonA=null,t.Testbed.PolyCollision.prototype.m_polygonB=null,t.Testbed.PolyCollision.prototype.m_transformA=null,t.Testbed.PolyCollision.prototype.m_transformB=null,t.Testbed.PolyCollision.prototype.m_positionB=null,t.Testbed.PolyCollision.prototype.m_angleB=0,t.Testbed.PolyCollision.prototype.Step=function(){var e=new t.b2Manifold;t.b2CollidePolygons(e,this.m_polygonA,this.m_transformA,this.m_polygonB,this.m_transformB);var o=new t.b2WorldManifold;o.Initialize(e,this.m_transformA,this.m_polygonA.m_radius,this.m_transformB,this.m_polygonB.m_radius),this.m_debugDraw.DrawString(5,this.m_textLine,"point count = %d",e.pointCount),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;for(var i=new t.b2Color(.9,.9,.9),n=new Array(t.b2_maxPolygonVertices),s=0;s<this.m_polygonA.m_count;++s)n[s]=t.b2MulXV(this.m_transformA,this.m_polygonA.m_vertices[s],new t.b2Vec2);this.m_debugDraw.DrawPolygon(n,this.m_polygonA.m_count,i);for(var s=0;s<this.m_polygonB.m_count;++s)n[s]=t.b2MulXV(this.m_transformB,this.m_polygonB.m_vertices[s],new t.b2Vec2);this.m_debugDraw.DrawPolygon(n,this.m_polygonB.m_count,i);for(var s=0;s<e.pointCount;++s)this.m_debugDraw.DrawPoint(o.points[s],4,new t.b2Color(.9,.3,.3))},t.Testbed.PolyCollision.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.A:this.m_positionB.x-=.1;break;case e.events.KeyCodes.D:this.m_positionB.x+=.1;break;case e.events.KeyCodes.S:this.m_positionB.y-=.1;break;case e.events.KeyCodes.W:this.m_positionB.y+=.1;break;case e.events.KeyCodes.Q:this.m_angleB+=.1*t.b2_pi;break;case e.events.KeyCodes.E:this.m_angleB-=.1*t.b2_pi}this.m_transformB.SetPositionAngleRadians(this.m_positionB,this.m_angleB)},t.Testbed.PolyCollision.Create=function(e,o){return new t.Testbed.PolyCollision(e,o)},t}(o,pt),qt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.PolyShapes&&(t.Testbed.PolyShapes={}),t.Testbed.PolyShapesCallback=function(){this.m_circle=new t.b2CircleShape,this.m_transform=new t.b2Transform},e.inherits(t.Testbed.PolyShapesCallback,t.b2QueryCallback),t.Testbed.PolyShapesCallback.e_maxCount=4,t.Testbed.PolyShapesCallback.prototype.m_circle=null,t.Testbed.PolyShapesCallback.prototype.m_transform=null,t.Testbed.PolyShapesCallback.prototype.m_debug_draw=null,t.Testbed.PolyShapesCallback.prototype.m_count=0,t.Testbed.PolyShapesCallback.prototype.DrawFixture=function(e){var o=new t.b2Color(.95,.95,.6),i=e.GetBody().GetTransform();switch(e.GetType()){case t.b2ShapeType.e_circleShape:var n=e.GetShape(),s=t.b2MulXV(i,n.m_p,new t.b2Vec2),r=n.m_radius;this.m_debugDraw.DrawCircle(s,r,o);break;case t.b2ShapeType.e_polygonShape:var a=e.GetShape(),l=t.b2ParseInt(a.m_count);t.ENABLE_ASSERTS&&t.b2Assert(l<=t.b2_maxPolygonVertices);for(var p=new Array(t.b2_maxPolygonVertices),b=0;l>b;++b)p[b]=t.b2MulXV(i,a.m_vertices[b],new t.b2Vec2);this.m_debugDraw.DrawPolygon(p,l,o)}},t.Testbed.PolyShapesCallback.prototype.ReportFixture=function(e){if(this.m_count==t.Testbed.PolyShapesCallback.e_maxCount)return!1;var o=e.GetBody(),i=e.GetShape(),n=t.b2TestOverlapShape(i,0,this.m_circle,0,o.GetTransform(),this.m_transform);return n&&(this.DrawFixture(e),++this.m_count),!0},t.Testbed.PolyShapes=function(o,i){e.base(this,o,i),this.m_bodyIndex=0,this.m_bodies=new Array(t.Testbed.PolyShapes.e_maxBodies),this.m_polygons=new Array(4);for(var n=0;4>n;++n)this.m_polygons[n]=new t.b2PolygonShape;this.m_circle=new t.b2CircleShape;var s=new t.b2BodyDef,r=this.m_world.CreateBody(s),a=new t.b2EdgeShape;a.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),r.CreateFixture2(a,0);var l=new Array(3);l[0]=new t.b2Vec2(-.5,0),l[1]=new t.b2Vec2(.5,0),l[2]=new t.b2Vec2(0,1.5),this.m_polygons[0].SetAsArray(l,3);var l=new Array(3);l[0]=new t.b2Vec2(-.1,0),l[1]=new t.b2Vec2(.1,0),l[2]=new t.b2Vec2(0,1.5),this.m_polygons[1].SetAsArray(l,3);var p=1,b=p/(2+t.b2Sqrt(2)),m=t.b2Sqrt(2)*b,l=new Array(8);l[0]=new t.b2Vec2(.5*m,0),l[1]=new t.b2Vec2(.5*p,b),l[2]=new t.b2Vec2(.5*p,b+m),l[3]=new t.b2Vec2(.5*m,p),l[4]=new t.b2Vec2(-.5*m,p),l[5]=new t.b2Vec2(-.5*p,b+m),l[6]=new t.b2Vec2(-.5*p,b),l[7]=new t.b2Vec2(-.5*m,0),this.m_polygons[2].SetAsArray(l,8),this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5;for(var n=0;n<t.Testbed.PolyShapes.e_maxBodies;++n)this.m_bodies[n]=null},e.inherits(t.Testbed.PolyShapes,t.Testbed.Test),t.Testbed.PolyShapes.e_maxBodies=256,t.Testbed.PolyShapes.prototype.CreateBody=function(e){null!=this.m_bodies[this.m_bodyIndex]&&(this.m_world.DestroyBody(this.m_bodies[this.m_bodyIndex]),this.m_bodies[this.m_bodyIndex]=null);var o=new t.b2BodyDef;o.type=t.b2BodyType.b2_dynamicBody;var i=t.b2RandomRange(-2,2);if(o.position.Set(i,10),o.angle=t.b2RandomRange(-t.b2_pi,t.b2_pi),4==e&&(o.angularDamping=.02),this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(o),4>e){var n=new t.b2FixtureDef;n.shape=this.m_polygons[e],n.density=1,n.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(n)}else{var n=new t.b2FixtureDef;n.shape=this.m_circle,n.density=1,n.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(n)}this.m_bodyIndex=(this.m_bodyIndex+1)%t.Testbed.PolyShapes.e_maxBodies},t.Testbed.PolyShapes.prototype.DestroyBody=function(){for(var e=0;e<t.Testbed.PolyShapes.e_maxBodies;++e)if(null!=this.m_bodies[e])return this.m_world.DestroyBody(this.m_bodies[e]),this.m_bodies[e]=null,void 0},t.Testbed.PolyShapes.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.ONE:case e.events.KeyCodes.TWO:case e.events.KeyCodes.THREE:case e.events.KeyCodes.FOUR:case e.events.KeyCodes.FIVE:this.CreateBody(o-e.events.KeyCodes.ONE);break;case e.events.KeyCodes.A:for(var i=0;i<t.Testbed.PolyShapes.e_maxBodies;i+=2)if(this.m_bodies[i]){var n=this.m_bodies[i].IsActive();this.m_bodies[i].SetActive(!n)}break;case e.events.KeyCodes.D:this.DestroyBody()}},t.Testbed.PolyShapes.prototype.Step=function(o){e.base(this,"Step",o);var i=new t.Testbed.PolyShapesCallback;i.m_circle.m_radius=2,i.m_circle.m_p.Set(0,1.1),i.m_transform.SetIdentity(),i.m_debugDraw=this.m_debugDraw;var n=new t.b2AABB;i.m_circle.ComputeAABB(n,i.m_transform,0),this.m_world.QueryAABB(i,n);var s=new t.b2Color(.4,.7,.8);this.m_debugDraw.DrawCircle(i.m_circle.m_p,i.m_circle.m_radius,s),this.m_debugDraw.DrawString(5,this.m_textLine,"Press 1-5 to drop stuff"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"Press 'a' to (de)activate some bodies"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"Press 'd' to destroy a body"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.PolyShapes.Create=function(e,o){return new t.Testbed.PolyShapes(e,o)},t}(o,pt),Kt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Prismatic&&(t.Testbed.Prismatic={}),t.Testbed.Prismatic=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),n.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(2,.5);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-10,10),s.angle=.5*t.b2_pi,s.allowSleep=!1;var a=this.m_world.CreateBody(s);a.CreateFixture2(r,5);var l=new t.b2PrismaticJointDef,p=new t.b2Vec2(2,1);p.Normalize(),l.Initialize(n,a,new t.b2Vec2(0,0),p),l.motorSpeed=10,l.maxMotorForce=1e4,l.enableMotor=!0,l.lowerTranslation=0,l.upperTranslation=20,l.enableLimit=!0,this.m_joint=this.m_world.CreateJoint(l)},e.inherits(t.Testbed.Prismatic,t.Testbed.Test),t.Testbed.Prismatic.prototype.m_joint=null,t.Testbed.Prismatic.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.L:this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled());break;case e.events.KeyCodes.M:this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled());break;case e.events.KeyCodes.S:this.m_joint.SetMotorSpeed(-this.m_joint.GetMotorSpeed())}},t.Testbed.Prismatic.prototype.Step=function(o){e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Keys: (l) limits, (m) motors, (s) speed"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;var i=this.m_joint.GetMotorForce(o.hz);this.m_debugDraw.DrawString(5,this.m_textLine,"Motor Force = %4.0f",i),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Prismatic.Create=function(e,o){return new t.Testbed.Prismatic(e,o)},t}(o,pt),jt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Pulleys&&(t.Testbed.Pulleys={}),t.Testbed.Pulleys=function(o,i){e.base(this,o,i);var n=16,s=12,r=1,a=2,l=null,p=new t.b2BodyDef;l=this.m_world.CreateBody(p);var b=new t.b2EdgeShape;b.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0));var m=new t.b2CircleShape;m.m_radius=2,m.m_p.Set(-10,n+a+s),l.CreateFixture2(m,0),m.m_p.Set(10,n+a+s),l.CreateFixture2(m,0);var _=new t.b2PolygonShape;_.SetAsBox(r,a);var p=new t.b2BodyDef;p.type=t.b2BodyType.b2_dynamicBody,p.position.Set(-10,n);var d=this.m_world.CreateBody(p);d.CreateFixture2(_,5),p.position.Set(10,n);var h=this.m_world.CreateBody(p);h.CreateFixture2(_,5);var c=new t.b2PulleyJointDef,u=new t.b2Vec2(-10,n+a),y=new t.b2Vec2(10,n+a),f=new t.b2Vec2(-10,n+a+s),S=new t.b2Vec2(10,n+a+s);c.Initialize(d,h,f,S,u,y,1.5),this.m_joint1=this.m_world.CreateJoint(c)},e.inherits(t.Testbed.Pulleys,t.Testbed.Test),t.Testbed.Pulleys.prototype.m_joint1=null,t.Testbed.Pulleys.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.ZERO:}},t.Testbed.Pulleys.prototype.Step=function(o){e.base(this,"Step",o);var i=this.m_joint1.GetRatio(),n=this.m_joint1.GetCurrentLengthA()+i*this.m_joint1.GetCurrentLengthB();this.m_debugDraw.DrawString(5,this.m_textLine,"L1 + %4.2f * L2 = %4.2f",i,n),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Pulleys.Create=function(e,o){return new t.Testbed.Pulleys(e,o)},t}(o,pt),Ut=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Pyramid&&(t.Testbed.Pyramid={}),t.Testbed.Pyramid=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0);var a=.5,r=new t.b2PolygonShape;r.SetAsBox(a,a);for(var l=new t.b2Vec2(-7,.75),p=new t.b2Vec2(0,0),b=new t.b2Vec2(.5625,1.25),m=new t.b2Vec2(1.125,0),_=0;_<t.Testbed.Pyramid.e_count;++_){p.Copy(l);for(var d=_;d<t.Testbed.Pyramid.e_count;++d){var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Copy(p);var h=this.m_world.CreateBody(n);h.CreateFixture2(r,5),p.SelfAdd(m)}l.SelfAdd(b)}},e.inherits(t.Testbed.Pyramid,t.Testbed.Test),t.Testbed.Pyramid.e_count=20,t.Testbed.Pyramid.prototype.Step=function(t){e.base(this,"Step",t)},t.Testbed.Pyramid.Create=function(e,o){return new t.Testbed.Pyramid(e,o)},t}(o,pt),Ht=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.RayCast&&(t.Testbed.RayCast={}),t.Testbed.RayCastClosestCallback=function(){e.base(this),this.m_point=new t.b2Vec2,this.m_normal=new t.b2Vec2},e.inherits(t.Testbed.RayCastClosestCallback,t.b2RayCastCallback),t.Testbed.RayCastClosestCallback.prototype.m_hit=!1,t.Testbed.RayCastClosestCallback.prototype.m_point=null,t.Testbed.RayCastClosestCallback.prototype.m_normal=null,t.Testbed.RayCastClosestCallback.prototype.ReportFixture=function(e,t,o,i){var n=e.GetBody(),s=n.GetUserData();if(s){var r=s.index;if(0==r)return-1}return this.m_hit=!0,this.m_point.Copy(t),this.m_normal.Copy(o),i},t.Testbed.RayCastAnyCallback=function(){e.base(this),this.m_point=new t.b2Vec2,this.m_normal=new t.b2Vec2},e.inherits(t.Testbed.RayCastAnyCallback,t.b2RayCastCallback),t.Testbed.RayCastAnyCallback.prototype.m_hit=!1,t.Testbed.RayCastAnyCallback.prototype.m_point=null,t.Testbed.RayCastAnyCallback.prototype.m_normal=null,t.Testbed.RayCastAnyCallback.prototype.ReportFixture=function(e,t,o){var i=e.GetBody(),n=i.GetUserData();if(n){var s=n.index;if(0==s)return-1}return this.m_hit=!0,this.m_point.Copy(t),this.m_normal.Copy(o),0},t.Testbed.RayCastMultipleCallback=function(){e.base(this),this.m_points=t.b2Vec2.MakeArray(t.Testbed.RayCastMultipleCallback.e_maxCount),this.m_normals=t.b2Vec2.MakeArray(t.Testbed.RayCastMultipleCallback.e_maxCount)},e.inherits(t.Testbed.RayCastMultipleCallback,t.b2RayCastCallback),t.Testbed.RayCastMultipleCallback.e_maxCount=3,t.Testbed.RayCastMultipleCallback.prototype.m_points=null,t.Testbed.RayCastMultipleCallback.prototype.m_normals=null,t.Testbed.RayCastMultipleCallback.prototype.m_count=0,t.Testbed.RayCastMultipleCallback.prototype.ReportFixture=function(e,o,i){var n=e.GetBody(),s=n.GetUserData();if(s){var r=s.index;if(0==r)return-1}return t.ENABLE_ASSERTS&&t.b2Assert(this.m_count<t.Testbed.RayCastMultipleCallback.e_maxCount),this.m_points[this.m_count].Copy(o),this.m_normals[this.m_count].Copy(i),++this.m_count,this.m_count==t.Testbed.RayCastMultipleCallback.e_maxCount?0:1},t.Testbed.RayCastMode={e_closest:0,e_any:1,e_multiple:2},e.exportProperty(t.Testbed.RayCastMode,"e_closest",t.Testbed.RayCastMode.e_closest),e.exportProperty(t.Testbed.RayCastMode,"e_any",t.Testbed.RayCastMode.e_any),e.exportProperty(t.Testbed.RayCastMode,"e_multiple",t.Testbed.RayCastMode.e_multiple),t.Testbed.RayCast=function(o,i){e.base(this,o,i),this.m_bodyIndex=0,this.m_bodies=new Array(t.Testbed.RayCast.e_maxBodies),this.m_polygons=new Array(4);
for(var n=0;4>n;++n)this.m_polygons[n]=new t.b2PolygonShape;this.m_circle=new t.b2CircleShape,this.m_edge=new t.b2EdgeShape;var s=new t.b2BodyDef,r=this.m_world.CreateBody(s),a=new t.b2EdgeShape;a.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),r.CreateFixture2(a,0);var l=new Array(3);l[0]=new t.b2Vec2(-.5,0),l[1]=new t.b2Vec2(.5,0),l[2]=new t.b2Vec2(0,1.5),this.m_polygons[0].SetAsArray(l,3);var l=new Array(3);l[0]=new t.b2Vec2(-.1,0),l[1]=new t.b2Vec2(.1,0),l[2]=new t.b2Vec2(0,1.5),this.m_polygons[1].SetAsArray(l,3);var p=1,b=p/(2+t.b2Sqrt(2)),m=t.b2Sqrt(2)*b,l=new Array(8);l[0]=new t.b2Vec2(.5*m,0),l[1]=new t.b2Vec2(.5*p,b),l[2]=new t.b2Vec2(.5*p,b+m),l[3]=new t.b2Vec2(.5*m,p),l[4]=new t.b2Vec2(-.5*m,p),l[5]=new t.b2Vec2(-.5*p,b+m),l[6]=new t.b2Vec2(-.5*p,b),l[7]=new t.b2Vec2(-.5*m,0),this.m_polygons[2].SetAsArray(l,8),this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5,this.m_edge.SetAsEdge(new t.b2Vec2(-1,0),new t.b2Vec2(1,0));for(var n=0;n<t.Testbed.RayCast.e_maxBodies;++n)this.m_bodies[n]=null;this.m_angle=0,this.m_mode=t.Testbed.RayCastMode.e_closest},e.inherits(t.Testbed.RayCast,t.Testbed.Test),t.Testbed.RayCast.e_maxBodies=256,t.Testbed.RayCast.prototype.m_bodyIndex=0,t.Testbed.RayCast.prototype.m_bodies=null,t.Testbed.RayCast.prototype.m_polygons=null,t.Testbed.RayCast.prototype.m_circle=null,t.Testbed.RayCast.prototype.m_edge=null,t.Testbed.RayCast.prototype.CreateBody=function(e){null!=this.m_bodies[this.m_bodyIndex]&&(this.m_world.DestroyBody(this.m_bodies[this.m_bodyIndex]),this.m_bodies[this.m_bodyIndex]=null);var o=new t.b2BodyDef,i=t.b2RandomRange(-10,10),n=t.b2RandomRange(0,20);if(o.position.Set(i,n),o.angle=t.b2RandomRange(-t.b2_pi,t.b2_pi),o.userData=new Object,o.userData.index=e,4==e&&(o.angularDamping=.02),this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(o),4>e){var s=new t.b2FixtureDef;s.shape=this.m_polygons[e],s.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(s)}else if(5>e){var s=new t.b2FixtureDef;s.shape=this.m_circle,s.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(s)}else{var s=new t.b2FixtureDef;s.shape=this.m_edge,s.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(s)}this.m_bodyIndex=(this.m_bodyIndex+1)%t.Testbed.RayCast.e_maxBodies},t.Testbed.RayCast.prototype.DestroyBody=function(){for(var e=0;e<t.Testbed.RayCast.e_maxBodies;++e)if(null!=this.m_bodies[e])return this.m_world.DestroyBody(this.m_bodies[e]),this.m_bodies[e]=null,void 0},t.Testbed.RayCast.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.ONE:case e.events.KeyCodes.TWO:case e.events.KeyCodes.THREE:case e.events.KeyCodes.FOUR:case e.events.KeyCodes.FIVE:case e.events.KeyCodes.SIX:this.CreateBody(o-e.events.KeyCodes.ONE);break;case e.events.KeyCodes.D:this.DestroyBody();break;case e.events.KeyCodes.M:this.m_mode==t.Testbed.RayCastMode.e_closest?this.m_mode=t.Testbed.RayCastMode.e_any:this.m_mode==t.Testbed.RayCastMode.e_any?this.m_mode=t.Testbed.RayCastMode.e_multiple:this.m_mode==t.Testbed.RayCastMode.e_multiple&&(this.m_mode=t.Testbed.RayCastMode.e_closest)}},t.Testbed.RayCast.prototype.Step=function(o){var i=0==o.pause||o.singleStep;switch(e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Press 1-6 to drop stuff, m to change the mode"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_mode){case t.Testbed.RayCastMode.e_closest:this.m_debugDraw.DrawString(5,this.m_textLine,"Ray-cast mode: closest - find closest fixture along the ray");break;case t.Testbed.RayCastMode.e_any:this.m_debugDraw.DrawString(5,this.m_textLine,"Ray-cast mode: any - check for obstruction");break;case t.Testbed.RayCastMode.e_multiple:this.m_debugDraw.DrawString(5,this.m_textLine,"Ray-cast mode: multiple - gather multiple fixtures")}this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;var n=11,s=new t.b2Vec2(0,10),r=new t.b2Vec2(n*t.b2Cos(this.m_angle),n*t.b2Sin(this.m_angle)),a=t.b2AddVV(s,r,new t.b2Vec2);if(this.m_mode==t.Testbed.RayCastMode.e_closest){var l=new t.Testbed.RayCastClosestCallback;if(this.m_world.RayCast(l,s,a),l.m_hit){this.m_debugDraw.DrawPoint(l.m_point,5,new t.b2Color(.4,.9,.4)),this.m_debugDraw.DrawSegment(s,l.m_point,new t.b2Color(.8,.8,.8));var p=t.b2AddVV(l.m_point,t.b2MulSV(.5,l.m_normal,t.b2Vec2.s_t0),new t.b2Vec2);this.m_debugDraw.DrawSegment(l.m_point,p,new t.b2Color(.9,.9,.4))}else this.m_debugDraw.DrawSegment(s,a,new t.b2Color(.8,.8,.8))}else if(this.m_mode==t.Testbed.RayCastMode.e_any){var l=new t.Testbed.RayCastAnyCallback;if(this.m_world.RayCast(l,s,a),l.m_hit){this.m_debugDraw.DrawPoint(l.m_point,5,new t.b2Color(.4,.9,.4)),this.m_debugDraw.DrawSegment(s,l.m_point,new t.b2Color(.8,.8,.8));var p=t.b2AddVV(l.m_point,t.b2MulSV(.5,l.m_normal,t.b2Vec2.s_t0),new t.b2Vec2);this.m_debugDraw.DrawSegment(l.m_point,p,new t.b2Color(.9,.9,.4))}else this.m_debugDraw.DrawSegment(s,a,new t.b2Color(.8,.8,.8))}else if(this.m_mode==t.Testbed.RayCastMode.e_multiple){var l=new t.Testbed.RayCastMultipleCallback;this.m_world.RayCast(l,s,a),this.m_debugDraw.DrawSegment(s,a,new t.b2Color(.8,.8,.8));for(var b=0;b<l.m_count;++b){var m=l.m_points[b],_=l.m_normals[b];this.m_debugDraw.DrawPoint(m,5,new t.b2Color(.4,.9,.4)),this.m_debugDraw.DrawSegment(s,m,new t.b2Color(.8,.8,.8));var p=t.b2AddVV(m,t.b2MulSV(.5,_,t.b2Vec2.s_t0),new t.b2Vec2);this.m_debugDraw.DrawSegment(m,p,new t.b2Color(.9,.9,.4))}}i&&(this.m_angle+=.25*t.b2_pi/180)},t.Testbed.RayCast.Create=function(e,o){return new t.Testbed.RayCast(e,o)},t}(o,pt),Xt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Revolute&&(t.Testbed.Revolute={}),t.Testbed.Revolute=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0));var a=new t.b2FixtureDef;a.shape=r,n.CreateFixture(a);var r=new t.b2CircleShape;r.m_radius=.5;var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody;var l=new t.b2RevoluteJointDef;s.position.Set(-10,20);var p=this.m_world.CreateBody(s);p.CreateFixture2(r,5);var b=100;p.SetAngularVelocity(b),p.SetLinearVelocity(new t.b2Vec2(-8*b,0)),l.Initialize(n,p,new t.b2Vec2(-10,12)),l.motorSpeed=1*t.b2_pi,l.maxMotorTorque=1e4,l.enableMotor=!1,l.lowerAngle=-.25*t.b2_pi,l.upperAngle=.5*t.b2_pi,l.enableLimit=!0,l.collideConnected=!0,this.m_joint=this.m_world.CreateJoint(l);var m=new t.b2CircleShape;m.m_radius=3;var _=new t.b2BodyDef;_.type=t.b2BodyType.b2_dynamicBody,_.position.Set(5,30);var a=new t.b2FixtureDef;a.density=5,a.filter.maskBits=1,a.shape=m,this.m_ball=this.m_world.CreateBody(_),this.m_ball.CreateFixture(a);var d=new t.b2PolygonShape;d.SetAsOrientedBox(10,.2,new t.b2Vec2(-10,0),0);var h=new t.b2BodyDef;h.position.Set(20,10),h.type=t.b2BodyType.b2_dynamicBody,h.bullet=!0;var c=this.m_world.CreateBody(h);c.CreateFixture2(d,2);var l=new t.b2RevoluteJointDef;l.Initialize(n,c,new t.b2Vec2(20,10)),l.lowerAngle=-.25*t.b2_pi,l.upperAngle=0*t.b2_pi,l.enableLimit=!0,this.m_world.CreateJoint(l);var u=new t.b2BodyDef;u.type=t.b2BodyType.b2_dynamicBody;var p=this.m_world.CreateBody(u),y=new t.b2PolygonShape,f=t.b2Vec2.MakeArray(3);f[0].Set(17.63,36.31),f[1].Set(17.52,36.69),f[2].Set(17.19,36.36),y.SetAsVector(f,3);var S=new t.b2FixtureDef;S.shape=y,S.density=1,p.CreateFixture(S)},e.inherits(t.Testbed.Revolute,t.Testbed.Test),t.Testbed.Revolute.prototype.m_ball=null,t.Testbed.Revolute.prototype.m_joint=null,t.Testbed.Revolute.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.L:this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled());break;case e.events.KeyCodes.M:this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled())}},t.Testbed.Revolute.prototype.Step=function(o){e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Keys: (l) limits, (m) motor"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Revolute.Create=function(e,o){return new t.Testbed.Revolute(e,o)},t}(o,pt),Zt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Rope&&(t.Testbed.Rope={}),t.Testbed.Rope=function(o,i){e.base(this,o,i),this.m_rope=new t.b2Rope;for(var n=40,s=t.b2Vec2.MakeArray(n),r=t.b2MakeNumberArray(n),a=0;n>a;++a)s[a].Set(0,20-.25*a),r[a]=1;r[0]=0,r[1]=0;var l=new t.b2RopeDef;l.vertices=s,l.count=n,l.gravity.Set(0,-10),l.masses=r,l.damping=.1,l.k2=1,l.k3=.5,this.m_rope.Initialize(l),this.m_angle=0,this.m_rope.SetAngleRadians(this.m_angle)},e.inherits(t.Testbed.Rope,t.Testbed.Test),t.Testbed.Rope.prototype.m_rope=null,t.Testbed.Rope.prototype.m_angle=0,t.Testbed.Rope.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.Q:this.m_angle=t.b2Max(-t.b2_pi,this.m_angle-.05*t.b2_pi),this.m_rope.SetAngleRadians(this.m_angle);break;case e.events.KeyCodes.E:this.m_angle=t.b2Min(t.b2_pi,this.m_angle+.05*t.b2_pi),this.m_rope.SetAngleRadians(this.m_angle)}},t.Testbed.Rope.prototype.Step=function(o){var i=o.hz>0?1/o.hz:0;1==o.pause&&0==o.singleStep&&(i=0),this.m_rope.Step(i,1),e.base(this,"Step",o),this.m_rope.Draw(this.m_debugDraw),this.m_debugDraw.DrawString(5,this.m_textLine,"Press (q,e) to adjust target angle"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"Target angle = %4.2f degrees",180*this.m_angle/t.b2_pi),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Rope.Create=function(e,o){return new t.Testbed.Rope(e,o)},t}(o,pt),Yt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.RopeJoint&&(t.Testbed.RopeJoint={}),t.Testbed.RopeJoint=function(o,i){e.base(this,o,i),this.m_ropeDef=new t.b2RopeJointDef;var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),n.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(.5,.125);var a=new t.b2FixtureDef;a.shape=r,a.density=20,a.friction=.2,a.filter.categoryBits=1,a.filter.maskBits=65533;var l=new t.b2RevoluteJointDef;l.collideConnected=!1;var p=10,b=15;this.m_ropeDef.localAnchorA.Set(0,b);for(var m=n,_=0;p>_;++_){var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(.5+1*_,b),_==p-1&&(r.SetAsBox(1.5,1.5),a.density=100,a.filter.categoryBits=2,s.position.Set(1*_,b),s.angularDamping=.4);var d=this.m_world.CreateBody(s);d.CreateFixture(a);var h=new t.b2Vec2(_,b);l.Initialize(m,d,h),this.m_world.CreateJoint(l),m=d}this.m_ropeDef.localAnchorB.SetZero();var c=.01;this.m_ropeDef.maxLength=p-1+c,this.m_ropeDef.bodyB=m,this.m_ropeDef.bodyA=n,this.m_rope=this.m_world.CreateJoint(this.m_ropeDef)},e.inherits(t.Testbed.RopeJoint,t.Testbed.Test),t.Testbed.RopeJoint.prototype.m_ropeDef=null,t.Testbed.RopeJoint.prototype.m_rope=null,t.Testbed.RopeJoint.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.J:this.m_rope?(this.m_world.DestroyJoint(this.m_rope),this.m_rope=null):this.m_rope=this.m_world.CreateJoint(this.m_ropeDef)}},t.Testbed.RopeJoint.prototype.Step=function(o){e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Press (j) to toggle the rope joint."),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_rope?this.m_debugDraw.DrawString(5,this.m_textLine,"Rope ON"):this.m_debugDraw.DrawString(5,this.m_textLine,"Rope OFF"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.RopeJoint.Create=function(e,o){return new t.Testbed.RopeJoint(e,o)},t}(o,pt),Qt=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.SensorTest&&(t.Testbed.SensorTest={}),t.Testbed.SensorTest=function(o,i){e.base(this,o,i),this.m_bodies=new Array(t.Testbed.SensorTest.e_count),this.m_touching=new Array(t.Testbed.SensorTest.e_count);for(var n=0;n<t.Testbed.SensorTest.e_count;++n)this.m_touching[n]=new Array(1);var s=new t.b2BodyDef,r=this.m_world.CreateBody(s),a=new t.b2EdgeShape;a.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),r.CreateFixture2(a,0);var a=new t.b2CircleShape;a.m_radius=5,a.m_p.Set(0,10);var l=new t.b2FixtureDef;l.shape=a,l.isSensor=!0,this.m_sensor=r.CreateFixture(l);var a=new t.b2CircleShape;a.m_radius=1;for(var n=0;n<t.Testbed.SensorTest.e_count;++n)s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-10+3*n,20),s.userData=this.m_touching[n],this.m_touching[n][0]=!1,this.m_bodies[n]=this.m_world.CreateBody(s),this.m_bodies[n].CreateFixture2(a,1)},e.inherits(t.Testbed.SensorTest,t.Testbed.Test),t.Testbed.SensorTest.e_count=7,t.Testbed.SensorTest.prototype.m_sensor=null,t.Testbed.SensorTest.prototype.m_bodies=null,t.Testbed.SensorTest.prototype.m_touching=null,t.Testbed.SensorTest.prototype.BeginContact=function(e){var t=e.GetFixtureA(),o=e.GetFixtureB();if(t==this.m_sensor){var i=o.GetBody().GetUserData();if(i){var n=i;n[0]=!0}}if(o==this.m_sensor){var i=t.GetBody().GetUserData();if(i){var n=i;n[0]=!0}}},t.Testbed.SensorTest.prototype.EndContact=function(e){var t=e.GetFixtureA(),o=e.GetFixtureB();if(t==this.m_sensor){var i=o.GetBody().GetUserData();if(i){var n=i;n[0]=!1}}if(o==this.m_sensor){var i=t.GetBody().GetUserData();if(i){var n=i;n[0]=!1}}},t.Testbed.SensorTest.prototype.Step=function(o){e.base(this,"Step",o);for(var i=0;i<t.Testbed.SensorTest.e_count;++i)if(0!=this.m_touching[i][0]){var n=this.m_bodies[i],s=this.m_sensor.GetBody(),r=this.m_sensor.GetShape(),a=s.GetWorldPoint(r.m_p,new t.b2Vec2),l=n.GetPosition(),p=t.b2SubVV(a,l,new t.b2Vec2);if(!(p.GetLengthSquared()<t.b2_epsilon_sq)){p.Normalize();var b=t.b2MulSV(100,p,new t.b2Vec2);n.ApplyForce(b,l)}}},t.Testbed.SensorTest.Create=function(e,o){return new t.Testbed.SensorTest(e,o)},t}(o,pt),$t=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.ShapeEditing&&(t.Testbed.ShapeEditing={}),t.Testbed.ShapeEditing=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0);var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(0,10),this.m_body=this.m_world.CreateBody(n);var r=new t.b2PolygonShape;r.SetAsOrientedBox(4,4,new t.b2Vec2(0,0),0),this.m_fixture1=this.m_body.CreateFixture2(r,10),this.m_fixture2=null,this.m_sensor=!1},e.inherits(t.Testbed.ShapeEditing,t.Testbed.Test),t.Testbed.ShapeEditing.prototype.m_body=null,t.Testbed.ShapeEditing.prototype.m_fixture1=null,t.Testbed.ShapeEditing.prototype.m_fixture2=null,t.Testbed.ShapeEditing.prototype.m_sensor=!1,t.Testbed.ShapeEditing.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.C:if(null===this.m_fixture2){var i=new t.b2CircleShape;i.m_radius=3,i.m_p.Set(.5,-4),this.m_fixture2=this.m_body.CreateFixture2(i,10),this.m_body.SetAwake(!0)}break;case e.events.KeyCodes.D:null!==this.m_fixture2&&(this.m_body.DestroyFixture(this.m_fixture2),this.m_fixture2=null,this.m_body.SetAwake(!0));break;case e.events.KeyCodes.S:null!==this.m_fixture2&&(this.m_sensor=!this.m_sensor,this.m_fixture2.SetSensor(this.m_sensor))}},t.Testbed.ShapeEditing.prototype.Step=function(o){e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Press: (c) create a shape, (d) destroy a shape."),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"sensor = %d",this.m_sensor?1:0),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.ShapeEditing.Create=function(e,o){return new t.Testbed.ShapeEditing(e,o)},t}(o,pt),eo=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.SliderCrank&&(t.Testbed.SliderCrank={}),t.Testbed.SliderCrank=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),n.CreateFixture2(r,0);var a=n,r=new t.b2PolygonShape;r.SetAsBox(.5,2);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(0,7);var l=this.m_world.CreateBody(s);l.CreateFixture2(r,2);var p=new t.b2RevoluteJointDef;p.Initialize(a,l,new t.b2Vec2(0,5)),p.motorSpeed=1*t.b2_pi,p.maxMotorTorque=1e4,p.enableMotor=!0,this.m_joint1=this.m_world.CreateJoint(p),a=l;var r=new t.b2PolygonShape;r.SetAsBox(.5,4);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(0,13);var l=this.m_world.CreateBody(s);l.CreateFixture2(r,2);var p=new t.b2RevoluteJointDef;p.Initialize(a,l,new t.b2Vec2(0,9)),p.enableMotor=!1,this.m_world.CreateJoint(p),a=l;var r=new t.b2PolygonShape;r.SetAsBox(1.5,1.5);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.fixedRotation=!0,s.position.Set(0,17);var l=this.m_world.CreateBody(s);l.CreateFixture2(r,2);var p=new t.b2RevoluteJointDef;p.Initialize(a,l,new t.b2Vec2(0,17)),this.m_world.CreateJoint(p);var b=new t.b2PrismaticJointDef;b.Initialize(n,l,new t.b2Vec2(0,17),new t.b2Vec2(0,1)),b.maxMotorForce=1e3,b.enableMotor=!0,this.m_joint2=this.m_world.CreateJoint(b);var r=new t.b2PolygonShape;r.SetAsBox(1.5,1.5);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(0,23);var l=this.m_world.CreateBody(s);l.CreateFixture2(r,2)},e.inherits(t.Testbed.SliderCrank,t.Testbed.Test),t.Testbed.SliderCrank.e_count=30,t.Testbed.SliderCrank.prototype.m_joint1=null,t.Testbed.SliderCrank.prototype.m_joint2=null,t.Testbed.SliderCrank.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.F:this.m_joint2.EnableMotor(!this.m_joint2.IsMotorEnabled()),this.m_joint2.GetBodyB().SetAwake(!0);break;case e.events.KeyCodes.M:this.m_joint1.EnableMotor(!this.m_joint1.IsMotorEnabled()),this.m_joint1.GetBodyB().SetAwake(!0)}},t.Testbed.SliderCrank.prototype.Step=function(o){e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Keys: (f) toggle friction, (m) toggle motor"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;var i=this.m_joint1.GetMotorTorque(o.hz);this.m_debugDraw.DrawString(5,this.m_textLine,"Motor Torque = %5.0f",i),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.SliderCrank.Create=function(e,o){return new t.Testbed.SliderCrank(e,o)},t}(o,pt),to=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.SphereStack&&(t.Testbed.SphereStack={}),t.Testbed.SphereStack=function(o,i){e.base(this,o,i),this.m_bodies=new Array(t.Testbed.SphereStack.e_count);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0);var r=new t.b2CircleShape;r.m_radius=1;for(var a=0;a<t.Testbed.SphereStack.e_count;++a){var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(0,4+3*a),this.m_bodies[a]=this.m_world.CreateBody(n),this.m_bodies[a].CreateFixture2(r,1),this.m_bodies[a].SetLinearVelocity(new t.b2Vec2(0,-50))}},e.inherits(t.Testbed.SphereStack,t.Testbed.Test),t.Testbed.SphereStack.e_count=10,t.Testbed.SphereStack.prototype.m_bodies=null,t.Testbed.SphereStack.prototype.Step=function(t){e.base(this,"Step",t)},t.Testbed.SphereStack.Create=function(e,o){return new t.Testbed.SphereStack(e,o)},t}(o,pt),oo=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.TestCCD&&(t.Testbed.TestCCD={}),t.Testbed.TestCCD=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=[];r[0]=new t.b2Vec2(-30,0),r[1]=new t.b2Vec2(30,0),r[2]=new t.b2Vec2(30,40),r[3]=new t.b2Vec2(-30,40);var a=new t.b2ChainShape;a.CreateLoop(r),s.CreateFixture2(a,0),this.m_world.SetContinuousPhysics(!0);var n,l,p=new t.b2FixtureDef;p.density=4,p.restitution=1.4,n=new t.b2BodyDef,n.type=t.b2BodyType.b2_dynamicBody,n.bullet=!0,n.position.Set(15,5),l=this.m_world.CreateBody(n);var b=new t.b2PolygonShape;b.SetAsBox(4.5,.45),p.shape=b,l.CreateFixture(p);var m=new t.b2PolygonShape;m.SetAsOrientedBox(.45,8.1,new t.b2Vec2(-4.35,7.05),.2),p.shape=m,l.CreateFixture(p);var _=new t.b2PolygonShape;_.SetAsOrientedBox(.45,8.1,new t.b2Vec2(4.35,7.05),-.2),p.shape=_,l.CreateFixture(p);for(var d=0;5>d;d++){var h=new t.b2CircleShape(1*Math.random()+.5);p.shape=h,p.friction=.3,p.density=1,p.restitution=1.1,n=new t.b2BodyDef,n.type=t.b2BodyType.b2_dynamicBody,n.bullet=!0,n.position.Set(30*Math.random()-25,32*Math.random()+2),l=this.m_world.CreateBody(n),l.CreateFixture(p)}},e.inherits(t.Testbed.TestCCD,t.Testbed.Test),t.Testbed.TestCCD.Create=function(e,o){return new t.Testbed.TestCCD(e,o)},t}(o,pt,_t),io=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.TestRagdoll&&(t.Testbed.TestRagdoll={}),t.Testbed.TestRagdoll=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=[];r[0]=new t.b2Vec2(-30,0),r[1]=new t.b2Vec2(30,0),r[2]=new t.b2Vec2(30,40),r[3]=new t.b2Vec2(-30,40);var a=new t.b2ChainShape;a.CreateLoop(r),s.CreateFixture2(a,0);for(var n=new t.b2BodyDef,l=new t.b2FixtureDef,p=new t.b2RevoluteJointDef,b=0;2>b;++b){var m=-20+2*Math.random()+40*b,_=30+5*Math.random();n.type=t.b2BodyType.b2_dynamicBody,l.shape=new t.b2CircleShape(1.25),l.density=1,l.friction=.4,l.restitution=.3,n.position.Set(m,_);var d=this.m_world.CreateBody(n);d.CreateFixture(l),d.ApplyLinearImpulse(new t.b2Vec2(1e3*Math.random()-500,1e3*Math.random()-500),d.GetWorldCenter()),l.shape=new t.b2PolygonShape,l.shape.SetAsBox(1.5,1),l.density=1,l.friction=.4,l.restitution=.1,n.position.Set(m,_-2.8);var h=this.m_world.CreateBody(n);h.CreateFixture(l),l.shape.SetAsBox(1.5,1),n.position.Set(m,_-4.3);var c=this.m_world.CreateBody(n);c.CreateFixture(l),l.shape.SetAsBox(1.5,1),n.position.Set(m,_-5.8);var u=this.m_world.CreateBody(n);u.CreateFixture(l),l.density=1,l.friction=.4,l.restitution=.1,l.shape.SetAsBox(1.8,.65),n.position.Set(m-3,_-2);var y=this.m_world.CreateBody(n);y.CreateFixture(l),l.shape.SetAsBox(1.8,.65),n.position.Set(m+3,_-2);var f=this.m_world.CreateBody(n);f.CreateFixture(l),l.density=1,l.friction=.4,l.restitution=.1,l.shape.SetAsBox(1.7,.6),n.position.Set(m-5.7,_-2);var S=this.m_world.CreateBody(n);S.CreateFixture(l),l.shape.SetAsBox(1.7,.6),n.position.Set(m+5.7,_-2);var C=this.m_world.CreateBody(n);C.CreateFixture(l),l.density=1,l.friction=.4,l.restitution=.1,l.shape.SetAsBox(.75,2.2),n.position.Set(m-.8,_-8.5);var v=this.m_world.CreateBody(n);v.CreateFixture(l),l.shape.SetAsBox(.75,2.2),n.position.Set(m+.8,_-8.5);var A=this.m_world.CreateBody(n);A.CreateFixture(l),l.density=1,l.friction=.4,l.restitution=.1,l.shape.SetAsBox(.6,2),n.position.Set(m-.8,_-12);var g=this.m_world.CreateBody(n);g.CreateFixture(l),l.shape.SetAsBox(.6,2),n.position.Set(m+.8,_-12);var w=this.m_world.CreateBody(n);w.CreateFixture(l),p.enableLimit=!0,p.lowerAngle=t.b2DegToRad(-40),p.upperAngle=t.b2DegToRad(40),p.Initialize(h,d,new t.b2Vec2(m,_-1.5)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-85),p.upperAngle=t.b2DegToRad(130),p.Initialize(h,y,new t.b2Vec2(m-1.8,_-2)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-130),p.upperAngle=t.b2DegToRad(85),p.Initialize(h,f,new t.b2Vec2(m+1.8,_-2)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-130),p.upperAngle=t.b2DegToRad(10),p.Initialize(y,S,new t.b2Vec2(m-4.5,_-2)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-10),p.upperAngle=t.b2DegToRad(130),p.Initialize(f,C,new t.b2Vec2(m+4.5,_-2)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-15),p.upperAngle=t.b2DegToRad(15),p.Initialize(h,c,new t.b2Vec2(m,_-3.5)),this.m_world.CreateJoint(p),p.Initialize(c,u,new t.b2Vec2(m,_-5)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-25),p.upperAngle=t.b2DegToRad(45),p.Initialize(u,v,new t.b2Vec2(m-.8,_-7.2)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-45),p.upperAngle=t.b2DegToRad(25),p.Initialize(u,A,new t.b2Vec2(m+.8,_-7.2)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-25),p.upperAngle=t.b2DegToRad(115),p.Initialize(v,g,new t.b2Vec2(m-.8,_-10.5)),this.m_world.CreateJoint(p),p.lowerAngle=t.b2DegToRad(-115),p.upperAngle=t.b2DegToRad(25),p.Initialize(A,w,new t.b2Vec2(m+.8,_-10.5)),this.m_world.CreateJoint(p)}n.type=t.b2BodyType.b2_staticBody,l.shape=new t.b2PolygonShape,l.density=0,l.friction=.4,l.restitution=.3;for(var x=1;10>=x;++x)l.shape.SetAsBox(1*x,1),n.position.Set(1*x-30,21-2*x),this.m_world.CreateBody(n).CreateFixture(l);for(var B=1;10>=B;++B)l.shape.SetAsBox(1*B,1),n.position.Set(30-1*B,21-2*B),this.m_world.CreateBody(n).CreateFixture(l);l.shape.SetAsBox(3,4),n.position.Set(0,4),this.m_world.CreateBody(n).CreateFixture(l)},e.inherits(t.Testbed.TestRagdoll,t.Testbed.Test),t.Testbed.TestRagdoll.Create=function(e,o){return new t.Testbed.TestRagdoll(e,o)},t}(o,pt,_t),no=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.TestStack&&(t.Testbed.TestStack={}),t.Testbed.TestStack=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=[];r[0]=new t.b2Vec2(-30,0),r[1]=new t.b2Vec2(30,0),r[2]=new t.b2Vec2(30,40),r[3]=new t.b2Vec2(-30,40);var a=new t.b2ChainShape;a.CreateLoop(r),s.CreateFixture2(a,0);var n=new t.b2BodyDef,l=new t.b2FixtureDef;n.type=t.b2BodyType.b2_dynamicBody,l.shape=new t.b2PolygonShape,l.density=1,l.friction=.5,l.restitution=.1,l.shape.SetAsBox(1,1);for(var p=0;10>p;++p)n.position.Set(0+.2*Math.random()-.1,30-2.5*p),this.m_world.CreateBody(n).CreateFixture(l);for(var p=0;10>p;++p)n.position.Set(10+.2*Math.random()-.1,30-2.5*p),this.m_world.CreateBody(n).CreateFixture(l);for(var p=0;10>p;++p)n.position.Set(20+.2*Math.random()-.1,30-2.5*p),this.m_world.CreateBody(n).CreateFixture(l);n.type=t.b2BodyType.b2_staticBody,n.position.Set(0,0);var b=[new t.b2Vec2(-30,0),new t.b2Vec2(-10,0),new t.b2Vec2(-30,10)];l.shape.SetAsArray(b,b.length),l.density=0,this.m_world.CreateBody(n).CreateFixture(l),n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(-25,20),l.shape=new t.b2CircleShape(4),l.density=2,l.restitution=.2,l.friction=.5,this.m_world.CreateBody(n).CreateFixture(l)},e.inherits(t.Testbed.TestStack,t.Testbed.Test),t.Testbed.TestStack.Create=function(e,o){return new t.Testbed.TestStack(e,o)},t}(o,pt,_t),so=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.TheoJansen&&(t.Testbed.TheoJansen={}),t.Testbed.TheoJansen=function(o,i){e.base(this,o,i),this.m_offset=new t.b2Vec2,this.Construct()},e.inherits(t.Testbed.TheoJansen,t.Testbed.Test),t.Testbed.TheoJansen.prototype.m_offset=null,t.Testbed.TheoJansen.prototype.m_chassis=null,t.Testbed.TheoJansen.prototype.m_wheel=null,t.Testbed.TheoJansen.prototype.m_motorJoint=null,t.Testbed.TheoJansen.prototype.m_motorOn=!1,t.Testbed.TheoJansen.prototype.m_motorSpeed=0,t.Testbed.TheoJansen.prototype.CreateLeg=function(e,o){var i=new t.b2Vec2(5.4*e,-6.1),n=new t.b2Vec2(7.2*e,-1.2),s=new t.b2Vec2(4.3*e,-1.9),r=new t.b2Vec2(3.1*e,.8),a=new t.b2Vec2(6*e,1.5),l=new t.b2Vec2(2.5*e,3.7),p=new t.b2FixtureDef,b=new t.b2FixtureDef;p.filter.groupIndex=-1,b.filter.groupIndex=-1,p.density=1,b.density=1;var m=new t.b2PolygonShape,_=new t.b2PolygonShape;if(e>0){var d=new Array;d[0]=i,d[1]=n,d[2]=s,m.SetAsArray(d),d[0]=t.b2Vec2_zero,d[1]=t.b2SubVV(a,r,new t.b2Vec2),d[2]=t.b2SubVV(l,r,new t.b2Vec2),_.SetAsArray(d)}else{var d=new Array;d[0]=i,d[1]=s,d[2]=n,m.SetAsArray(d),d[0]=t.b2Vec2_zero,d[1]=t.b2SubVV(l,r,new t.b2Vec2),d[2]=t.b2SubVV(a,r,new t.b2Vec2),_.SetAsArray(d)}p.shape=m,b.shape=_;var h=new t.b2BodyDef,c=new t.b2BodyDef;h.type=t.b2BodyType.b2_dynamicBody,c.type=t.b2BodyType.b2_dynamicBody,h.position.Copy(this.m_offset),c.position.Copy(t.b2AddVV(r,this.m_offset,new t.b2Vec2)),h.angularDamping=10,c.angularDamping=10;var u=this.m_world.CreateBody(h),y=this.m_world.CreateBody(c);u.CreateFixture(p),y.CreateFixture(b);var f=new t.b2DistanceJointDef;f.dampingRatio=.5,f.frequencyHz=10,f.Initialize(u,y,t.b2AddVV(n,this.m_offset,new t.b2Vec2),t.b2AddVV(a,this.m_offset,new t.b2Vec2)),this.m_world.CreateJoint(f),f.Initialize(u,y,t.b2AddVV(s,this.m_offset,new t.b2Vec2),t.b2AddVV(r,this.m_offset,new t.b2Vec2)),this.m_world.CreateJoint(f),f.Initialize(u,this.m_wheel,t.b2AddVV(s,this.m_offset,new t.b2Vec2),t.b2AddVV(o,this.m_offset,new t.b2Vec2)),this.m_world.CreateJoint(f),f.Initialize(y,this.m_wheel,t.b2AddVV(l,this.m_offset,new t.b2Vec2),t.b2AddVV(o,this.m_offset,new t.b2Vec2)),this.m_world.CreateJoint(f);var S=new t.b2RevoluteJointDef;S.Initialize(y,this.m_chassis,t.b2AddVV(r,this.m_offset,new t.b2Vec2)),this.m_world.CreateJoint(S)},t.Testbed.TheoJansen.prototype.Construct=function(){this.m_offset.Set(0,8),this.m_motorSpeed=2,this.m_motorOn=!0;var e=new t.b2Vec2(0,.8),o=new t.b2BodyDef,i=this.m_world.CreateBody(o),n=new t.b2EdgeShape;n.SetAsEdge(new t.b2Vec2(-50,0),new t.b2Vec2(50,0)),i.CreateFixture2(n,0),n.SetAsEdge(new t.b2Vec2(-50,0),new t.b2Vec2(-50,10)),i.CreateFixture2(n,0),n.SetAsEdge(new t.b2Vec2(50,0),new t.b2Vec2(50,10)),i.CreateFixture2(n,0);for(var s=0;40>s;++s){var n=new t.b2CircleShape;n.m_radius=.25;var o=new t.b2BodyDef;o.type=t.b2BodyType.b2_dynamicBody,o.position.Set(-40+2*s,.5);var r=this.m_world.CreateBody(o);r.CreateFixture2(n,1)}var n=new t.b2PolygonShape;n.SetAsBox(2.5,1);var a=new t.b2FixtureDef;a.density=1,a.shape=n,a.filter.groupIndex=-1;var o=new t.b2BodyDef;o.type=t.b2BodyType.b2_dynamicBody,o.position=t.b2AddVV(e,this.m_offset,new t.b2Vec2),this.m_chassis=this.m_world.CreateBody(o),this.m_chassis.CreateFixture(a);var n=new t.b2CircleShape;n.m_radius=1.6;var a=new t.b2FixtureDef;a.density=1,a.shape=n,a.filter.groupIndex=-1;var o=new t.b2BodyDef;o.type=t.b2BodyType.b2_dynamicBody,o.position=t.b2AddVV(e,this.m_offset,new t.b2Vec2),this.m_wheel=this.m_world.CreateBody(o),this.m_wheel.CreateFixture(a);var l=new t.b2RevoluteJointDef;l.Initialize(this.m_wheel,this.m_chassis,t.b2AddVV(e,this.m_offset,new t.b2Vec2)),l.collideConnected=!1,l.motorSpeed=this.m_motorSpeed,l.maxMotorTorque=400,l.enableMotor=this.m_motorOn,this.m_motorJoint=this.m_world.CreateJoint(l);var p=t.b2AddVV(e,new t.b2Vec2(0,-.8),new t.b2Vec2);this.CreateLeg(-1,p),this.CreateLeg(1,p),this.m_wheel.SetTransformVecRadians(this.m_wheel.GetPosition(),120*t.b2_pi/180),this.CreateLeg(-1,p),this.CreateLeg(1,p),this.m_wheel.SetTransformVecRadians(this.m_wheel.GetPosition(),-120*t.b2_pi/180),this.CreateLeg(-1,p),this.CreateLeg(1,p)},t.Testbed.TheoJansen.prototype.Step=function(o){this.m_debugDraw.DrawString(5,this.m_textLine,"Keys: left = a, brake = s, right = d, toggle motor = m"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,e.base(this,"Step",o)},t.Testbed.TheoJansen.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.A:this.m_motorJoint.SetMotorSpeed(-this.m_motorSpeed);break;case e.events.KeyCodes.S:this.m_motorJoint.SetMotorSpeed(0);break;case e.events.KeyCodes.D:this.m_motorJoint.SetMotorSpeed(this.m_motorSpeed);break;case e.events.KeyCodes.M:this.m_motorJoint.EnableMotor(!this.m_motorJoint.IsMotorEnabled())}},t.Testbed.TheoJansen.Create=function(e,o){return new t.Testbed.TheoJansen(e,o)},t}(o,pt),ro=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Tiles&&(t.Testbed.Tiles={}),t.Testbed.Tiles=function(o,i){e.base(this,o,i),this.m_fixtureCount=0;var n=new t.b2Timer,s=.5,r=new t.b2BodyDef;r.position.y=-s;var a=this.m_world.CreateBody(r),l=200,p=10,b=new t.b2Vec2;b.y=0;for(var m=0;p>m;++m){b.x=-l*s;for(var _=0;l>_;++_){var d=new t.b2PolygonShape;d.SetAsOrientedBox(s,s,b,0),a.CreateFixture2(d,0),++this.m_fixtureCount,b.x+=2*s}b.y-=2*s}var s=.5,d=new t.b2PolygonShape;d.SetAsBox(s,s);for(var h=new t.b2Vec2(-7,.75),c=new t.b2Vec2,u=new t.b2Vec2(.5625,1.25),y=new t.b2Vec2(1.125,0),_=0;_<t.Testbed.Tiles.e_count;++_){c.Copy(h);for(var m=_;m<t.Testbed.Tiles.e_count;++m){var r=new t.b2BodyDef;r.type=t.b2BodyType.b2_dynamicBody,r.position.Copy(c);var f=this.m_world.CreateBody(r);f.CreateFixture2(d,5),++this.m_fixtureCount,c.SelfAdd(y)}h.SelfAdd(u)}this.m_createTime=n.GetMilliseconds()
},e.inherits(t.Testbed.Tiles,t.Testbed.Test),t.Testbed.Tiles.e_count=20,t.Testbed.Tiles.prototype.m_fixtureCount=0,t.Testbed.Tiles.prototype.m_createTime=0,t.Testbed.Tiles.prototype.Step=function(o){var i=this.m_world.GetContactManager(),n=i.m_broadPhase.GetTreeHeight(),s=i.m_broadPhase.GetProxyCount(),r=2*s-1,a=Math.ceil(Math.log(r)/Math.log(2));this.m_debugDraw.DrawString(5,this.m_textLine,"dynamic tree height = %d, min = %d",n,a),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"create time = %6.2f ms, fixture count = %d",this.m_createTime,this.m_fixtureCount),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Tiles.Create=function(e,o){return new t.Testbed.Tiles(e,o)},t}(o,pt),ao=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.TimeOfImpact&&(t.Testbed.TimeOfImpact={}),t.Testbed.TimeOfImpact=function(o,i){e.base(this,o,i),this.m_shapeA=new t.b2PolygonShape,this.m_shapeB=new t.b2PolygonShape,this.m_shapeA.SetAsBox(25,5),this.m_shapeB.SetAsBox(2.5,2.5)},e.inherits(t.Testbed.TimeOfImpact,t.Testbed.Test),t.Testbed.TimeOfImpact.prototype.m_shapeA=null,t.Testbed.TimeOfImpact.prototype.m_shapeB=null,t.Testbed.TimeOfImpact.prototype.Step=function(o){e.base(this,"Step",o);var i=new t.b2Sweep;i.c0.Set(24,-60),i.a0=2.95,i.c=i.c0,i.a=i.a0,i.localCenter.SetZero();var n=new t.b2Sweep;n.c0.Set(53.474274,-50.252514),n.a0=513.36676,n.c.Set(54.595478,-51.083473),n.a=513.62781,n.localCenter.SetZero();var s=new t.b2TOIInput;s.proxyA.SetShape(this.m_shapeA,0),s.proxyB.SetShape(this.m_shapeB,0),s.sweepA.Copy(i),s.sweepB.Copy(n),s.tMax=1;var r=new t.b2TOIOutput;t.b2TimeOfImpact(r,s);r.t;this.m_debugDraw.DrawString(5,this.m_textLine,"toi = %4.2f",r.t),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"max toi iters = %d, max root iters = %d",t.b2_toiMaxIters,t.b2_toiMaxRootIters),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE;var a=new Array(t.b2_maxPolygonVertices),l=new t.b2Transform;i.GetTransform(l,0);for(var p=0;p<this.m_shapeA.m_count;++p)a[p]=t.b2MulXV(l,this.m_shapeA.m_vertices[p],new t.b2Vec2);this.m_debugDraw.DrawPolygon(a,this.m_shapeA.m_count,new t.b2Color(.9,.9,.9));var b=new t.b2Transform;n.GetTransform(b,0);for(var p=0;p<this.m_shapeB.m_count;++p)a[p]=t.b2MulXV(b,this.m_shapeB.m_vertices[p],new t.b2Vec2);this.m_debugDraw.DrawPolygon(a,this.m_shapeB.m_count,new t.b2Color(.5,.9,.5)),n.GetTransform(b,r.t);for(var p=0;p<this.m_shapeB.m_count;++p)a[p]=t.b2MulXV(b,this.m_shapeB.m_vertices[p],new t.b2Vec2);this.m_debugDraw.DrawPolygon(a,this.m_shapeB.m_count,new t.b2Color(.5,.7,.9)),n.GetTransform(b,1);for(var p=0;p<this.m_shapeB.m_count;++p)a[p]=t.b2MulXV(b,this.m_shapeB.m_vertices[p],new t.b2Vec2);this.m_debugDraw.DrawPolygon(a,this.m_shapeB.m_count,new t.b2Color(.9,.5,.5))},t.Testbed.TimeOfImpact.Create=function(e,o){return new t.Testbed.TimeOfImpact(e,o)},t}(o,pt),lo=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Tumbler&&(t.Testbed.Tumbler={}),t.Testbed.Tumbler=function(o,i){e.base(this,o,i);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.allowSleep=!1,s.position.Set(0,10);var r=this.m_world.CreateBody(s),a=new t.b2PolygonShape;a.SetAsOrientedBox(.5,10,new t.b2Vec2(10,0),0),r.CreateFixture2(a,5),a.SetAsOrientedBox(.5,10,new t.b2Vec2(-10,0),0),r.CreateFixture2(a,5),a.SetAsOrientedBox(10,.5,new t.b2Vec2(0,10),0),r.CreateFixture2(a,5),a.SetAsOrientedBox(10,.5,new t.b2Vec2(0,-10),0),r.CreateFixture2(a,5);var l=new t.b2RevoluteJointDef;l.bodyA=n,l.bodyB=r,l.localAnchorA.Set(0,10),l.localAnchorB.Set(0,0),l.referenceAngle=0,l.motorSpeed=.05*t.b2_pi,l.maxMotorTorque=1e8,l.enableMotor=!0,this.m_joint=this.m_world.CreateJoint(l),this.m_count=0},e.inherits(t.Testbed.Tumbler,t.Testbed.Test),t.Testbed.Tumbler.e_count=800,t.Testbed.Tumbler.prototype.m_joint=null,t.Testbed.Tumbler.prototype.m_count=0,t.Testbed.Tumbler.prototype.Step=function(o){if(e.base(this,"Step",o),this.m_count<t.Testbed.Tumbler.e_count){var i=new t.b2BodyDef;i.type=t.b2BodyType.b2_dynamicBody,i.position.Set(0,10);var n=this.m_world.CreateBody(i),s=new t.b2PolygonShape;s.SetAsBox(.125,.125),n.CreateFixture2(s,1),++this.m_count}},t.Testbed.Tumbler.Create=function(e,o){return new t.Testbed.Tumbler(e,o)},t}(o,pt),po=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.VaryingFriction&&(t.Testbed.VaryingFriction={}),t.Testbed.VaryingFriction=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(13,.25);var n=new t.b2BodyDef;n.position.Set(-4,22),n.angle=-.25;var s=this.m_world.CreateBody(n);s.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(.25,1);var n=new t.b2BodyDef;n.position.Set(10.5,19);var s=this.m_world.CreateBody(n);s.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(13,.25);var n=new t.b2BodyDef;n.position.Set(4,14),n.angle=.25;var s=this.m_world.CreateBody(n);s.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(.25,1);var n=new t.b2BodyDef;n.position.Set(-10.5,11);var s=this.m_world.CreateBody(n);s.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(13,.25);var n=new t.b2BodyDef;n.position.Set(-4,6),n.angle=-.25;var s=this.m_world.CreateBody(n);s.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(.5,.5);var a=new t.b2FixtureDef;a.shape=r,a.density=25;for(var l=[.75,.5,.35,.1,0],p=0;5>p;++p){var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(-15+4*p,28);var b=this.m_world.CreateBody(n);a.friction=l[p],b.CreateFixture(a)}},e.inherits(t.Testbed.VaryingFriction,t.Testbed.Test),t.Testbed.VaryingFriction.Create=function(e,o){return new t.Testbed.VaryingFriction(e,o)},t}(o,pt),bo=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.VaryingRestitution&&(t.Testbed.VaryingRestitution={}),t.Testbed.VaryingRestitution=function(o,i){e.base(this,o,i);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0);var r=new t.b2CircleShape;r.m_radius=1;var a=new t.b2FixtureDef;a.shape=r,a.density=1;for(var l=[0,.1,.3,.5,.75,.9,1],p=0;7>p;++p){var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody,n.position.Set(-10+3*p,20);var b=this.m_world.CreateBody(n);a.restitution=l[p],b.CreateFixture(a)}},e.inherits(t.Testbed.VaryingRestitution,t.Testbed.Test),t.Testbed.VaryingRestitution.Create=function(e,o){return new t.Testbed.VaryingRestitution(e,o)},t}(o,pt),mo=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.VerticalStack&&(t.Testbed.VerticalStack={}),t.Testbed.VerticalStack=function(o,i){e.base(this,o,i),this.m_bullet=null,this.m_bodies=new Array(t.Testbed.VerticalStack.e_rowCount*t.Testbed.VerticalStack.e_columnCount),this.m_indices=new Array(t.Testbed.VerticalStack.e_rowCount*t.Testbed.VerticalStack.e_columnCount);var n=new t.b2BodyDef,s=this.m_world.CreateBody(n),r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),s.CreateFixture2(r,0),r.SetAsEdge(new t.b2Vec2(20,0),new t.b2Vec2(20,20)),s.CreateFixture2(r,0);for(var a=[0,-10,-5,5,10],l=0;l<t.Testbed.VerticalStack.e_columnCount;++l){var r=new t.b2PolygonShape;r.SetAsBox(.5,.5);var p=new t.b2FixtureDef;p.shape=r,p.density=1,p.friction=.3;for(var b=0;b<t.Testbed.VerticalStack.e_rowCount;++b){var n=new t.b2BodyDef;n.type=t.b2BodyType.b2_dynamicBody;var m=l*t.Testbed.VerticalStack.e_rowCount+b;t.ENABLE_ASSERTS&&t.b2Assert(m<t.Testbed.VerticalStack.e_rowCount*t.Testbed.VerticalStack.e_columnCount),this.m_indices[m]=m,n.userData=this.m_indices[m];var _=0;n.position.Set(a[l]+_,.752+1.54*b);var d=this.m_world.CreateBody(n);this.m_bodies[m]=d,d.CreateFixture(p)}}},e.inherits(t.Testbed.VerticalStack,t.Testbed.Test),t.Testbed.VerticalStack.e_columnCount=5,t.Testbed.VerticalStack.e_rowCount=16,t.Testbed.VerticalStack.prototype.m_bullet=null,t.Testbed.VerticalStack.prototype.m_bodies=null,t.Testbed.VerticalStack.prototype.m_indices=null,t.Testbed.VerticalStack.prototype.Keyboard=function(o){switch(o){case e.events.KeyCodes.COMMA:this.m_bullet&&(this.m_world.DestroyBody(this.m_bullet),this.m_bullet=null);var i=new t.b2CircleShape;i.m_radius=.25;var n=new t.b2FixtureDef;n.shape=i,n.density=20,n.restitution=.05;var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.bullet=!0,s.position.Set(-31,5),this.m_bullet=this.m_world.CreateBody(s),this.m_bullet.CreateFixture(n),this.m_bullet.SetLinearVelocity(new t.b2Vec2(400,0))}},t.Testbed.VerticalStack.prototype.Step=function(o){e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"Press: (,) to launch a bullet."),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.VerticalStack.Create=function(e,o){return new t.Testbed.VerticalStack(e,o)},t}(o,pt),_o=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Web&&(t.Testbed.Web={}),t.Testbed.Web=function(o,i){e.base(this,o,i),this.m_bodies=new Array(4),this.m_joints=new Array(8);var n=null,s=new t.b2BodyDef;n=this.m_world.CreateBody(s);var r=new t.b2EdgeShape;r.SetAsEdge(new t.b2Vec2(-40,0),new t.b2Vec2(40,0)),n.CreateFixture2(r,0);var r=new t.b2PolygonShape;r.SetAsBox(.5,.5);var s=new t.b2BodyDef;s.type=t.b2BodyType.b2_dynamicBody,s.position.Set(-5,5),this.m_bodies[0]=this.m_world.CreateBody(s),this.m_bodies[0].CreateFixture2(r,5),s.position.Set(5,5),this.m_bodies[1]=this.m_world.CreateBody(s),this.m_bodies[1].CreateFixture2(r,5),s.position.Set(5,15),this.m_bodies[2]=this.m_world.CreateBody(s),this.m_bodies[2].CreateFixture2(r,5),s.position.Set(-5,15),this.m_bodies[3]=this.m_world.CreateBody(s),this.m_bodies[3].CreateFixture2(r,5);var a,l,p,b=new t.b2DistanceJointDef;b.frequencyHz=2,b.dampingRatio=0,b.bodyA=n,b.bodyB=this.m_bodies[0],b.localAnchorA.Set(-10,0),b.localAnchorB.Set(-.5,-.5),a=b.bodyA.GetWorldPoint(b.localAnchorA,new t.b2Vec2),l=b.bodyB.GetWorldPoint(b.localAnchorB,new t.b2Vec2),p=t.b2SubVV(l,a,new t.b2Vec2),b.length=p.GetLength(),this.m_joints[0]=this.m_world.CreateJoint(b),b.bodyA=n,b.bodyB=this.m_bodies[1],b.localAnchorA.Set(10,0),b.localAnchorB.Set(.5,-.5),a=b.bodyA.GetWorldPoint(b.localAnchorA,new t.b2Vec2),l=b.bodyB.GetWorldPoint(b.localAnchorB,new t.b2Vec2),p=t.b2SubVV(l,a,new t.b2Vec2),b.length=p.GetLength(),this.m_joints[1]=this.m_world.CreateJoint(b),b.bodyA=n,b.bodyB=this.m_bodies[2],b.localAnchorA.Set(10,20),b.localAnchorB.Set(.5,.5),a=b.bodyA.GetWorldPoint(b.localAnchorA,new t.b2Vec2),l=b.bodyB.GetWorldPoint(b.localAnchorB,new t.b2Vec2),p=t.b2SubVV(l,a,new t.b2Vec2),b.length=p.GetLength(),this.m_joints[2]=this.m_world.CreateJoint(b),b.bodyA=n,b.bodyB=this.m_bodies[3],b.localAnchorA.Set(-10,20),b.localAnchorB.Set(-.5,.5),a=b.bodyA.GetWorldPoint(b.localAnchorA,new t.b2Vec2),l=b.bodyB.GetWorldPoint(b.localAnchorB,new t.b2Vec2),p=t.b2SubVV(l,a,new t.b2Vec2),b.length=p.GetLength(),this.m_joints[3]=this.m_world.CreateJoint(b),b.bodyA=this.m_bodies[0],b.bodyB=this.m_bodies[1],b.localAnchorA.Set(.5,0),b.localAnchorB.Set(-.5,0),a=b.bodyA.GetWorldPoint(b.localAnchorA,new t.b2Vec2),l=b.bodyB.GetWorldPoint(b.localAnchorB,new t.b2Vec2),p=t.b2SubVV(l,a,new t.b2Vec2),b.length=p.GetLength(),this.m_joints[4]=this.m_world.CreateJoint(b),b.bodyA=this.m_bodies[1],b.bodyB=this.m_bodies[2],b.localAnchorA.Set(0,.5),b.localAnchorB.Set(0,-.5),a=b.bodyA.GetWorldPoint(b.localAnchorA,new t.b2Vec2),l=b.bodyB.GetWorldPoint(b.localAnchorB,new t.b2Vec2),p=t.b2SubVV(l,a,new t.b2Vec2),b.length=p.GetLength(),this.m_joints[5]=this.m_world.CreateJoint(b),b.bodyA=this.m_bodies[2],b.bodyB=this.m_bodies[3],b.localAnchorA.Set(-.5,0),b.localAnchorB.Set(.5,0),a=b.bodyA.GetWorldPoint(b.localAnchorA,new t.b2Vec2),l=b.bodyB.GetWorldPoint(b.localAnchorB,new t.b2Vec2),p=t.b2SubVV(l,a,new t.b2Vec2),b.length=p.GetLength(),this.m_joints[6]=this.m_world.CreateJoint(b),b.bodyA=this.m_bodies[3],b.bodyB=this.m_bodies[0],b.localAnchorA.Set(0,-.5),b.localAnchorB.Set(0,.5),a=b.bodyA.GetWorldPoint(b.localAnchorA,new t.b2Vec2),l=b.bodyB.GetWorldPoint(b.localAnchorB,new t.b2Vec2),p=t.b2SubVV(l,a,new t.b2Vec2),b.length=p.GetLength(),this.m_joints[7]=this.m_world.CreateJoint(b)},e.inherits(t.Testbed.Web,t.Testbed.Test),t.Testbed.Web.prototype.m_bodies=null,t.Testbed.Web.prototype.m_joints=null,t.Testbed.Web.prototype.Keyboard=function(t){switch(t){case e.events.KeyCodes.B:for(var o=0;4>o;++o)if(this.m_bodies[o]){this.m_world.DestroyBody(this.m_bodies[o]),this.m_bodies[o]=null;break}break;case e.events.KeyCodes.J:for(var o=0;8>o;++o)if(this.m_joints[o]){this.m_world.DestroyJoint(this.m_joints[o]),this.m_joints[o]=null;break}}},t.Testbed.Web.prototype.Step=function(o){e.base(this,"Step",o),this.m_debugDraw.DrawString(5,this.m_textLine,"This demonstrates a soft distance joint."),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE,this.m_debugDraw.DrawString(5,this.m_textLine,"Press: (b) to delete a body, (j) to delete a joint"),this.m_textLine+=t.Testbed.DRAW_STRING_NEW_LINE},t.Testbed.Web.prototype.JointDestroyed=function(e){for(var t=0;8>t;++t)if(this.m_joints[t]==e){this.m_joints[t]=null;break}},t.Testbed.Web.Create=function(e,o){return new t.Testbed.Web(e,o)},t}(o,pt),ho=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.TestEntries&&(t.Testbed.TestEntries={}),t.Testbed.GetTestEntries=function(e){return e.push(new t.Testbed.TestEntry("Convex Hull",t.Testbed.ConvexHull.Create)),e.push(new t.Testbed.TestEntry("Apply Force",t.Testbed.ApplyForce.Create)),e.push(new t.Testbed.TestEntry("Continuous Test",t.Testbed.ContinuousTest.Create)),e.push(new t.Testbed.TestEntry("Time of Impact",t.Testbed.TimeOfImpact.Create)),e.push(new t.Testbed.TestEntry("Motor Joint",t.Testbed.MotorJoint.Create)),e.push(new t.Testbed.TestEntry("Mobile",t.Testbed.Mobile.Create)),e.push(new t.Testbed.TestEntry("MobileBalanced",t.Testbed.MobileBalanced.Create)),e.push(new t.Testbed.TestEntry("Ray-Cast",t.Testbed.RayCast.Create)),e.push(new t.Testbed.TestEntry("Conveyor Belt",t.Testbed.ConveyorBelt.Create)),e.push(new t.Testbed.TestEntry("Gears",t.Testbed.Gears.Create)),e.push(new t.Testbed.TestEntry("Varying Restitution",t.Testbed.VaryingRestitution.Create)),e.push(new t.Testbed.TestEntry("Tumbler",t.Testbed.Tumbler.Create)),e.push(new t.Testbed.TestEntry("Tiles",t.Testbed.Tiles.Create)),e.push(new t.Testbed.TestEntry("Dump Shell",t.Testbed.DumpShell.Create)),e.push(new t.Testbed.TestEntry("Cantilever",t.Testbed.Cantilever.Create)),e.push(new t.Testbed.TestEntry("Character Collision",t.Testbed.CharacterCollision.Create)),e.push(new t.Testbed.TestEntry("Edge Test",t.Testbed.EdgeTest.Create)),e.push(new t.Testbed.TestEntry("Body Types",t.Testbed.BodyTypes.Create)),e.push(new t.Testbed.TestEntry("Shape Editing",t.Testbed.ShapeEditing.Create)),e.push(new t.Testbed.TestEntry("Car",t.Testbed.Car.Create)),e.push(new t.Testbed.TestEntry("Prismatic",t.Testbed.Prismatic.Create)),e.push(new t.Testbed.TestEntry("Vertical Stack",t.Testbed.VerticalStack.Create)),e.push(new t.Testbed.TestEntry("SphereStack",t.Testbed.SphereStack.Create)),e.push(new t.Testbed.TestEntry("Revolute",t.Testbed.Revolute.Create)),e.push(new t.Testbed.TestEntry("Pulleys",t.Testbed.Pulleys.Create)),e.push(new t.Testbed.TestEntry("Polygon Shapes",t.Testbed.PolyShapes.Create)),e.push(new t.Testbed.TestEntry("Rope",t.Testbed.Rope.Create)),e.push(new t.Testbed.TestEntry("Web",t.Testbed.Web.Create)),e.push(new t.Testbed.TestEntry("RopeJoint",t.Testbed.RopeJoint.Create)),e.push(new t.Testbed.TestEntry("One-Sided Platform",t.Testbed.OneSidedPlatform.Create)),e.push(new t.Testbed.TestEntry("Pinball",t.Testbed.Pinball.Create)),e.push(new t.Testbed.TestEntry("Bullet Test",t.Testbed.BulletTest.Create)),e.push(new t.Testbed.TestEntry("Confined",t.Testbed.Confined.Create)),e.push(new t.Testbed.TestEntry("Pyramid",t.Testbed.Pyramid.Create)),e.push(new t.Testbed.TestEntry("Theo Jansen's Walker",t.Testbed.TheoJansen.Create)),e.push(new t.Testbed.TestEntry("Edge Shapes",t.Testbed.EdgeShapes.Create)),e.push(new t.Testbed.TestEntry("PolyCollision",t.Testbed.PolyCollision.Create)),e.push(new t.Testbed.TestEntry("Bridge",t.Testbed.Bridge.Create)),e.push(new t.Testbed.TestEntry("Breakable",t.Testbed.Breakable.Create)),e.push(new t.Testbed.TestEntry("Chain",t.Testbed.Chain.Create)),e.push(new t.Testbed.TestEntry("Collision Filtering",t.Testbed.CollisionFiltering.Create)),e.push(new t.Testbed.TestEntry("Collision Processing",t.Testbed.CollisionProcessing.Create)),e.push(new t.Testbed.TestEntry("Compound Shapes",t.Testbed.CompoundShapes.Create)),e.push(new t.Testbed.TestEntry("Distance Test",t.Testbed.DistanceTest.Create)),e.push(new t.Testbed.TestEntry("Dominos",t.Testbed.Dominos.Create)),e.push(new t.Testbed.TestEntry("Dynamic Tree",t.Testbed.DynamicTreeTest.Create)),e.push(new t.Testbed.TestEntry("Sensor Test",t.Testbed.SensorTest.Create)),e.push(new t.Testbed.TestEntry("Slider Crank",t.Testbed.SliderCrank.Create)),e.push(new t.Testbed.TestEntry("Varying Friction",t.Testbed.VaryingFriction.Create)),e.push(new t.Testbed.TestEntry("Add Pair Stress Test",t.Testbed.AddPair.Create)),e.push(new t.Testbed.TestEntry("Blob Test",t.Testbed.BlobTest.Create)),e.push(new t.Testbed.TestEntry("Buoyancy Test",t.Testbed.BuoyancyTest.Create)),e.push(new t.Testbed.TestEntry("Continuous Collision",t.Testbed.TestCCD.Create)),e.push(new t.Testbed.TestEntry("Ragdolls",t.Testbed.TestRagdoll.Create)),e.push(new t.Testbed.TestEntry("Stacked Boxes",t.Testbed.TestStack.Create)),e},t}(o,bt,dt,ht,ct,ut,yt,ft,St,Ct,vt,At,gt,wt,xt,Bt,Vt,Tt,Mt,Dt,Et,Pt,Rt,It,Jt,Lt,Ft,Gt,Nt,kt,Ot,Wt,zt,qt,Kt,jt,Ut,Ht,Xt,Zt,Yt,Qt,$t,eo,to,pt,oo,io,no,so,ro,ao,lo,po,bo,mo,_o),co=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.events&&(e.events={}),"undefined"==typeof e.events.BrowserFeature&&(e.events.BrowserFeature={}),e.events.BrowserFeature={HAS_W3C_BUTTON:!e.userAgent.IE||e.userAgent.isDocumentModeOrHigher(9),HAS_W3C_EVENT_SUPPORT:!e.userAgent.IE||e.userAgent.isDocumentModeOrHigher(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:e.userAgent.IE&&!e.userAgent.isVersionOrHigher("9"),HAS_NAVIGATOR_ONLINE_PROPERTY:!e.userAgent.WEBKIT||e.userAgent.isVersionOrHigher("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:e.userAgent.GECKO&&e.userAgent.isVersionOrHigher("1.9b")||e.userAgent.IE&&e.userAgent.isVersionOrHigher("8")||e.userAgent.OPERA&&e.userAgent.isVersionOrHigher("9.5")||e.userAgent.WEBKIT&&e.userAgent.isVersionOrHigher("528"),HTML5_NETWORK_EVENTS_FIRE_ON_BODY:e.userAgent.GECKO&&!e.userAgent.isVersionOrHigher("8")||e.userAgent.IE&&!e.userAgent.isVersionOrHigher("9"),TOUCH_ENABLED:"ontouchstart"in e.global||!!(e.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!e.global.navigator||!e.global.navigator.msMaxTouchPoints)},e}(mt),uo=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.events&&(e.events={}),"undefined"==typeof e.events.EventId&&(e.events.EventId={}),e.events.EventId=function(e){this.id=e},e.events.EventId.prototype.toString=function(){return this.id},e}(o),yo=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.events&&(e.events={}),"undefined"==typeof e.events.Event&&(e.events.Event={}),"undefined"==typeof e&&(e={}),"undefined"==typeof e.events&&(e.events={}),"undefined"==typeof e.events.EventLike&&(e.events.EventLike={}),e.events.EventLike,e.events.Event=function(t,o){this.type=t instanceof e.events.EventId?String(t):t,this.target=o,this.currentTarget=this.target},e.events.Event.prototype.disposeInternal=function(){},e.events.Event.prototype.dispose=function(){},e.events.Event.prototype.propagationStopped_=!1,e.events.Event.prototype.defaultPrevented=!1,e.events.Event.prototype.returnValue_=!0,e.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=!0},e.events.Event.prototype.preventDefault=function(){this.defaultPrevented=!0,this.returnValue_=!1},e.events.Event.stopPropagation=function(e){e.stopPropagation()},e.events.Event.preventDefault=function(e){e.preventDefault()},e}(uo),fo=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.events&&(e.events={}),"undefined"==typeof e.events.EventType&&(e.events.EventType={}),e.events.getVendorPrefixedName_=function(t){return e.userAgent.WEBKIT?"webkit"+t:e.userAgent.OPERA?"o"+t.toLowerCase():t.toLowerCase()},e.events.EventType={CLICK:"click",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",SELECTSTART:"selectstart",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:e.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:e.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",DRAG:"drag",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",DRAGEND:"dragend",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",BEFOREUNLOAD:"beforeunload",CONSOLEMESSAGE:"consolemessage",CONTEXTMENU:"contextmenu",DOMCONTENTLOADED:"DOMContentLoaded",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",ORIENTATIONCHANGE:"orientationchange",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",BEFOREPASTE:"beforepaste",ONLINE:"online",OFFLINE:"offline",MESSAGE:"message",CONNECT:"connect",ANIMATIONSTART:e.events.getVendorPrefixedName_("AnimationStart"),ANIMATIONEND:e.events.getVendorPrefixedName_("AnimationEnd"),ANIMATIONITERATION:e.events.getVendorPrefixedName_("AnimationIteration"),TRANSITIONEND:e.events.getVendorPrefixedName_("TransitionEnd"),POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTERCANCEL:"pointercancel",POINTERMOVE:"pointermove",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",GOTPOINTERCAPTURE:"gotpointercapture",LOSTPOINTERCAPTURE:"lostpointercapture",MSGESTURECHANGE:"MSGestureChange",MSGESTUREEND:"MSGestureEnd",MSGESTUREHOLD:"MSGestureHold",MSGESTURESTART:"MSGestureStart",MSGESTURETAP:"MSGestureTap",MSGOTPOINTERCAPTURE:"MSGotPointerCapture",MSINERTIASTART:"MSInertiaStart",MSLOSTPOINTERCAPTURE:"MSLostPointerCapture",MSPOINTERCANCEL:"MSPointerCancel",MSPOINTERDOWN:"MSPointerDown",MSPOINTERENTER:"MSPointerEnter",MSPOINTERHOVER:"MSPointerHover",MSPOINTERLEAVE:"MSPointerLeave",MSPOINTERMOVE:"MSPointerMove",MSPOINTEROUT:"MSPointerOut",MSPOINTEROVER:"MSPointerOver",MSPOINTERUP:"MSPointerUp",TEXTINPUT:"textinput",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",EXIT:"exit",LOADABORT:"loadabort",LOADCOMMIT:"loadcommit",LOADREDIRECT:"loadredirect",LOADSTART:"loadstart",LOADSTOP:"loadstop",RESPONSIVE:"responsive",SIZECHANGED:"sizechanged",UNRESPONSIVE:"unresponsive",VISIBILITYCHANGE:"visibilitychange"},e}(mt),So=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.reflect&&(e.reflect={}),e.reflect.object=function(e,t){return t},e.reflect.sinkValue=function(t){return e.reflect.sinkValue[" "](t),t},e.reflect.sinkValue[" "]=e.nullFunction,e.reflect.canAccessProperty=function(t,o){try{return e.reflect.sinkValue(t[o]),!0}catch(i){}return!1},e}(o),Co=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.events&&(e.events={}),"undefined"==typeof e.events.BrowserEvent&&(e.events.BrowserEvent={}),"undefined"==typeof e&&(e={}),"undefined"==typeof e.events&&(e.events={}),"undefined"==typeof e.events.BrowserEvent&&(e.events.BrowserEvent={}),"undefined"==typeof e.events.BrowserEvent.MouseButton&&(e.events.BrowserEvent.MouseButton={}),e.events.BrowserEvent=function(e,t){e&&this.init(e,t)},e.inherits(e.events.BrowserEvent,e.events.Event),e.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2},e.events.BrowserEvent.IEButtonMap=[1,4,2],e.events.BrowserEvent.prototype.target=null,e.events.BrowserEvent.prototype.currentTarget,e.events.BrowserEvent.prototype.relatedTarget=null,e.events.BrowserEvent.prototype.offsetX=0,e.events.BrowserEvent.prototype.offsetY=0,e.events.BrowserEvent.prototype.clientX=0,e.events.BrowserEvent.prototype.clientY=0,e.events.BrowserEvent.prototype.screenX=0,e.events.BrowserEvent.prototype.screenY=0,e.events.BrowserEvent.prototype.button=0,e.events.BrowserEvent.prototype.keyCode=0,e.events.BrowserEvent.prototype.charCode=0,e.events.BrowserEvent.prototype.ctrlKey=!1,e.events.BrowserEvent.prototype.altKey=!1,e.events.BrowserEvent.prototype.shiftKey=!1,e.events.BrowserEvent.prototype.metaKey=!1,e.events.BrowserEvent.prototype.state,e.events.BrowserEvent.prototype.platformModifierKey=!1,e.events.BrowserEvent.prototype.event_=null,e.events.BrowserEvent.prototype.init=function(t,o){var i=this.type=t.type;e.events.Event.call(this,i),this.target=t.target||t.srcElement,this.currentTarget=o;var n=t.relatedTarget;n?e.userAgent.GECKO&&(e.reflect.canAccessProperty(n,"nodeName")||(n=null)):i==e.events.EventType.MOUSEOVER?n=t.fromElement:i==e.events.EventType.MOUSEOUT&&(n=t.toElement),this.relatedTarget=n,this.offsetX=e.userAgent.WEBKIT||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=e.userAgent.WEBKIT||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0,this.button=t.button,this.keyCode=t.keyCode||0,this.charCode=t.charCode||("keypress"==i?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.platformModifierKey=e.userAgent.MAC?t.metaKey:t.ctrlKey,this.state=t.state,this.event_=t,t.defaultPrevented&&this.preventDefault(),delete this.propagationStopped_},e.events.BrowserEvent.prototype.isButton=function(t){return e.events.BrowserFeature.HAS_W3C_BUTTON?this.event_.button==t:"click"==this.type?t==e.events.BrowserEvent.MouseButton.LEFT:!!(this.event_.button&e.events.BrowserEvent.IEButtonMap[t])},e.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(e.events.BrowserEvent.MouseButton.LEFT)&&!(e.userAgent.WEBKIT&&e.userAgent.MAC&&this.ctrlKey)},e.events.BrowserEvent.prototype.stopPropagation=function(){e.events.BrowserEvent.superClass_.stopPropagation.call(this),this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0},e.events.BrowserEvent.prototype.preventDefault=function(){e.events.BrowserEvent.superClass_.preventDefault.call(this);var t=this.event_;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,e.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{var o=112,i=123;(t.ctrlKey||t.keyCode>=o&&t.keyCode<=i)&&(t.keyCode=-1)}catch(n){}},e.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_},e.events.BrowserEvent.prototype.disposeInternal=function(){},e}(co,yo,fo,So,mt),vo=function(e,t){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.Testbed&&(t.Testbed={}),"undefined"==typeof t.Testbed.Main&&(t.Testbed.Main={}),t.Testbed.Main=function(){var o=this,i=this.m_fps_div=document.body.appendChild(document.createElement("div"));i.style.position="absolute",i.style.left="0px",i.style.bottom="0px",i.style.backgroundColor="rgba(0,0,255,0.75)",i.style.color="white",i.style.font="10pt Courier New",i.style.zIndex=256,i.innerHTML="FPS";var n=this.m_debug_div=document.body.appendChild(document.createElement("div"));n.style.position="absolute",n.style.left="0px",n.style.bottom="0px",n.style.backgroundColor="rgba(0,0,255,0.75)",n.style.color="white",n.style.font="10pt Courier New",n.style.zIndex=256,n.innerHTML="",this.m_settings=new t.Testbed.Settings,this.m_test_entries=t.Testbed.GetTestEntries(new Array),this.m_projection0=new t.b2Vec2,this.m_viewCenter0=new t.b2Vec2,document.body.style.backgroundColor="black";var s=document.body.appendChild(document.createElement("div"));s.style.position="absolute",s.style.left="0px",s.style.top="0px";var r=function(){s.style.width=window.innerWidth+"px",s.style.height=window.innerHeight+"px"};window.addEventListener("resize",function(){r()},!1),window.addEventListener("orientationchange",function(){r()},!1),r();var a=s.appendChild(document.createElement("div"));a.style.textAlign="center",a.style.color="grey",a.innerHTML="Box2D Testbed version "+t.b2_version+" (revision "+t.b2_changelist+")";var l=s.appendChild(document.createElement("div")),p=this.m_canvas_div=l.appendChild(document.createElement("div"));p.style.position="absolute",p.style.left="0px",p.style.right="0px",p.style.top="0px",p.style.bottom="0px";var b=this.m_canvas=p.appendChild(document.createElement("canvas")),m=function(){b.width!=b.parentNode.clientWidth&&(b.width=b.parentNode.clientWidth),b.height!=b.parentNode.clientHeight&&(b.height=b.parentNode.clientHeight)};window.addEventListener("resize",function(){m()},!1),window.addEventListener("orientationchange",function(){m()},!1),m(),this.m_ctx=this.m_canvas.getContext("2d");var _=l.appendChild(document.createElement("div"));_.style.position="absolute",_.style.backgroundColor="rgba(255,255,255,0.5)",_.style.padding="8px",_.style.right="0px",_.style.top="0px",_.style.bottom="0px",_.style.overflowY="scroll",_.appendChild(document.createTextNode("Tests")),_.appendChild(document.createElement("br"));var d=document.createElement("select");d.id="testEntries";for(var h=0;h<this.m_test_entries.length;++h){var c=document.createElement("option");c.text=this.m_test_entries[h].name,c.value=h,d.add(c,null)}d.selectedIndex=this.m_test_index,d.addEventListener("change",function(){o.m_test_index=this.selectedIndex,o.LoadTest()},!1),_.appendChild(d),_.appendChild(document.createElement("br")),_.appendChild(document.createElement("hr"));var u,y=function(t,i,n,s,r,a){var l=t.appendChild(document.createElement("tr")),p=l.appendChild(document.createElement("td"));p.align="right",p.appendChild(document.createTextNode(i));var b=l.appendChild(document.createElement("td")),m=document.createElement("input");return e.userAgent.IE||(m.type="number"),m.size=8,m.min=s||1,m.max=r||100,m.step=a||1,m.value=o.m_settings[n],m.addEventListener("change",function(){o.m_settings[n]=parseInt(this.value,10)},!1),b.appendChild(m),m},f=_.appendChild(document.createElement("table"));u=y(f,"Vel Iters","velocityIterations",1,20,1),u=y(f,"Pos Iters","positionIterations",1,20,1),u=y(f,"Hertz","hz",10,120,1);var S,C=function(e,t,i){var n=document.createElement("input");return n.type="checkbox",n.checked=o.m_settings[i],n.addEventListener("click",function(){o.m_settings[i]=this.checked},!1),e.appendChild(n),e.appendChild(document.createTextNode(t)),e.appendChild(document.createElement("br")),n};S=C(_,"Sleep","enableSleep"),S=C(_,"Warm Starting","enableWarmStarting"),S=C(_,"Time of Impact","enableContinuous"),S=C(_,"Sub-Stepping","enableSubStepping");var v=_.appendChild(document.createElement("fieldset")),A=v.appendChild(document.createElement("legend"));A.appendChild(document.createTextNode("Draw")),S=C(v,"Shapes","drawShapes"),S=C(v,"Joints","drawJoints"),S=C(v,"AABBs","drawAABBs"),S=C(v,"Contact Points","drawContactPoints"),S=C(v,"Contact Normals","drawContactNormals"),S=C(v,"Contact Impulses","drawContactImpulse"),S=C(v,"Friction Impulses","drawFrictionImpulse"),S=C(v,"Center of Masses","drawCOMs"),S=C(v,"Statistics","drawStats"),S=C(v,"Profile","drawProfile");
var g=function(e,t,o){var i=document.createElement("input");return i.type="button",i.style.width=100,i.value=t,i.addEventListener("click",o,!1),e.appendChild(i),e.appendChild(document.createElement("br")),i},w=_.appendChild(document.createElement("div"));w.align="center";var x;x=g(w,"Pause",function(){o.Pause()}),x=g(w,"Step",function(){o.SingleStep()}),x=g(w,"Restart",function(){o.LoadTest()}),x=g(w,"Demo",function(){o.ToggleDemo()}),this.m_demo_button=x,window.addEventListener("contextmenu",function(e){e.preventDefault()},!0),p.addEventListener("mousemove",function(e){o.HandleMouseMove(e)},!1),p.addEventListener("mousedown",function(e){o.HandleMouseDown(e)},!1),p.addEventListener("mouseup",function(e){o.HandleMouseUp(e)},!1),p.addEventListener("mousewheel",function(e){o.HandleMouseWheel(e)},!1),p.addEventListener("touchmove",function(e){o.HandleTouchMove(e)},!1),p.addEventListener("touchstart",function(e){o.HandleTouchStart(e)},!1),p.addEventListener("touchend",function(e){o.HandleTouchEnd(e)},!1),window.addEventListener("keydown",function(e){o.HandleKeyDown(e)},!1),window.addEventListener("keyup",function(e){o.HandleKeyUp(e)},!1),this.LoadTest(),this.m_time_last=(new Date).getTime()},t.Testbed.Main.prototype.m_time_last=0,t.Testbed.Main.prototype.m_fps_time=0,t.Testbed.Main.prototype.m_fps_frames=0,t.Testbed.Main.prototype.m_fps=0,t.Testbed.Main.prototype.m_fps_div=null,t.Testbed.Main.prototype.m_debug_div=null,t.Testbed.Main.prototype.m_settings=null,t.Testbed.Main.prototype.m_test=null,t.Testbed.Main.prototype.m_test_index=0,t.Testbed.Main.prototype.m_test_entries=null,t.Testbed.Main.prototype.m_shift=0,t.Testbed.Main.prototype.m_ctrl=0,t.Testbed.Main.prototype.m_rMouseDown=!1,t.Testbed.Main.prototype.m_projection0=null,t.Testbed.Main.prototype.m_viewCenter0=null,t.Testbed.Main.prototype.m_demo_mode=!1,t.Testbed.Main.prototype.m_demo_time=0,t.Testbed.Main.prototype.m_max_demo_time=1e4,t.Testbed.Main.prototype.m_canvas_div=null,t.Testbed.Main.prototype.m_canvas=null,t.Testbed.Main.prototype.m_ctx=null,t.Testbed.Main.prototype.m_demo_button=null,t.Testbed.Main.prototype.ConvertViewportToElement=function(e,t){var o=this.m_canvas_div.getBoundingClientRect(),i=+e.x+o.left+.5*o.width,n=-e.y+o.top+.5*o.height,s=t.Set(i,n);return s},t.Testbed.Main.prototype.ConvertElementToViewport=function(e,t){var o=this.m_canvas_div.getBoundingClientRect(),i=+(e.x-o.left-.5*o.width),n=-(e.y-o.top-.5*o.height),s=t.Set(i,n);return s},t.Testbed.Main.prototype.ConvertProjectionToViewport=function(e,o){var i=o.Copy(e);return t.b2MulSV(this.m_settings.viewZoom,i,i),t.b2MulSV(this.m_settings.canvasScale,i,i),i},t.Testbed.Main.prototype.ConvertViewportToProjection=function(e,o){var i=o.Copy(e);return t.b2MulSV(1/this.m_settings.canvasScale,i,i),t.b2MulSV(1/this.m_settings.viewZoom,i,i),i},t.Testbed.Main.prototype.ConvertWorldToProjection=function(e,o){var i=o.Copy(e);return t.b2SubVV(i,this.m_settings.viewCenter,i),t.b2MulTRV(this.m_settings.viewRotation,i,i),i},t.Testbed.Main.prototype.ConvertProjectionToWorld=function(e,o){var i=o.Copy(e);return t.b2MulRV(this.m_settings.viewRotation,i,i),t.b2AddVV(this.m_settings.viewCenter,i,i),i},t.Testbed.Main.prototype.ConvertElementToWorld=function(e,t){var o=this.ConvertElementToViewport(e,t),i=this.ConvertViewportToProjection(o,t);return this.ConvertProjectionToWorld(i,t)},t.Testbed.Main.prototype.ConvertElementToProjection=function(e,t){var o=this.ConvertElementToViewport(e,t);return this.ConvertViewportToProjection(o,t)},t.Testbed.Main.prototype.MoveCamera=function(e){var t=this.m_settings.viewCenter.Clone(),o=this.m_settings.viewRotation.Clone();e.SelfRotateRadians(o.GetAngleRadians()),t.SelfAdd(e),this.m_settings.viewCenter.Copy(t)},t.Testbed.Main.prototype.RollCamera=function(e){var t=this.m_settings.viewRotation.GetAngleRadians();this.m_settings.viewRotation.SetAngleRadians(t+e)},t.Testbed.Main.prototype.ZoomCamera=function(e){this.m_settings.viewZoom*=e,this.m_settings.viewZoom=t.b2Clamp(this.m_settings.viewZoom,.02,200)},t.Testbed.Main.prototype.HomeCamera=function(){this.m_settings.viewCenter.Set(0,20),this.m_settings.viewRotation.SetAngleRadians(t.b2DegToRad(0)),this.m_settings.viewZoom=1},t.Testbed.Main.prototype.HandleMouseMove=function(e){var o=new t.b2Vec2(e.clientX,e.clientY),i=this.ConvertElementToWorld(o,new t.b2Vec2);if(this.m_test.MouseMove(i),this.m_rMouseDown){var n=this.ConvertElementToProjection(o,new t.b2Vec2),s=t.b2SubVV(n,this.m_projection0,new t.b2Vec2),r=t.b2SubVV(this.m_viewCenter0,s,new t.b2Vec2);this.m_settings.viewCenter.Copy(r)}},t.Testbed.Main.prototype.HandleMouseDown=function(e){var o=new t.b2Vec2(e.clientX,e.clientY),i=this.ConvertElementToWorld(o,new t.b2Vec2);switch(e.which){case 1:0==this.m_shift?this.m_test.MouseDown(i):this.m_test.ShiftMouseDown(i);break;case 3:var n=this.ConvertElementToProjection(o,new t.b2Vec2);this.m_projection0.Copy(n),this.m_viewCenter0.Copy(this.m_settings.viewCenter),this.m_rMouseDown=!0}},t.Testbed.Main.prototype.HandleMouseUp=function(e){var o=new t.b2Vec2(e.clientX,e.clientY),i=this.ConvertElementToWorld(o,new t.b2Vec2);switch(e.which){case 1:this.m_test.MouseUp(i);break;case 3:this.m_rMouseDown=!1}},t.Testbed.Main.prototype.HandleTouchMove=function(e){var o=new t.b2Vec2(e.touches[0].clientX,e.touches[0].clientY),i=this.ConvertElementToWorld(o,new t.b2Vec2);this.m_test.MouseMove(i),e.preventDefault()},t.Testbed.Main.prototype.HandleTouchStart=function(e){var o=new t.b2Vec2(e.touches[0].clientX,e.touches[0].clientY),i=this.ConvertElementToWorld(o,new t.b2Vec2);this.m_test.MouseDown(i),e.preventDefault()},t.Testbed.Main.prototype.HandleTouchEnd=function(e){this.m_test.MouseUp(this.m_test.m_mouseWorld),e.preventDefault()},t.Testbed.Main.prototype.HandleMouseWheel=function(e){e.wheelDelta>0?this.ZoomCamera(1.1):e.wheelDelta<0&&this.ZoomCamera(1/1.1),e.preventDefault()},t.Testbed.Main.prototype.HandleKeyDown=function(o){switch(o.keyCode){case e.events.KeyCodes.CTRL:this.m_ctrl=1;break;case e.events.KeyCodes.SHIFT:this.m_shift=1;break;case e.events.KeyCodes.LEFT:this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new t.b2Vec2(2,0)):this.MoveCamera(new t.b2Vec2(-.5,0));break;case e.events.KeyCodes.RIGHT:this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new t.b2Vec2(-2,0)):this.MoveCamera(new t.b2Vec2(.5,0));break;case e.events.KeyCodes.DOWN:this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new t.b2Vec2(0,2)):this.MoveCamera(new t.b2Vec2(0,-.5));break;case e.events.KeyCodes.UP:this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new t.b2Vec2(0,-2)):this.MoveCamera(new t.b2Vec2(0,.5));break;case e.events.KeyCodes.PAGE_DOWN:this.RollCamera(t.b2DegToRad(-1));break;case e.events.KeyCodes.PAGE_UP:this.RollCamera(t.b2DegToRad(1));break;case e.events.KeyCodes.Z:this.ZoomCamera(1.1);break;case e.events.KeyCodes.X:this.ZoomCamera(1/1.1);break;case e.events.KeyCodes.HOME:this.HomeCamera();break;case e.events.KeyCodes.R:this.LoadTest();break;case e.events.KeyCodes.SPACE:this.m_test&&this.m_test.LaunchBomb();break;case e.events.KeyCodes.P:this.Pause();break;case e.events.KeyCodes.PERIOD:this.SingleStep();break;case e.events.KeyCodes.OPEN_SQUARE_BRACKET:this.DecrementTest();break;case e.events.KeyCodes.CLOSE_SQUARE_BRACKET:this.IncrementTest()}this.m_test&&this.m_test.Keyboard(o.keyCode)},t.Testbed.Main.prototype.HandleKeyUp=function(t){switch(t.keyCode){case e.events.KeyCodes.CTRL:this.m_ctrl=0;break;case e.events.KeyCodes.SHIFT:this.m_shift=0}this.m_test&&this.m_test.KeyboardUp(t.keyCode)},t.Testbed.Main.prototype.UpdateTest=function(e){if(this.m_demo_mode){this.m_demo_time+=e,this.m_demo_time>this.m_max_demo_time&&this.IncrementTest();var t=((500+this.m_max_demo_time-this.m_demo_time)/1e3).toFixed(0).toString();this.m_demo_button.value=t}else this.m_demo_button.value="Demo"},t.Testbed.Main.prototype.DecrementTest=function(){this.m_test_index<=0&&(this.m_test_index=this.m_test_entries.length),this.m_test_index--,document.getElementById("testEntries").selectedIndex=this.m_test_index,this.LoadTest()},t.Testbed.Main.prototype.IncrementTest=function(){this.m_test_index++,this.m_test_index>=this.m_test_entries.length&&(this.m_test_index=0),document.getElementById("testEntries").selectedIndex=this.m_test_index,this.LoadTest()},t.Testbed.Main.prototype.LoadTest=function(){this.m_demo_time=0,this.m_test=this.m_test_entries[this.m_test_index].createFcn(this.m_canvas,this.m_settings),this.HomeCamera()},t.Testbed.Main.prototype.Pause=function(){this.m_settings.pause=!this.m_settings.pause},t.Testbed.Main.prototype.SingleStep=function(){this.m_settings.pause=!0,this.m_settings.singleStep=!0},t.Testbed.Main.prototype.ToggleDemo=function(){this.m_demo_mode=!this.m_demo_mode},t.Testbed.Main.prototype.SimulationLoop=function(){var e=(new Date).getTime();this.m_time_last=this.m_time_last||e;var o=e-this.m_time_last;if(this.m_time_last=e,o>1e3&&(o=1e3),this.m_fps_time+=o,this.m_fps_frames++,this.m_fps_time>=500&&(this.m_fps=1e3*this.m_fps_frames/this.m_fps_time,this.m_fps_frames=0,this.m_fps_time=0,this.m_fps_div.innerHTML=this.m_fps.toFixed(1).toString()),o>0){var i=this.m_ctx,n=this.m_canvas.width,s=this.m_canvas.height;i.clearRect(0,0,n,s),i.save(),i.translate(.5*n,.5*s),i.scale(1,-1),i.scale(this.m_settings.canvasScale,this.m_settings.canvasScale),i.lineWidth/=this.m_settings.canvasScale,i.scale(this.m_settings.viewZoom,this.m_settings.viewZoom),i.lineWidth/=this.m_settings.viewZoom,i.rotate(-this.m_settings.viewRotation.GetAngleRadians()),i.translate(-this.m_settings.viewCenter.x,-this.m_settings.viewCenter.y);var r=this.m_settings.hz;this.m_settings.hz=t.b2Max(1e3/o,r),this.m_test.Step(this.m_settings),this.m_settings.hz=r,this.m_test.DrawTitle(this.m_test_entries[this.m_test_index].name),i.restore(),this.UpdateTest(o)}},t}(o,pt,ho,Co,_t);!function(e){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.start&&(t.start={}),t.m_app=null,t.start=function(){t.m_app=new e.Testbed.Main,t.loop()},t.loop=function(){requestAnimationFrame(t.loop),t.m_app.SimulationLoop()},t}(vo)}"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof window&&(window.main=t)}();